/*!
* Data Aquarium Framework - If This Then That + Kiosk UI
* Copyright 2020 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function b(n,t,i){var r=n.id;return r||(r=n.id="flow"+uf++),t=r+"_"+t,arguments.length<3?wr[t]:wr[t]=i}function dr(n,t,i){var r=b(n,t);return r==null&&(r=i,b(n,t,r)),r}function d(t,i,r){n.notify(arguments.length>1?{text:t,force:i,duration:r}:t)}function g(){return n.busy()||n.isInTransition()}function gr(){return n.activePage()||$()}function ei(){return!1}function ct(n){s.barcode(":always",n)}function kt(){return u&&!u.nextAll(".ui-page-active").length}function nt(t){if(arguments.length)t?(ct(!u||kt()),r&&r.input.barcode&&$(document.activeElement).blur(),s.valid()&&(ui||(ui=ut("ui.transitions.style")),ut("ui.transitions.style","none"),y.addClass("app-ui-automation"),gr().addClass("app-ui-automation-root"))):(ct(kt()),$(".app-ui-automation,.app-ui-automation-root").removeClass("app-ui-automation app-ui-automation-root"),s.barcode(":peek")==null&&n.resetUI(),ut("ui.transitions.style",ui));else return y.is(".app-ui-automation")}function dt(n){n===!0?(y.addClass("app-ui-automation-system"),ut("ui.transitions.style",ui)):(y.removeClass("app-ui-automation-system"),ut("ui.transitions.style","none"))}function nu(){dt();u&&ct(!0)}function v(n){return n="ui.automation."+n,ut.apply(this,arguments)}function lt(n){n&&e.error(n);ht&&ht.resolve()}function di(){ht&&ht.reject()}function oi(n){return JSON.stringify(n).replace(/","/g,'", "')}function tu(n){return new RegExp(RegExp.escape(n).replace(/\\\+/g,".+?"),"i")}function h(n,t,i){var o=t&&t.length,u,e,r,f;if(n&&n._extended)return n;if(o===1&&typeof n=="object"&&!("selector"in n)){n._extended||(n._extended={});for(e in n)wi.indexOf(e)<0&&(n.selector=e,u=n[e],u instanceof tt&&(n[e]=u=u.unwrap()),n._extended.mapped||(n.value=u,n._extended.mapped=!0))}return n==null&&(n=""),typeof n=="string"&&(n={selector:n,_extended:{}}),r=n.regex,r||(r=n.selector,r==null&&(r=""),r instanceof RegExp||(r=r.toString(),r!=null&&r.match(/^@/)?(r=r.substring(1),n.identifier=r):r=tu(r)),n.regex=r),t&&(o>1&&(u=t[1],u instanceof tt&&(u=t[1]=u.unwrap()),n.value=u,i===2&&(n.in=u)),o>2&&(n.in=t[2])),n.in&&(f={selector:n.in},f=h(f),f.identifier?n.inIdentifier=f.identifier:n.inRegex=f.regex),n}function gi(n){var r=n&&n._survey,i=r&&r.context;return i&&typeof i=="object"&&"model"in i&&"search"in i&&(n=t.find(i.id)),n}function nr(){var i=u&&!nt()?pt(u.prevAll(".ui-page-active,.ui-page").first().attr("id")):n.dataView(),f,r;return i=u&&!nt()?u.prevAll(".ui-page-active").length?n.dataView():pt(u.prevAll(".ui-page:first").attr("id")):n.dataView(),i||(f=$("#Main .app-echo:first"),f.length&&(i=pt(f.data("for")))),i||(r=n.pageInfo(br),$app.survey({controller:r.id,id:r.id,show:!1,questions:[{name:"text"}]}),i=r.dataView=t.findDataView(r.id),r.page||(r.page=$(".ui-page-active")),r.initialized=!1,i&&n.pageInit(i._id)),i}function gt(n){var i=nr(),r;return i&&(i=gi(i),n.in&&(n.inIdentifier?r=i.findField(n.inIdentifier):i._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(r=t),!r}),i=r?t.find(r._dataViewId):null)),i}function iu(n,t,i,r){!n._allFields||n._busy()||ei()?setTimeout(iu,32,n,t,i,r):ru(n,t,i,r)}function ru(n,t,i,u){if(i)u(n,t)!==!1&&(r.error?t.reject():setTimeout(e._wait,rt,t));else{var f=u(n,t);f&&f.then||(f?t.resolve(f):t.reject())}}function tr(n,i,r,u){var f=nr(),o,e;return f&&(f=gi(f),n.in&&(n.inIdentifier?e=f.findField(n.inIdentifier):f._allFields.every(function(t){return t.HeaderText.match(n.inRegex)&&(e=t),!e}),e?(f=t.find(e._dataViewId),o=!f._allFields||f._busy()):f=null)),u&&(o?(s.focus({field:e}),iu(f,i,r,u)):ru(f,i,r,u)),f}function k(n,t){var i,r=n.identifier;return t||(t=gt(n)),t&&(r?i=t.findField(r):t._allFields.every(function(t){return t.HeaderText.match(n.regex)&&(i=t),!i})),i}function uu(n,t){var u={},i,r,f=[];if(n._extended.mapped)for(r in n)wi.indexOf(r)<0&&(i=k(h({selector:r,"in":n.in})),i?u[i.Name]=n[r]:f.push(r));else i=k(n),i?u[i.Name]=n.value:f.push(n.selector);return f.length&&(e.error(t+': "'+f.join('", "')+'" not found.'),lt(!1),u=null),u}function ir(t,i,r){var u,o=n.contextScope(),e=i.identifier,f;return t&&(f=!t.get_isForm(),r||(r=[]),r.length||(n.contextScope(t),n.navContext(r),n.contextScope(o)),r.every(function(n){var r=n.text;return(e==null||n.path!==e)&&(!r||n.system&&!i.system||n.command==="New"&&f&&(n.argument===t._viewId||!n.argument)||n.command==="Edit"&&f&&(n.argument===t._viewId||!n.argument)||!r.match(i.regex))||(u=n),!u})),u}function fu(n,t,i,r){var u=[],e=[],o,s;if(r.method==="filter"){u=null;for(o in i)s=n.findField(o),s&&e.push(s.Name+":=%js%"+JSON.stringify(i[o]))}else n._allFields.forEach(function(n){n.IsPrimaryKey&&(u.push(t[n.Name]),e.push(n.Name+":=%js%"+JSON.stringify(t[n.Name])))});r.filter&&!f&&(n._syncFilter=!0,n.set_filter(e));n.sync(u);n._syncFilter=!1}function tt(n){this._deferred=$.Deferred();this._pending=n?n._pending.slice():[]}function of(){var c=$app.userName(),r=a("app-avatar").attr("data-title",c).appendTo(u),e=Web.Menu.currentNode,l=v("kiosk.copyright"),p,s,h,i;for(p=a("app-logo").appendTo(u).html(n.appName()),e&&n.icon("material-icon-chevron-right",a("app-page-title").appendTo(p.attr("data-title",e.description)).text(e.title)),a('app-btn-menu ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"').appendTo(u).attr("data-title",et.Menu),s=a('app-btn-context ui-btn ui-btn-icon-notext ui-btn-left ui-icon-bars"').appendTo(u).attr("data-title",et.More),t.AccountManager.avatar(c,kr("app-icon-avatar").text(n.initials(t.userName())).appendTo(r)),t.userName()?s=r:(r.hide(),y.data("public")||a("app-login ui-btn").appendTo(u).attr("data-title",Web.MembershipResources.Bar.LoginLink)),f=o("app-display").appendTo(u),l!==!1&&o("app-copyright app-acc-footer").appendTo(u.addClass("app-has-copyright")).html(l||$("#PageFooterBar,footer small").html()),h=u.width()-s.offset().left-28,i=1;i<3;i++)h+=50,a("ui-btn ui-btn-icon-notext ui-btn-left app-btn app-btn"+i,ef("i","app-icon material-icon")).css("right",h).appendTo(u).hide()}function ni(n){if(f)if(n===!0){var i=f.data("config"),t;navigator.userAgent.match(/Edge/)&&(t=$(".app-kiosk > .ui-btn,.app-kiosk > .app-logo").hide());bu();f.empty();fr(i);t&&t.show()}else clearTimeout(ar),ar=setTimeout(ni,200,!0)}function ti(n){if(f)if(n){var t=n.dataView._id,i=ot.indexOf(t);i===-1&&ot.push(n.dataView._id);setTimeout(ti)}else g()?setTimeout(ti,rt):ot.length&&pu()}function sf(n){return'&nbsp;<i class="app-icon material-icon" aria-hidden="true">expand_'+(n?"less":"more")+"<\/i >"}function hf(){return 8}function cf(n){return n.toString()}function lf(){return this._config.columns||8}function si(n,t){n&&(n._dataView=t,n.val=t?af:null)}function af(n){var r=this,u=r._dataView,t,i;return n&&(n.match(/^@/)?n=n.substring(1):t=n instanceof RegExp?n:tu(n)),u._allFields.every(function(r){return(t&&r.HeaderText.match(t)||r.Name===n)&&(i=r.Name),!i}),r[i]}function eu(n){var t=n._inDataView;return n._hasFields&&!t.get_isForm()&&n._count>1}function ou(n){return{width:n[0].offsetWidth-n[0].clientWidth+1,height:n[0].offsetHeight-n[0].clientHeight+1}}function rr(n,t){var r=t==="fill",i;return t!=null&&(i=o("app-container-content").attr("tabindex",0).appendTo(n.toggleClass("app-container-autosize",r)),i.css({"margin-right":i[0].clientWidth-i[0].offsetWidth-1-parseInt(n.css("paddingRight")),height:!r&&t!==!1?t:null})),i}function ur(n){var t=n.perform;return"barcode"in n||t&&(typeof t=="function"||t.show||t.hide||typeof t.pick=="string")}function vf(n){var r=[],i=v("numPad.buttons"),u=n.label;return i||(i=standardNumPadButtons,n.compact&&(i=JSON.parse(JSON.stringify(i)),i[1][3]=i[3][2],i[2][3]=i[4][0],i[2][3].tall=!0,i.splice(i.length-1))),r.push('<div class="app-numpad">'),u&&r.push('<div class="app-label">'+t.htmlEncode(u)+"<\/div>"),r.push('<div class="app-text app-null"><span class="app-value"><\/span><i class="app-icon material-icon" aria-hidden="true" title="'+et.ClearText+'" data-key="Clear">clear<\/i><\/div>'),i.forEach(function(n){var t=0,i;n.forEach(function(n){t+=n.width||1;n.tall&&(i=!0)});r.push('<div class="app-row'+(i?" app-tall":"")+'">');n.forEach(function(n){var f=n.icon,e=n.font,i=n.key,u=n.test;typeof i=="function"&&(i=i());u&&bi.push(u);r.push('<span class="app-btn app-feedback'+(n.accent?" app-accent":"")+(n.dark?" app-dark":"")+(n.tall?" app-tall":"")+'" style="width:'+(n.width||1)/t*100+"%;"+(e?"font-size:"+e+";":"")+'" data-key="'+i+'"'+(u?' data-test="'+(bi.length-1)+'"':"")+">");r.push(f?'<i class="app-icon material-icon" aria-hidden="true">'+f+"<\/i>":n.text||i);r.push("<\/span>")});r.push("<\/div>")}),r.push("<\/div>"),r.join("")}function su(n,i,r,u,f){function g(){if(b){var n=e.parent(),u,i=n.outerHeight(),h=i<=ut&&!t.agent.ie,f=n.find("h1>.material-icon,h2>.material-icon,h3>.material-icon,h4>.material-icon,h5>.material-icon,h6>.material-icon").first(),s=d.icon,r;h&&(n.is(".app-align-top,.app-align-bottom")||n.addClass("app-align-center"),i=ut-(i-e.outerHeight(!0)),n.height(i));b=null;s!==!1&&(r=Math.min(n.width(),n.height()),typeof s=="string"?kr("material-icon").text(s).insertBefore(e).css({transform:"scale("+r/24+")",right:r/2}):f.length&&(f=f.clone().insertBefore(e).css("transform","scale("+r*.6/24+")")));h&&d.sticky&&(u=o("app-sticky-hero-container").insertBefore(n),n.appendTo(u).addClass("app-spacing-none app-hero-sticky").find(".app-hero-content").appendTo(o("app-hero").toggleClass("app-spacing-none",d.spacing===!1).height(i).appendTo(u)))}}var nt;i.data("created")||(i.data("created",new Date),n.forEach(function(n){delete n._lastResult}));it(n,function(n){hu(n);it(n,function(n){hu(n)},!1)},!1);var tt=nr(),c=r,s,y,p,rt,l,w,e,b,d,ut=i.height();or(n,i);n.forEach(function(i,ut){var wt=i.in,yt,ct=i.background,ei=ct&&ct.fluid,di=i.fluid,gi=i.jumbo,ot=i.hero,ti,kt,dt,ii,si,ni,ui,hi,ci,li,lt,ai,vi,wi,ht;if(ot!=null&&(ot=typeof ot=="object"?ot:{id:ot},"id"in ot||(ot.id=!0)),wt?(wt=k(h({"in":wt})),wt?(yt=wt._dataView,i._inDataView=yt):nt='Invalid DataView field "'+i.in+'".'):(yt=tt,i._inDataView=tt),!i.hidden){i._count=i.count||10;i._newRow&&(y=ei?o("app-row-container").appendTo(r):r,s=o("app-row").appendTo(y),ot?(ti=ot.id,kt=ot.background,(ti===!0||ti!==b)&&(g(),d=ot,b=ti,e=o("app-hero-content").appendTo(o("app-hero").toggleClass("app-spacing-none",ot.spacing===!1).css("background-color",kt?kt.color:null).appendTo(r)),ot.align==="top"&&e.parent().addClass("app-align-top"),ot.align==="bottom"&&e.parent().addClass("app-align-bottom")),s.appendTo(e),y=e,kt&&e.parent().addClass("app-has-background").toggleClass("app-background-accent",kt.accent===!0)):g(),f&&!di&&s.css({maxWidth:f,minWidth:f,marginLeft:"auto",marginRight:"auto"}),gi&&(ei&&!ot?y:s).addClass("app-jumbo").toggleClass("app-spacing-none",i.spacing===!1),ct&&(ei&&!ot?y:s).addClass("app-has-background").toggleClass("app-background-accent",ct.accent===!0).css("background-color",ct.color));i._newCol&&(c=o("app-column").appendTo(s),dt=i._width,i.isContent&&f&&dt<1&&i._newRow&&(ut===n.length-1||n[ut+1]._newRow)?(ii=f*dt,i.fluid?at(s,dt).css({marginLeft:"auto",marginRight:"auto"}):s.css({width:ii,minWidth:ii,maxWidth:ii}),at(c,1)):at(c,dt),!i._newRow&&ct&&c.addClass("app-has-background").toggleClass("app-background-accent",ct.accent===!0).css("background-color",ct.color));var pt=i.append?c.find(".app-container:last"):null,ft=pt?pt.length?pt:c:o("app-container").attr("data-index",ut).appendTo(c).data(i).toggleClass("app-spacing-none",i.spacing===!1),et,gt,vt=i.tab,pi=vt||i.label,ri,oi=i.height;if(i.readOnly&&!pt&&ft.attr("data-read-only","true"),vt?p&&(gt=p):(p=null,l=null),pi!=null&&(gt||(gt=o("app-header").appendTo(ft)),vt!=null&&vt===rt&&l?(ri=l,w=l.data("tab")):(ri=o("app-text").text(pi).data("config",i).appendTo(gt),vt!=null&&(w=[],l=ri.data("tab",w))),vt!=null&&(rt=vt,p=gt.addClass("app-tabset"),l=ri,w.push(ft))),yt)if(si=[],it(i,function(n,t){var e=n.type,r,u,f;n.expression?(i._hasFields=!0,u=!0):ur(n)||(t==="numpad"?f=vf(n):t==="#"?("tall"in n||(n.tall=ni?ni.tall:!0),n.field={Name:"#",HeaderText:"#",Type:"Int32",_config:n,format:cf,toColumns:lf},u=!0):t===">"?(n.tall=ni?ni.tall:!0,n.field={Name:">",Type:"Boolean",HtmlEncode:!1,_config:n,format:sf,toColumns:hf},n.label=!1,u=!0):(r=e==="field"||!e?k(h(n.clone||t),yt):null,r&&(n.field=yt._allFields[r.AliasIndex],i._hasFields=!0,u=!0)));n.dense&&(n.density="condensed");n._label=n.label!=null?n.label:r?r.HeaderText:t;si.push({html:f?f:'<div data-type="'+(u?"field":"button")+'" data-name="'+t+'"'+(r?' data-field="'+r.Name+'"':"")+">"+(u?bt("app-label")+bt("app-value"):bt("app-button app-feedback",bt("app-text")))+"<\/div>",obj:n});ni=n}),i._propCount)i._items=si,eu(i)?(ui=0,hi=[],it(i,function(n,t,r){var u=n.field;if((!n.flow||!r&&n.flow==="row")&&u)n._grid=!0,t===">"&&(i.expand=!0,i._expanded=dr(i,"expanded",{})),hi.push(n),ci=u.toColumns(),n._columns=ci,ui+=ci;else return!1}),ui&&(li=o("app-row-header").appendTo(ft),hi.forEach(function(n){var i=n.field,r=n._label;n._width=n._columns/ui;a("app-text").appendTo(at(a("app-column-header"),n._width).appendTo(li).attr("data-name",i.Name).attr("data-type",i.Type).toggleClass("app-field-type-numeric",i.Type.match(t._numericTypeRegex)!=null)).text(r!==!1?r:"")})),or(i,li||ft),rr(ft,oi||!1),i.letters&&o("app-letters").data("config",i).appendTo(ft.addClass("app-has-letters"))):(oi!=null?et=rr(ft,oi):(et=ft,pt&&(et=ft.find(".app-container-content"),et.length||(et=ft))),or(i,et),cu(i,et));else if(pt&&(et=ft.find(".app-container-content"),et.length&&(ft=et),ft=o("").appendTo(ft)),i.isContent){if(ft=rr(ft,i.height)||ft,et=i.content,lt=i.as,ht=i.icon,ht&&(typeof ht=="string"&&(ht={header:ht}),typeof ht=="object"&&(ht.header&&(et=et.replace(/(<h1.*?>)/i,'$1<i class="material-icon">'+ht.header+"<\/i>")),ht.subheader&&(et=et.replace(/(<h[2-6].*?>)/i,'$1<i class="material-icon">'+ht.subheader+"<\/i>")))),wi=$(et).appendTo(ft),ft.css({color:i.color,"text-align":i.align}),lt){typeof lt=="string"&&lt.match(/c#|csharp|vb|visualbasic|html|javascript|json/i)&&(lt={code:lt});for(vi in lt)ai=t.display.as[vi],ai&&(wi=ai.render(lt[vi],ft,et))}}else{var yi=i.image,st=i.content,fi=yi!=null||st!=null?!1:i.gapColor||v("kiosk.gapColor"),nr=fi!==!1&&i.gapAccent,bi=i.dense?"condensed":i.density,ki=i._gap=ft.addClass("app-gap").toggleClass("app-accent",i.gapAccent===!0).toggleClass("app-gap-bkg",fi===!0).css({height:yi||st?"":i._vertGap?"100%":er(i),"background-color":nr||fi===!1?null:i.gapColor||fi});yi?st=$("<img/>").appendTo(ki).attr("src",t.resolveClientUrl(i.image)):st!=null&&(st.match(/^\s*<\w+/)||(st='<div class="app-html">'+st+"<\/div>"),st=$(st).appendTo(ki),parseInt(st.css("font-size"))||st.addClass("app-html"),bi&&st.addClass("app-density-"+bi));st&&(u||(u=ou(r)),st.css({"max-width":i.fluid?null:ft.width(),"max-height":r.height()-u.height}))}return!nt}});g()}function fr(t){var h,l,r,i,e,s;if(!arguments.length||typeof t!="string"&&!t.length)return"[Invalid display]";for(f.data("config")!==t&&f.removeData("created"),f.data("config",t),c=o("app-display-content app-display-flow").attr("tabindex",0).appendTo(f),typeof t=="string"?t={other:t}:Array.isArray(t)&&(t={other:t}),f.css({width:"",height:"",left:"","margin-left":"",display:""}),l=n.toWidth(f.width()),r=p.indexOf(l),ft=r;r>=0;)if(i=t[p[r]],i)break;else i=null,r--;return i||(i=t.other),e=Math.min(Math.max(u.width(),n.toWidth(l)),v("kiosk.maxWidth")||n.toWidth("xxl")),s=ou(c),f.css({width:e,height:f.height(),left:"50%","margin-left":-e/2+1}),c.css("width",e+s.width),c.css("height",f.height()+s.height),typeof i=="string"?o("app-content app-text").appendTo(c).html(i):h=su(i,f,c,s),h||(sr(),ot.splice(0),pu(!1),f.find(".app-tabset .app-text:first").each(function(){var n=$(this),t=n.parent().find(".app-text"),i=dr(n.data("config"),"selectedTab",0);$(t[i<t.length?i:0]).trigger("vclick")}),hi(),li()),h}function hi(n,t,i){n||(n=f);t||(t=c);var o=t.find(".app-container-autosize:not(.app-hidden)"),r,u,e,s=96;o.length&&o.each(function(){var f=$(this),o=f.show().find(".app-container-content"),c,l,a,v,h;o.data("sized")&&!i||o.is(".app-hidden")||(e=o.height("").is(":empty"),e&&(f.data("altered")||f.data("altered",!0).css({"padding-top":0,"padding-bottom":0}),f.show()),r==null&&(r=n.offset().top+n.height(),u=t.children().last()),o.data("sized",!0),c=f.parent(),l=c.children().filter(":visible").last(),a=c.offset().top+c.height()-(l.offset().top+l.outerHeight(!0)),v=r-(u.offset().top+u.outerHeight(!0)),h=o.height()+v+a,e&&(s=-1,h=Math.max(h,f.height(),0),h?f.show():f.hide()),h>s&&o.height(h))})}function hu(n){var i=n.alter,e=i,r,h,t,o,l,a,s,u,c,y=["_lastResult"],v=[];for(t in n)t.match(/^_/)&&y.indexOf(t)<0&&v.push(t);if(v.forEach(function(t){delete n[t]}),i){s=e.remove||{};for(t in s)delete n[t];u=e.restore||{};for(t in u)n[t]=u[t];r=i.portrait;r&&f.width()<f.height()?i=r:(r=i.landscape,r&&f.width()>f.height()&&(i=r));for(t in i)if(o=t.match(tf),o&&(l=p.indexOf(o[1]||p[0]),a=p.indexOf(o[3]||p[p.length-1]),l<=ft&&ft<=a)){h=i[t];for(t in h)t in n?u[t]=n[t]:s[t]=!0,c=h[t],c==null?delete n[t]:n[t]=c;e.remove=s;e.restore=u;break}}}function er(n){var t=n.gapSize,i=t!=null?t:v("kiosk.gapSize");return i==null?f?12:16:i}function ii(n){return!n._propCount&&n.content==null&&n.image==null}function or(n,t){var f=[],r,u,o=t.width(),i,e;it(n,function(t){var s=Array.isArray(n)&&typeof n=="object",o;s&&it(t);o=t.flow;t._grid||(o!=="row"&&r?o==="column"&&(e=!0,u=[],r.push(u),ii(t)&&s&&(t.width==null&&(t.width=er(t)),t._vertGap=!0)):(s&&(o==="column"||o==="row"&&(!i||i.flow==="row"&&ii(i)))&&ii(t)&&(t.width==null?t.width=er(t):t._keepWidth=!0,t._vertGap=!0),r=[],u=[],f.push(r),r.push(u)),u.push(t),!o&&t._propCount&&i&&ii(i)&&i._vertGap&&(i._keepWidth&&delete i.width,delete i._vertGap));i=t});f.forEach(function(n){var r=0,i=0,t=n[0][0];n.length===1&&n[0].length===1&&(ii(t)||!e)?(delete t._vertGap,t._keepWidth||t.isContent||delete t.width,t._width=1,t._newCol=!0,t._newRow=!0):n.forEach(function(t,u){var e=t[0].width,s,h;e!=null&&e!=="auto"?(typeof e=="string"&&(e.match(/%$/)?e=parseFloat(e)/100:e.match(/^\d+x$/)?(yt||(s=$('<div class="app-container"><div data-type="button"><div class="app-button app-no-text"><\/div><\/div><\/div>').appendTo(c),h=s.find(".app-button"),yt={w:h.width(),g:parseInt(h.css("margin-left"))},s.remove()),e=parseInt(e)*(yt.w+yt.g)+yt.g):e=parseInt(e)),t[0]._width=e=e<=1&&t[0].width!==1?e:e/o,r+=e):(i++,t[0]._width=null);(n.length>1||f.length>1)&&(u||(t[0]._newRow=!0),t[0]._newCol=!0)});i&&n.forEach(function(n){n[0]._width==null&&(n[0]._width=(1-r)/i)})})}function at(n,t){return t=t!=null?t*100+"%":"",n.toggleClass("app-full-width",t==="100%"),n.css({width:t,minWidth:t,maxWidth:t})}function ci(n,t){return typeof n=="function"&&(n=n(t)),n}function cu(n,i){var s=n._items,f=i,r=0,u,h=0,e;s.forEach(function(c){var l=c.obj,y=c.html,a,p=l._grid,v=l.darkest?.75:l.dark,k=l._width,w=l._newRow,b=0;if((w||!u&&p)&&(e=!1,f=u=o("app-row").toggleClass("app-collapsed",n.expand&&h>0).appendTo(i),w&&r--)){while(r>=0)b+=s[r--].obj._width;u.css("margin-left",b*100+"%")}l.field&&!e&&(e=!0,h++);l._newCol&&(f=at(o("app-column"),k).appendTo(u||i));(p||l._label===!1)&&(y=y.replace(bt("app-label"),""));a=l.item=$(y).appendTo(f);p&&(a.toggleClass("app-field-type-numeric",l.field.Type.match(t._numericTypeRegex)!=null),l.tall&&r++);v!=null&&(v===!0&&(v=.5),wu(a.find(".app-button"),1-v));ur(l)&&a.find(".app-button").data("obj",l)})}function it(n,t,i){var u,r,e,f=0;for(u in n)if(rf.indexOf(u)===-1&&!u.match(/^_/)&&u!=="alter"&&(r=n[u],typeof r=="function"&&(r=n[u]={expression:r}),r!=null&&typeof r=="object"&&(!r.hidden||r.visible||i===!1)&&(e=t?t(r,u,f++):++f,e===!1)))return;n._propCount==null&&(n._propCount=f)}function lu(t,i,r){var u=t._inDataView,e=u.get_isForm(),f;it(t,function(o,s){var c=o.field,tt=o.expression,v,it,g,a=o.item,ft=a,w,k,p=o.tooltip,nt,rt;if((c||tt)&&r){var y=tt?tt.apply(r,[r]):r[c.Name],et=y==null,l,ht=o.text!==!1,ot=o._label,st=!nt&&ot===!1,ct=c?c.HtmlEncode:!0,d=a.find(".app-value"),lt=a.find(".app-label");et?l=nf:y.getMonth&&ut("ui.smartDates")?(l=n.toSmartDate(y,new Date),d.attr({"data-smart-type":c?c.Type:"DateTime","data-smart-value":JSON.stringify(y),"data-title":c?c.format(y):String.format("{0:"+$app.dateFormatStrings["{0:g}"]+"}",y)})):l=c?c.format(y):y.toString();ct?d.text(l):d.html(l);nt=o._grid;d.toggleClass("app-medium",o.medium===!0||o.mediumValue===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0).toggleClass("app-accent",o.accent===!0||o.accentValue===!0).toggleClass("app-nowrap",!nt&&o.wrap===!1).css("color",ci(o.colorValue,r));rt=o._width;rt&&nt?at(a.addClass("app-cell").toggleClass("app-nowrap",o.wrap===!1),rt):lt.text(ot).toggleClass("app-medium",o.medium===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeLabel===!0).toggleClass("app-accent",o.accent===!0||o.accentLabel===!0).css("color",ci(o.colorLabel,r));a.toggleClass("app-label-hidden",st).toggleClass("app-null",et).toggleClass("app-medium",o.medium===!0||o.mediumValue===!0||o.mediumLabel===!0).toggleClass("app-large",o.large===!0||o.largeValue===!0||o.largeLabel===!0);(st&&c||p!=null)&&a.attr("data-title",p!=null?p:c.HeaderText);o.density&&a.addClass("app-density-"+o.density);o.align&&a.addClass("app-align-"+o.align);c&&c.Name===">"&&d.attr("data-title",y?pr.Minimize:pr.Maximize);c&&e&&a.css("display",$("#"+t._inDataView._id+' [data-field="'+u._allFields[c.OriginalIndex].Name+'"]').is(":visible")?"":"none")}else ft=v=a.find(".app-button"),it=v.find(".app-text"),g=b(o,"checked"),ht&&(l=o.text),l==null&&(l=s),ur(o)?it.text(l):(f=i[u._id],f||(i[u._id]=f=[]),w=ir(u,h(s),f),w?(v.show().data({obj:o,contextItem:w}),l=w.text,p=w.tooltip,it.text(l)):v.hide()),p==null&&(p=l),k=o.icon||(w?w.icon:null),v.find("i").remove(),k&&n.icon(k,v),v.toggleClass("app-no-icon",k===!1||k==null).toggleClass("app-wide",o.wide===!0),g!==!0&&(typeof g!="function"||!g(r))||n.icon("material-icon-check-circle",v).addClass("app-checked"),o.text===!1&&(v.addClass("app-no-text"),l=null),p!==l&&v.attr("data-title",p);ft.css({"background-color":ci(o.colorBackground,r),color:ci(o.color,r)});o.when&&a.css("display",r&&o.when(r)?"":"none")})}function au(n,t){var r=[],u=[],i;return n._lastResult.primaryKey.forEach(function(n){i=t[n.Name];r[n.Index]=i;u.push(i)}),{row:r,key:u}}function vu(t,i,r){t._lastResult=r;var y=t._inDataView,d={},p,c=i.find(".app-container-content").empty(),e,u=r.pageIndex,f=r.pageSize,s=r.totalRowCount,w=t._expanded,h,l,v=r.letters,k=[],g=b(t,"beginsWithLetter");r.list.forEach(function(n,i){n["#"]=u*f+i+1;h=o("app-item app-feedback").appendTo(c).data({id:y._id,obj:n,config:t});cu(t,h);var r=au(t,n);w&&(l=w[r.key.toString()]===!0,n[">"]=l,l||h.addClass("app-collapsed"));si(n,y);lu(t,d,n);si(n);p||t._inDataView.rowIsSelected(r.row)&&(p=!0,h.addClass("app-selected"))});f<s&&(e=o("app-row-pager").appendTo(c).data("config",t),n.icon("material-icon-navigate-before",a("app-btn app-feedback app-prev").appendTo(e).attr("data-title",pi.Previous).toggleClass("app-disabled",!u)),n.icon("material-icon-navigate-next",a("app-btn app-feedback app-next").appendTo(e).attr("data-title",pi.Next).toggleClass("app-disabled",u===Math.ceil(s/f)-1)),a("app-info").appendTo(e).html(String.format(pi.ShowingItems,u*f+1,Math.min(s,(u+1)*f),s)));li(c);t.letters&&v&&(v.list.forEach(function(n){k.push('<span title="'+n+'"'+(g===n?' class="app-selected"':"")+">"+n+"<\/span> ")}),i.find(".app-letters").html(k.join("")).data("letters",v))}function li(n){if(n){var r=n.find(".app-selected"),t,i;r.length&&(i=r[0].getBoundingClientRect(),t=n[0].getBoundingClientRect(),(i.top<t.top||i.bottom>t.bottom)&&n.scrollTop(i.top-t.top+n.scrollTop()-(t.height-i.height)/2))}else $(".app-display .app-row-header+.app-container-content").each(function(){li($(this))})}function yu(n,i,r){var f=n._inDataView,e=n.letters,u,s=r==null,o=n.loadOnStart;o===!1&&delete n.loadOnStart;r=r||0;e&&(u=b(n,"beginsWithFilter"));t.execute({from:f,as:"list",pageSize:n._count,pageIndex:r,requiresRowCount:!0,_filter:u?[u]:null,sync:s?f._selectedKey:null,requiresData:o==null,letters:e&&r===0}).then(function(t){vu(n,i,t)})}function pu(n){var i=f.data("config"),r={},u={},o={},t,e;typeof i!="string"&&(t=c.children().last(),t&&(e=t.offset().top),i.forEach(function(n,t){var i=n._inDataView,l=ot.length,s=s=f.find('.app-container[data-index="'+t+'"]'),a=i._dataViewFieldOwnerId||i._id,h=u[i._id],c,e;(h==null&&(h=u[a]=$("#"+a+".ui-page-active").length>0||!ai("ontop")),h)&&(!l||ot.indexOf(i._id)>=0)&&(eu(n)?(c=n._lastResult,n.loadOnStart!==!1||n.letters?!l&&c?vu(n,s,c):yu(n,s):delete n.loadOnStart):(e=r[i._id],e===undefined&&(e=r[i._id]=i.data()),e=i.commandRow()?e:null,n._hasFields&&s.css("display",e?"":"none"),si(e,i),lu(n,o,e),si(e)))}),ot.splice(0),e!==t.offset().top&&n!==!1&&hi())}function wu(n,t){var i=n.css("background-color").match(/^rgba?\((\d+,\s*\d+,\s*\d+)/);i&&n.css("background-color",typeof t=="number"?"rgba("+i[1]+","+t+")":"rgb("+i[1]+")")}function sr(){c&&c.focus()}function bu(){var t=n.screen();t.isVirtual&&u.css({left:t.left,top:t.top,width:t.width,height:t.height})}function hr(t){var f=e.error(),i=f,u,o=r.runOnce;t=i?!1:typeof t=="boolean"?t:!0;r.input.barcode!=null&&(t||(u=r.input.barcode,i=i?u+" > "+i:u));r=null;i!=null&&d(i,!0,f?3e4:null);nt(!1);s.barcode(!0);s.barcode().length||(o?(clearTimeout(yr),n.kiosk()?n.kiosk("focus"):yr=setTimeout(s.focus,200,{lastFocused:!0})):st({runOnce:!0}))}function cr(){if(r.error)g()||r.discarding?setTimeout(cr,rt):hr();else{r.index++;var n=(new Date).getTime();n-vi>16?(vi=n,setTimeout(ri,rt)):ri()}}function ri(i){var s=t.ifThisThenThat(),h,f,u,o;if(i){if(r&&!s.length)return;if(u=n.dataView(),o=i.id,f=g(),gi(u)!==u&&(ei(!0)?(f=!0,i._notified||(d(et.Reading,!0,3e4),i._notified=!0)):i.input.barcode&&(d(!1),n.goBack(),f=!0)),u&&u._inlineEditor)if(ei(!0))f=!0;else{u.tag("discard-changes-prompt-none");n.goBack(function(){setTimeout(ri,rt,i)});return}if(f){setTimeout(ri,rt,i);return}r=i;o&&s.every(function(n,t){return n.id===o&&(r.index=t),r.index==null});r.index==null&&(vi=(new Date).getTime(),r.index=0);nt(!0)}else if(!r)return;if(r.context=new tt,r.index<s.length)if(h=s[r.index],h.background||o&&h.id===o){ht=$.Deferred();$.when(ht).then(hr).fail(cr);try{h.execute(e,r.context).done(lt).fail(di)}catch(c){lt(c)}}else cr();else hr(!1),st()}function st(n){n||(n={});var f=n.id||n.input||n.runOnce,i=t.ifThisThenThat._interval,u;n.input||(n.input={});"numpad"in n||(w=lr(w),n.input.numpad=w,String.isNullOrEmpty(w)||(u=parseFloat(w),n.input["numpad.number"]=isNaN(u)?null:u,n.input["numpad.date"]=Date.tryParseFuzzyDate(w),n.input["numpad.time"]=Date.tryParseFuzzyTime(w)));clearTimeout(yi);f?yi=g()||r?setTimeout(st,96,n):setTimeout(ri,n.interval||0,n):i&&(n.interval=i,i&&st(n))}function yf(){var f=t.odp.offline("icon"),u=[],i,r,e;if(n.navContext(u),f)for(i=0;i<u.length;i++)if(r=u[i],r.icon===f){e=!0;break}e?r.callback(r.context):t.alert(vt.ODP.SaveAndSync)}function pf(){d("Not supported.")}function wf(){var n=[],i;t.odp.offline()&&(ki.icon=t.odp.offline("icon")||"material-icon-cloud",ki.tooltip=t.odp.offline("tooltip"),n.push(ki));t.host&&n.push(ff);u.find("> .app-btn").each(function(t){var u=$(this),r=n[t];t<n.length?(u.data("btn",r).show().attr("data-title",r.tooltip).find("i").css("transform",r.transform||"").text(r.icon.replace("material-icon-","").replace("-","_")),i=u):u.hide()});i&&u.find(".app-logo").css("right",u.width()-i.offset().left)}function bf(){l.one("touchinit.app",function(){y.data("kiosk")&&v("kiosk.enabled",!0);n.kiosk(v("kiosk.enabled"))}).on("pagereadycomplete.app",function(){if(u)if(fi){var t=n.pageInfo();t&&!t.home||r?ct(kt()):l.trigger("ifttt.app")}else fr(""),fi=!0;else fi=!0}).on("barcode.app",function(n){if(!n.isDefaultPrevented()&&t.ifThisThenThat().length)return r?s.barcode().push(n.text):st({input:{barcode:n.text}}),!1}).on("ifttt.app",function(n,t){var i=n.ifThis||t;st({id:i,runOnce:i==null});vr=!0}).on("vclick",".app-kiosk .app-avatar",function(){return setTimeout(function(){$(".app-bar-toolbar .app-avatar").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-btn-context",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-context").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-logo",function(){return setTimeout(function(){$(".app-bar-toolbar .app-btn-menu").trigger("vclick")}),!1}).on("vclick",".app-kiosk .app-login",function(){return n.showAccountManager(null,!0),!1}).on("vclick",".app-kiosk .app-button",function(){var t=$(this);return g()||nt()||(n.callWithFeedback(t),setTimeout(df,0,t)),!1}).on("vclick",".app-kiosk .app-numpad .app-btn, .app-kiosk .app-numpad .app-text i",function(){var t=$(this);return g()||nt()||(n.callWithFeedback(t),setTimeout(ne,0,t)),!1}).on("vclick",".app-kiosk .app-item",function(t){var i=$(this),o=$(t.target).closest('[data-name=">"]'),f,u,r,e;return o.length?(f=i.data("config"),u=i.data("obj"),r=!u[">"],u[">"]=r,f._expanded[au(f,u).key.toString()]=r,i.toggleClass("app-collapsed",!r),e=o.find(".app-value"),e.find("i").text("expand_"+(r?"less":"more")),n.toggleTooltip(e,r)):(n.callWithFeedback(i),g()||nt()||(i.is(".app-selected")?li(i.parent()):setTimeout(kf,0,i))),!1}).on("vclick",".app-kiosk .app-tabset .app-text",function(){var n=$(this),r=n.parent().find(".app-text"),t=[n.addClass("app-selected")],i=n.prevAll(".app-text"),u=i.length?i.last():n;return r.each(function(i){var r=$(this);r.is(n)?b(u.data("config"),"selectedTab",i):t.push(r.removeClass("app-selected"))}),t.forEach(function(n,t){var i=!n.prev().length;n.data("tab").forEach(function(r,u){var f=i&&!u?n.parent().nextAll():r;f.toggleClass("app-hidden",!!t)})}),hi(),!1}).on("vclick",".app-row-pager .app-btn",function(){var t=$(this);return g()||nt()||t.is(".app-disabled")||(n.callWithFeedback(t),setTimeout(gf,0,t)),!1}).on("vclick",".app-kiosk .app-letters span",function(){var r=$(this),u=r.parent(),i=u.data("config"),e=u.data("letters"),n,o=b(i,"beginsWithLetter"),t=i._inDataView,f=e.field;return u.find(".app-selected").removeClass("app-selected"),r.addClass("app-selected"),t&&(n=r.text(),n===o&&(n=null),b(i,"beginsWithFilter",n==null?null:f+":$beginswith$%js%"+JSON.stringify(n)),b(i,"beginsWithLetter",n),t.removeFromFilter(f),n==null?t.sync():t.applyFilter(t.findField(f),"$beginswith$",n)),!1}).on("vclick",".app-kiosk > .app-btn",function(){var n=$(this).data("btn");return setTimeout(n.exec),!1}).on("dataviewrefresh.app datainputbroadcast.app",ti).on("themechanged.app",ni).on("useravatarchanged.app",function(){u&&t.AccountManager.avatar(t.userName(),u.find("> .app-avatar i"))});gu.on("throttledresize",ni)}function kf(n){n.parent().find(".app-item").removeClass("app-selected");n.addClass("app-selected");fu(pt(n.data("id")),n.data("obj"),{},{})}function ku(n){var t;return it(f.data("config"),function(i){return it(i,function(i,r){if(r===n)return t=i,!1},!1),t?!1:void 0},!1),t}function df(n){var r=n.data("obj"),a=n.data("contextItem"),p=r.barcode,u=r.perform,f,e,o,c,i,t,l,v,y;a?a.callback(a.context):(u&&(typeof u=="function"?u(r):(e=u.pick,o=u.show,c=u.hide,e&&(t=k(h({selector:e})),t&&(v=t.Type.match(/^Date/),t=t._dataView._allFields[t.OriginalIndex],(t.ItemsStyle||v)&&(f=!0,s.focus({field:t}),l=$('.ui-page-active [data-field="'+t.Name+'"]'),y=l.find(".app-data-input-button"),v?(l.trigger("vclick"),setTimeout(d,0,r._label||t.HeaderText,!0)):y.length?y.trigger("vclick"):s.methods.lookup.click($.Event("vclick",{target:l})))),f||d("pick: "+e,!0)),!f&&o&&(i=ku(o),i&&!i.visible&&(i.visible=!0,b(r,"checked",c!=null?!0:null),ni(!0),f=!0)),!f&&c&&(i=ku(c),i&&i.visible&&(i.visible=!1,b(r,"checked",o!=null?!1:null),ni(!0),f=!0)))),p!=null&&s.barcode(p))}function gf(n){var r=n.closest(".app-row-pager"),u=n.closest(".app-container"),t=r.data("config"),i=t._lastResult.pageIndex;yu(t,u,n.is(".app-next")?++i:--i)}function ne(n){n=$(n);var f=n.closest(".app-numpad"),i=n.data("key"),e=n.data("test"),t=f.data("text"),u,r,o;t==null&&(t="");u=$.Event("numpadkey.app",{numPad:f,key:i,text:t});l.trigger(u);u.isDefaultPrevented()||(i=u.key,t=u.text,r=t.length,i==="BackSpace"?t.length&&(t=t.substring(0,r-1)):i==="Enter"?r&&(t!==lr(t)?t=lr(t):(s.barcode(t),t="")):i==="PlusMinus"?r<1?t="-":(o=t[r-1],t.match(/\W$/)?t=t.substring(0,r-1)+(o==="+"?"-":"+"):t+="+"):i==="*"?r&&(t.match(/\W$/)?t=t.substring(0,r-1)+"*":t+="*"):i==="abc"||(i==="Clear"?t="":i!=null&&(e==null||bi[e](t))&&(t+=i)),du(t))}function lr(n){var u=0,f=/((-|\+).+?)(-|\+|$)/,t,e,r,o=/(\*(.+?))(\*|$)/,i;if(!String.isNullOrEmpty(n)&&n.substring(1).match(/(-|\+|\*)/)){for(n.match(/^(-|\+)/)||(n="+"+n),t=n.match(f);t;){for(r=1,t=t[1],n=n.substring(t.length),e=t[0]==="+"?1:-1,t=t.substring(1),t.match(/^\*/)||(t="*"+t),i=t.match(o);i;)i=i[1],t=t.substring(i.length),i=i.substring(1),r*=Number.parseLocale(i),i=t.match(o);u+=e*r;t=n.match(f)}n=u.toString()}return n}function du(n){n==null&&(n="");w=n.toString();c.find(".app-numpad").data("text",w).find(".app-text").toggleClass("app-null",!w.length).find(".app-value").text(w)}var e,t=$app,n,s,ai,ht,r,rt=16,vi,y=$("body"),l=$(document),gu=$(window),ui,fi,yi,ar,vr,u,f,c,ft,p,yr,vt=Web.DataViewResources,et=vt.Mobile,pi=vt.Pager,pr=vt.Form,nf=vt.Data.NullValueInForms,tf=/^(tn|xxs|xs|sm|md|lg|xl|xxl)?(_)?(tn|xxs|xs|sm|md|lg|xl|xxl)?$/,wi=["selector","value","regex","inSelector","inRegex","qualifier","_extended"],rf=["as","background","border","hero","icon"],ot=[],yt,ut,w,bi=[],uf=0,wr={},pt=t.findDataView,ki={exec:yf},ff={icon:"line_weight",tooltip:"Scan",transform:"rotate(270deg)",exec:pf},br,wt=t.html,ef=wt.tag,o=wt.$div,bt=wt.span,a=wt.$span,kr=wt.$i;standardNumPadButtons=[[{key:"7"},{key:"8"},{key:"9"},{key:"BackSpace",icon:"backspace",dark:!0}],[{key:"4"},{key:"5"},{key:"6"},{key:"PlusMinus",text:String.fromCharCode(177),dark:!0}],[{key:"3"},{key:"2"},{key:"1"},{key:"*",dark:!0}],[{key:"0",width:2},{key:function(){return Sys.CultureInfo.CurrentCulture.numberFormat.NumberDecimalSeparator},test:function(n){return!n.match(/(\.|\.\d+)$/)}},{key:"abc",font:"1em",dark:!0}],[{key:"Enter",icon:"keyboard_return",accent:!0}]];tt.prototype={deferred:function(n,t){var r=this,i=r._deferred;if(n&&n.match(/^:/))return n=n.substring(1),i.state()===n;if(n==="resolve")i.resolve(t),r._resolvedArgs=t;else if(n==="reject")i.reject(t);else if(n==="pending")r._deferred=$.Deferred();else return i},_generic:function(n,t,i){var r=this,f=r._andNot,u;return r.deferred(":rejected")||(r=new tt(r),n=h(n,i),u=t(n,r),u&&u.then?r.pending(u):(f&&(u=!u,r._andNot=!1),u?r.deferred("resolve",u):r.deferred("reject",n))),r},pending:function(n){if(arguments.length)this._pending.push(n);else return this._pending},not:function(){var n=this;return n._andNot=!0,n},page:function(n){return this._generic(n,function(n){var r=Web.Menu.currentNode,i=n.identifier,u,f;if(r){if(u=r.title,i)r.url===t.resolveClientUrl(i)&&(f=!0);else if(u!=null)try{f=u.match(n.regex)}catch(e){}}else if(typeof i=="string")return location.pathname===t.resolveClientUrl(i);return f})},controller:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=gt(n);return t&&(i=r?t._controller===r:t.get_view().Label.match(n.regex)),i})},view:function(n){return this._generic(n,function(n){var i,r=n.identifier,t=gt(n),u=n.selector;return t&&(i=r?t._viewId===r:u.match(/^:/)?t.extension().viewStyle().toLowerCase()===u.substring(1).toLowerCase():t.get_view().Label.match(n.regex)),i})},form:function(){return this.view(":form")},list:function(){return this.not().form()},field:function(n){return this._generic(n,function(n){return k(n)})},action:function(n){n=h(n,arguments,2);var t=this._andNot;return this._generic(n,function(n,i){var r=i.deferred();return tr(n,r,!1,function(i){var r=ir(i,n);return t&&(r=!r),r==null?!1:r}),r.promise()})},input:function(n,t){return n!=null&&(arguments.length<2?t=n.test:n.test=t),!t||t instanceof RegExp||typeof t=="function"||(t=new RegExp(RegExp.escape(t),"i")),this._generic(n,function(n){var i,u=n.selector,f;if(u==="")for(f in r.input){u=f;break}return r&&(i=r.input[u],t&&(typeof t=="function"?i=t(i):i!=null&&typeof i=="string"&&(i=i.match(t)))),i})},barcode:function(n){var t={selector:"barcode"};return arguments.length>0&&(t.test=n),this.input(t)},display:function(n){return this._generic({},function(){return typeof n=="string"&&(n={id:n}),f!=null&&n===f.data("display")})},reading:function(n){return this.not().editing(n)},editing:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.editing()})},inserting:function(t){return this._generic(t,function(){var t=n.dataView();return t&&t._id!=="-confirm"&&t.get_isForm()&&t.inserting()})},val:function(n,t){var r=this,i;return n!=null&&(arguments.length<2?(i=typeof n=="object"&&"test"in n,t=n.test):(n.test=t,i=!0)),r._generic(n,function(n){var r,u=k(n),f;return u&&(f=u._dataView.data(),r=f[u.Name],i&&(t instanceof RegExp?r!=null&&(r=r.toString().match(t)):t==null?r=r==null:typeof t=="function"?r=t(r):retult=r===t)),r})},row:function(n){var i=this._andNot;return this._generic(n,function(n,u){var f=u.deferred();return tr(n,f,!1,function(u,f){var o={},s;if(u){if(o=uu(n,"context:row"),!o)return!1;if(s=r.input[JSON.stringify(o)],s)return s;t.execute({controller:u._controller,view:u._viewId,externalFilter:u.get_externalFilter(),filter:o,odp:!0}).done(function(t){var e=t[u._controller],s=n._extended.mapped?n.qualifier:n.selector,c,h;if(s=s?s+=".":"",e&&e.length){e=e[0];r.input[JSON.stringify(o)]=e;for(c in e)r.input[s+c]=e[c];h=e}i&&(h=!h);h?f.resolve(e):f.reject()}).fail(function(t){e.error("context.row: "+t.get_message()+"\n"+oi(n));lt(!1)})}else e.error("context.row: Data view "+(n.in||"")+" is not found."),di(!1);return f}),f},arguments)},confirm:function(i){return this._generic(i,function(i,u){function e(n){var i=n.text===s;return setTimeout(function(){i?t.action({path:"form/submit"}):history.go(-1)}),!1}var f=u.deferred(),o=i.selector,s=r.context.barcode().unwrap();s&&(o+="\r\n"+et.ScanToConfirm);l.on("barcodebefore.app",e);return dt(!0),n.whenPageShown(nu),t.confirm(o).then(function(){l.off("barcodebefore.app",e);f.resolve()}).fail(function(){l.off("barcodebefore.app",e);f.reject()}),f})},key:function(n){return typeof n=="string"&&(n={"in":n}),this._generic(n,function(n){var i,r=gt(n),t;return r&&(t=r.get_selectedKey(),t.length&&(i=t.length===1?t[0]:t)),i})},unwrap:function(){var n=this.deferred();return n.state()==="resolved"?this._resolvedArgs:n},toString:function(){return this.unwrap()}};e={"if":function(){function h(){r.context._andNot=null;f.resolve()}function e(){f.reject()}for(var n,s,u,i=!0,f=$.Deferred(),t=[],o=0;o<arguments.length;o++)if(n=arguments[o],n instanceof tt)if(n.deferred(":rejected")){i=!1;break}else s=n.pending(),s.length&&(t=t.concat(s));else if(n&&n.promise)t.push(n);else if(typeof n=="function"){if(u=n(),u&&u.promise)t.push(u);else if(!u){i=!1;break}}else if(!n){i=!1;break}return i?t.length?$.when.apply($,t).then(function(){for(var n=0;n<t.length;n++)if(t[n].state()!=="resolved"){i=!1;break}i?h():e()}).fail(function(){e()}):h():e(),f.promise()},resolve:function(){return lt(),$.when(!0)},reject:function(){return di(),$.when(!0)},discard:function(t){var i=$(".app-ui-automation-root").attr("id");return r.error=t,r.discarding=!0,e._exec(function(t){function u(){var f=n.dataView(),e;f?f._id===i?(ti({dataView:f}),r.discarding=!1,t.resolve()):(e=f._parentDataViewId,e&&ti({dataView:pt(e)}),f.get_isForm()&&f.tag("discard-changes-prompt-none"),n.goBack(u)):t.resolve()}return u(),!1})},notify:function(n,t){return n instanceof tt&&(n=n.unwrap()),typeof n!="object"&&(n={text:n,force:!0,duration:t}),e._exec(function(){d(n)})},_wait:function(n){n.resolve&&(n={deferred:n,attempts:0});var i=n.deferred,t=ei();if(g()||t)t&&!n.notified&&(r.confirmed?r.confirmed=!1:s.barcode().length&&(d(et.Reading,!0,3e4),n.notified=!0)),n.attempts++,setTimeout(e._wait,rt,n);else{n.notified&&d(!1);try{i.resolve()}catch(u){lt(u)}}},_exec:function(n){var t=$.Deferred(),i=arguments.length>1&&arguments[0];return i?tr(i,t,!0,arguments[1]):n(t)!==!1&&(r.error?t.reject():setTimeout(e._wait,rt,t)),t.promise()},error:function(n){if(arguments.length)typeof n=="object"&&n.message&&(n=n.message+"\n"+n.stack),typeof n=="string"&&(n={error:n}),r&&(r.error=n.error);else return r.error},action:function(n){return n=h(n,arguments,2),e._exec(n,function(t){var i=ir(t,n),r=i&&i.callback;r?r(i.context):e.error('app.action: "'+n.selector+'" is not available in the context'+(n.in?' "'+n.in+'"':"")+".")})},_countBarcodes:function(n){var r=1,t;if(n!=null){for(n instanceof tt&&(n=n.unwrap()),t=s.barcode(),i=0;i<t.length&&t[i++]===n;)r++;t.splice(0,r-1)}return r},inc:function(n,t){n=h(n);var r=k(n),u,i,f=n._method||"inc";if(r)return u=r._dataView.data(),n=r.Name,i=u[n],i==null&&(i=0),i+=e._countBarcodes(t)*(f==="inc"?1:-1),e.val(n,i);e.error("app."+f+": Failed to change "+oi(n))},dec:function(n){return arguments[0]=n=h(n),n._method="dec",e.inc.apply(e,arguments)},val:function(n){return n=h(n,arguments),delete n.in,e._exec(function(i){function y(n,t,i){n.map[t]=i;n.reverseMap[i]=t;a[t]=n}function p(n){s.execute(r);n!==!1&&i.resolve(r)}var o=k(n),c,l,r=[],u=[],a={},v=[],f;if(o){if(l=o._dataView,n._extended.mapped)for(f in n)wi.indexOf(f)<0&&(c=k(h({selector:f})),c?r.push({field:c,value:n[f]}):u.push('"'+f+'"'));else r.push({field:o,value:n.value});if(r.forEach(function(n){n.value instanceof tt&&$.when(n.value.deferred()).done(function(t){n.value=t})}),!u.length){if(l._allFields.forEach(function(n){if(n.ItemsStyle&&n.ItemsDataController){var r={field:n,map:{},reverseMap:{}},u=n.Copy,i,f=t._fieldMapRegex;if(y(r,n.Name,n.ItemsDataValueField),y(r,l._allFields[n.AliasIndex].Name,n.ItemsDataTextField),u)for(i=f.exec(u);i;)y(r,i[1],i[2]),i=f.exec(u)}}),r.forEach(function(n){var u=a[n.field.Name],o,s,h,c={},f,l;u&&!u.pending&&(o=u.field,s=o.ItemsDataController,ItemsDataView=o.ItemsDataView,r.forEach(function(n){a[n.field.Name]===u&&(c[u.map[n.field.Name]]=n.value)}),f={controller:s,filter:c,odp:!0},h&&(f.view=h),l=oi(f),u.pending=t.execute(f).done(function(n){var t=n[s],f;if(t&&t.length)for(f in u.reverseMap)r.push({field:u.reverseMap[f],value:t[0][f]});else e.error("app.val: failed to lookup \n"+l),i.reject(r)}),v.push(u.pending))}),v.length)return $.when.apply($,v).done(p).fail(function(n){r.forEach(function(n){var t=n.field.Name;t&&(n.field=t)});e.error("app.val: failed to lookup - "+n.get_message()+"\n"+oi(r));i.reject(r)}),!1;p(!1)}}else u.push('"'+n.selector+'"');u.length&&e.error("app.val: "+u.join(", ")+" not found.")})},focus:function(n,t){return n=h(n),arguments.length>1?n.message=t:t=n.message,e._exec(function(){var i=k(n);i?(i=i._dataView._allFields[i.OriginalIndex],i.Type!=="DataView"&&dt(!0),s.focus({field:i,message:t}),dt()):e.error("app.focus: field "+n.selector+" not found.")})},confirm:function(i){var u=r.context.barcode().unwrap(),o,f;if(u&&(f=s.barcode(),f.length))for(o=!0;f[0]===u;)f.splice(0,1);return e._exec(function(f){function s(i){var f=i.text===u;return r.confirmed=!0,setTimeout(function(){n.isInTransition()||(f?t.action({path:"form/submit"}):history.go(-1))}),!1}if(o)return!0;if(dt(!0),n.whenPageShown(nu),u){l.on("barcodebefore.app",s);i+="\n\n"+et.ScanToConfirm}return t.confirm(i).then(function(){l.off("barcodebefore.app",s);f.resolve(i)}).fail(function(){l.off("barcodebefore.app",s);e.resolve();f.reject(i)}),!1})},row:function(n){return n=h(n,arguments),e._exec(function(){function a(){s.focus({field:o})}var c=n._extended,u=c.method||"row",v=u==="filter",f=uu(n,u),t,o,h,i;if(!f)return!1;if(h=JSON.stringify(f),i=r.input[h],!i&&v&&(i={}),i){if(t=gt(n),t&&(fu(t,i,f,c),o=t._dataViewFieldName,o))if(t._busy())l.one("dataviewrefresh.app",a);else a();return t}e.error("app."+u+": This method requires a data row in the input.\n Specify 'app.if(context.row("+h+"))' in the activity. Use the same filter when invoking '"+u+"' method.")})},rowFilter:function(n){return n=h(n,arguments),n._extended.method="rowFilter",n._extended.filter=!0,this.row(n)},filter:function(n){return n=h(n,arguments),n._extended.method="filter",n._extended.filter=!0,this.row(n)},input:function(n,t){var i=n,f,e;i==null&&(i={});typeof n!="object"&&(i={},i[n]=t);for(f in i)e=i[f],r.input[f]=e,f==="numpad"&&u&&du(e)},display:function(t){function i(){r.resolve()}function s(n){e.error("app.display: "+n);r.reject()}var r=$.Deferred(),o,h;return arguments.length?f&&t===f.data("display")?f.is(":visible")?i():f.fadeIn("fast",i):(h=u!=null,v("kiosk.enabled")!==!1?(n.kiosk(!0),f.empty().data("display",t),o=fr(t),h?(f.hide(),f.fadeIn("fast")):(u.hide(),u.fadeIn("fast")),o?s(o):i()):i()):s("Missing display configuration."),r.promise()},page:function(n){function u(f){f.every(function(f){var e=f.title;if(r)f.url===t.resolveClientUrl(r)&&(i=f);else if(e!=null)try{e.match(n.regex)&&(i=f)}catch(o){}return!i&&f.children&&u(f.children),!i})}var r=n.identifier,i;return n=h(n),r=n.identifier,u(Web.Menu.nodes),i&&i.url&&(location.href=i.url),i}};t.display=function(i){function h(){var a=r.scrollTop(),s=(f!=null||e!=null)&&a>0,o,c,v,h,l;s&&(o=$(document.elementFromPoint(r.offset().left+r.width()/2,r.offset().top+32)).closest(".app-container,.app-row-container,.app-sticky-hero-container").first(),o.length&&(o.is(".app-container")||(o=o.find(".app-container").first()),o.length&&(c=o.attr("data-index"),v=o.offset().top-r.offset().top)));h=[];l=[];u.find(".app-container-selected").each(function(){h.push($(this).attr("data-index"))});u.find(".app-container-cut").each(function(){l.push($(this).attr("data-index"))});su(i.flow,r,u.empty(),null,n.toWidth(p[ft]));s&&(c&&(o=u.find('.app-container[data-index="'+c+'"]'),o.length&&(r.scrollTop(o.offset().top-r.offset().top-v),s=!1)),s&&r.scrollTop(a));hi(r,u,!0);h.forEach(function(n){u.find('.app-container[data-index="'+n+'"]').addClass("app-container-selected")});l.forEach(function(n){u.find('.app-container[data-index="'+n+'"]').addClass("app-container-cut")});h.length&&t.display.designer.selectionChanged()}if(arguments.length||(i=[{flow:"row",content:".app-page-content > *"}]),i==="designer")t.display.designer?t.display.designer.attach():$.ajax({type:"GET",dataType:"script",cache:!0,url:t.resolveClientUrl("~/js/daf/touch-flow."+t.jsExt())}).then(function(){t.display.designer.attach()});else if(Array.isArray(i))l.one("displayflow.app",function(n){var e;typeof i=="string"&&(i=[{content:i}]);var t=n.page,r=n.content,u={},f={flow:i};br=t.attr("id");i.forEach(function(n){var r=n.content,i;r!=null&&(n.isContent=!0,r.match(/^(#|\.)[\w-]+/)&&(i=u[r],i==null&&(i=[],t.find(r).each(function(){i.push(this.innerHTML)}),i=u[r]=i.join("")),n.content=i));n.hero&&(f.trackHeight=!0)});e=r.data("displayFlow",f).find(".app-page-content").addClass("app-display-flow");e.attr("data-editable")&&r.data("originalFlow",JSON.stringify(i))});else{var r=$(i),u,o,s=n.screen().height,f,e;i=i.data("displayFlow");i&&(o=n.toWidth(r.width()),u=r.find(".app-page-content"),ft=Math.min(p.indexOf(y.data("content-width")||n.settings("ui.content.width")||"xl"),p.indexOf(o)),f=i.breakpoint,e=i.lastHeight,(f!==ft||e!==s)&&(i.breakpoint=ft,i.lastHeight=s,h()))}};t.display.as={code:{render:function(n,t){typeof n=="string"&&(n={type:n});t.addClass("app-render-as-code");var f=t.find("h1,h2,h3,h4,h5,h6").remove(),u=t.find("pre code").first(),r,i=n.type;i&&(i.match(/javascript/i)?i="text/javascript":i.match(/c#|csharp/i)?i="text/x-csharp":i.match(/html/i)&&(i={name:"htmlmixed",scriptTypes:[{matches:/\/x-handlebars-template|\/x-mustache/i,mode:null}]}));r=o().appendTo(t.empty());CodeMirror(r[0],{lineNumbers:!0,tabSize:4,matchBrackets:!0,readOnly:!0,mode:i,scrollbarStyle:null,value:u.text().trim()})}}};ai=function(){var p=arguments,t,h,i=p[0],r,e,w,l,a;if(p.length&&v("kiosk.enabled")!==!1)if(r=i,e=typeof r=="number"&&r>0&&r<=1?r:!1,e!==!1&&(r=!0),typeof r=="boolean")i?(u||(ct(!0),w=!0,u=o("app-kiosk").attr("tabindex",0).toggleClass("app-fullscreen",v("kiosk.fullscreen")===!0),bu(),l=v("kiosk.density"),l&&u.addClass("app-density-"+l),a=gr(),a.length?u.insertAfter(a):u.appendTo(y),of(),y.addClass("app-is-kiosk")),e!==!1&&wu(u,e),sr(),vr&&w&&!nt()&&st({runOnce:!0})):u&&(ct(!1),u.remove(),u=null,f=null,c=null,_displayId=null,y.removeClass("app-is-kiosk"),n.resetUI(),$(".ui-page-active .app-wrapper").focus(),s.focus({lastFocused:!0}));else if(typeof i=="string"&&u){if(i==="get")return!fi||y.is(".app-ui-automation:not(.app-ui-automation-system)")?u:null;if(i==="ontop")return kt();i==="focus"?(t=kt(),t||(h=n.pageInfo(),h&&h.home&&(t=!0)),t&&sr()):i==="refresh"&&wf()}return t==null&&(t=u!=null),t};l.on("beforetouchinit.app",function(){n=t.touch;s=t.input;n.kiosk=ai;ut=n.settings;p=n.toWidth();n&&v("enabled")===!0&&bf()})})();