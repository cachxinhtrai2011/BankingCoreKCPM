/*!
* Data Aquarium Framework - Touch UI
* Copyright 2008-2021 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function yi(n){var t=lc.stack,r=lc.activeIndex,i;switch(n){case"length":i=t.length;break;case"list":i=t;break;case"next":i=t[r+1];break;case"prev":i=t[r-1];break;case"index":i=r;break;case"last":i=t[t.length-1];break;case"reduce":t.splice(--lc.activeIndex,1);break;default:i=t[arguments.length?n:r]}return i}function lr(){return $(this).is(":visible")}function gt(n){return n instanceof jQuery&&(n=n[0]),n.getBoundingClientRect()}function wg(n){n.trigger("vclick")}function ys(n){return n.find("a").data("context-action")}function bg(n,t){function k(n){var i=n.is(".app-collapsed");n.removeClass("app-collapsed");i&&t&&(v+=gt(n).height)}function it(n){var i=!n.is(".app-collapsed");i&&t&&(v+=gt(n).height,n.css("display","block"));n.addClass("app-collapsed");n.find(".app-selected").length&&(selectedItem=n)}function d(n,t){n.find(".app-btn").text("expand_"+(t?"less":"more")).attr("data-title",t?ca:fo)}var s=n,y=ys(n),f=y.depth,u,i=n.next(),h,o,c,l,w,r,g,a,e,nt,v=0,b,tt;if(n.is(".app-collapsed")||n.next().is(".app-collapsed")&&ys(i).depth===f+1&&(n=i),l=n,u=n.prev(),i=n.next(),y=ys(n),f=y.depth,n.is(".app-collapsed")){for(c=!0,k(n);u.is(".app-has-depth");){if(h=ys(u),h.depth<=f&&k(u),h.depth<f&&d(u,!0),h.depth===1)break;u=u.prev()}while(i.is(".app-has-depth")){if(o=ys(i),o.depth===1)break;l=i;o.depth<=f&&k(i);i=i.next()}}else{for(i=n.next();i.is(".app-has-depth");){if(o=ys(i),o.depth===f)break;l=i;it(i);d(i,!1);i=i.next()}d(n,!1)}if(t){for(et=!0,n=l;n.length;){if(w!=null?n.find(".app-btn").toggleClass("app-show-selected",w):(tt=n.find(".app-item-selected"),tt.length&&(w=n.is(".app-collapsed"),n.closest(".ui-listview").find(".app-show-selected").removeClass("app-show-selected"))),n.is(s))break;n=n.prev()}for(b="translate3d(0,-"+v+"px,0)",r=p("ui-listview",'style="display:block;z-index:1"').insertAfter(s),i=s.next().next();i.length;)n=i.next(),i.appendTo(r),i=n;a=s.closest(".ui-panel-inner");g=a.parent();nt=g.css("background-color");e=$(".app-stub-panel");c||(e.length||(e=p("app-stub-panel").appendTo(a)),e.css("height",e.height()+v+Math.ceil(gt(a).bottom-gt(e).bottom)-16));r.prevAll().each(function(){var n=$(this);n.css({"z-index":2,"background-color":n.css("background-color")==="rgba(0, 0, 0, 0)"?nt:""})});r.css("transform",c?b:"");setTimeout(function(){r.css("transition","transform 128ms ease-out");setTimeout(function(){r.css("transform",c?"":b);setTimeout(function(){r.prevAll().css({"z-index":"","background-color":""});var n=r.children().insertBefore(r);n.css("display","");r.remove();et=!1},128)},16)},16)}}function ar(n,t){return(n=st(n),n.is(".app-has-focus")&&t!==!1)?n:(n.closest("[data-container]").find('[data-control="label"][data-field="'+n.attr("data-field")+'"]').toggleClass("app-has-focus",t!==!1),n.toggleClass("app-has-focus",t!==!1))}function vc(n,t){if(!ku)return ku=!0,t==="forceclose"?n.panel("close",!0):n.panel(t||"toggle"),n}function ps(n,t){return dp?n:vc(n,t?"forceclose":"close")}function yt(){var t=arguments;if(t.length)n.busy(t[0]);else return n.busy()}function pet(){$(".app-scrollbar-hover").filter(function(){var n=$(this);return!n.is(".app-scrollbar-dragging")&&!n.data("hover")&&ai()-n.data("time")>2500}).addClass("app-scrollbar-contracting").on("transitionend",function(){$(this).is(".app-scrollbar-contracting")&&$(this).removeClass("app-scrollbar-contracting app-scrollbar-hover")})}function kg(n){var t=o("ui.actions.reverse")==!0;return(!vft||t)&&!(n._isWizard||n._controller=="MyProfile"&&n._viewId.match(/^(pas|ide)/))&&(lt("ui.actions.autoReverse")||t)}function dg(){var t=n._menuButton,i=t[0].scrollWidth;i!==t.width()?(c.addClass("app-ensure-font"),setTimeout(dg,16)):c.removeClass("app-ensure-font")}function te(n){di("focus")||bi({container:n,lastFocused:!0})}function gg(){var n=ft().closest(".app-page-inlineeditor").length;eu().blur();setTimeout(function(){n&&ht.activate();te()})}function fv(n){var t,r,i,u;n&&(typeof n=="string"?t=n:(t=n.address,r=n.zoom,i=n.api,baseMap=n.type),r||(r=16),i||(i="search"),t=encodeURIComponent(t),u=gr||ra?"http://maps.apple.com/?"+(i==="dir"?"daddr":"q")+"="+t:"https://www.google.com/maps/"+i+"/?api=1&zoom="+r+(i==="dir"?"&destination":"&query")+"="+t,fh("_blank:"+u))}function nw(t){var u=t.config,w=tw(u),e=t.data,s,l=k(t.dataView),f,a,v,y=e.components,i={},b,h,r,o,c,p;for(h in u)h.match(/^_/)||(v=u[h],o=v.field,r=h.toLowerCase(),r in e?(w&&(f=l.findField(o),f._geocode?(a||(a=l.row()),a[f.Index]==null&&(f=null)):f=null),f||(i[o]=e[r])):r.match(/^component/)&&y&&(r=r.substring(9),r in y&&(i[o]=y[r])),s=i[o],!v.trigger||e._reset||s!=null&&(typeof s!="string"||s.length)||(b=!0));w&&"map"in u&&!(u.map.field in e)&&(c=u.map.field,i[c]=null);b?(p=rs,i=c?{}:null,i&&(i[c]=null)):p=t.data.name;i&&wi({dataView:l,values:i,autoFill:!1});t.focus&&te();t.notify&&n.notify(p)}function tw(n){return!!n._type.match(/^(address|geocode)$/)}function nn(n,t){tw(n)&&"map"in n&&wi({dataView:t,values:[{name:n.map.field}],autoFill:!1})}function tn(t,i,r,u){var l=r._type,e,o="_canceled"in r,s,h,c;if(!r._canceled&&tw(r))if(n.busy())setTimeout(function(){tn(t,i,r,u)},100);else{e={autofill:l};s=t._controller;for(fname in r)fname.match(/^_/)||(h=r[fname],c=i[h.index],e[fname]=c,c==null||h.trigger||(o=!0));r._supported!==!1?f.execute({controller:s,view:t._viewId,command:"AutoFill",trigger:JSON.stringify(e)}).done(function(i){var l=i[s].AutoFill,h=l!=null,c=h?JSON.parse(l):[],a=c.length,e,f;a?a>1||o?(e=[],f=u.find('[data-field="'+r[r._fields[0]].field+'"][data-control="field"]'),c.forEach(function(n){e.push({text:n.name,context:{config:r,dataView:t._id,data:n,focus:!0},callback:nw})}),o&&e.push({},{text:cp.CancelButton,callback:function(){r._canceled=!0}}),yr({anchor:f,arrow:f.length>0,x:f.length?f.offset().left:null,items:e})):nw({config:r,dataView:t,data:c[0],notify:!0}):h?n.notify(rs):(r._supported=h,nn(r,t))}):nn(r,t)}}function rn(n,t){var e=n._autoFill,o=e&&e[t],u,s,f;if(!o&&!e){n._autoFill={};u={};s=new RegExp(vd.source,"g");n._allFields.forEach(function(n){var i=n.Tag,t;if(i)for(t=s.exec(i);t;)t[1]in u||(u[t[1]]=t[3]),t=s.exec(i)});for(f in u){var h=u[f],c=new RegExp(RegExp.escape(f)+"\\-(\\w+)"),i=n._autoFill[f]={_type:h,_fields:[]},r=[];n._allFields.forEach(function(n){var u=n.Tag,o=n.Name,e=u?u.match(c):null,t;e&&(t=e[1],i[t]={field:o,index:n.Index},u.indexOf(f+"-trigger")!==-1&&r.push(t),i._fields.push(t))});r.length||(h==="address"&&"address1"in i?r.push("address1"):h==="geocode"&&("latitude"in i&&r.push("latitude"),"longitude"in i&&r.push("longitude")));r.forEach(function(n){i[n].trigger=!0})}o=n._autoFill[t]}return o}function ev(n,t,i,r,u){var s,h,l;if(n&&n.length){if(s=0,i&&!ni(i).length)if(h=i.prev(),h.is(".dv-item")||h.is(".app-group")&&h.prev().is(".dv-item"))s=d(i,"margin-bottom");else{t.scrollTop(0);return}t||(t=g(n));var c=t.data("sticky-header"),f=gt(n),e=gt(t),v=c?gt(c):e,a=Math.max(e.top,c?v.bottom:e.top),o;if(f.bottom+s>e.bottom){if(o=f.bottom+s-e.bottom+4,f.height>e.height){if(f.top<e.bottom)return;o-=f.height-e.height+7}}else f.top<a&&(o=f.top-a-4);o&&(!u||o>f.height*u)&&(l=t.scrollTop()+o,r===!1?af(t,l):t.scrollTop(l))}}function wet(t){function s(t){n.pageInfo().deleted=!0;o=u.commandRow();u.commandRow(t);u.headerText(t);u.command(t,i.editing()?"Edit":"Select",r._viewId);tr(function(){u.commandRow(o)})}var r=dt(),i,u,o,e;if(r&&r._parentDataViewId&&!yt()&&(i=k(r._parentDataViewId),i&&i._controller===r._controller&&i.get_isGrid()))return u=i.extension(),e={controller:i._controller,view:i._viewId,odp:i._odp,_filter:i._filter,sort:i._sortExpression,requiresAggregates:!1,sync:r.get_selectedKey(),pageSize:3,includeRawResponse:!0},f.execute(e).then(function(n){var r=-1,u=n.rawResponse.Rows;u.forEach(function(n,t){i.rowIsSelected(n)&&(r=t)});r!==-1&&t==="right"&&(r===2?(e.sync=null,e.pageIndex=n.pageIndex+1,e.requiresRowCount=!1,f.execute(e).then(function(n){s(n.rawResponse.Rows[0])})):n.pageSize*n.pageIndex+r<n.totalRowCount-1&&s(u[r+1]))}),!0}function ov(){return pi.appName||"Code On Time"}function wr(){return!!r.isVirtual}function bet(){window.webkit?window.webkit.messageHandlers.invoke.postMessage({method:"exit",args:{}}):b.location.href="cloudontime://exit/?{}"}function di(){return n.kiosk.apply(this,arguments)}function un(n,t,i){var r=!!$(n.relatedTarget).find('[data-layout="form"]').length;return r&&(clearTimeout(ig),t&&(i?ig=setTimeout(t,i):t())),r}function eu(){return $(document.activeElement)}function fn(){return!!b.location.host.match(/^localhost\b/)}function ket(){return!!$(".designer-frame").length}function ws(){return c.is(".designer")}function yc(){var t=b.location.host+"_DevToolsDevice",n;if(arguments.length)f.storage.set(t,JSON.stringify(arguments[0]));else return n=f.storage.get(t),n&&!ws()&&(n=JSON.parse(n)),n||{name:"Responsive"}}function en(n,t){var i=0;return n[2]<t[2]?i=1:n[2]>t[2]&&(i=-1),i}function on(n){var t=n.text();return t.length>300&&(t=t.substring(0,300)+"..."),t.match(/</)&&(t=sf(t)),t}function sn(n){var t,i,u,r;t=g(n);i=t.offset();r=n.offset();r.top<i.top?u=-(i.top-r.top+8):r.top+n.outerHeight()>i.top+t.height()&&(u=r.top+n.outerHeight()-(i.top+t.height())+8);u!=null&&t.scrollTop(t.scrollTop()+u)}function cf(n,t){(n||(n=st($(".app-data-input")).data("field"),n))&&(n&&typeof n!="string"&&(n.closest&&(n=i.elementToField(n)),n=n.Name),t||(t=l()),t.data("last-focused-field",n))}function hn(n){var t=n.field,u=n.lookupInfo,f=n.row,e=tt().dataView,r=i.methods.lookup._rowToValues(t,e,f);r&&ou(function(){tt(t._dataView._id).autoFocus=!1;u.change(r)})}function det(n){dt().extension().executeInContext("New",n.ItemsNewDataView,!0)}function get(){kr._defaultUseCase="ObjectRef";dt().extension().executeInContext("Select","editForm1",!0)}function sv(n){var i=n.is("iframe"),t=i?n[0].contentDocument.body.innerHTML.trim():n.val();return i&&t.match(/^(\s*(&nbsp;|<\/?(p|br)\/?>)\s*)+$/)&&(t=""),t}function hv(){var t=n.promo(),i,u;return!rt||!t.length||!t.is(":visible")||li()&&r.splitTop?!1:(i=rt.offset(),u=t.offset(),!(i.left+rt.outerWidth()<u.left||i.left>u.left+t.outerWidth()))}function cn(n){var i=l(),t;return i.is(".app-page-modal")||li()&&r.splitTop?!1:(t=i.find(".app-bar-footer"),(t.find(".app-bar-tabs").is(":visible")||t.find(".app-bar-buttons").length)&&(!n||n(t)))}function iw(){return l(".app-bar-footer")}function not(){var n=$(".app-page-modal-root .app-bar-footer");return n.length&&n.css("transform")!=="none"?n:null}function ln(){rt.removeData("busy shown").addClass("app-hidden")}function rw(){var t,tt,h,y,st;if(!rt){rt=p("app-bar-notify app-hidden").appendTo(c).on("vclick",function(t){function i(){var r=n.promo(),u=rt.outerHeight(),h=cn(function(n){return n.css("transform")!=="none"}),f={transition:"transform 200ms ease-in",transform:""},e=not(),o=hv(),c=si(),s=$(t.target),i=s.is(".ui-btn")?rt.data("notify"):null;o&&r.css({transition:"transform 200ms ease-in",transform:"translate3d(0,"+u+"px,0)"});e&&e.css(f);i&&s.addClass("ui-btn-active");rt.data("busy",!0).css({transform:"translate3d(0,"+u+"px,0)"}).one("transitionend",function(){$(".ui-page").find(".app-bar-footer").css({transition:"",transform:""});setTimeout(function(){if(ln(),o&&(r.css({transition:"",transform:""}),c===si()&&n.promo(!0)),i){var t=$.Event(i.buttonEvent);t.notifyData=i;$(document).trigger(t)}},16)});h&&iw().css(f)}return rt.data("cancel")===!1?(rt.removeData("cancel busy shown").addClass("app-hidden"),$(".ui-page .app-bar-footer").css({transition:"",transform:""}),a.css({transition:"",transform:""})):(rt.is(".app-hidden")||(vu?setTimeout(function(){rt.trigger("vclick")},100):i()),ir()),!1});o("ui.notify.transparent")===!0&&rt.addClass("app-bar-notify-transparent");$(document).on("notifymore.app",function(n){f.alert(n.notifyData.text)})}if(t=ka[0],rt.data("busy")||rt.data("shown")&&(!t||t.force!==!0)||vu||!wa&&!t.force)setTimeout(rw,100);else if(t){var i=t.text,b=t.buttonText||(t.buttonEvent?fr:null),u=t.duration,k,a=n.promo(),ht=a.is(":visible"),it=cn(),d,v=r.width>568&&!it||gu()||di(),g=v&&o("ui.notify.location")==="left",ut=r.left+(w.left.visible?w.left.width:0),nt=r.left,ft=rt.data("notify"),et=i===!1;if(ka.splice(0,1),ft&&ft.text===i&&rt.is(":visible")||et){et&&rt.trigger("vclick");return}rt.data({busy:!0,shown:!0,notify:t}).addClass("app-hidden").css("transition-property","none");rt.toggleClass("app-bar-notify-center",v).toggleClass("app-bar-notify-left",g).css("left","");ht&&n.promo(!0);rt.removeClass("app-hidden");i=ah(i).trim();i.length>250&&(i=i.substring(0,250)+"...",t.buttonEvent||(t.buttonEvent="notifymore.app",b=e.More));i=i.replace(/\n\s*/g,"<br/>");tt=ai();h=r.splitLeft;b?(s("ui-btn").text(b).appendTo(rt.empty()),s("app-text").html(i).appendTo(rt)):rt.html(i);v&&(g?nt=ut+(w.left.visible?-8:16):(y=ot()||l().is(".app-modal-keyboard")&&ot(l().prevAll(".ui-page").first()),nt=(li()||y?ut:0)+(h&&y?h:0)+((h&&li()?h:h&&y?r.splitRight:r.width+r.left*2)-rt.outerWidth())/2));rt.data("timestamp",tt).css({bottom:r.bottom+(g?16:0),left:nt,right:v?"":r.right});k=rt.outerHeight();rt.css({transform:"translate3d(0,"+k+"px,0)",bottom:r.bottom});u==null&&(u="short");u==="short"?u=o("ui.notify.duration.short")||2500:u==="medium"?u=o("ui.notify.duration.medium")||5e3:u==="long"&&(u=o("ui.notify.duration.long")||1e4);typeof u=="string"&&(u=2500);d=hv();st=si();setTimeout(function(){d&&a.css({transition:"transform 200ms ease-in",transform:"translate3d(0,-"+k+"px,0)"});it&&uw();rt.one("transitionend",function(){rt.removeData("busy");rt.css("transition-property","");d&&st===si()&&(n.promo(!0),a.css({transform:"",transition:""}));setTimeout(function(){rt.data("timestamp")===tt&&rt.trigger("vclick")},u)}).css({transform:"","transition-property":"transform"})},16)}}function uw(n){var t="transform 200ms ease-in",i;rt&&rt.is(":visible")&&!l().is(".app-page-modal")&&!rt.is(".app-bar-notify-center,.app-bar-notify-left")&&(i=iw().css({transition:n?"":t,transform:"translate3d(0,-"+rt.outerHeight()+"px,0)"}),n&&i.css("transiton",t))}function fw(n){var t=n.sidebar||fy();t.length&&(wr()?t.css({minHeight:r.height,height:r.height,left:r.left,top:r.top}):t.css({minHeight:"",height:"",left:"",top:""}))}function an(n){var t=n.accountManager||re();t.length&&(wr()?t.css({left:r.left,top:r.top,right:r.right,bottom:r.bottom}):t.css({left:"",top:"",right:"",bottom:""}))}function ew(t){var u=t.toolbar||(n?n._toolbar:$(".app-bar-tools")),i;r.toolbarHeight||(r.toolbarHeight=u.outerHeight());i=r.toolbarWidth;i&&(i+=pt.divider);wr()?u.css({left:r.left,top:r.top,width:i||r.width}):u.css({left:"",top:"",width:i||""})}function bs(t){var s,i=ls.width(),u=ls.height(),e=ws()?null:o("ui.banner.height"),h,a;t||(wr()?(s=yc(),t={isVirtual:!0,width:s.width||i,height:s.height||u},s.name==="Responsive"&&e&&(t.width=i,t.height=u,r.deviceWidth=r.deviceHeight=null)):t={width:r.width,height:r.height});t.isVirtual==null&&(t.isVirtual=wr());t.width||(t.width=r.width);t.height||(t.height=r.height);var f=$(".app-virtual-screen-bar"),l=r.isVirtual=t.isVirtual,v=t.width==="auto";if(e&&!l&&(l=t.isVirtual=r.isVirtual=!0,t.width=r.deviceWidth=i,t.height=r.deviceHeight=u),l){if(v?(t.width=r.deviceWidth=i-60,t.height=r.deviceHeight=u-60):(r.deviceWidth&&(t.width=r.deviceWidth,t.deviceWidth=null),r.deviceHeight&&(t.height=r.deviceHeight,t.deviceHeight=null),t.width>i&&(r.deviceWidth=t.width,t.width=i-40),t.height>u&&(r.deviceHeight=t.height,t.height=u-40)),r.width=t.width,r.height=t.height,r.physicalWidth=i,r.physicalHeight=u,r.left=Math.ceil((i-t.width)/2),r.top=Math.ceil((u-t.height)/2),r.right=i-r.left-r.width,r.bottom=u-r.top-r.height,e&&(h=$("#app-banner"),h.length||(h=$('<div id="app-banner"><\/div>').appendTo(c)),h.css({left:r.left,top:r.top,width:r.width,height:e,minHeight:e,maxHeight:e}),r.top+=e,r.height-=e),ew(t),!f.length)for(a=0;a<6;a++)p("app-virtual-screen-bar").appendTo(c);f=$(".app-virtual-screen-bar");e&&i===t.width?f.remove():($(f[0]).css({width:r.left-1,right:"auto"}).addClass("app-left"),$(f[1]).css({width:r.right-1,left:"auto"}).addClass("app-right"),$(f[2]).css({height:r.top-1,bottom:"auto"}).addClass("app-top"),$(f[3]).css({height:r.bottom-1,top:"auto"}).addClass("app-bottom"),$(f[4]).css({width:r.left-1,right:"auto"}).addClass("app-left2"),$(f[5]).css({width:r.right-1,left:"auto"}).addClass("app-right2"));fw(t)}else r.width=i,r.height=u,r.physicalWidth=i,r.physicalHeight=u,r.left=0,r.top=0,r.right=0,r.bottom=0,ew(t),f.remove();r.portrait=r.width<r.height;fw(t);an(t);c.toggleClass("app-virtual-screen",wr());rt&&rt.is(":visible")&&(vr(!1),ln(),n.notify(rt.data("notify")));n.indicator("reset")}function o(n,t){var f,o=arguments.length;if(o===1&&(f=ga[n],f!==undefined||n in ga))return f;for(var s=n.split(/\./g),e=s.length,r,i=pi,u=0;u<e;u++)if(r=s[u],o===2)u===e-1?(i[r]=t,ga[n]=t):i=i[r]==null?i[r]={}:i[r];else{if(u===e-1)return f=i[r],ga[n]=f,f;if(i[r]!=null)i=i[r];else if(u<e-1)i[r]={},i=i[r];else return null}}function lt(n){return o(n)!==!1}function vn(n){return n.tagName==="DIV"&&!n.className.match(/app\-drop\-box/)}function yn(n,t,i){return(n.ctrlKey===t.ctrlKey||i&&n.ctrlKey===t.metaKey)&&n.altKey===t.altKey&&n.shiftKey===t.shiftKey&&n.metaKey===t.metaKey}function ks(t,r,u){var c=t.keyCode||t.which,f,e,o,s,h;if(r)for(o=0;o<y.list.length;o++)if(e=y.list[o],e.key&&(f=e.shortcut,f||(f=e.shortcut=pn(e.key,e)),f.which===c&&yn(f,t,e.metaKey)))return t.preventDefault(),t.stopPropagation(),u||y.range("exec",{command:e.command,argument:e.argument,validate:!0}),!0;if(bu.list.length&&!u&&(s=bu.keyCodes.indexOf(c),s!==-1&&(f=bu.list[s],yn(f,t)&&!(f.which===13&&ft().is("iframe,textarea")))))return i.popup(":visible")&&f.shortcut==="Enter"?!1:(h=[],n.navContext(h),$(h).each(function(){var n=this;if(n.shortcut===f.shortcut)return n.inspect||ws()||lf(!0),setTimeout(yf,100,n),!1}),t.preventDefault(),t.stopPropagation(),!0)}function pn(n,t){for(var r,i={shortcut:n,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},e=n.split(/\s*\+\s*/g),u=0;u<e.length;u++)if(r=e[u].toLowerCase(),r.length>1)switch(r){case"ctrl":i.ctrlKey=!0;break;case"alt":i.altKey=!0;break;case"shift":i.shiftKey=!0;break;case"meta":i.metaKey=!0;break;default:i.which=f.keyCode[r];i.which||(i.invalid=!0)}else i.which=t&&t.which!=null?t.which:r.toUpperCase().charCodeAt(0);return bu.cache[n]=i,i}function ds(n,t){var i=$(".app-popup");if(i.length&&(!t||i.is(t)))return i.popup("close",n),!0}function lf(n){var t=$(".ui-panel-open");return t.length?(ps(t,n),!0):ds(n)}function cv(n,t){var i=t===!1?n.text:n.tooltip||n.text,r=n.shortcut;return r&&t!==!1&&(i+=" ("+r+")"),i}function lv(n,t){f.AccountManager.avatar(n,t)}function tot(n){ac=io(n)}function iot(n){var t=$(this),i;ac&&(i=io(n),ac.y<i.y?(t[0].scrollHeight<t.height()||t.scrollTop()==0)&&n.preventDefault():ac.y>i.y&&(t[0].scrollHeight<t.height()||t.outerHeight()+t.scrollTop()>=t[0].scrollHeight)&&n.preventDefault(),ac=null)}function pc(n,t){var i=n.is(".ui-panel-inner,.app-wrapper")?n:n.find(".ui-panel-inner");if(gr)if(t)i.off("touchstart touchmove");else i.on("touchstart",tot).on("touchmove",iot);i.is(".ui-panel-inner")}function ow(){vr(!1);setTimeout(vr,250)}function vr(n){arguments.length||(n=!0);vu=!n}function rot(n){ii.navigate("#"+n);yi().pageUrl=n}function wc(n){n=n.split(/@/g);n=n[0];n=n.split(/\\/g);n=n[n.length>1?1:0];var t=n.replace(/\W/g," ").trim(),i,u="",r;for(t||(t=n),t=t.split(/\b/g),r=0;r<t.length;r++)if(i=t[r],i&&(i=i.trim()),i&&(u+=i.substring(0,1)),u.length===2)break;return u}function uot(n,t){var u,i,f=/(\w+)(\s*=\s*(\w+))?/g,r=n.ContextFields;if(r)for(i=f.exec(r);i;){if(i[1]==t.Name){u=n._dataView.findField(i[3]?i[3]:i[1]);break}i=f.exec(r)}return u}function sw(n){return n.match(/^(=|<>|<|>|<=|>=|(\$(between|in|notin|beginswith|doesnotbeginwith|contains|doesnotcontain|endswith|doesnotendwith)))$/)!=null}function gs(n){var i=n._dataView,t=cw(i,n,[]);return t=t.length?JSON.stringify(t):"",n.Name+"_listOfValues_"+t.toLowerCase().replace(/\W+/g,"_")}function hw(n){var t=n._dataView;t.session(n.Name+"_listCache",null);t.sessionRemove(gs(n))}function cw(n,t,i){for(var h=n.get_contextFilter(t,n.extension().collect()),o=0,r,e,y=t.ItemsStyle||"",l=n.editRow(),a,s,c;o<h.length;)if(r=h[o],r.Literal)o++;else{e=uot(t,r);var p=n.findField(e.Name+"_op2"),v=n.findField(e.Name+"_op"),u=null,w;p&&(u=l[p.Index]);u==null&&v&&(u=l[v.Index]);u==null&&(u="=");w=sw(u);u.match(/^\$/)&&(u+="$");r.Value==null?v?(h.splice(o,1),u&&!w&&i.push(r.Name+":"+u)):(o++,i.push(r.Name+":=null")):e&&(e.ItemsTargetController||e.ItemsStyle=="CheckBoxList"?(h.splice(o,1),a=f.csv.toArray(r.Value),a.forEach(function(t,i){a[i]=n.convertFieldValueToString(e,t)}),u=="="&&(u="$in$"),i.push(r.Name+":"+u+a.join("$or$"))):(u=="$between$"&&(r.Value2=l[n.findField(e.Name+"_v2").Index],r.Value2==null?u=">=":r.Value>r.Value2&&(r.Value=[r.Value2,r.Value2=r.Value][0])),r.Value=n.convertFieldValueToString(e,r.Value),r.Value2!=null&&(r.Value2=n.convertFieldValueToString(e,r.Value2)),u=="="?(o++,i.push(r.Name+":="+r.Value)):(h.splice(o,1),i.push(r.Name+":"+u+(r.Value!=null?r.Value:"")+(r.Value2!=null?"$and$"+r.Value2:"")))))}return(y.match(/^(AutoComplete|Lookup)$/)&&t.ItemsTargetController||y=="CheckBoxList")&&(s=l[t.Index],s!=null&&(s=f.csv.toArray(s.toString()),s.forEach(function(n,t){s[t]="%js%"+f.serializer.serialize(n)}),i.push(t.Name+":$notin$"+s.join("$or$")))),c=t.Extended,c&&c.filter&&(c.filter.forEach(function(n){var r=n.match(/^(.+?)\:/);r&&r[1]!=t.Name&&i.push(n)}),c.search.forEach(function(n){i.push(n)})),h}function ie(n){var e=n[0],t,i,u=e.className,o=w.left.visible?w.left.width:0,f=w.left.visible?w.right.width:0;return u.match(/\b(app\-wrapper)\b/)?(t=n.closest(".ui-page")[0].className,i=t.match(/\b(app\-page\-modal|app\-has\-panel)\b/)&&t.indexOf("app-page-modal-never")==-1?d(n,"width"):r.width-o-f):i=u.match(/\b(app\-bar\-tools)\b/)?r.width-f:n.outerWidth(),i}function wn(n){return n.ItemsDataController&&n.ItemsNewDataView}function av(){return r.width>=oi(o("ui.modal.when")||"md")&&r.height>=oi("xs")||lw().length>0}function bn(){return r.width>420&&r.height>=600}function lw(){return $(".app-page-modal-root")}function bc(n,t){t||(t=l().prevAll(".ui-page").first().attr("id"));$(document).one("pagecanceled.app",function(i){if(i.namespace==="app"){var r=si();t===r||r==="Main"?n():l().prevAll(".ui-page").filter(function(){return $(this).attr("id")===t}).length&&bc(n,t)}})}function tr(n){$(document).one("pagereadycomplete.app",function(){kn(n)})}function kn(n){document.readyState==="complete"?n():setTimeout(kn,32,n)}function ou(n){i.ignoreErrors=!0;n&&typeof n=="function"&&tr(n);et=!0;wp.go(-1)}function fot(n){var t=n?n.page.find(".app-page-header").filter(function(){return!$(this).is(".app-page-header-fixed")}):null;c.is(".app-page-header-hidden")||n&&n.headerText==!1?lu(!1,t):lu(n&&n.headerText||n&&n.dataView&&n.dataView.get_view().Label||document.title,t)}function gi(){}function dn(t){var i=typeof t=="string";n.infoView(k(i?t:t.id),i)}function eot(n,t){n.refresh_token&&f.userName()!=n.name?dy(n.name):kt(t,function(){dy(n.name)})}function vv(){return b.location.pathname.match(/\/login(\.aspx|$)/i)}function gn(){function t(){n.showAccountManager(null,!0)}function i(){setTimeout(t,1e3)}if(n._started)t();else{f.AccountManager.count()&&re(null,"loading");hr.one("pagereadycomplete.app",so&&(gr||ra)?i:t)}}function ntt(){if(lt("splash.enabled")){if(sessionStorage){if(sessionStorage.spashShown)return;sessionStorage.spashShown=!0}var n=Math.max(1e3,o("splash.duration")||2500)-500;re(null,"splash");setTimeout(function(){re().find(".app-acc-close").trigger("vclick")},n)}}function oot(){var i=b.location.href.match(/(\?|&)_accMan=(\w+)/),h=n.returnUrl(),o=ub(".TOKEN"),l=ub(".PROVIDER"),a,e;if(o&&tst(".TOKEN",null,-1),sessionStorage&&(a=sessionStorage.signedOut,sessionStorage.removeItem("signedOut")),!ho&&f.AccountManager.enabled()||i){var s=f.AccountManager.list(),t=s._lastUser&&s[s._lastUser],v=!i&&t&&!!t.refresh_token,r=i?i[2]:null,u=r==="loading"||r==="splash",y=r==="list";if(o&&(t={name:l,refresh_token:o,Handler:l},v=!0,u=!1),v||u){if(u&&!t&&(t={UserName:"Test"}),e=[],r!=="splash"&&(e.push({text:t.name,context:t}),e.push({text:of})),re(e,r),u)return;f.switchUser(t,function(){var n=c.data("public")?b.location.href:h||ne;i||b.location.replace(n)},function(){yt(!1);t.access_token=null;t.refresh_token=null;f.AccountManager.set(t);gn()})}else(y||h||a)&&!vv()?gn():ho||ntt()}else ho||ntt()}function re(n,t){function v(n,t){t.match(/url\(/)?n.css("background",t):n.css("background-image","url("+t+")");n.css("text-indent","-9999px")}var i=$(".app-acc-man"),o,h,u,l,a,b;if(!arguments.length)return i;if(i.length)i.show().appendTo(c)[0].className="app-acc-man",o=i.find("ul").empty();else{i=p("app-acc-man").appendTo(c);p("app-acc-space").appendTo(i);var r=p("app-acc-inner").appendTo(i),y=p("app-logo").appendTo(r).html(ov()),w=p("app-acc-list").appendTo(r);an({accountManager:i});h=$('<a class="app-acc-close"><i class="material-icon">close<\/i><\/a>').attr("title",lp).prependTo(r);u=pi.splash;u&&(l=u.background,a=u.logo,l&&v(i.find(".app-acc-space"),f.resolveClientUrl(l)),a&&v(y,f.resolveClientUrl(a)));h.on("vclick",function(){kt(h,function(){ds();c.removeClass("app-has-acc-man");i.fadeOut(fi)})});o=nr().appendTo(w).on("vclick","a",function(n){var r=$(n.target),t=r.closest("a"),u=t.data("context"),i;return r.is(".app-btn-more")?(i=u.context.name,kt(r,function(){yr({anchor:r,items:[{text:i,user:i,keepOpen:!0,callback:gi,selected:!0,depth:1},{},{text:se.LoginButton,icon:"material-icon-arrow-forward",callback:function(){t.trigger("vclick")}},{text:e.Forget,icon:"material-icon-delete",callback:function(){f.AccountManager.remove(i,!0);i==f.userName()&&gy();t.remove()}}]})})):u.callback&&kt(t,function(){u.callback(u.context,t)}),!1});b=p("app-acc-footer").appendTo(r).html($("#PageFooterBar,footer small").html());w.css({top:y.outerHeight(!0)+16,bottom:b.outerHeight(!0)})}c.addClass("app-has-acc-man");t&&t!=="loading"&&t!=="splash"&&!i.is(".app-acc-man-loading")&&i.hide().fadeIn();t&&i.removeClass("app-acc-man-loading app-acc-man-switch").addClass("app-acc-man-"+t);$(n).each(function(){var t=this,c=ct().appendTo(o),n=vt().appendTo(c),l=p("app-user-name").text(t.text).appendTo(n),r=t.context,i=r&&r.name,h,u;t.icon&&bt(t.icon,n);n.data("context",t);i&&(n.addClass("app-avatar"),l.text(i),u=r.Handler||r.email,u&&u!==i&&n.append(s("app-user-email").text(u)),i===f.userName()?n.addClass("app-selected"):r.refresh_token||n.append(s("app-user-signed-out").text(e.SignedOut)),h=$('<i class="app-icon-avatar">'+wc(i)+"<\/i>"),n.prepend(h),lv(i,h),t.callback&&s("app-icon material-icon app-btn-more").appendTo(n).attr("title",fr));t.callback||n.addClass("app-link-disabled")})}function ttt(n,t){n._syncKey=t;n._selectedKey=t}function sot(){return ta>=144}function nh(n){n.type!=="taphold"&&(ki=io(n))}function su(n){return ki&&ki.x||n}function th(n){return ki&&ki.y||n}function hot(n){var t=n.find(".ui-popup-arrow-container");return n.outerHeight()+(t.length?t.height()/2:0)+5}function kc(n,t,i){if(n.multiSelect()){var r;if(t||(t=(si()===n._id?l():ni(n)).find(".app-listview .ui-btn.app-selected"),r=!0),!t.is(".app-checked"))return n._selectedKeyList.length&&hy(n,r),yb(n,t,i),!0}}function itt(n){var t=l(),i=d(t,"width"),r=d(t,"height"),u=d(t,"top"),f=d(n,"width"),e=d(n,"height"),o=d(n,"top");(i!==f||r!==e||u!==o)&&ei(n)}function gu(){return c&&c.is(".app-ui-automation:not(.app-ui-automation-system)")}function aw(n){return n.is(".app-page-modal-centered,.app-page-modal-fullscreen,.app-page-modal-fit-content,.app-page-modal-dock,.app-ui-automation-root")||di()}function yv(){return r.width>1200?80:r.width<500?25:35}function vw(n,t){var v,h,i,e,u,s,o,k=yv(),b=[],f=[],a,y,w;if(n||(n=l()),n.is(".app-page-modal")){for(h="#"+n.attr("id"),u=yi("length");u--;u>=0){if(y=yi(u),f.length)if(h=y.hash,h){if(i=$(h),!i.length||!i.is(".app-page-modal"))break}else break;else y.hash===h&&(i=n);i&&(f.push(i),aw(i)&&(e=i))}for(a=f.length,e&&(u=f.indexOf(e),u<a-1&&(e=f[u+1])),u=0;u<a;u++){if(i=f[u],u>0)if(e)itt(i.addClass("app-page-modal-revealed"));else{if(t=f[u-1],v=r.physicalWidth-t.offset().left+k,v>r.physicalWidth*1.75||ot(i))break;itt(i.addClass("app-page-modal-partial"));i.css("right",v);o||(o=i)}e&&(w=i.css("width")+","+i.css("height"),a>1&&(b.indexOf(w)===-1?(e===i||i.is(".app-modal-keyboard")||i.addClass("app-page-modal-centered"),b.push(w)):i.addClass("app-page-modal-obscured")));e===i&&(e=null)}i=f[a-1];i&&ot(i)&&ei(i);s=$(".app-page-modal-glass-pane");s.length||ot(n)||(s=p("app-page-modal-glass-pane"),c.addClass("app-has-modal-glass-pane"));o&&f.indexOf(o)===1?(s.addClass("app-page-modal-glass-pane-partial").css({right:o.css("right"),top:o.css("top"),height:o.css("height")}).insertAfter(o),c.addClass("app-has-modal-glass-pane-partial")):(s.css({right:0,top:"",height:""}).removeClass("app-page-modal-glass-pane-partial").insertBefore(f[0]),c.removeClass("app-has-modal-glass-pane-partial"));ot(n)&&s.remove();gu()&&s.insertBefore(".app-ui-automation-root")}}function cot(n){var t=n.find('[data-wrap="adaptive"]');if(t.length)if(ot(n))t.attr("data-wrap","true");else{var i=[],r=30,u=0;t.find("[data-control]").each(function(){var t=$(this),u=t.data("control"),n;(u==="label"||u==="field")&&(n=t.height(),n&&(i.push(n),n<r&&(r=n)))});i.forEach(function(n){n>r&&u++});u>i.length*.2&&(t.attr("data-wrap","true"),ei(n))}}function rtt(t){var v,h,k,a,d;if(pi){if(kp=!1,vr(),ur(),trt(!1),v=n.pageTransitionCallback,v){n.pageTransitionCallback=null;yt(!1);setTimeout(v);return}irt();wa=!1;var f=t.toPageInfo||tt(),s,y=t.options,o=y&&y.fromPage&&y.reverse;f&&f.initCallback&&(f.initCallback(),f.initCallback=null);yt(!1);var u=$(t.toPage),w=u.is(".app-page-modal"),e=$(t.prevPage),b=e.is(".app-page-modal");if(o?li()&&($(".app-reading-pane-detail").addClass("app-hidden"),c.removeClass("app-has-reading-pane-right app-has-reading-pane-bottom app-has-reading-pane")):ot()&&(u.removeClass("app-hidden"),c.addClass("app-has-reading-pane app-has-reading-pane-"+(r.splitTop?"bottom":"right"))),!et&&f&&(s=f.dataView),u&&e&&u.attr("id")===e.attr("id"))return!1;rp(u);ei(u);cot(u);yi("index")>1&&yi().hash===yi("prev").hash&&yi("reduce");h=n._modalBackground;(!b||ot(e))&&w?(ot(e)||e.addClass("app-page-modal-root"),h||(h=n._modalBackground=p("app-page-modal-background")),h.insertBefore(u).show(),ot(u)&&h.hide()):b&&(!w||ot(u))&&h&&h.hide();k=!!(s&&s.tagged("modal-background-transparent"));c.toggleClass("app-has-modal-background-clear",s&&!!(s.tagged("modal-background-clear")||s._inlineEditor!=null&&ot(o?f.page.prevAll(".ui-page:first"):e)));c.toggleClass("app-has-modal-background-transparent",k);c.toggleClass("app-has-modal-glass-pane-transparent",k&&b&&u.prevAll(".ui-page").is(".app-page-modal"));$(".app-page-modal-partial").removeClass("app-page-modal-partial").css("right","");$(".app-page-modal-centered,.app-page-modal-obscured").removeClass("app-page-modal-centered app-page-modal-obscured");o&&e.removeClass("app-page-modal-revealed");w?vw(u,e,o):(li(u)||u.removeClass("app-page-modal-root"),$(".app-page-modal-glass-pane").remove(),c.removeClass("app-has-modal-glass-pane"));a=f&&f.scrollable||g(u);nf(a.find(".app-listview"));tf(a);vf(u);uu(a);iy(a);gw();cu&&!bp&&n._toolbar.css("visibility",si()==="Main"||l()&&l().is(".app-page-modal")?"hidden":"");uf(f?f.page:null);i.popup("hide");$(document).trigger($.Event("scrollablepageready.app",{scrollable:a}));o=yi("index")<lc.previousIndex;uw(!0);yo()!=="slide"||(!e||e.is(".app-transition-none")||!o)&&(u.is(".app-transition-none")||o)?(d=f&&f.dynamic&&!f.delayed,d?(f.delayed=!0,setTimeout(pv,0,f,o,e)):o||!ot(u)||s._skipAnimate?pv(f,o,e):(u.hide(),et=!0,setTimeout(function(){u.fadeIn(128,function(){et=!1;pv(f,o,e)})}))):aot(e,u,o,function(){pv(f,o,e)})}}function pv(t,i,r){var c=t?t.scrollable:g(),w=$.Event("pageready.app"),b,e,u,f,k,v,y,o,p,a,s;t&&(u=w.dataView=t.dataView,lot(t));de(100);yt(!1);$(document).trigger(w);uh(t?t.dataView:null);i&&r.is(".app-modal-keyboard")||(fi(!1,0),pf(null,null,t?t.scrollable.find(".app-echo"):null));t&&(b=t.autoFocus,t.autoFocus=!0,e=t.calculate,e&&(delete t.calculate,e=u.findField(e),u._raiseCalculate(e,e)));n.garbageCollector();i&&n.syncData(t);f=l();v=f.data("inputExecute");wa=!0;i&&(k=n.syncWithOdp(u));v&&(f.removeData("inputExecute"),wi(v));u&&u._inlineEditor&&(yl(),rt&&!rt.is(".app-hidden")&&rt.trigger("vclick"));!i&&f.is(".app-modal-keyboard")&&ei(f);hr.trigger($.Event("pagereadycomplete.app",{dataView:u,reverse:i,page:f}));k||et||c&&c.length&&(!eu().closest("[data-control]").length||i)&&(ir(c),h||b===!1||bi({container:c,lastFocused:i===!0}));i?(y=yi("next"),o=y&&y.hash,o&&o.match(/^#/)&&(p=n.pageInfo(o.substring(1)),p&&($(o).trigger("pagecanceled.app"),a=p.dataView,s=a&&a._survey,s&&s.close&&hr.trigger($.Event(s.close,{dataView:a,survey:s}))))):!gu()&&u&&u.pageProp("zoomed")&&!f.is(".app-page-modal-fullscreen")&&l(".app-btn-fullscreen").trigger("vclick")}function utt(n,t){var i=ht.syncKey(n)||n._syncKey,r=f.syncMap[n._controller],u;!i&&n.get_isGrid()&&r&&(u=n._id+"_"+n._viewId,i=r[u]===!0,r[u]=!1);i&&(i===!0?n.sync():(n.sync(i),t&&n.extension().notifyChildren()),n._syncKey=null)}function lot(n){n&&n.home&&!n.tabBar&&(n.tabBar=ftt(),dc(n,!0))}function yw(){n._tabBar||(n._tabBar=ftt(),dc(null,!0))}function ftt(){var t=n._tabBarItems,u,i,f,r;if(t||(t=n._tabBarItems=[],items=[],ff(items,!0),$(items).each(function(n){var i=this;if(i.icon&&i.context)t.push(i);else return t.splice(n),!1})),t.length>1&&o("ui.menu.tabbar")!==!1){if(u=n.bar("create",{type:"footer",page:l()}),!u.length)return null;i=p("app-bar-tabs",'data-location="bottom"').hide().appendTo(u);f=nr().appendTo(i);t.forEach(function(n){r=ct("",'data-tooltip-location="above"').appendTo(f).data("item",n).css("width",Math.floor(100/t.length)-1+"%");bt(n.icon,r);s().appendTo(r).text(n.text);r.attr("title",n.tooltip);var i=n.context.selected;i&&$(n.context.children).each(function(){this.selected&&(i=!1)});i&&r.addClass("app-selected")});i.data("items",i.find("li"))}return i}function ett(){var i=o("ui.menu.tabbar"),u=n._uiSideBarWhen,t=vl();return t&&(u==="Never"?t=!1:u==="Landscape"&&r.width<r.height&&(t=!1)),i===!0||i!==!1&&!w.left.visible&&!t}function dc(t,i){var r=t?t.tabBar:n._tabBar,o,u;if(r&&r.length){if(u=ett(),o=r.is(":visible"),(u&&!o||!u&&o)&&n.bar(u?"show":"hide",r),u&&i){var f,e=r.data("items"),c=e.first().outerWidth(),l=n._tabBarItems.length,h=Math.floor(r.width()/c);r.data("more")&&(r.data("more").remove(),r.removeData("more"),e.show());l>h&&(f=ct("app-has-icon",'data-tooltip-location="above"').appendTo(r.find("ul")).attr("title",fr),vs("app-icon material-icon material-icon-more").appendTo(f),r.data("more",f),e.filter(":gt("+(h-2)+")").hide(),s().appendTo(f).text(fr),e.filter(lr).filter(".app-selected").length||f.addClass("app-selected"))}ott(u)}return u}function ott(n){n==null&&(n=ett());c.toggleClass("app-has-complete-tabbar",n&&nu.Menu.nodeCount===nu.Menu.nodesWithIcons.length)}function ot(n){return(n||l()).is(".app-reading-pane-detail")}function li(n){return(n||l()).is(".app-reading-pane-master")}function stt(){var n=nu.Menu.nodeCountInSidebar;n&&c.toggleClass("app-has-complete-toolbar-in-sidebar",w.left.visible&&nu.Menu.nodeCount===n)}function aot(t,i,u,f){function tt(){l--;l||(y&&y(),l||(f(),vr()))}function it(n,t){n.is(":visible")&&(l++,n.one("transitionend",tt).css(t))}function h(n){y=n.done;n.position();setTimeout(function(){n.transition();setTimeout(function(){$(n.run).each(function(){var n=this,i={};for(var t in n)t!=="element"&&(i[t]=n[t]);it(n.element,i)})})})}var nt=t.is(".app-page-modal"),g=i.is(".app-page-modal"),a,v,o,c,e=n._backText,y,l=0,p,w,s,k;yt(!0);fi(!0);nt?g?(prevPageIsSlide=t.is(".app-page-modal-partial"),a=aw(t)||ot(t),v=aw(i)||ot(i),u?a||v?h({position:function(){t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out")},run:[{element:t,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""})}}):(o=$(".app-page-modal-partial").add(i),c=d(i,"width")+yv(),p=d(t,"left")+c,h({position:function(){t.css("left",p).addClass("app-page-revealed");t.css({transform:"translate3d("+-c+"px,0,0)"});o.css({transform:"translate3d("+-c+"px,0,0)"})},transition:function(){o.addClass("app-transition-slide");t.addClass("app-transition-slide")},run:[{element:t,transform:"translate3d("+(r.physicalWidth-p+yv())+"px,0,0)"},{element:o,transform:""}],done:function(){o.removeClass("app-transition-slide").css({transform:"",transition:""});t.removeClass("app-transition-slide app-page-revealed").css({left:"",transform:"",transition:""})}})):v||a?(w=t.is(".app-page-modal-obscured"),h({position:function(){w&&t.toggleClass("app-page-modal-obscured app-page-modal-centered");i.css({opacity:0})},transition:function(){i.addClass("app-transition-fade-in")},run:[{element:i,opacity:""}],done:function(){i.removeClass("app-transition-fade-in");w&&t.toggleClass("app-page-modal-obscured app-page-modal-centered")}})):(o=$(".app-page-modal-partial").add(i),h({position:function(){c=d(i,"width")+yv();o.css({transform:"translate3d("+c+"px,0,0)"});o=$(o.get().reverse())},transition:function(){o.addClass("app-transition-slide")},run:[{element:o,transform:""}],done:function(){o.removeClass("app-transition-slide").css({transform:"",transition:""})}}))):(s=n._modalBackground,h({position:function(){s.show().css({opacity:1});t.addClass("app-page-revealed").css({opacity:1})},transition:function(){t.addClass("app-transition-fade-out");s.addClass("app-transition-fade-out")},run:[{element:t,opacity:0},{element:s,opacity:0}],done:function(){t.removeClass("app-transition-fade-out app-page-revealed").css({opacity:""});s.hide().removeClass("app-transition-fade-out").css({opacity:""})}})):g?(s=n._modalBackground,h({position:function(){i.css({opacity:0});s.css({opacity:0})},transition:function(){i.addClass("app-transition-fade-in");s.addClass("app-transition-fade-in")},run:[{element:i,opacity:""},{element:s,opacity:""}],done:function(){i.removeClass("app-transition-fade-in");s.removeClass("app-transition-fade-in")}})):t.length?t.is("#Main")&&!b.location.hash?f():(k=d(i,"width"),k>oi("md")?u?h({position:function(){i.addClass("app-transition-slide-background");t.addClass("app-page-revealed").css({transform:"translate3d(0,0,0)","z-index":2,opacity:1});e.css({transform:"translate3d(-"+d(e,"width")+"px,0,0)",opacity:0})},transition:function(){t.addClass("app-transition-slide-peel-out");e.addClass("app-transition-slide-and-reveal")},run:[{element:t,transform:"translate3d(200px,0,0)",opacity:0},{element:e,transform:"",opacity:""}],done:function(){i.removeClass("app-transition-slide-background");t.removeClass("app-transition-slide-peel-out app-page-revealed").css({transform:"","z-index":"",opacity:""});e.removeClass("app-transition-slide-and-reveal")}}):h({position:function(){i.css({transform:"translate3d(200px,0,0)"});t.addClass("app-transition-slide-background app-page-revealed");e.css({transform:"translate3d("+d(e,"width")+"px,0,0)",opacity:0})},transition:function(){i.addClass("app-transition-slide-peel-in");e.addClass("app-transition-slide-and-reveal")},run:[{element:i,transform:""},{element:e,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide-background app-page-revealed");i.removeClass("app-transition-slide-peel-in").css({transform:"",transition:"","z-index":""});e.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}}):h({position:function(){i.css({transform:"translate3d("+(u?-1:1)*k+"px,0,0)","z-index":2});t.addClass("app-page-revealed");e.css({transform:"translate3d("+(u?-1:1)*d(e,"width")+"px,0,0)",opacity:0})},transition:function(){e.addClass("app-transition-slide-and-reveal");t.addClass("app-transition-slide");i.addClass("app-transition-slide2")},run:[{element:i,transform:""},{element:t,transform:"translate3d("+(u?1:-1)*d(t,"width")+"px,0,0)"},{element:e,transform:"",opacity:""}],done:function(){t.removeClass("app-transition-slide app-page-revealed").css({transform:""});i.removeClass("app-transition-slide2").css({transform:"",transition:""});e.removeClass("app-transition-slide-and-reveal").css({transform:"",opacity:""})}})):f()}function htt(n,t){function r(t){if(!c){var r=[];$(n.get_actions("Custom")).each(function(){var t=this;n._isActionMatched(t,!0)&&r.push(t)});r.length&&(t&&i.push('<div data-container="collapsible" data-wrap="false" data-header-text="none">'),i.push('<div data-container="row">'),$(r).each(function(){i.push('<span data-control="action" data-action="'+this.Path+'"><span class="app-control-inner"><\/span><\/span>')}),i.push("<\/div>"),t&&i.push("<\/div>"));c=!0}}var y=n.get_view(),o,i,u=[],s={},h,c,l=[],a=[],v=$.Event("generatelayout.dataview.app",{dataView:n,view:y}),e=n.tagged("clear-all"),p=lt("ui.form.adpativeWrapping");return($(document).trigger(v),i=v.layout,i)?i:($(n._expressions).each(function(){var n=this,t=n.Scope,i=n.Target;t===2&&l.push(i);t===3&&a.push(i)}),$(n._categories).each(function(n){var f=this,i=f.Wizard,e=!n||f.Flow==="NewRow",r,t;i?h:i=h?"_after_":"_before_";t=s[i];t||(t={text:i,rows:[]},s[i]=t,u.push(t),e=!0);e?(r={categories:[]},t.rows.push(r)):r=t.rows[t.rows.length-1];r.categories.push(f)}),$(u).each(function(){var t=this;$(t.rows).each(function(){var t=this,i=[],r={},u={};$(t.categories).each(function(){var n=this,e=n.Tab,t=r["t_"+e],f,o={id:n.Id,headerText:n.HeaderText,desc:n.Description,collapsed:n.Collapsed,fields:[],floating:n.Floating,wrap:n.Wrap,dataViewCount:0};t?n.Flow==="NewColumn"?(f={categories:[]},t.columns.push(f)):f=t.columns[t.columns.length-1]:(f={categories:[]},t={text:n.Tab,columns:[f]},r["t_"+e]=t,i.push(t));u[n.Index]=o;f.categories.push(o)});$(n._fields).each(function(){var n=this,t=u[n.CategoryIndex];t&&(t.fields.push(n),n.Type==="DataView"&&t.dataViewCount++)});t.tabList=i})}),i=['<div data-layout="form" data-layout-size="'+le(t)+'">'],$(u).each(function(){var u=this,s=u.text,h=!s.match(/^\_(before|after)\_$/);h&&(i.push('<div data-container="wizard" data-wizard-step="'+f.htmlAttributeEncode(s)+'">'),r(!0));$(u.rows).each(function(){var h=this,s=h.tabList,u=s.length>1;u&&r(!0);u&&i.push('<div data-container="tabset">');$(s).each(function(){var h=this,c=h.columns,s=h.columns.length>1;u&&i.push('<div data-container="tab" data-tab-text="'+f.htmlAttributeEncode(h.text)+'">');$(c).each(function(){var f=this,h=100/c.length-1,v=s?t*h/100:t;s&&v<=oi("tn")&&(s=!1);s&&(r(!0),i.push('<div data-container="column" style="width:'+h+'%">'));$(f.categories).each(function(){var c=this,g=c.desc,nt=' data-visibility="c:'+c.id+'"',y=u&&f.categories.length===1&&c.dataViewCount===c.fields.length,tt=g&&g.replace(/\{([\w+\_]+)\}/g,'<span data-control="field" data-field="$1" data-read-only="true"><span class="app-control-inner">&#160;<\/span><\/span>'),rt=tt&&n._formatViewText(yd.DefaultCategoryDescriptions[tt],!0,tt),b=c.wrap,k=b===!0||(s?v:t)<=oi("xs")&&b!==!1,it=l.indexOf(c.id)!==-1;y?c.dataViewCount>1&&i.push('<div data-container="simple"'+(it?nt:"")+">"):i.push('<div data-category="'+c.id+'" data-container="collapsible" data-wrap="'+(k?!b&&p?"adaptive":"true":"false")+'" data-header-text="'+(c.headerText||"none")+'"'+(c.collapsed?'data-collapsed="true" ':"")+(it?nt:"")+(e?' class="app-has-clear-all'+(n._showClearAll?" app-form-clear-all-visible":"")+'"':"")+">");r();g&&(y||i.push('<div data-container="row">'),i.push('<div data-control="description"><span class="app-control-inner">'+rt+"<\/span><\/div>"),y||i.push("<\/div>"));var d=[],w=[],h=1;$(c.fields).each(function(){var n=this;n.Type==="DataView"?(w.length&&d.push(w),d.push([n]),w=[]):w.push(n)});!s&&c.floating&&(b?(oi("sm")<=t&&(h=2),oi("md")<=t&&(h=3),oi("lg")<=t&&(h=4)):(oi("md")<=t&&(h=2),oi("lg")<=t&&(h=3)),h=Math.min(h,c.fields.length));w.length&&d.push(w);$(d).each(function(){for(var r,f,t,v=this,d=v.length,p=Math.ceil(d/h),c=0;c<p;c++){for(y?i.push('<div data-container="simple"'):i.push('<div data-container="row"'+(h>1?' data-columns="'+h+'"':"")),r=[],f=0;f<h;f++)if(t=v[c+f*p],t){var w=t.Type==="DataView",u=t.Name,b=t.HeaderText,l=a.indexOf(u)!==-1,s=l?' data-visibility="f:'+u+'"':"";y?l?i.push(s):it&&i.push(nt):h===1&&l&&i.push(s);k&&h>1&&r.push('<span class="app-field-group">');w||k&&(!b||b==="&nbsp;")||r.push('<span data-control="label" data-field="'+u+'"'+(h>1?s:"")+'><span class="app-control-inner">'+u+"<\/span><\/span>");r.push('<span data-control="'+(w?"dataview":"field")+'" data-field="'+u+'"'+(h>1?s:"")+(t.is("focus-auto")?' data-focus="true"':"")+'><span class="app-control-inner">['+u+"]<\/span><\/span>");k&&h>1&&r.push("<\/span>");o||(o=t)}i.push(">");e&&(e=!1,i.push('<i class="material-icon app-form-clear-all" title="'+ic+'">clear<\/i>'),n._showClearAll=!0);$(r).each(function(){i.push(this)});i.push("<\/div>")}});y?c.dataViewCount>1&&i.push("<\/div>"):i.push("<\/div>")});s&&i.push("<\/div>")});u&&i.push("<\/div>")});u&&i.push("<\/div>")});h&&i.push("<\/div>")}),i.push("<\/div>"),i=i.join("\r\n"))}function le(n){return n>=1366?"xxl":n>=1200?"xl":n>=992?"lg":n>=768?"md":n>=576?"sm":n>=480?"xs":n>=320?"xxs":"tn"}function vot(n){var t=df.indexOf(n);return t===-1?r.width:oi(df[Math.min(df.length-1,t+1)])-1}function oi(n){switch(n){case"tn":return 280;case"xxs":return 320;case"xs":return 480;case"sm":return 576;case"md":return 768;case"lg":return 992;case"xl":return 1200;case"xxl":return 1366;default:return r.width}}function ctt(n,t){var c=le(t),l=n._controller+"_"+n._viewId+"_"+n._filterFields+"_layout_"+c+(av(n)?"_m":""),r,a=$.Event("createlayout.dataview.app",{dataView:n,view:n._viewId}),e=n.survey(),u,i,o,h,v,y;return $(document).trigger(a),r=a.layout,r=r?{html:r}:f.cache[l],r||(u=n.get_view().Layout,u&&(o=$("<div>"+u+"<\/div>"),h=o.find("[data-layout]"),h.length?(y=df.indexOf(c),h.each(function(){var t=$(this),r=t.attr("data-layout-size")||"tn",n=df.indexOf(r);n!=-1&&n<=y&&(!i||n>v)&&(i=t,v=n)})):(i=$('<div data-layout="form"><\/div>'),$(o.html()).appendTo(i))),i?(i.find("[data-control]").each(function(){var n=$(this),t=n.contents().remove();t.appendTo(s("app-control-inner").appendTo(n))}),u=p().append(i.clone()).html()):u=htt(n,t),r={html:u},e&&(e.dynamic||!e.cache)||(f.cache[l]=r)),i=$(r.html).toggleClass("app-form-lines-horiz-none",ltt(n)).toggleClass("app-form-lines-input",att(n)),i.attr("data-input-container",n._id),n._isWizard=i.find('[data-container="wizard"]').length>0,i}function ltt(n){return!!n.tagged("form-lines-horizontal-none")||o("ui.form.lines.horizontal")===!1}function att(n){return!!n.tagged("form-lines-input")||o("ui.form.lines.input")===!0}function vtt(n,t,r){function s(n,t,i){if(n.getAttribute){var v=n.getAttribute("data-control"),l=!v&&n.getAttribute("data-container"),a,y=n.childNodes,o,r;for(v&&t?(f.push(n),o=$(n),offset=o.offset(),r={self:o,parent:i,type:v,children:[]},c.push(r),i.children.push(r),o.data("node",r)):l&&(u.push(n),o=$(n),r={self:o,children:[],type:l},o.data("node",r),h.push(r),t?(r.parent=i,i.children.push(r)):e.push(r)),a=0;a<y.length;a++)s(y[a],l?n:t,l?r:i,null)}}var u=[],h=[],f=[],c=[],e=[],l=n.extension(),o=l.editing();r.data("prepared",!0);r.find("[data-visible-when]").each(function(t){var i=$(this),r=n._expressions,e=i.attr("data-visible-when"),u=i.parent().is('[data-container="wizard"]'),f={Scope:u?2:7,Target:t,Test:e,Type:1,ViewId:n._viewId};r||(r=n._expressions=[]);r.push(f);i.attr({"data-visible-when":null,"data-visibility":(u?"c:":"v:")+f.Target})});i.evaluate({dataView:n,row:t,container:r,ignoreDynamicButtons:!0});s(r[0]);u=$(u);f=$(f);r.data("rootNodes",e).attr("data-state",o?"write":"read");ytt(n,t,o,e)}function ytt(t,i,r,u){$(u).each(function(u){var f=this,e=f.self,o,c,y,l,a,v;!f.ready&&e.is(":visible")&&(f.ready=!0,f.type==="tabset"?(o=[],$(f.children).each(function(){var n=this;n.type==="tab"&&o.push({text:n.self.attr("data-tab-text"),content:n.self,context:n})}),o.length&&(f.tabs=o,n.tabs("create",{id:t._id+"_tabset_"+u,tabs:o,className:"app-tabs-layout",scope:t.get_selectedKey(),change:function(n){var i=n.content;gc({dataView:t,controls:n.context.children});pu(null,i);od(i);!t.editing()||h||et||bi({container:i})}}),$(o).each(function(){var n=this;if(n.active)return gc({dataView:t,row:i,editing:r,controls:n.context.children}),!1}))):(f.type==="collapsible"&&(c=e.attr("data-header-text"),v=e.attr("data-collapsed")==="true",c&&c!=="none"&&(y=e.contents(),l=p("app-feedback",'data-container="toggle"'),a=p("",'data-container="simple"'),y.appendTo(a),s("app-collapsible-toggle-text").appendTo(l).text(c),s("app-collapsible-toggle-button").appendTo(l).attr("data-title",v?fo:ca),l.appendTo(e),a.appendTo(e),v&&e.addClass("app-container-collapsed"))),pw(t,i,r,f.children)))})}function pw(n,t,r,u){$(u).each(function(){var p=this,f=p.self,v,a,c,u,l,y,et,ot,nt,ut,ft,vt,st,ht,d,yt,pt,ct,wt;if(p.children.length)ytt(n,t,r,[p]);else{if(p.ready||!f.is(":visible"))return;if(p.ready=!0,c=f.attr("data-field"),v=p.type,c){if(a=f.find(".app-control-inner"),u=et=n.findField(c),u)if(u.AllowNulls||f.attr("data-required",!0),v==="label"||v==="header")y=u.tagged(/\blabel\-icon-(.+?)(\s|,|$)/),u=n._allFields[u.AliasIndex],l=u.HeaderText,y?(a.html("&nbsp;"),y=y[1],y.match(fa)||(y="material-icon-"+y),bt(y,f).attr("data-title",l),f.closest("[data-layout]").addClass("app-has-icon-label"),et.Watermark==null&&(et.Watermark=l)):a.html(l),l&&l!=="&nbsp;"||f.attr("data-required",null);else if(v==="footer")ot=u.FooterText,ot?a.html(ot):f.addClass("app-hidden");else if(f.addClass("app-field-"+u.Name),v==="dataview"){if(u.Type==="DataView"&&u.DataViewController)if(n.extension().inserting()&&!n.odp)f.hide(),f.parent().is('[data-container="row"]')&&f.parent().hide();else{c=u.Name;var w=n.get_parentDataView(n),o=n._id+"_"+c,h,kt=0,it,lt=u.DataViewFilterFields,e,at=t[u.Index],b,rt;for(w._controller!==n._controller&&(w=n),l=u.HeaderText,b=n._dataViewFields,b||(b=n._dataViewFields={}),b[c]?o+=b[c]++:b[c]=1,h=k(o);h&&h._dataViewFieldParentId!==w._id;)o=w._id+"_"+c+kt++,h=k(o);p.dataView=o;f.empty().attr("id",o+"_ph").attr("data-input","dataview");h?h._startPage=at:(e={id:o,controller:u.DataViewController,viewId:u.DataViewId,filterFields:u.DataViewFilterFields,baseUrl:ne,servicePath:rv,showSearchBar:!0,autoHide:lt?2:null,tag:u.Tag},e.startPage=at,lt&&(e.filterSource=n._id,u.DataViewFilterSource&&(nt=n.findField(u.DataViewFilterSource),ut=nt._detailDataViews,nt&&(e.filterSource=nt._dataViewId,ut||(ut=nt._detailDataViews=[]),ut.push(o),ft=n._expressions,ft||(n._expressions=ft=[]),ft.every(function(t){return t.Scope===3&&t.Target===c&&t.ViewId===n._viewId&&(t._visChanged=!1,vt=t),!vt}),f.closest('[data-visibility="f:'+c+'"]').hide()))),e.showInSummary=!!u.DataViewShowInSummary,u.DataViewPageSize&&(e.pageSize=u.DataViewPageSize),e.selectionMode=u.DataViewMultiSelect?"Multiple":"Single",u.DataViewShowActionButtons&&(e.showActionButtons=u.DataViewShowActionButtons),e.showActionBar=u.DataViewShowActionBar!==!1,e.showDescription=u.DataViewShowDescription!==!1,e.showViewSelector=u.DataViewShowViewSelector!==!1,e.showSearchBar=u.DataViewShowSearchBar!==!1,e.showQuickFind=u.DataViewShowQuickFind!==!1,e.showRowNumber=!!u.DataViewShowRowNumber,u.DataViewShowPager&&(e.showPager=u.DataViewShowPager),e.showPageSize=u.DataViewShowPageSize!==!1,e.showModalForms=!!u.DataViewShowModalForms,e.searchOnStart=!!u.DataViewSearchOnStart,e.autoSelectFirstRow=!!u.DataViewAutoSelectFirstRow,e.autoHighlightFirstRow=!!u.DataViewAutoHighlightFirstRow,h=$create(kr,e,null,null,dr()[0]),h._dataViewFieldName=c,u._dataViewId=o,h._dataViewFieldParentId=w._id,h._dataViewFieldOwnerId=u._dataView._id,h._filterSourceSelected(w),it=tt(o),it.text=l,it.headerText=l,it.activator.text=l);st=g(f);rt=st.find('[data-for="'+o+'"]');rt.length||(rt=kb(o,st).addClass("app-echo-embedded"));rt.width(f.width());h.get_startPage()&&(h._loadPage(),rf(o))}}else v==="field"&&(u.ToolTip&&f.attr("title",u.ToolTip),i.render({container:f,inner:a,dataView:n,field:u,row:t,editing:r}))}else v==="description"?f.closest("[data-container]").addClass("app-has-description"):v==="action"&&(a=f.find(".app-control-inner"),ht=f.attr("data-action"),d=n.findAction(ht),d?(yt=s("app-action-column-button").appendTo(a.empty().addClass("app-action-column")).text(d.HeaderText),ct=d.Description,ct&&yt.attr("title",ct),pt=d&&n._isActionAvailable(d),pt||f.addClass("app-disabled")):(wt=ht+": "+a.text(),s("app-action-column-button").appendTo(a.empty().addClass("app-action-column")).text(wt),f.addClass("app-disabled")))}})}function ptt(n,t,r,u){$(u).each(function(){var u=this,f=u.self,e;if(!u.ready)if(f.is(":visible"))pw(n,t,r,[u]);else return!1;u.children.length?ptt(n,t,r,u.children):u.ready&&u.dirty&&f.is(":visible")&&(e=i.elementToField(f),i.render({container:f,dataView:n,field:e,editing:r,row:t}),u.dirty=!1)})}function gc(n){var t=n.dataView,r=n.row,u=n.editing,i=n.controls;i&&i.length&&(t||(t=k($(i[0].self).closest("[data-input-container]").attr("data-input-container"))),r||(r=t.editRow()),u==null&&(u=t.editing()),pw(t,r,u,i),ptt(t,r,u,i))}function uu(n,t){var e;if(et&&!t&&(t=50),t){clearTimeout(b._syncEmbeddedViewsTimeout);b._syncEmbeddedViewsTimeout=setTimeout(uu,0,n);return}n||(n=g());var u=[],i=rh(n),o=n.offset(),r,f;n.find('[data-control="dataview"]').each(function(){var t=$(this),r=t.data("node"),n=ni(r.dataView),i=d(n,"height")+d(n,"margin-top")+d(n,"margin-bottom")+d(n,"padding-top")+d(n,"padding-bottom");n.length&&i&&(i!==d(t,"height")&&t.height(i),u.push({p:t,e:n}))});$(u).each(function(){var t=this,s=t.p,u,h=s.width();h?(r==null&&(r=n.scrollTop(),f=i.length?i.offset().left:0),u=s.offset(),t.e.css("display")==="none"&&(e=!0,t.e.css("display","")),t.e.css({visibility:"",left:u.left-f,top:Math.round(u.top+r-o.top),width:h})):t.e.css({visibility:"hidden",left:-2e4,top:0})});e&&(tf(n),pf());li(i)&&uu(g(".app-reading-pane-detail:not(.app-hidden)"))}function yot(n,t){for(var i=t.parent().hide().next();i.length&&!i.is(":visible");)i=i.show().next()}function nl(){return cr("style").appendTo($("head"))}function ww(n){return n._enumerateExpressions(nu.DynamicExpressionType.Any,nu.DynamicExpressionScope.ViewRowStyle,n.get_viewId())}function ih(n,t,i,r){var f,u;r||(r=ww(n));r&&r.length&&(f=n._evaluateJavaScriptExpressions(r,t,!0),i&&(u=[],$(r).each(function(){var n=this;n.Scope===1&&u.push(n.Result)}),u=u.join(" "),i.removeClass(u),f&&i.addClass(f)))}function wv(n){var t=n._gridFrozenField;return t||(t=n.pageProp("frozenField"),t||(n._hasKey()?(n._fields.every(function(n){return n.tagged("grid-frozen-field")&&(t=n.Name),!t}),t||(t="_first_")):t="_none_"),n._gridFrozenField=t),t}function bv(n){return n||(n=l()),n.find(".dv-heading")}function wtt(n){bv(n).remove()}function bw(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function kv(){var n=r.width,t=r.height;return n<480&&t<640||t<480&&n<640}function ae(n){tt(typeof n=="string"?n:n._id).echoChanged=!0}function st(n,t){return i.of(n,t)}function kw(){i.methods.lookup._hidePopup()}function g(n){var t;return n?typeof n=="string"?(n.match(/^\w/)&&(n="#"+n),$(n).find(".app-wrapper")):n.length&&n[0].className.indexOf("ui-page")!==-1?n.find(".app-wrapper"):(t=n.closest(".app-wrapper"),t.length||(t=g()),t):(t=l(".app-wrapper"),t?t:$())}function rh(n){return n?n.closest(".ui-page"):l()}function dv(n){return n=n?$(n).closest(".app-wrapper"):rh(),n.find('.app-focus[data-input="dataview"]')}function btt(n){return k(n._filterSource)}function ni(n){var t,i;return typeof n=="string"?(n.match(/_ph$/)&&(n=n.substring(0,n.length-3)),n.match(/_echo$/)||(n+="_echo"),t=$("#"+n)):n!=null&&n._controller?(i=tt(n),t=i.echo,t||(t=ni(i.id))):n!=null&&n._dataViewId?t=ni(n._dataViewId):(n=$(n),t=n.data("control")==="dataview"?ni(n.attr("id")):$(n).closest(".app-echo")),t}function ir(n){var t=eu().closest(".app-wrapper");return n=g(n),di("focus")||!n.length||t.length&&t[0]===n[0]||n.focus(),n}function dw(){var n=b.location.href,t=n.indexOf("#");t>=0&&(n=n.substr(0,t));b.location.reload(n)}function co(){if(!as){var n=o("ui.displayDensity.value");as=16;n==="Compact"?as=14:(n==="Condensed"||n==="Tiny")&&(as=12)}return as}function af(n,t){function r(){n.removeData("scrolling enableScrollEventsTimeout");pe(n)}n.data("scrolling",!0);n.scrollTop(t);var i=n.data("enableScrollEventsTimeout");i!=null&&clearTimeout(i);n.data("enableScrollEventsTimeout",setTimeout(r,300))}function lo(n,t){t||(t=ni(n));t.length&&t.find(".app-echo-toolbar .app-echo-controls").addClass("app-stale");var i=si();clearTimeout(b._refreshEchoToolbar);b._refreshEchoToolbar=setTimeout(function(){i!==si()||yt()||et||pf()},500)}function ktt(n){return!n&&kv()?"none":h?"fade":"none"}function tl(n){return n&&typeof n=="string"&&n.match(fa)}function bt(n,t){var i=n.match(fa),r,u;return i?(r=i[1],u=r==="material-icon",$('<i class="app-icon '+r+" "+i[0]+'" aria-hidden="true" data-icon="'+n+'">'+(u?i[2].replace(/-/g,"_"):"")+"<\/i>").appendTo(t.addClass("app-has-icon app-has-"+r))):null}function dtt(){return $(".ui-panel-open .ui-btn.app-animated")}function gtt(){return $(".ui-popup-active .ui-btn.app-animated")}function nit(n){f.search("show",n.dataViewId)}function tit(n){$(n).find(".app-signature").each(function(){f.upload("resize",{container:this})})}function iit(n){var t=n.find(".Current"),i,r;t.length&&(r=n.offset(),i=t.offset(),n.scrollLeft(i.left-r.left-t.outerWidth(!0)/2))}function ve(n,t){function e(n){var t,r=i.steps[n];return r.isDynamic&&(t=!0,$(i.containers[n]).children().each(function(){var n=this;if(n.style.display!=="none")return t=!1,!1})),!t}function o(n,t){for(t==null&&(t=i.active),t+=n;t>=0&&t<i.steps.length;)if(e(t))break;else t+=n;return t}function b(n){$(i.steps).each(function(t){var r=this;r.text===n&&e(t)&&(i.active=t,a())})}function s(n,t){var t=o(n,t);return t>=0&&t<i.steps.length}function c(){vi();i.containers.removeClass("app-wizard-active");var n=i.active,t;n!==-1&&(t=$(i.containers[n]).addClass("app-wizard-active"),gc({controls:t.data("node").children}),pu())}function a(){c();v();h||bi({container:$(i.containers[i.active])})}function v(){var n=u.closest(".ui-content"),t,i;n.length||(n=u.find(".ui-content"));t=n.find('[data-action-path="wizard-next"]');i=n.find('[data-action-path="wizard-prev"]');t.toggleClass("app-btn-disabled",!s(1));i.toggleClass("app-btn-disabled",!s(-1));w()}function w(){var e=r.closest(".ui-page"),t=e.find(".app-status-bar"),n,u,f,o;t.length&&(n=k(e.attr("id")),n._statusBarAuto&&(u=[n._controller+"."+n._viewId+"._wizard:"+i.active+"\n"],$(i.steps).each(function(n){var r=this,t,f=r.text;r.isDynamic&&(t=!0,$(i.containers[n]).children().each(function(){if(this.style.display!=="none")return t=!1,!1}));t||u.push((n===i.active?"["+f+"]":f)+" >")}),n._statusBarAuto=u.join("")),t.html(n.statusBar()),f=t.find("li.Segment"),o=f.length+10,f.each(function(n){this.style.zIndex=o-n}),iit(t))}var u,r,i,y,p,f;if(t||(t={}),u=t.container||l(),r=t.layout||u,r.is("[data-layout]")||(r=r.find("[data-layout]"),!r.length&&u&&(r=u.closest("[data-layout]"))),i=r.data("wizard-config"),i||(i={steps:[],active:0},i.containers=r.find('[data-container="wizard"]').each(function(){var n=$(this),t={text:n.attr("data-wizard-step"),isDynamic:n.find("> [data-visibility]").length>0};i.steps.push(t)}),r.data("wizard-config",i)),i.steps.length)switch(n){case"start":i.active=s(1,-1)?0:-1;c();w();break;case"status":v();break;case"select":b(t.text);break;case"next":y=o(1);y!==-1&&(i.active=y,a());break;case"prev":p=o(-1);p!==-1&&(i.active=p,a());break;case"visible":if(t.step)return t.step.is(".app-wizard-active")?!0:(f=t.step.prevAll('[data-container="wizard"]').length,e(f));break;case"show":t.step&&!t.step.is(".app-wizard-active")&&(f=t.step.prevAll('[data-container="wizard"]').length,f!==i.active&&e(f)&&(i.active=f,c(),v()))}}function uh(t,i){function b(){var i=r.left,n=r.splitBottom,t=9;n&&(n+=pt.divider+t);h.css({left:e?w.left.visible?w.left.width+f:f:"auto",right:e?"auto":i+(w.right.visible?w.right.width+f:f)+(r.splitRight?r.splitRight+pt.divider:0),bottom:wr()?r.bottom+(n||t):n||""})}if(o("ui.actions.promote")){var h=n.promo(),p,c,a,v,u,s,e,y,f;t||(t=dt());t&&(p=t._id);t&&(c=t.extension().viewStyle(),a=!0,e=c==="Map",a&&i==null&&(i=l(".app-listview .ui-li-has-thumb").length>0),c!=="Map"&&(a&&i||t.get_showMultipleSelection()||t.inlineEditing()||!fst())&&(e=!1));h=n.promo();y=h.outerWidth();f=Math.floor(y/3);v=tt(p);v?(u=v.page,u&&(u.is(".app-page-modal")?(s=u.offset(),u.is(".app-page-modal-fullscreen")||u.find(".app-listview.app-grid").length?h.css({left:e?s.left+f:"auto",right:e?"auto":r.physicalWidth-(s.left+u.outerWidth())+f,bottom:r.physicalHeight-(s.top+u.outerHeight()-f),"margin-bottom":0}):h.css({left:e?s.left+f:"auto",right:e?"auto":r.physicalWidth-(s.left+u.outerWidth())+f,bottom:r.physicalHeight-(s.top+u.outerHeight()+Math.ceil(y/2)),"margin-bottom":0})):b())):b()}}function gw(t){var i=n._title;(i.data("screen-width")!==r.width||t)&&i.data("screen-width",r.width).css("marginLeft",w.left.visible?w.left.width:n._logo.offset().left+n._logo.outerWidth())}function rit(){var n=w.left.inner;w.left.width=n.css("width","").outerWidth();wt.width&&n.css({"overflow-y":"scroll",width:w.left.width-wt.width+2})}function gv(){function e(){w.left.mini&&!t.match(/\bapp\-has\-minisidebar\-left\b/)?c.addClass("app-has-minisidebar-left"):!w.left.mini&&t.match(/\bapp\-has\-minisidebar\-left\b/)&&c.removeClass("app-has-minisidebar-left");t.match(/\bapp-has-sidebar-left\b/)||(c.addClass("app-has-sidebar-left"),w.left.visible=!0,rit(),i=!0)}function s(){t.match(/\bapp\-has\-minisidebar\-left\b/)&&c.removeClass("app-has-minisidebar-left");t.match(/\bapp-has-sidebar-left\b/)&&(c.removeClass("app-has-sidebar-left"),w.left.visible=!1,w.left.width=0,i=!0)}var t=document.body.className,i,f,u;cu||(o("ui.sidebar.when")==="Landscape"?vl()&&r.width>r.height?e():s():o("ui.sidebar.when")==="Never"?t.match(/\bapp-has-sidebar-left\b/)&&(c.removeClass("app-has-sidebar-left app-has-minisidebar-left"),w.left.visible=!1,w.left.width=0,i=!0):vl()?e():s());t.match(/\bapp-has-sidebar-right\b/)&&(c.removeClass("app-has-sidebar-right"),w.right.visible=!1,w.right.width=0,f=!0);i&&(gw(!0),stt(),uf(),uh());f&&(u=0,w.right.visible&&(u+=w.right.width+1),n._toolbar.css(u?{right:u,width:"auto"}:{right:"",width:""}),uh());uit()}function uit(){if(w.left.visible){var n=w.left.inner,t=parseInt(n[0].style.bottom||"0");w.left.mini?t||n.css("bottom",n.next().outerHeight()-1):t&&w.left.inner.css("bottom","")}}function fh(n){ur();var i=n.match(/^(_\w+)\:(.+)$/),t;i&&i[1]?(u=i[2],t=i[1],t==="_blank"?f.host?f.host.invoke("navigate",{type:"external",url:u}):b.open(u,t,"modal=yes,alwaysRaised=yes,resizable=yes"):t==="_internal"?f.touch.openExternalUrl(u,!1)():b.open(u,t)):h||ra?b.location.href=n:b.open(n)}function ai(){return(new Date).getTime()}function d(n,t){return parseFloat(arguments.length===1?n:n.css(t))}function pot(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function wot(){var u=n._toolbarButtons,f=n._contextButton,o=Math.ceil(f.show().offset().left),s=d(f,"width")+2,e=co(),t,i=u.length-1;for(t=d(n._toolbar,"width")-o+e,wr()&&(t+=r.left);i>=0;)btn=$(u[i]).css("right",t),t=t+s+e,i--}function fit(n,t,i,r){if(n.htmlEncode())if(n.TextMode==3){for(var u=sf(t).split(/\r?\n/),e,f=0;f<u.length;f++)e=u[f],m=e.match(/^\s+/),m&&(u[f]=Array(m[0].length*2).join("&nbsp;")+e.substring(m[0].length));t=u.join("<br/>");u.length>15?(i.html(uv("app-text-collapsible")).children().html(t),s("ui-btn ui-btn-icon-notext ui-btn-inline ui-icon-carat-d ui-inline ui-corner-all app-btn-toggle").attr("data-title",fo).appendTo(i)):(i.html(t),r&&i.css("white-space","nowrap"))}else i.text(t);else i.html(t)}function eit(t,i,r){t.find("> .app-map, > .app-presenter-instruction").hide();r||(i._mapPageWindow=null);n.presenter("hide",{container:t})}function ny(){return!0}function tb(n,t,i){if(n._hasKey()){var r=s("app-btn-more").appendTo(t).attr("title",fr);i&&r.addClass("app-frozen")}}function bot(n,t){n.extension().quickFind(t)}function ao(n){var t=[];return n&&n.asearch("active")&&(t=n.asearch("filter")),t}function oit(t){var i=t.extension().filterStatus(!0,!1);n.notify({dataView:t,text:i||e.FilterCleared})}function eh(n){wh(n);hit(n);$(n._allFields).each(function(){delete this._listOfValues});ll(n);oit(n);n._forceSync();n.refreshData()}function ty(n,t){!t&&ao(n).length&&n.asearch("filter",null);n.clearFilter(!0);eh(n)}function sit(n){var i=n._filter,r=ao(n),t;return r.length&&(n._filter=[],t=n.extension().filterStatus(!0),n._filter=i),t}function hit(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0,f=$.Event("searching.app",{dataView:n});for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!==-1?t.splice(i,1):i++;n.viewProp("filter",t);$(document).trigger(f)}function cit(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function rl(t){var r=n._menuStrip,i=r&&r.strip,u=n._title;i&&(arguments.length||(t=cit()),t?i.show():(i.hide(),n.refreshTitleState()))}function lit(n){n.length&&n[n.length-1].text&&n.push({})}function vo(n){var i=!0,t;if(n)setTimeout(vo,5);else try{b.getSelection?(t=b.getSelection(),t&&t.rangeCount>0&&t.removeAllRanges()):document.selection&&document.selection.empty()}catch(r){i=!1}return i}function ait(){var n,t,i,u,r;return document.selection&&document.selection.createRange?(n=document.selection.createRange(),t=n.htmlText):window.getSelection&&(i=window.getSelection(),i.rangeCount>0&&(n=i.getRangeAt(0),u=n.cloneContents(),r=document.createElement("div"),r.appendChild(u),t=r.innerHTML)),t}function vit(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length===1&&i.attr("data-enabled",t?"true":"false"))}function kot(n,t){t==="Cards"?n.addClass("app-cardview").removeClass("app-grid app-onecolumnview"):t==="Grid"?n.addClass("app-grid").removeClass("app-cardview app-onecolumnview"):t==="List"&&n.addClass("app-onecolumnview").removeClass("app-cardview app-grid")}function oh(n,t,i){var r=k(n);wh(r);r.extension().viewStyle(t,i);ae(n);fi(!0);fi(!1,10)}function ib(n,t){if(t.instruction){var i=n.find("> .app-presenter-instruction"),r=t.instruction();i.length||(i=p("app-presenter-instruction").appendTo(n).hide());r?(i.show(),i.html(r)):i.hide();ul();yit(t.dataView(),n.closest(".ui-page"),!1,!0)}}function yit(n,t,i,r){var e,o,f,u;tt(n).stickyHeader.hide();e=n.extension();e._instructed||n._totalRowCount===-1||(f=e.instruction(),u=bv(t),f||i?(u.empty(),e._instructed=!0,u.length||(u=s("dv-heading").appendTo(t).hide()),f&&s("app-view-instruction").appendTo(u).html(f.replace(/<a.*?<\/a>/gi,"")),u.attr("data-selector",r?".app-presenter-instruction:visible":"ul.app-listview li.app-list-instruction"),i&&(o=cy(n,u),f||o.addClass("app-grid-header-no-description")),uf(),(i||n.extension().viewStyle().match(/Cards|List/)&&n.get_groupExpression())&&$(document).trigger($.Event("scrollstop.app",{relatedTarget:g(t)}))):u.remove())}function pit(t){function i(i){var e=i.attr("data-presenter"),u=ot()?k(t.closest(".ui-page").attr("id")):dt(),r=u?u._id:null,f=i.closest(".app-echo");f.length&&(r=f.attr("data-for"));r&&i.css("display")!=="none"&&n.presenter("show",{name:e,id:r,container:t||g(i)})}t?(t.find('div[data-role="presenter"]').each(function(){i($(this))}),$('.ui-page:not(.ui-page-active) div[data-role="presenter"]').each(function(){var n=$(this);n.closest(".app-echo-inner").length||n.addClass("app-stale")})):$('div[data-role="presenter"].app-stale').each(function(){var n=$(this);n.removeClass("app-stale");i(n)})}function rb(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header").filter(lr),f=n.find("> .app-presenter-instruction").filter(lr),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function dot(){var u=o("ui.modal.max"),n,t=r.width,i;return u?n=Math.min(oi(u),t-30):(n=t,i=oi("sm"),n=n<=i?n-30:Math.max(i,Math.ceil(n/1.4)),n=Math.min(n,oi("md")),n>t&&(n=t<i?t:t-30)),n}function got(){var n=r.height,t=Math.max(354,r.width<=oi("xxs")?n-30:Math.ceil(n*.8));return t>n-30&&(t=n-30),t}function wit(n){var i=n.prev(),r,t;i.is(".app-page-header-fixed")&&(i.css("top",d(n,"top")),r=i.outerHeight(),n.data("header-height",r),t=i.prev(),t.is(".app-page-header-image")&&(t.css("height",""),t.css({top:d(n,"top"),height:t.height()+r})))}function bit(n,t){n.find('> .app-presenter > [data-fill-screen="true"]').each(function(){var i=$(this);i.height(t-(i.offset().top-n.offset().top))})}function nst(){return $(this).is(".app-bar-header,.app-bar-actions,.app-tabs")}function ei(n){var tr=l(),t=n||tr,ci,ct,li=t.attr("id")===tr.attr("id")||t.is(".app-page-modal-root"),cr=t.is(".app-page-modal"),gt=r.toolbarHeight,nt=gt,lt,b=r.height-gt,ir=t.find(".ui-content"),rr=ir.children().filter(nst),ai=ir.find(".app-bar-footer"),vi=cc&&t.find(cc.fixedTop.selector),yi=vi&&vi.css("position")==="fixed"&&vi.outerHeight(),pi=cc&&t.find(cc.fixedBottom.selector),wi=pi&&pi.css("position")==="fixed"&&pi.outerHeight(),at=0,bi,ni=t.attr("class"),ei=tt(t.attr("id")),vt=ei&&ei.dataView,it=w.left.width,ur=pt.enabled,fr,di,oi,ui,si,er,or,ti,fi;if(it&&it++,cr){var ki=ni.match(/\bapp-page-modal-max-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),k=ni.match(/\bapp-page-modal-dock-(top|left|right|bottom)\b/),o=r.width<480&&k||t.is(".app-page-modal-gap-none")?0:15,i=got(),a=dot(),lr=ki?vot(ki[1]):0;k&&(k=k[1]);ki&&(a=Math.min(r.width-o*2,lr));bi=ni.match(/\bapp-page-modal-fullscreen\b/);bi&&(a=r.width-o*2,i=r.height-o*2);var v=g(t),rt=0,u=(r.height-i)/2,y=(r.width-a)/2,ri,yt;ur&&ni.match(/\bapp-reading-pane-detail\b/)&&(r.splitLeft||r.splitBottom)?(r.splitLeft?(u=0,y=it+r.splitLeft+pt.divider,a=r.splitRight,i=r.height):(u=r.toolbarHeight+r.splitTop+pt.divider,y=it,a=r.width-it,i=r.splitBottom),t.toggleClass("app-reading-pane-detail-vertical",!r.splitLeft)):k&&(k==="top"?u=r.width===a?0:o:k==="left"?(y=o,vt&&vt.tagged("modal-fit-content")||(u=o,yt=o,i=r.height-o*2)):k==="bottom"?(u="auto",yt=o):k==="right"&&(y="auto",ri=o,vt&&vt.tagged("modal-fit-content")||(u=o,yt=o,i=r.height-o*2)));wr()&&(u!=="auto"&&(u+=r.top),y!=="auto"&&(y+=r.left),yt!=null&&yt!=="auto"&&(yt+=r.bottom),ri!=null&&ri!=="auto"&&(ri+=r.right));u!=="auto"&&(u=Math.round(u));ct={page:t,dataView:vt,top:u,right:ri,bottom:yt,left:y,width:a,height:i};ci=$.Event("getpagerect.app",{rect:ct});hr.trigger(ci);a=ct.width;i=ct.height;t.css({"padding-top":0,top:ct.top,left:ct.left,right:ct.right,bottom:ct.bottom,"min-width":a,"max-width":a,width:a,"min-height":i,"max-height":i,height:i});footerHeight=ai.length?ai.outerHeight():0;rr.each(function(){var n=$(this);n.css("display")!=="none"&&(rt+=n.outerHeight(!0))});fr=v.data("scrolling");di=t.find(".app-page-modal-title");v.data("scrolling",!0);t.find(".app-bar-actions,.app-bar-footer,.app-bar-header").each(function(){var n=$(this);n.width(Math.round(a-d(n,"padding-left")-d(n,"padding-right")))});di.length&&(rt+=di.outerHeight());oi=a+wt.width;ui=i-footerHeight-rt;v.css({top:rt,left:0,"min-width":oi,"max-width":oi,width:oi,"min-height":ui,"max-height":ui,height:ui});bit(v,ui);!bi&&vt&&vt.tagged("modal-fit-content")&&!ci.isDefaultPrevented()&&(si=v.find(".app-stub"),si.length&&(er=si.position(),or=Math.ceil(er.top+si.height()+v.scrollTop()),ti=v.height()-or,ti>0&&(v.css({"min-height":i-footerHeight-rt-ti,"max-height":i-footerHeight-rt-ti,height:i-footerHeight-rt-ti}),i-=ti,k!=="top"&&k!=="bottom"&&(u=r.top+(r.height-i)/2),t.css({top:u,"min-height":i,"max-height":i,height:i}))),t.addClass("app-page-modal-fit-content"));wit(v);v.data("vscrollbar").css({height:i-footerHeight-rt,right:0,top:rt});rb(v);li&&$app.display(v);fr||v.data("scrolling",!1)}else{if(t.css({"padding-top":nt}),nt=d(nt),cu&&!bp&&t.attr("id")==="Main"&&(nt=0,b+=gt),y=r.left+it,lt=r.width-it,ei&&ei.home&&ur&&ni&&ni.match(/\bapp-reading-pane-master\b/)){var ut,ar=r.portrait,ft,et,st,ht,e=pt.divider,gi=pt.minLeft,hi=pt.minRight,sr=pt.minTop,nr=pt.minBottom,bt=r.width-it,kt=r.height-gt,ii,dt=pt.splitter,p=pt.bkg;ar?(st=fu("splitTop"),ht=st?kt-st-e:ht=Math.ceil(kt*.618),(kt-e-ht<sr||kt-e-st<nr)&&(ht=kt-e-sr),kt-pt.minTop-e>=nr&&ht>=nr&&(b=st=kt-ht-e,ii=!0)):(ft=fu("splitLeft"),et=ft?bt-ft-e:Math.ceil(bt*.618),bt-e-et<gi?et=bt-e-gi:bt-e-ft<hi&&(et=hi),bt-gi-e>=hi&&et>=hi&&(lt=ft=bt-et-e,ut=ft+it));(ft!==r.splitLeft||et!==r.splitRight||st!==r.splitTop||ht!==r.splitBottom)&&(r.toolbarWidth=ut,ut&&r.splitLeft!=null&r.splitLeft!=ft&&(r.toolbarWidthChanged=!0),r.splitLeft=ut?ft:null,r.splitRight=ut?et:null,r.splitTop=ii?st:null,r.splitBottom=ii?ht:null,ew({}),(ut||ii)&&(ot()&&l().is(".app-hidden")&&l().removeClass("app-hidden"),dt||(dt=pt.splitter=s("app-reading-pane-splitter",'data-draggable="reading-pane"')),dt.insertAfter(t).show().toggleClass("app-bottom",ii!=null),ut?dt.css({left:y+lt,top:r.top,height:b+r.toolbarHeight,width:""}):dt.css({left:y,top:r.top+gt+st,width:lt,height:""}),typeof p!="object"&&(typeof p=="string"?(fi=f.resolveClientUrl(p),p.match(/\(/)||(fi="url("+fi+")")):fi=p||p==null?"":"none",p=pt.bkg=s("app-reading-pane-bkg").css("background-image",fi),p.insertAfter(t).show()),ut?p.css({left:y+lt,top:r.top,height:b+r.toolbarHeight,width:e+et,display:""}):p.css({left:y,top:r.top+gt+st,width:lt,height:e+ht,display:""})));ut||ii||(dt&&(dt.hide(),$(".app-reading-pane-detail").addClass("app-hidden")),typeof p=="object"&&p.hide())}t.css({left:y,width:lt,top:r.top,minHeight:r.splitTop||b});g(t).each(function(){var n=$(this),t=0,r=n.data("scrolling"),i;n.data("scrolling",!0);rr.each(function(){var n=$(this);n.css("display")!=="none"&&(t+=n.outerHeight(!0))});ai.each(function(){var n=$(this);n.css("display")!=="none"&&(at+=n.outerHeight(!0))});t&&(b=b-t,nt=nt+t);yi&&(b-=yi,nt+=yi);wi&&(b-=wi,at+=wi);at&&(at-=2);i=b-at;n.css({top:nt,bottom:at,"min-height":i});bit(n,i);li&&n.css({height:i});wt.width&&n.css("width","").width(n.width()+wt.width);$(n.data("vscrollbar")).css({height:b-at,right:0,top:nt});wit(n);rb(n);li&&$app.display(n);r||n.data("scrolling",!1)})}h&&c.scrollTop(0);t.data("trackPosition")&&$(document).trigger($.Event("pagepositionchanged.app",{page:t}))}function ub(n){var i=document.cookie.split(";"),r,t;for(r in i)if(t=i[r].trim(),t.startsWith(n+"="))return t.substring(n.length+1)}function tst(n,t,i){var u="",r;i&&(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString());document.cookie=n+"="+t+u+"; path=/"}function ist(){function ht(n){return n&&(n=n.match(/Landscape|Always|Never/)),n?n[0]:"Landscape"}for(var tt=o("ui.displayDensity.mobile"),st=o("ui.displayDensity.desktop"),y=kf.Browser,it,p,rt,l=$("#PageHeader").parent(),s,b=$("div[data-content-framework]").first(),ut=ri("promoteActions"),ft=ri("smartDates"),et=o("ui.input.focus.style")||"underline",t=(c.attr("class")||"").split(/\s+/),a=0,ot,k,v,g,i,u;a<t.length;)tl(t[a])?t.splice(a,1):a++;if(h?t.push("app-touch"):ro||t.push("app-desktop"),ot=pi.appInfo.split("|")[1],k=ub(".COTTHEME"+ot),k&&(v=k.split("."),v.length>1&&(s={theme:v[0],accent:v[1]})),l.length||(l=c),o("membership.profile",o("membership.profile")||"view switch login logout"),o("ui.transitions.style",ri("transitions")||o("ui.transitions.style")||"slide"),n._uiSideBarWhen=gp?"Never":ri("sidebar")||ht(o("ui.sidebar.when")),o("ui.sidebar.when",n._uiSideBarWhen||(vl()?"Always":"Landscape")),g=ri("minisidebar"),o("ui.sidebar.mini",g!=null?g:lt("ui.sidebar.mini")||o("ui.sidebar.mini")==null&&r.width<=oi("lg")),o("ui.menu.location",cu?"toolbar":o("ui.menu.location")?o("ui.menu.location"):"toolbar"),pi.bars={left:{visible:!1,width:0,content:[]},bottom:{visible:!1,height:0,content:[]},right:{visible:!1,width:0,content:[]}},o("ui.theme.name",ri("theme")||s&&s.theme||o("ui.theme.name")),o("ui.theme.accent",ri("accent")||s&&s.accent||o("ui.theme.accent")),o("ui.displayDensity.value",ri("displayDensity")||(ta<144?st:tt==="Auto"?Math.min(r.height,r.width)<=oi("sm")?"Comfortable":"Compact":tt)),o("ui.list.labels.display",ri("labelsInList")||o("ui.list.labels.display")),o("ui.showSystemButtons",ri("showSystemButtons")||o("ui.showSystemButtons")||"Auto"),o("ui.actions.promote",ut!=null?ut:o("ui.actions.promote")),iv=o("ui.menu.autoExpand")||"current",o("ui.list.initialMode",cu?"Summary":ri("initialListMode")||o("ui.list.initialMode")||"SeeAll"),o("ui.smartDates",ft!=null?ft:o("ui.smartDates")===!0),he=o("ui.scrollbars.wide"),he=he===!0||he==="pointer"&&!h,yg=o("ui.history.dataView")||"search filter sort group",gh=o("ui.autoCompleteMaxRowCount")||1e3,ia=o("ui.multiSelectMaxRowCount")||1e3,o("barcode.enabled")===!0&&(nt.enabled=!0,nt.enter=o("barcode.enter")||["Enter"],nt.override=lt("barcode.override"),nt.inputSpeed=o("barcode.inputSpeed")||30,nt.slowInputSpeed=o("barcode.slowInputSpeed")||100,nt.inventorySpeed=o("barcode.inventorySpeed")||500,nt.frequency=o("barcode.frequency")||100,nt.ignore=new RegExp(o("barcode.ignore")||"total.+?\\d+","i")),w=pi.bars,y.agent==y.InternetExplorer&&y.version<=9&&!(__settings.host||window.external)&&(c.hide(),pi.defaultUI?(it=(new Date).getDate()+365,p=new Date,p.setDate(it),rt=String.format("appfactorytouchui=false; expires={0}; path=/",p.toUTCString()),document.cookie=rt,location.reload(ii.path.parseUrl(location.href).hrefNoHash)):alert(e.TouchUINotSupported)),gr&&t.push("app-ios"),(wu||cft)&&t.push("app-android"),(f.host||o("ui.native"))&&t.push("app-native"),o("ui.showSystemButtons")!=="Always"&&t.push("app-show-system-buttons-on-hover"),et!=="none"&&t.push("app-input-focus-"+et),o("ui.input.focus.label")===!0&&t.push("app-input-focus-label"),l.is(".Tall")&&t.push("app-page-header-hidden"),(l.is(".Wide")||o("ui.menu.location")!=="sidebar"&&b.length&&b.attr("data-sidebar")!=="true"||!b.length&&$('div[data-app-role="page"]').first().attr("data-sidebar")==="false")&&(o("ui.sidebar.when","Never"),o("settings.options.sidebar",!1)),cu){if(location.href.match(/_showNavigation=false/)||(t.push("app-hosted-show-navigation"),bp=!0,n._toolbar.css("visibility","")),location.hash){c.children().hide();location.reload(location.pathname+location.search);return}t.push("app-hosted")}$(document).trigger("init.app");i=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed app-sidebar app-sidebar-left app-sidebar"><div class="ui-panel-inner" tabindex="0"><ul/><\/div><div class="app-bar-toolbar-bottom"><\/div><\/div>').appendTo(c);u=i.find(".ui-panel-inner");i.toggleClass("app-sidebar-menu",o("ui.menu.location")==="sidebar");fw({sidebar:i});wt.width&&u.css({"overflow-y":"scroll",width:i.width()-d(u,"padding-left")-d(u,"padding-right")+wt.width});w.left.inner=u;w.left.toolbar=u.next();w.left.content.push(i.find("ul").listview());i=$('<div class="ui-panel ui-panel-fixed app-sidebar app-sidebar-right"><div class="ui-panel-inner" tabindex="0"><ul><\/ul><\/div><\/div>').appendTo(c);u=i.find(".ui-panel-inner");w.right.inner=u;w.right.content.push(i.find("ul").listview());lt("ui.sidebar.mini")&&(w.left.mini=!0);o("ui.displayDensity.value")||o("ui.displayDensity.value",h?"Comfortable":"Compact");t.push(lk(o("ui.theme.name")));t.push("app-accent-"+o("ui.theme.accent"));t.push(ck(o("ui.displayDensity.value")));o("ui.list.labels.display")==="DisplayedAbove"&&t.push("app-labelsinlist-displayedabove");c.attr("class",t.join(" "));gv();$(document).trigger("starting.app")}function vf(t){n.tabs("fit",{page:t})}function kit(n){n=$(n);g(n).each(function(){var n=$(this),t=n.data("scroll-top")});n.find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)})}function fb(n){n=$(n);n.is(":visible")&&n.find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())})}function dit(n){var t=n.scrollTop();return{top:t*-1,height:n.height()+t,maxHeight:n[0].scrollHeight}}function git(n){function f(){var n=t.scrollTop(),e=n!==r;e||ai()-u<100?(r=n,e&&(u=ai()),requestAnimationFrame(f)):(i=!1,vr(),t.data("scroll-stop-time",new Date))}var t=n.find(".ui-panel-inner"),i,r,u;if(t.length)t.on("scroll keydown keyup",function(){!et&&h&&(i||(i=!0,r=t.scrollTop(),vr(!1),u=ai(),requestAnimationFrame(f)))})}function rst(n){n.find(".ui-panel-inner").off("scroll keydown keyup")}function iy(t,i){t||(t=g());pe(t,!1,i===!0);t.find(".app-data-list").each(function(){ry($(this))});rh(t).find(".app-hscrollbar2[data-view]").each(function(){var i=$(this),t=k(i.attr("data-view"));t.session("scroll-left")&&i.width()>=t.session("grid-avail-width")&&n.scrollGrid(t,0);ye(t,i.find(".app-hscrollbar-handle"))})}function ry(n,t){n.length&&(t||(t=n,n.parent().attr("class").match(/\-outer/)&&(t=n.parent()),t=t.next().find(".app-hscrollbar-handle")));var r=n.scrollLeft(),u=n.width(),f=n[0].scrollWidth,i=Math.abs(u-f)<=2?1:u/f;t.parent().css("visibility",i===1?"hidden":"");i===1||n.find(".app-hidden").length?(t.css("display","none"),n.removeClass("app-inner-shadow-left app-inner-shadow-right app-inner-shadow-left-right")):(r<=0?n.addClass("app-inner-shadow-right").removeClass("app-inner-shadow-left app-inner-shadow-left-right"):r>=n[0].scrollWidth-n[0].clientWidth-1?n.addClass("app-inner-shadow-left").removeClass("app-inner-shadow-right app-inner-shadow-left-right"):n.addClass("app-inner-shadow-left-right").removeClass("app-inner-shadow-right app-inner-shadow-left"),t.css({left:r*i,width:u*i,display:""}))}function ye(t,i){var c=t.sessionShared("isSummary"),o,y=t.session("scroll-left")||0,l=t.session("grid-avail-width"),r,a,u;if(c||(i=$("#"+t._id+" .app-bar-footer .app-hscrollbar-handle")),i||(a=ni(t),i=a.find(".app-hscrollbar-handle")),u=i.parent(),o=u.width(),r=Math.abs(o-l)<=2?1:o/l,r<1&&i.css({left:y*r,width:o*r}),c)u.css("visibility",r>=1?"hidden":"");else{var p=u.css("display"),f=r>=1?"none":"block",s=u.parent(),e,h,v;p!==f&&(u.css("display",f),n.bar(f==="block"?"show":"hide",s));e=s.parent();e.data("hsbInit")||(e.data("hsbInit",!0),h=s.prev(),v=s.next(),e.toggleClass("app-bar-footer-flat",f==="block"&&!h.length),e.toggleClass("app-bar-footer-scrollbar",f==="block"&&!h.length&&!v.length))}}function pe(t,i,r){var a,c;if(t.length)if(r)clearTimeout(b._updateVScrollbarTimeout),b._updateVScrollbarTimeout=setTimeout(pe,100,t,i);else{i||(i=t.next().find(".app-vscrollbar-handle"));var e=t[0].scrollHeight,o=t.height(),u=e&&t.css("overflow-y")!=="hidden"?Math.ceil(o)/e:1,l=i.parent(),f=t.parent().parent();if(footer=l.next(),l.css("visibility",u>=1?"hidden":""),u===1)i.css("display","none"),footer.addClass("app-bar-footer-no-scrolling"),f.removeClass("app-page-scrolled"),f.is("#Main")&&n._toolbar.removeClass("app-page-scrolled");else{var s=t.scrollTop(),h=o*u;h<16&&(h=16);i.css({top:s*u-0,height:h,display:""});e<=s+o?footer.addClass("app-bar-footer-no-scrolling"):footer.removeClass("app-bar-footer-no-scrolling");a=t.data("header-height");c=s>(a||50);f.toggleClass("app-page-scrolled",c);f.is("#Main")&&n._toolbar.toggleClass("app-page-scrolled",c)}}}function uy(t,i){function b(){f=u.data("lastScrollTop");f==null&&(f=0);var t=u.data("scroll-dir"),i=u.scrollTop(),n=i<f?"up":i==f?"none":"down";n==="none"&&t==="none"&&(n="up");n!==t&&(u.data("scroll-dir",n),$(document).trigger($.Event("scrolldir.app",{relatedTarget:u})))}function k(){var n=u.scrollTop(),t=n!=f,i=ai();t||i-l<100?(f=n,t&&(l=i),requestAnimationFrame(k)):(clearInterval(u.data("scrollInterval")),b(),s=!1,vr(),u.data({"scroll-stop-time":new Date,lastScrollTop:n,scrollInterval:null}),e.removeClass("app-scrollbar-reveal"),$(document).trigger($.Event("scrollstop.app",{relatedTarget:u})))}var u=g(t),e,o,c,y,s,f,l,d,a,v;if(!u.length){if(c=t.find(".ui-content"),y=c.contents(),u=p("app-wrapper").appendTo(c),wt.width&&u.css("overflow-y","scroll"),d=r.width,u.toggleClass("app-display-tablet",d>=oi("sm")+(w.left.visible?w.left.width:0)),e=p("app-vscrollbar"+(lt("ui.scrollbars.modern")?" app-scrollbar-modern":"")).toggleClass("app-scrollbar-wide",he).insertAfter(u),o=p("app-vscrollbar-handle",'data-draggable="vscrollbar"').appendTo(e),u.data({vscrollbar:e,"vscrollbar-handle":o}),pe(u,o),pc(u,!1),a=n.pageInfo(t),a&&a.external&&e.css("display","none"),i===!1)u.on("scroll",function(){pe(u,o)});else u.on("scroll",function(){if(et||u.data("scrolling")){clearInterval(u.data("scrollInterval"));u.data("lastScrollTop",u.scrollTop());s=!1;vr();return}pe(u,o);s?b():(s=!0,vi(),$(document).trigger($.Event("scrollstart.app",{relatedTarget:u})),vr(!1),e.addClass("app-scrollbar-reveal"),l=ai(),requestAnimationFrame(k))});h||u.attr("tabindex",0);v=$('<div class="app-page-header"><h2><\/h2><h1><\/h1><\/div><div class="app-page-header-divider"><\/div>');u.closest('[data-page-header="false"]').length&&v.hide();v.appendTo(u);y.appendTo(u)}return u}function ur(t){n.activeLink(t)}function kt(n,t){t||(t=gi);n=$(n);var i=n.attr("class");i&&i.match(/\bapp-btn-/)?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");feedbackFrom="link";t(n)},er)):(ur(n),setTimeout(function(){et&&t===gi||(ur(),feedbackFrom="link",n&&n.is(".app-btn")&&(feedbackFrom="toolbar"),t(n))},er))}function sh(){rr&&rr._updateLastActivity()}function fy(){return pa&&pa.length||(pa=$(".app-sidebar").first()),pa}function fst(n){return pi.bars[n||"left"].visible}function yf(n,t,i){if(n){var r=n.context,u=n.href;i||ir();u?fh(u):n.callback&&(t&&r&&!r.url&&t.parent().find(".app-btn").trigger("vclick"),n.callback(r,t))}}function eb(n){var t=n.closest("ul").find(".app-focus");n.closest(".ui-panel-inner").focus();t.length&&(t.removeClass("app-focus ui-btn-active"),n.addClass("app-focus ui-btn-active"))}function nrt(n,t){if(n.length){t||(t=n.closest(".ui-panel-inner"));var i=n.offset(),e=t.offset(),r,u=e.top,f=u+t.outerHeight()-1;i.top<u?r=i.top-u:i.top+n.outerHeight()>f&&(r=i.top+n.outerHeight()-f);r&&setTimeout(function(){t.scrollTop(t.scrollTop()+r)},10)}}function trt(n){var t=l();t&&(ot()&&(t=$(".app-reading-pane-master")),t.find(".dv-load-at-top").css("visibility",n?"hidden":""));et=n}function dt(){return n.dataView()}function l(n){var t=ii.activePage;return arguments.length&&t?t.find(n):t}function si(){var n=l();return n?n.attr("id"):"_"}function tt(t){return n.pageInfo(t)}function est(){return si()==="Main"}function ob(n,t){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_f_"+t.Name}function hh(n){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_scroll_"}function ost(n,t){t||(t=co());var i=n.cols!=null?n.cols:n.toColumns(),r=n.long?i*.5:i<11?i:i<21?Math.ceil(i*.5):10;return Math.ceil(t*(r<=3?1:.55)*r)}function nf(n){var t=Math.ceil(co()*1);$(n||l(".app-listview")).each(function(){var i=$(this),b=i.parent(),l=i.closest(".ui-page"),ft,gt="w"+Math.ceil(d(l,"width")/t),u=hg[gt],k,et,ot,ti,st,nt,ht=i.data("data-yardstick-class"),e=c.find("#app-yardstick"),ii=i.is(".app-grid"),ct=b.is(".app-echo-inner"),ri,ui,fi,lt,bt,kt,si,hi,ci,ut,dt;if(u||(e.length||(e=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(c).listview()),ct&&ii&&(b=g(b)),e.addClass("app-onecolumnview").appendTo(b).show(),k=e.find("li").first(),lt=i.closest(".ui-popup").length,ft=l.css("display"),ft==="block"||lt||(l.css("display","block"),ei(l)),ot=k.outerWidth(),e.toggleClass("app-onecolumnview  app-cardview"),et=k.outerWidth(),e.toggleClass("app-cardview app-grid"),ti=e.find("span").first(),st=d(ti,"margin-left"),wt.gridColumnPadding=st,ri=k.outerWidth(),e.removeClass("app-grid"),ft==="block"||lt||l.css("display",""),e.appendTo(c).hide(),ui=le(ot),fi=le(et),u={listBreakpoint:ui,cardBreakpoint:fi,card:Math.floor(et/t),list:Math.floor(ot/t),columnPadding:st,grid:{},gridWidth:ri},hg[gt]=u),nt="app-listitem-"+(i.is(".app-cardview")?u.cardBreakpoint:u.listBreakpoint),nt!==ht&&(ht&&i.removeClass(ht),i.addClass("app-yardstick "+nt).data("data-yardstick-class",nt)),ii){var ai=tt(ct?ni(i).attr("data-for"):l.attr("id")),n=ai.dataView,h=n.session("grid-style"),o=yh(n);if(!h||n.session("grid-style-changed")||o&&n.session("window-width")!==r.width){n.session("grid-style-changed",null);var vi=n._fields,yi=n._allFields,at=[],y,pi=0,a=n.get_showMultipleSelection(),f=i.is(":visible")?i.width():u.gridWidth,vt=n._hasKey(),yt=n.inlineEditing(),oi=(vt?22:0)+(a?38:0)+(yt?40:0)+wt.gridColumnPadding,it=oi,rt,v,p=n.gridSettings(),pt=new kf.StringBuilder;if($(vi).each(function(){var r=this,i=yi[r.AliasIndex];r.Hidden||i.GroupBy||r.OnDemand||r.Type==="DataView"||(y=i.toColumns(),rt=Math.ceil(Math.min(f*.5,y*t*(y<=3?1:.55))),p&&p.width[i.Name]&&(rt=p.width[i.Name]),it+=rt+wt.gridColumnPadding,pi+=y,at.push({name:i.Name,className:ob(n,i),cols:y,type:i.Type,ew:rt,long:i.ItemsTargeDataController||i.Type==="String"&&i.Rows>1}))}),n){if(n.session("avail-width",f),bt=n.session("grid-avail-width"),kt=oi,n.tagged("grid-fit-none")&&(o&&yh(n,!1),o=!1),p){for(v in p.width)hi=!0;hi&&(o&&yh(n,!1),o=!1)}bt==null||o?(f-=wt.gridColumnPadding+1,ct&&(f-=wt.width),o&&f<it&&(ci=(f-(a?22:0))/it,$(at).each(function(){var n=this,i=ost(n,t);n.ew=(n.ew+wt.gridColumnPadding)*ci-wt.gridColumnPadding;n.ew<i&&(n.ew=i,si=!0);kt+=n.ew+wt.gridColumnPadding})),si?f=kt:o||(f=it),n.session("grid-avail-width",Math.floor(f)),yh(n,o),n.session("window-width",r.width)):f=bt}var wi,s=0,w=wv(n),li=w!=="_none_";$(at).each(function(){v=this;var n=v.ew;v==wi&&(vt&&(n-=22),a&&(n-=22+u.columnPadding));w!=="_none_"&&(s+=n+u.columnPadding,(w===v.name||w==="_first_")&&(w="_none_"));pt.appendFormat(".{0} {{width:{1}px;max-width:{1}px}}",v.className,Math.floor(n));pt.appendLine()});ut=pt.toString();dt=n._id+"_"+n._viewId;h||(h=$('style[id="'+dt+'"]'),h.length||(h=nl().attr("id",dt)),h.data("css")!==ut&&h.text(ut).data("css",ut));s&&(s+=4);yt&&(s+=24+u.columnPadding);s=!li&&!a?0:Math.floor(s+(vt?26:4))+(a?22+(s>0?u.columnPadding:4):0);li||a||!yt||(s=40+u.columnPadding);n.session("grid-frozen-width",s)}}})}function sst(){var i=si(),t=n._pages;return i==="Main"||t.length&&i===t[0].id&&t[0].home}function irt(){var r=n._menuButton,c=l(),i,f,o;if(r&&n.toolbar().is(":visible")&&!c.is(".app-page-modal")&&!gu())if(sst()?r.removeClass("ui-icon-back ui-icon-bars "+cd).addClass("ui-icon-bars").attr({"data-action":"#app-btn-menu",title:e.Menu}):r.removeClass("ui-icon-bars "+cd).addClass("ui-icon-back").attr({"data-action":"#app-back",title:e.Back}),f=!r.is(".ui-icon-bars"),n.toolbar().toggleClass("app-has-back",f),o=n._backText,f){var u=yi("prev"),s=u&&u.hash,h=s?tt(s.substring(1)):null,t=h?h.headerText:u&&u.title;i=tt();(!t||i&&i.headerText===t)&&(i&&(t=i.backText),t||(t=e.Back));o.text(typeof t=="string"?t:t[0]).show()}else o.hide()}function sb(n){n.length&&n.closest(".app-sidebar").length&&(sg[si()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function hst(n){n.find(".ui-panel-inner").scrollTop(n.length&&n.closest(".app-sidebar").length?sg[si()+"_"+n.attr("id")]||0:0)}function hb(n){var i=$(n.target),t;return i.is(".app-btn-check")?!0:(t=i.closest(".ui-btn,.app-grid-header").find(".app-btn-check"),t.length>0&&su(n.pageX)<=t.offset().left+t.outerWidth()+8)}function rrt(n,t){var u,i,f=su(n.clientX),e=th(n.clientY),o=$(n.target).closest(".ui-btn").find(".app-action-column"),r;return o.length&&o.find(".app-action-column-button").each(function(){var n=$(this),o=n.offset();if(f>=o.left-4&&f<=o.left+n.outerWidth()+3&&e>=o.top-6&&e<=o.top+n.outerHeight()+4)return u=!0,n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");i=ni(n);bb(i);oy(t).removeClass("app-selected ui-btn-active");r=n.closest(".ui-btn");t.extension().tap(r.data("data-context"),"none");i.length&&r.addClass("app-selected");var u=[],f=n.attr("data-action-path");go("ActionColumn",t,u,t.commandRow());$(u).each(function(){var n=this;if(n.path===f)return yf(n,r),!1});i.length?lo(t,i):ae(t._id)},er),!1}),u}function urt(n){var r=$(n.target),t;if(r.is(".app-btn-more"))return!0;var i=r.closest(".ui-btn").find(".app-btn-more"),u=su(n.clientX),f=th(n.clientY);return i.length?(t=i.offset(),t.left-8<=u&&u<=t.left+i.outerWidth(!0)+8&&t.top-8<=f&&f<=t.top+i.outerHeight(!0)+8):!1}function cb(n){return n.closest(".ui-btn").find(".app-btn-more")}function ey(n){return String.format("app-style-dv-{0} app-style-c-{1} app-style-cv-{1}-{2}",n._id,n._controller,n._viewId)}function oy(n){return tt(n).page.find('ul[data-role="listview"] li a')}function ue(n){$(arguments).each(function(t){t&&(n?$(this).addClass("app-btn-check-selected").closest(".ui-btn").addClass("app-checked").parent().addClass("app-checked"):$(this).removeClass("app-btn-check-selected").closest(".ui-btn").removeClass("app-checked").parent().removeClass("app-checked"))})}function sy(n){n.is(".app-cardcolumn")&&(n=n.parent());n.find("a.app-selected").removeClass("app-selected ui-btn-active")}function lb(n,t){t==null||t.match(/^null\b/)||n.push(t)}function hy(t,i,r){function a(){e.length&&lo(t,e)}var u=t._selectedKeyList,s=!u.length,o=g().find(".app-style-dv-"+t._id),e=ni(o),h=o.find(".dv-item .ui-btn:not(.app-calculated) .app-btn-check"),v=(e.length?e:o.closest(".ui-page")).find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check"),y=n.stickyHeaderBar().find(".app-grid-header .app-btn-check"),c,l;if(s&&t._totalRowCount>ia){f.alert(String.format(tu.Presenters.Charts.DataWarning,ia),function(){e.length&&n.contextScope(t);bh({mode:"everything"});n.contextScope(null)});return}if(u.splice(0,u.length),ue(s,h,v,y),s)if(h.length&&!t.commandRow()&&(l=$(h[0]).closest(".ui-btn"),t.extension().tap(l.data("data-context"),"none"),e.length&&l.addClass("app-selected")),t._keyFields.length===1&&g(o).find(".dv-load-at-top,.dv-load-at-bottom,.dv-action-see-all").length){if(t._busy())return;c=t._createArgsForListOfValues(t._keyFields[0].Name);c.request.MaximumValueCount=ia;t._invoke("GetListOfValues",c,function(n){t._busy(!1);$(n).each(function(){lb(u,this.toString())});t.set_selectedValue(u.join(";"));vb(t);a()})}else o.find(".dv-item .ui-btn:not(.app-calculated)").each(function(){lb(u,t._createRowKey($(this).data("data-context").row))}),a();else i||(t.extension().clearSelection(!0),r&&db(t));t.set_selectedValue(u.join(";"));e.length?(ue(s,tt(t).page.find(".app-wrapper .app-listview .app-btn-check, .dv-heading .app-btn-check")),a()):(ae(t),fi());vb(t)}function ab(n){return n.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check")}function frt(n){return ke(tt(n).page).find(".app-grid-header .app-btn-check")}function ert(n){var i=n._selectedKeyList,t=i.length;return Array.indexOf(i,"null")!==-1&&t--,t?" "+String.format(t>1?e.ItemsSelectedMany:e.ItemsSelectedOne,t)+".":""}function vb(n){var r=n._selectedKeyList.length,t=tt(n),i=$.merge(t.page.find(".app-multi-select-instruction"),ni(n).find(".app-multi-select-instruction"));si()===n._id&&$.merge(i,ke(t.page).find(".app-multi-select-instruction"));i.text(ert(n));r>1&&ul();ht.sync()}function ul(n){n||(n=ke());n.find(".app-bar-text-instruction-hidden").removeClass("app-bar-text-instruction-hidden")}function yb(n,t,i){var c=n.extension(),a=t.find(".app-btn-check"),o=t.data("data-context"),r=n._selectedKeyList,v=r.slice(0),s=o?n._createRowKey(o.row):n.get_selectedKey().join(","),l=r.indexOf(s),u=t.closest(".ui-listview"),f=ni(u),y,w=frt(n),h,e,b=t.is(".app-selected"),p;y=ab(u);l!==-1?(r.splice(l,1),ue(!1,a),b&&(sy(u),v.length>1?n._clearSelectedKey():(c.clearSelection(!0),db(n)),e=u.find(".dv-item.app-checked .ui-btn").first(),e.length?(p=e.data("data-context"),s=n._createRowKey(p.row),r.splice(r.indexOf(s),1),f.length?e.trigger("vclick"):c.tap(e.data("data-context"),i)):r.length&&n.sync(r[0])),f.length?lo(n,f):ae(n)):(lb(r,s),ue(!0,a),sy(u),f.length?t.addClass("app-selected"):ae(n),o&&c.tap(o,i));ue(r.length,y,w);f.length&&(u=g(n._id).find(".app-listview"),u.length&&(h=t.data("data-context"),u.find(".ui-btn").each(function(){var t=$(this),i=t.data("data-context"),f=0;if(h&&($(n._keyFields).each(function(){var t=n.findField(this.Name);h.row&&i&&i.row&&h.row[t.Index]===i.row[t.Index]&&f++}),f===n._keyFields.length))return checkBox=t.find(".app-btn-check"),l!==-1?ue(!1,checkBox):(sy(u),ue(!0,checkBox),t.addClass("app-selected")),ue(u,r.length,ab(u)),!1})));r=r.join(";");n.set_selectedValue(r);v.join(";")!==r&&fi();vb(n)}function cy(n,t){var v=n._fields,y=n._allFields,c=!0,i=$('<div data-draggable="grid-header" class="app-grid-header app-grid-header-cv-'+n._id+"-"+n._viewId+'"><\/div>').appendTo(t).attr("data-for",n._id),l=hh(n),r=wv(n),u=r==="_none_",p=0,a,o;return n.get_showMultipleSelection()&&(o=s("app-btn-check").appendTo(i).attr("title",e.LookupSelectAction),n._selectedKeyList.length&&o.addClass("app-btn-check-selected")),n.inlineEditing()&&s("app-row-status").appendTo(i),i.toggleClass("app-grid-header-inlineediting",n.inlineEditing()),(r!=="_none_"||o||n.inlineEditing())&&s("app-frozen-spacer "+l+"frozen_").appendTo(i),$(v).each(function(){var w=this,t=y[w.AliasIndex],o,v,b,k,d,g;w.Hidden||t.GroupBy||w.OnDemand||w.Type==="DataView"||(o=s("",'data-draggable="grid-header-field"').addClass(ob(n,t)).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(i),t.Type.match(f._numericTypeRegex)?o.addClass("app-field-type-numeric"):t.Type==="Boolean"&&o.addClass("app-field-type-bool"),v=ge(n,t.Name),b=n.get_fieldFilter(t,!0),v||b?cr("b","app-grid-header-text").appendTo(o).text(t.HeaderText+" "):o.text(t.HeaderText),v&&bt("material-icon-arrow-"+(v.match(/^asc/i)?"upward":"downward"),o).addClass("app-btn-sort").attr({"data-title":e.Sort,"data-sort":v}),b&&(g=bt("material-icon-filter-list",o),$(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return k=n,!1}),k&&!h&&(d=n._filter,n._filter=[k],g.attr("title",n.extension().filterStatus(!0)),n._filter=d)),c&&(c=!1,tb(n,i)),a=s("app-field-separator",'data-draggable="grid-header-separator"').appendTo(i),r!=="_none_"?(o.addClass("app-frozen"),t.Name===r||r==="_first_"?(u=!0,r="_none_"):a.addClass("app-frozen")):u&&(o.addClass(l+" app-scroll"),u=!1),p++)}),i}function ort(n,t,i,r){if(n.get_showMultipleSelection()){var f=s("app-btn-check").appendTo(r).attr("title",e.LookupSelectAction),u;i||(u=n._createRowKey(t),n._selectedKeyList.indexOf(u)!==-1&&(f.addClass("app-btn-check-selected"),r.addClass("app-checked").parent().addClass("app-checked")))}n.inlineEditing()&&s("app-row-status").appendTo(r)}function ly(n,t){var i=n.HyperlinkFormatString,r;return i&&(r=n._dataView._parseLocation(i,t)),r}function fl(n,t,i,r,u){if(u)switch(t.Type){case"Date":case"DateTime":n.removeAttr("data-smart-type data-smart-value data-smart-text")}if(pi.ui.smartDates&&i!=null&&!t.is("smart-dates-disabled")){var e,o;switch(t.Type){case"Date":case"DateTime":e=hrt(n,t.Type,i,r,new Date);e&&(o=!0,n.attr({"data-smart-type":t.Type,"data-smart-value":JSON.stringify(i),"data-smart-text":r}));break;default:t._smartSize&&(e=f.sizeToText(i),n.text(e))}return e&&o&&!b.smartValueInterval&&(b.smartValueInterval=setTimeout(function(){srt();b.smartValueInterval=setInterval(srt,6e4)},6e4-(new Date).getSeconds()*1e3)),e}}function srt(n){n&&n.length||(n=$("[data-smart-value]"));var t=new Date;n.each(function(i){var r=n.eq(i),f=r.attr("data-smart-type"),u=JSON.parse(r.attr("data-smart-value")),e=r.attr("data-smart-text");switch(f){case"Date":case"DateTime":u=new Date(u)}hrt(r,f,u,e,t)})}function hrt(n,t,i,r,u){if(i)switch(t){case"Date":case"DateTime":var f=pb(i,u);return f?(n.text(f),!0):(n.removeAttr("data-smart-type").removeAttr("data-smart-value").removeAttr("data-smart-text").text(r),!1)}}function pb(n,t){var r,f;if(n==null)return null;var o=oe.AbbreviatedDayNames,i=e.Dates,s=t-n,h=s/864e5;if(h>=8||h<-14)return n.getYear()==t.getYear()?String.format("{0:"+oe.MonthDayPattern.replace(/M+/,"MMM")+"}",n)+ch(n):null;var c=new Date(t).setHours(0,0,0,0),l=new Date(n).setHours(0,0,0,0),u=(c-l)/864e5;return u>1?i.Last+" "+o[n.getDay()]+ch(n):u==1?i.Yesterday+ch(n):u==0?crt(n)?i.Today:(r=s/6e4,f=r/60,r%=60,s>0)?f>1?String.format("{0:"+oe.ShortTimePattern+"}",n):f==1?i.OneHour:r>2?String.format(i.MinAgo,Math.floor(r)):r>1?i.AMinAgo:i.JustNow:f<=-1?String.format("{0:"+oe.ShortTimePattern+"}",n):r<=-59?i.InHour:r<-2?String.format(i.InMin,-Math.floor(r)):r<-1?i.InAMin:i.Now:u==-1?i.Tomorrow+ch(n):u>=-7?o[n.getDay()]+ch(n):i.Next+" "+o[n.getDay()]+ch(n)}function crt(n){var t=n.getHours(),i=n.getMinutes(),r=n.getSeconds();return!t&&!i&&!r}function ch(n){if(!crt(n)){var t=n.getSeconds(),i=n.getMinutes(),r=n.getHours();if(r||i||t)return", "+String.format("{0:"+(t?oe.LongTimePattern:oe.ShortTimePattern)+"}",n)}return""}function lh(n,t,i,r,u,e){var b=n._fields,k=n._allFields,v=hh(n),h,o=wv(n),l=o==="_none_",c=0,y,a=!0,w=!u||e;(o!=="_none_"||n.get_showMultipleSelection()||n.inlineEditing())&&s("app-frozen-spacer "+v+"frozen_").appendTo(r);r.attr("data-draggable","data-item");ort(n,t,u,r);$(b).each(function(b){var tt=this,g=k[tt.AliasIndex],ut=g.itemColumnClass||ob(n,g),d,nt,rt,ft,it=tt.Items,et;tt.Hidden||g.GroupBy||tt.OnDemand||tt.Type==="DataView"||(d=s("",'data-draggable="data-item"').appendTo(r).addClass(ut+" app-field app-field-"+g.Name),g.itemColumnClass||(g.itemColumnClass=ut),et=nt=t[u?tt.Index:g.Index],nt==null?(ft=!0,d.addClass("app-null")):rt=ly(tt,t),nt=g.text(nt,g.TextMode!==3),a&&tb(n,r,o!=="_none_"),g.Type.match(f._numericTypeRegex)&&d.addClass("app-field-type-numeric"),u?(h=u?u[b]:null,h&&(nt=t[tt.Index],nt=String.localeFormat(tt.DataFormatString||"{0:n0}",nt),d.text(nt),p("app-static-text").text(h).insertBefore(d.contents()),d.attr("title",g.HeaderText+"\n"+h+" "+nt))):(g.Type==="Boolean"?(d.addClass("app-field-type-bool"),bt("material-icon-"+(!ft&&it&&it.length>=2&&it[it.length-1][1]==nt?"check-box":"check-box-outline-blank"),d)):fit(g,nt,d,!0),d.attr("title",g.HeaderText+":\n"+(g.Type==="Boolean"?nt:on(d))),rt&&s().text(d.text()).attr("data-href",rt).appendTo(d.empty())),fl(d,g,et,nt),a&&i!=null&&s("app-item-number").insertBefore(d.contents()).text(i+"."),u&&!e&&(y=s("app-field-separator").appendTo(r)),o!=="_none_"?(d.addClass("app-frozen"),g.Name===o||o==="_first_"?(l=!0,o="_none_"):u&&y.addClass("app-frozen")):l&&(d.addClass(v),l=!1),g.TextMode===2&&d.addClass("app-field-data app-field-data-rtf"),a=!1,w&&(c===1&&s("app-cell-separator").insertBefore(d),c>0&&s("app-cell-separator").insertAfter(d)),c++)});w&&c===1&&s("app-cell-separator").appendTo(r)}function ah(n){var t=f._htmlConverter;return t||(t=f._htmlConverter=dr()),t.html(n.replace(/></g,"> <")).text()}function fe(n,t,i,r,u,e,o,h){var g=n._allFields,ot=e.is("a"),nt=cr("h3").appendTo(e),ut=g[i.heading],l,lt=[],ft,at,y,w,b,k;if(ot&&ort(n,t,null,e),e.attr("data-draggable","data-item"),i.thumb!=null&&(l=t[i.thumb],l&&l.toString().match(/^null/)?u.addClass("ui-li-has-thumb"):(ft=g[i.thumb],at=cr("img","ui-li-thumb app-field").appendTo(e).addClass("app-field-"+ft.Name),f.odp.blob("init",{image:at,field:ft,key:l,crop:ft.OnDemandStyle!==2}))),l=t[i.heading],l=ut.text(l),ot&&e.attr("title",l),ut.HtmlEncode?nt.text(l):nt.html(l),nt.addClass("app-field app-field-"+ut.Name).attr("title",ut.HeaderText+":\n"+nt.text()),r&&s("app-item-number").insertBefore(nt.contents()).text(r+". "),nt.contents().wrap(hf("app-field-data")),i.desc.length){var tt=dr("app-para").appendTo(e),it=tt,a,vt=1,v;$(i.desc).each(function(n){var y=this,f=g[y],nt=i.descLabels[n],rt=i.descPara[n],ut=i.descColumn[n],p,c,d=f.HeaderText,h,w,b,k;rt&&(it.is(".app-para")||(tt=dr("app-para"),a?tt.appendTo(e):tt.insertAfter(it),it=tt,vt++),a=null);ut&&(a||u.addClass("app-has-column"),a=s("app-column").addClass(a?"":"app-column-first"),p=100/i.descColumnCount+"%",a.css({minWidth:p,maxWidth:p}),lt.push(a));l=t[y];w=l==null;h=s("app-item-desc").addClass("app-field app-field-"+f.Name);l=f.text(l);o?(v=s("app-field-data").appendTo(h),f.TextMode===2&&v.addClass("app-field-data-rtf"),fit(f,l,v)):(v=s("app-field-data").appendTo(h),f.TextMode===2?v.text(ah(l)):f.HtmlEncode||f.TextMode===3?v.text(l):v.html(l));o&&y===i.heading&&(h.addClass("app-item-heading"),r&&s("app-item-number").insertBefore(v.contents()).text(r+". "));c=h.contents();h.attr("title",f.HeaderText+":\n"+on(h));w||(i.descOriginal[n]!=null&&(f=g[i.descOriginal[n]]),b=ly(f,t),b&&(c=c.wrap(hf()).attr("data-href",b)));nt!=null&&((pi.ui.list.labels.display==="DisplayedAbove"||o)&&s("app-field-label-before").insertBefore(c.first()).text(d),pi.ui.list.labels.display==="DisplayedBelow"&&s("app-field-label-after").insertAfter(c.last()).text(d));k=c;w&&k.addClass("app-null");fl(k,f,t[y],l);a?h.appendTo(a):h.insertAfter(it);it=h});vt>1&&u.addClass("app-para-multi");lt.forEach(function(n){$(n).appendTo(e)})}if(ot){var st=n.extension(),bt=st._commandRow,ht,yt=n.get_actionGroups("ActionColumn",!0),kt=0,pt=co();if(yt.length&&h!==!0){ht=s("app-action-column").appendTo(e);var rt=d(e,"padding-left"),ct=yt[0],wt=ct.groupText,p=ct.groupTextMaxWidth,et;i.thumb!=null&&(l=t[i.thumb],l&&!l.toString().match(/^null/)&&(rt+=70));i.thumb!=null&&(l=t[i.thumb],l&&!l.toString().match(/^null/)&&(rt+=70));wt&&!p&&(p=0,et=s("app-action-column",hf("app-action-column-button")).appendTo(c).find("span"),$(wt).each(function(){et.text(this);p=Math.max(p,et.outerWidth())}),et.parent().remove(),ct.groupTextMaxWidth=p);ht.css({left:rt,maxWidth:p});rt+=p+pt;e.css("padding-left",rt/pt+"em");st._commandRow=t;$(n.actionGroups("ActionColumn")).each(function(){$(this.Actions).each(function(){var n=this;kt++;s("app-action-column-button").appendTo(ht).text(n.HeaderText).attr({title:n.Description,"data-action-scope":"ActionColumn","data-action-path":n.Path})})});st._commandRow=bt}i.aside!=null&&(u.addClass("app-li-has-aside"),y=dr("ui-li-aside").appendTo(e),w=g[i.aside],l=t[i.aside],l=w.text(l),w.HtmlEncode?y.text(l):y.html(l),y.addClass("app-field app-field-"+w.Name).attr("title",w.HeaderText+":\n"+y.text()),fl(y,w,t[i.aside],l),i.asideLabel&&s("app-field-label").insertBefore(y.contents()).text(w.HeaderText));i.count!=null&&(y==null||i.desc.length)&&(b=s("ui-li-count").appendTo(e),k=g[i.count],l=t[i.count],l=k.text(l),k.HtmlEncode?b.text(l):b.html(l),b.addClass("app-field app-field-"+k.Name).attr("title",k.HeaderText+":\n"+b.text()),fl(b,k,t[i.count],l),i.countLabel&&s("app-field-label").insertBefore(b.contents()).text(k.HeaderText));tb(n,e)}}function ay(n,t,i,r,u){if(n.inlineEditing()&&ht.supports(n,"New")){var v=n.extension(),y=v.viewStyle(),c=y==="Grid",o,p,l,a,f,h;r&&c&&(o=v.instruction(),(o||c)&&!t.find(".app-list-instruction").length&&(l=ct("app-list-instruction",'data-role="list-divider"').appendTo(t),o&&s("app-view-instruction").appendTo(l).html(o),c&&(p=cy(n,l),o||p.addClass("app-grid-header-no-description")),l.toggleClass("app-no-records",n._totalRowCount<1)));a=new Array(n._allFields.length);f=ct("dv-item dv-item-new",'data-icon="false"');h=vt("ui-btn").appendTo(f).data("data-context",{row:a,pageIndex:-1});c?lh(n,a,null,h):fe(n,a,i,null,f,h,y==="List");h.find(".app-row-status").addClass("app-row-status-new").attr("title",e.LookupNewAction);h.find(".app-btn-more").css("visibility","hidden");u?f.insertAfter(u):f.appendTo(t);f.next().is(".dv-item")||(t.find(".ui-last-child").removeClass("ui-last-child"),f.addClass("ui-last-child"))}}function cst(n,t,i){var r=n._headerImageField,e="t",u,f,o;r&&(f=i[r.Index],o=r.tagged("header-image-original"),typeof f!="string"||f.match(/^null\|/)||(r.tagged("header-image-original")&&(e=le(d(t,"width"))),u=tt(n),u.dataImage={field:r,key:r.format(i[r.Index]),format:e,crop:!1},u.dataImageOriginal=o))}function lrt(n,t,i){for(var e=n._tag||"",u=[],f,r=ua.exec(e);r;)u.push(r),r=ua.exec(e);r=u[0];!r&&(n._lookupInfo||n._useCase==="seeAll")&&(r=["","material-icon-playlist-add-check"]);r&&(i.find(".app-icon").remove(),bt(r[1],i.addClass("app-has-icon")),f=t.find(".app-page-modal-title"),f.length&&bt(r[1],f.addClass("app-has-icon")),t.addClass("app-has-icon"),u.length>1&&(r=u[1]),bt(r[1],i).addClass("app-icon-background"))}function lu(t,i){function g(){var u,n,e,t;i.length>1&&(i=i.first());i.show().next().show();u=r.find(".app-wrapper");n=r.find(".app-page-header-fixed");n.is(".app-page-header")||(n=p("app-page-header app-page-header-fixed").insertBefore(u));n.html(i.html()).css("top",d(u,"top"));n.toggleClass("app-has-action-bar",i.is(".app-has-action-bar"));n.toggleClass("app-has-icon",i.is(".app-has-icon"));e=c&&c.dataImage;e&&(n.addClass("app-has-image"),i.addClass("app-has-image"),t=n.prev(),t.is(".app-page-header-image")||(t=p("app-page-header-image").insertBefore(n)),c.dataImageOriginal&&t.addClass("app-page-header-image-original"),f.odp.blob("init",e).done(function(n){f.odp.blob("url",n.src).done(function(n){t.css("background-image",'url("'+n+'")')})}))}function nt(){i.hide().next().hide()}var h,r,a,w,v,u,e="",y,o,b,ut,k,ft;if(i)r=i.first().closest(".ui-page");else{if(r=l(),!r)return;i=r.find(".app-page-header")}var it=r.is(".app-page-modal"),rt=r.attr("id"),c=tt(rt);if(w=i.find("h1"),v=i.find("h2"),a=r.attr("data-page-header")!=="false",typeof t=="boolean")t&&a?g():nt();else return h=i.data("data-text"),t?(h&&typeof h!="string"&&typeof t=="string"&&(h[1]=t,t=h),i.data("data-text",t)):t=h,o=or.currentNode,ut=o&&o.showPageHeaderTitle,rt==="Main"&&o&&(o.showPageHeaderDescription&&(t=[t,o.description]),o.icon&&o.showPageHeaderIcon&&!i[0].className.match(/\bapp\-has\-icon\b/)&&(bt(o.icon,i.addClass("app-has-icon")),bt(o.icon,i).addClass("app-icon-background"))),t&&(typeof t=="string"?u=t.trim():(u=(t[0]||"").trim(),e=t[1].trim())),i.attr("data-locked")!=="true"&&(w.length&&(w[0].innerText=u,u&&(y=u)),v.length&&(v[0].innerText=e,e&&(y+=" / "+e),e||(v[0].innerHTML="")),u&&(it?(b=r.find(".app-page-modal-title"),y=b.find(".app-text").text(u),e&&!b.next().is(".app-bar-actions")&&s().appendTo(y).text(e)):(k=r.find(".app-page-header-placeholder"),k.length&&(ft=k.find(".app-text").text(u),e&&s().appendTo(ft).text(e)))),c&&u&&(c.headerText=e?[u,e]:u,c.text=u)),(t!==n.title()||si()==="Main"||ut||it)&&a||r.is(".app-page-header-show")?g():(nt(),a&&r.attr("data-page-header","false")),t}function lst(n,t){var i=Math.ceil(r.width*.9);!t&&kv()?n.css({maxWidth:r.width-1,minWidth:r.width-1}):(i>800&&(i=800),n.css({maxWidth:i}))}function yo(n){var t=o("ui.transitions.style");if(!arguments.length)return t;n?o("ui.transitions.style",o("ui.transitions.currentStyle")):(o("ui.transitions.currentStyle",t),o("ui.transitions.style","none"))}function ast(t){var r=t._hasSearchAction,u=[],f,e=t._totalRowCount,i;if(r&&(t._totalRowCount=0,f=n.contextScope(),n.contextScope(t),n.navContext(u),n.contextScope(f),t._totalRowCount=e,u.every(function(n){return n.path===r&&(i=n),i==null}),i))return t.get_searchOnStart()&&(t.set_searchOnStart(!1),t._requiresContextRefresh=!0),yut(i.context),!0}function wb(n,t,i){if(navigator.msSaveBlob)return navigator.msSaveBlob(new Blob(["",t],{type:"data:attachment/text"}),n);var r=$('<a style="display: none;"/>').appendTo(c),u=URL.createObjectURL(new Blob(["",t],{type:i||"text/csv"}));r.attr({download:n,href:u})[0].click();r.remove();URL.revokeObjectURL(u)}function vh(n,t){n.find(".app-listview a").removeData();var i=n.find('ul[data-role="listview"]').off().removeData();t||i.remove()}function el(t){var i=k(t);i._requiresContextRefresh=!0;n.notify({dataView:i,text:e.Refreshed});i.sync()}function vst(t,i){var f,r,u,o,s;t=k(t);u=t.multiSelect();r=t.extension().viewStyle();i.push({});r!=="Grid"||t.tagged("grid-fit-none")||(f=t.viewProp("grid-is-fitted")!==!1,i.push({text:e.FitToWidth,icon:f?"check":!1,callback:function(){var i=t.gridSettings();i&&(i.width={},t.gridSettings(i));yh(t,!f,!0);wf(t);nf();n.scrollGrid(t,0);tf();uu()}}));r.match(/Grid|List|Cards/)&&!t.tagged("multi-select-none")&&(!t._lookupInfo||t._lookupInfo.multiSelect)&&(u&&i.push({}),i.push({text:e.MultiSelection,icon:u?"check":!1,context:t._id,callback:yst}));u&&i.push({text:ya.SelectAll,icon:!1,context:t._id,callback:pst},{});r.match(/Grid|List|Cards/)&&!t.tagged("inline-editing-option-none")&&lt("ui.inlineEditing.enabled")&&i.push({text:e.InlineEditing,icon:t.inlineEditing()?"check":!1,context:t._id,callback:wst});o=n.pageInfo(t);o.home&&art()&&!t.tagged("reading-pane-none")&&(s=li(o.page),i.push({text:e.ReadingPane,icon:s?"check":!1,context:t._id,callback:vrt}),s,i.push({}));i.push({text:uo.Refresh,icon:"refresh",context:t._id,callback:el})}function art(){return pt.enabled&&(r.portrait?r.height-r.toolbarHeight>pt.minTop+pt.minBottom:r.width-w.left.width>pt.minLeft+pt.minRight)}function po(){fft();bs();pu(!0)}function vrt(t){if(typeof t=="string")setTimeout(vrt,100,k(t));else{t=k(t);var r=n.pageInfo(t),u=r.page,i=!li(u);n.readingPane(t,i);$(".app-reading-pane-detail").removeClass("app-reading-pane-detail");n.modalDataView();i||$(".app-reading-pane-bkg,.app-reading-pane-splitter").hide();t.pageProp("readingPane",i);po();n.refreshMenuStrip()}}function yst(n){n=k(n);n.multiSelect(!n.multiSelect());n.sync();ht.detach()}function pst(n){n=k(n);n._selectedKeyList.length<n._totalRowCount&&(n._selectedKeyList=[]);hy(k(n),null,!0)}function wst(n){var t=k(n);setTimeout(function(){t!==dt()||t.commandRow()||(ik(),af(g(),0));$(document).trigger($.Event("inlineeditingmode.dataview.app",{dataView:t,inlineEditing:!t.inlineEditing()}));tf()},50)}function bb(n){n.find(".app-echo-inner .app-selected").removeClass("app-selected")}function wo(n,t){var i=ni(n),u,r;i.length&&(u=i.attr("data-for"),r=$("#"+u+"_ph").attr("data-field"),r&&bi({fieldName:r,container:g(i),scrollIntoView:t}))}function yrt(n){function s(n){var f=parseInt(o.attr("data-start-index")),e=parseInt(o.attr("data-end-index")),t=n==="next"?e+1:f-1,i=0;return t<0&&(t=0),i=Math.floor(t/k(u).extension().pageSize()),{action:n,rowIndex:t,pageIndex:i,ensurePageIndex:Math.max(n=="next"?i+1:i-1,0),pageY:r.offset().top}}function h(n){r.find(".app-btn-"+n.dir).trigger("vclick")}function c(){i.removeClass("ui-btn-active");i.is(".app-btn-prev")?rf(u,s("prev")):i.is(".app-btn-next")&&rf(u,s("next"));n.feedback!==!1&&pf()}var i=$(n.target),r=i.closest(".dv-action-see-all"),l=r.closest(".app-echo"),t=r.find(".app-btn-next"),o=r.find(".app-info"),u=l.attr("data-for"),f=su(n.pageX);if(!i.is(".app-btn-next,.app-btn-prev"))if(t.length&&f>=t.offset().left&&f<t.offset().left+t.outerWidth()+4)i=t;else if(t=r.find(".app-btn-prev"),t.length&&f>=t.offset().left&&f<t.offset().left+t.outerWidth())i=t;else if(i.closest(".app-info").length)yr({anchor:o,yOffset:"bottom",items:[{text:e.Prev,disabled:r.find(".app-btn-prev").is(".app-btn-disabled"),icon:"material-icon-navigate-before",context:{id:u,dir:"prev"},callback:h},{text:e.Next,disabled:r.find(".app-btn-next").is(".app-btn-disabled"),icon:"material-icon-navigate-next",context:{id:u,dir:"next"},callback:h}]});else return;i.is(".app-btn-disabled")||(r.removeClass("ui-btn-active"),n.feedback===!1?c():kt(i,c))}function kb(n,t){var i=p("app-echo").appendTo(t).attr({id:n+"_echo","data-for":n}),o,s,u=k(n),r,c=tt(n),f;return c.echoChanged=!0,r=$('<div class="app-echo-toolbar">'+ce("h3")+ce("a","ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more")+uv("app-echo-controls")+hf("app-echo-see-all")+"<\/div>").appendTo(i),o=r.find("h3"),u.get_showViewSelector()||o.addClass("app-hidden"),r.find(".ui-icon-dots").attr("title",fr).css("visibility","hidden"),f=u.get_master(),bt("material-icon-chevron-right",r.find(".app-echo-see-all").toggleClass("app-hidden",(f&&f.inserting())===!0).css("visibility","hidden").html(e.SeeAll)),u.get_showActionBar()||r.hide(),p("app-echo-instruction").appendTo(i).hide(),s=p("app-echo-inner").appendTo(i),p("app-echo-footer").appendTo(i),p("app-echo-empty").appendTo(s).text(of),r.find("h3").text(tt(n).text),h||i.find(".app-echo-inner").attr("tabindex",0),u._hidden&&(i.hide(),u._hiddenEcho=!0),i}function pf(t,i,r){var e,f,u,o=0;t?l(".app-echo-toolbar").each(function(){e=$(this).parent();f=e.attr("data-for");u=tt(f);u.echoId&&!u.dataView._busy()&&rf(u.echoId)}):vu||et||os||rt&&rt.data("busy")?(clearTimeout(tg),tg=setTimeout(pf,50,t,i)):(n.callWhenVisible(r||".app-echo",function(t){function r(){if(f=t.attr("data-for"),u=tt(f),u){var i=u.dataView;!i||i._busy()||i.get_isForm()||ht._pending&&ht._dataViewId==i._id||(u.echoInitialized?u.echoChanged&&rf(u.echoId):(u.echoId=t.attr("id"),n.pageInit(u.id,!1)&&u.echoInitialized&&rf(u.echoId)))}}var e=i==null?o:i;e==0?r():setTimeout(r,e);o+=50}),l(".app-echo-controls.app-stale").each(function(){var n=ni($(this).removeClass("app-stale")),t=n.attr("id"),i=tt(t.substring(0,t.length-5));hl(i.dataView,n)}))}function vy(n,t,i){var u=t._dataViewFieldName,e=u?k(t._dataViewFieldOwnerId).findField(u).HeaderText:null,r=n.find("h3").empty().text(e||t.get_view().Label||i.text),f=t._totalRowCount;return n.length&&f>0&&($("<span> (<\/span>").appendTo(r),s("app-echo-count").appendTo(r).text(String.format("{0:N0}",f)),$("<span>)<\/span>").appendTo(r),h||r.attr("title",r.text())),r}function ol(n){var i=hh(n),t=n.session(i);return t||(t=nl(),t.text("."+i+"frozen_{display:none!important}"),n.session(i,t)),t}function yh(n,t,i){if(arguments.length>=2)n.session("grid-is-fitted",t),i&&n.viewProp("grid-is-fitted",t?null:!1);else{var u=n.session("grid-is-fitted");return u!=null&&n.session("window-width")!==r.width&&(u=null),u==null&&(u=n.viewProp("grid-is-fitted"),u==null&&(u=!n.tagged("grid-fit-none")),n.session("grid-is-fitted",u)),u}}function tf(n){var t;n||(n=l(),t=!0);n.find(".app-grid-header").each(function(){var r=$(this),o=r.height(),e=r.find("[data-field-name]").first(),n,f,i,u;o&&e.length&&(n=k(r.attr("data-for")),f=n.inlineEditing(),f&&r.addClass("app-grid-header-bold"),i=n.session("grid-header-style"),i||(i=nl(),n.session("grid-header-style",i)),(t||n.session("reset-grid-header"))&&(i.text("").data("text",""),n.session("reset-grid-header",null)),u=".app-grid-header-cv-"+n._id+"-"+n._viewId+" > span {height:"+(r.height()-parseFloat(e.css("padding-top"))*2)+"px}",i.data("text")!=u&&i.data("text",u).text(u),f&&r.removeClass("app-grid-header-bold"))});hr.trigger("gridresized.app")}function ph(n,t,i,r){function f(){bst(n,t)}function e(){ut.scrollingAnimationFrame=null;i&&(t=-1*n.session("scroll-left"));var c=o+"-last-scroll-left",h=n.session(c)||0,l=n.session("scroll-left-margin")||0,a=Math.abs(Math.abs(t)-Math.abs(h));i&&h!=null&&a==0||(r&&t<(h||0)&&f(),n.session(c,t),u.html("."+o+"{margin-left:"+(t?t+l+"px !important":"inherit")+(r?";transition:margin-left "+s+"ms ease-out":"")+"}"),r?setTimeout(function(){f();ph(n,t)},s+64):f(),ye(n));i&&(ut.scrollingAnimationFrame=requestAnimationFrame(e))}var u=n.session("scroll-style"),o=hh(n),h=+new Date,s=384;if(u||(u=nl(),n.session("scroll-style",u)),arguments.length>=2)if(i){if(ut.scrollingAnimationFrame)return;ut.scrollingAnimationFrame=requestAnimationFrame(e)}else e();return u}function bst(n,t){var i=ol(n),r=t?"inline-block":"none",u=n.session("grid-frozen-width")||0;if(i&&(i.data("display")!=r||i.data("width")!=u))return i.html("."+hh(n)+"frozen_{display:"+r+"!important;width:"+u+"px}"),i.data("display",r).data("width",u),!0}function kst(n){n.session("scroll-left",0);ye(n);var t=n.session("scroll-style");t&&(t.remove(),n.session("scroll-style",null))}function prt(n,t,i){var r=n.extension(),u=r.aggregateLabels(),f=p("app-bar-aggregate-list").appendTo(t);$(n._fields).each(function(t){var o=this,c=n._allFields[o.AliasIndex],h=u[t],r,e,l;h&&(r=i[o.Index],r=String.localeFormat(o.DataFormatString||"{0:n0}",r),e=vt("ui-btn ui-inline app-calculated app-btn-static").appendTo(f),s("app-calculated-label").text(c.HeaderText).appendTo(e),l=s("app-calculated-value").text(r).appendTo(e),p("app-static-text").text(h).insertBefore(l.contents()),e.attr({title:c.HeaderText+"\n"+h+" "+r,"data-tooltip-location":"above"}))})}function wrt(t,i){function r(){var t=[];n.navContext(t);$(t).each(function(){var n=this;if(n.command==u&&(!f||f==n.argument))return n.callback(n.context),!1})}if(!t._checkedStartCommand){t._checkedStartCommand=!0;var u=t.get_lastCommandName(),f=t.get_lastCommandArgument();u&&(i?r():tr(r))}}function brt(n){var i=ni(n),r,t;i.find(".app-listview").css("visibility","hidden");r=i.find(".app-echo-toolbar");r.find(".app-echo-controls .ui-btn,h3 span").remove();r.find(".app-echo-see-all").css("visibility","hidden");t=k(i.attr("data-for")).extension();t&&(t._commandRow=null,t.currentPageIndex(null))}function sl(n){var t=n._dataViewFieldName,i=n._dataViewFieldOwnerId;if(i&&t)return k(i).findField(t)}function krt(n,t){var i=n._detailDataViews;i&&i.forEach(function(n){var r=k(n),i=sl(r);i&&(t(i),krt(i,t))})}function db(n){var t=sl(n);t&&t._detailDataViews&&krt(t,brt)}function rf(t,i){function hu(){si&&(prt(u,ci.show().empty(),si),l(".app-echo").filter(lr).length===1&&b.prev().is(".app-page-header,.app-tabs")&&(ut-=ci.outerHeight()))}function cu(){$(c).each(function(n){var t=this;if(u.rowIsSelected(t))return u.extension().headerText(t),lt=n,y.commandRow()?y._commandRow=t.slice(0):(y.tap(t,"none"),y.currentPageIndex(ui)),!1});bi=c.length}function yr(){var n,r,f=u._totalRowCount,o,e,t;u._autoNewRow?(k=Math.floor(f/nt)*nt,k===f&&(k-=nt),c.length<nt&&ui&&(et=y.visibleDataRows(ui-1),et&&(c=et.concat(c))),c=c.slice(c.length-(f-k))):i?(lt=null,i.action==="prev"?(k=i.rowIndex-a+1,k<0&&(k=0),r=i.rowIndex%ot,n=r-nt+1,n>0?c=c.slice(n,r+1):(c=c.slice(0,r+1),i.pageIndex&&(et=y.visibleDataRows(i.pageIndex-1),et&&(c=et.slice(et.length+n).concat(c))))):(k=i.rowIndex,n=i.rowIndex%ot,c=c.slice(n,n+a+1),c.length<a&&(et=y.visibleDataRows(i.pageIndex+1),et&&(c=c.concat(et)))),cu()):lt!=null&&nt<f&&(o=ot*ui+lt,e=a||nt,k=Math.floor(o/e)*e,t=ui*ot-k,t>0?(et=y.visibleDataRows(ui-1),c=et.slice(ot-t).concat(c),lt+=t):t<0&&(c=c.slice(-t),lt+=t),c.length<e&&(et=y.visibleDataRows(ui+1),et&&(c=c.concat(et))),bi=ot)}function pr(n,t,i){n.empty();var r=s("app-btn-prev").appendTo(n).text(e.Prev).attr("title",uo.Previous);return t||r.addClass("app-btn-disabled"),r=s("app-btn-next").appendTo(n).text(e.Next).attr("title",uo.Next),s("app-btn-separator").insertBefore(r),i>=ti-1&&r.addClass("app-btn-disabled"),s("app-info").appendTo(n).attr({"data-start-index":t,"data-end-index":i}).html(String.format(uo.ShowingItems,t+1,Math.min(i+1,ti),ti)+'<i class="app-icon material-icon">arrow_drop_down<\/i>'),n}function lu(){at=p("dv-action-see-all").appendTo(w).html("text")}var b,di,wr,br,kr,dr,au,tr,tu,fi,yu,vi,yi,ur,iu,ru;if(!os&&(b=ni(t),b.length)){di=b.is(".app-echo-embedded");b.removeClass("app-density-condensed app-density-compact");var wt=g(b),wu=wt.scrollTop(),bu=b.outerHeight(),w=b.find(".app-echo-inner").show(),ci=w.next().hide(),ku=b.attr("data-for"),ri=tt(ku),u=ri.dataView,pi=u._pagerSize,fr=u.inlineEditing(),er=ww(u),ti=u._totalRowCount,y=u.extension(),ui=i?i.pageIndex:y.pageIndex()||0,ot=y.pageSize(),k=0,bt,c=y.visibleDataRows(ui),et,o,v,rt,gi,st,wi,ei=u.get_showRowNumber()===!0,or=$(b).find(".app-echo-toolbar"),du=or.find(".app-echo-controls"),sr=or.find(".app-echo-see-all"),eu,ou=w.prev(),hr=y.instruction(!1),kt=y.viewStyle(),li=y.itemMap(kt==="List"),gu=r.height,ut=wt.height()*.55,lt,bi,a,nt,it,at,ai,cr=u.get_selectedKey().length>0,ki,ar,si=y.aggregates(),su,vr;if(ht.detach(u._id),wrt(u,!0),u._checkedAutoSelect||(u._checkedAutoSelect=!0,y._autoSelect&&(ki=y._autoSelect,ki&&!yt()&&(ri.echoChanged=!0,n.contextScope(u),y.tap(ki.row,ki.action),u._selectedKeyList=[u._createRowKey(ki.row)],n.contextScope(null),cr=!0,pf(!1,0)),y._autoSelect=null)),!b.is(":visible")){ri.echoChanged=!0;return}if(ri.echoChanged=!1,!c||i&&ot*i.ensurePageIndex<ti&&!y.visibleDataRows(i.ensurePageIndex)){u.goToPage(i&&i.pageIndex||0,!0);y.echoCallback=function(){rf(t,i)};return}if(eu=vy(or,u,ri),ri.echoInitialized||(ri.echoInitialized=!0,ri.refreshed=!0),di||b.css("padding-bottom",""),n.stub("put",wt),hr&&(c.length||hr.match(/"app-filter"/))?ou.html(hr).show():ou.hide(),vh(w),su=w.find('div[data-role="presenter"]').detach(),w.empty(),su.appendTo(w),n.presenter("hide",{container:w}),c.length||u.get_searchOnStart()&&kt==="Grid"||fr&&kt==="Grid"){if(u._filterSource||wt.find(".app-echo").filter(lr).length!==1?h||wt.css("overflow",""):(ut=gu-w.offset().top,h||(ut-=d(b,"padding-top")+d(b,"padding-bottom"),kt&&kt.match(/List|Grid|Cards/)?(wt.css("overflow",""),overflowIsHidden=!0):wt.css("overflow",""))),yy(u,w),n.presenter("supports",kt)&&(wr=[],br=!1,n.presenter("enumerate",{id:u._id,list:wr}),$(wr).each(function(){if(this.name===kt)return br=!0,!1}),w.height(""),br&&n.presenter("show",{name:kt,id:u._id,container:w,maxHeight:Math.ceil(ut)})?vr=!0:kt="Grid"),!vr)if(i||cu(),kr=iw(),ut+=kr.is(":visible")?-kr.outerHeight():0,kt==="Grid"){w.height("");vh(w);o=nr("app-listview app-grid",'data-role="listview"').addClass(ey(u)).appendTo(w);v=ct("app-list-instruction",'data-role="list-divider"').appendTo(o);cl(u,o);cy(u,v);v=ct("dv-item",'data-icon="false"').appendTo(o);c.length&&lh(u,c[0],null,$("<a/>").appendTo(v));o.listview().listview("refresh");gi=v.outerHeight();nf(o);tf(o);ut-=v.prev().outerHeight()+1;nt=Math.ceil(ut/(gi+1));si&&(nt-=2);v.remove();nt<4&&(nt=4);nt>ot&&(nt=ot);a=pi||u.session("gridPagerSize");a&&(nt=a);dr=lt;a||dr==null||(lt=0);yr();var pt=[],dt=[],hi=0,ii,nu;$(c).each(function(n){var i=this,f=k+n+1,t=ct("dv-item",'data-icon="false"').appendTo(o),r=vt("ui-btn").appendTo(t).data("data-context",{row:this.slice(0),pageIndex:0});return(lh(u,i,ei?f:null,r),r.data("rowIndex",f-1),n===lt&&(ai=i,r.addClass("app-selected")),ih(u,i,t,er),bt=k+n,a&&n===a-1)?!1:(!lt||n<lt?pt.push(t):dt.push(t),nt<bi&&nt-1===n?!1:void 0)});si&&(v=ct("dv-item",'data-icon="false"').appendTo(o),rt=vt("app-divider app-calculated").appendTo(v),lh(u,si,null,rt,y.aggregateLabels(),!0));ol(u);au=$('<span class="app-hscrollbar2" data-view="'+u._id+'"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"/><\/span>').toggleClass("app-scrollbar-wide",he).appendTo(w).find(".app-hscrollbar-handle");(nt<bi||bi<ti)&&lu();o.listview().listview("refresh");at&&(ut-=at.outerHeight());o.find(".dv-item").each(function(){hi+=$(this).outerHeight()});function vu(){ii&&(hi-=ii.outerHeight(),ii.find(".ui-btn").removeData(),ii.remove())}if(hi>ut&&!a){if(at||(lu(),ut-=at.outerHeight()),dt.length)while(pt.length+dt.length+1>3&&hi>ut)ii=null,nu==="before"?(nu="after",pt.length>1&&pt.length>=dt.length&&(ii=pt[0],pt.splice(0,1),k++)):(nu="before",dt.length>1&&dt.length>pt.length&&(ii=dt[dt.length-1],dt.splice(dt.length-1,1),bt--)),vu();else while(pt.length>3&&hi>ut)i&&i.action=="prev"?(ii=pt[0],pt.splice(0,1),k++):(ii=pt[pt.length-1],pt.splice(pt.length-1,1),bt--),vu();o.listview("refresh")}if(!a&&(a=o.find(".dv-item").length,si&&a--,hi<ut&&(a=Math.floor(ut/(hi/a)),a>ot&&(a=ot)),a<3&&(a=3),u.session("gridPagerSize",a),dr!=null)){rf(t,i);return}fr&&(tr=o.find(".dv-item .ui-btn:not(.app-calculated)").last(),tr.length?tr.data("rowIndex")===u._totalRowCount-1&&ay(u,o,null,!1,tr.parent()):ay(u,o));at&&(ti<=a?at.remove():pr(at,k,bt));ye(u,au)}else if(kt==="List"){for(nt=ot,a=pi||u.session("listPagerSize"),a&&(nt=a),yr(),w.height(""),vh(w),hu(),o=nr("app-listview app-onecolumnview",'data-role="listview"').addClass(ey(u)).appendTo(w).listview(),tu=0,fi=0,nf(o),cl(u,o),at=p("dv-action-see-all").text("text").insertAfter(o),ut-=at.outerHeight(),at.remove(),vi=0,bt=k;fi>=0&&fi<c.length;){var rr=c[fi],uf=k+fi+1,v=ct("dv-item",'data-icon="false"'),rt=vt("ui-btn").appendTo(v).data("data-context",{row:rr.slice(0),pageIndex:0});if(v.appendTo(o),fe(u,rr,li,ei?uf:null,v,rt,!0),fi==lt&&(ai=rr,rt.addClass("app-selected")),a||o.listview("refresh"),vi++,ih(u,rr,v,er),tu+=v.outerHeight(),a){if(vi==a||fi==c.length-1)break}else if(tu>=ut&&vi>2){vi>3&&(yu=!0,bt--);break}bt++;fi++}if(vi<ti&&(yu&&(rt.removeData(),v.remove()),o.listview("refresh"),pr(p("dv-action-see-all").insertAfter(o),k,bt)),a)o.listview("refresh");else if(a=o.find(".dv-item").length,rt.is(".dv-action-see-all")&&a--,a<3&&(a=3),u.session("listPagerSize",a),lt!=null&&!ai){rf(t,i);return}}else{for(o=nr("app-listview app-cardcolumn",'data-role="listview"').appendTo(w),cl(u,o),yy(u,o),hu(),yi=u.session("cardsPagerSize"),yi?(o.listview(),a=yi.pagerSize,it=yi.itemsPerColumn,wi=yi.cardWidth,st=yi.columns):(at=ct("dv-item",'data-icon="false"',uv("ui-btn dv-action-see-all")).appendTo(o),ut-=at.outerHeight(),at.remove(),v=ct("dv-item",'data-icon="false"').appendTo(o),rt=vt("ui-btn").appendTo(v),fe(u,c[0],li,ei?1:null,v,rt),c.length>1&&(v=ct("dv-item",'data-icon="false"').appendTo(o),rt=vt("ui-btn").appendTo(v),fe(u,c[1],li,ei?1:null,v,rt)),c.length>2&&(v=ct("dv-item",'data-icon="false"').appendTo(o),rt=vt("ui-btn").appendTo(v),fe(u,c[2],li,ei?1:null,v,rt)),o.listview(),gi=v.outerHeight(!0),it=Math.floor(ut/gi),it<1&&(it=1),st=Math.floor(w.innerWidth()/v.outerWidth(!0)),st===1&&gt(wt).width>=oi("md")&&st++,it<2&&(it=2),pi&&it*st<pi&&(it=Math.ceil(pi/st)),a=it*st,a>ot&&(a=Math.floor(ot/it)*it),wi=st===1?Math.floor(v.outerWidth(!0)):Math.floor(w.innerWidth()/st-d(o,"margin-right")+d(o,"margin-right")/st)-2*st+1,u.session("cardsPagerSize",{pagerSize:a,itemsPerColumn:it,columns:st,cardWidth:wi})),nt=a;c.length<=(it-1)*st&&it>=1;)it--;if(yr(),vh(w),bt=k,$(c).each(function(n){o&&n%it!=0||(o=nr("app-listview app-cardcolumn",'data-role="listview"').addClass(ey(u)).appendTo(w),o.css({"min-width":wi,"max-width":wi}),yy(u,o),cl(u,o),ur=0);var t=this,f=k+n+1,i=ct("dv-item",'data-icon="false"').appendTo(o),r=vt("ui-btn").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});if(fe(u,t,li,ei?f:null,i,r),n===lt&&(ai=t,r.addClass("app-selected")),ih(u,t,i,er),ur++,bt===k+a-1)return!1;bt++}),ur<it&&st>1&&(iu=it-ur,iu<it))while(iu-->0)v=ct("dv-item",'data-icon="false"').appendTo(o),rt=vt().appendTo(v),fe(u,c[0],li,ei?1:null,v,rt),rt.css("visibility","hidden").parent().addClass("app-hidden");o=ci.find(".app-echo-container-see-all").hide();ti>a&&(ci.show(),o.length?(o.show(),rt=o.find(".dv-action-see-all")):(o=p("app-echo-container-see-all"),si?o.insertBefore(ci.find(".app-bar-aggregate-list")):o.appendTo(ci),rt=p("dv-action-see-all").appendTo(o)),pr(rt,k,bt));nf(w.find(".app-listview").listview())}}else p("app-echo-empty").appendTo(w.height("")).text(sa);if(di||b.prev().is(".app-echo")||b.next().is(".app-echo")||b.css("padding-bottom",0),vr||(cr?ai||i?u.rowIsSelected(y.commandRow())||u.multiSelect()||(y.clearSelection(),y.tap(ai,"none")):y.clearSelection():y.commandRow()&&y.clearSelection()),sr.css({visibility:ti===0?"hidden":"","margin-top":sr.outerHeight(!0)/-2}),hl(u,b,cr,du,eu,sr),di&&uu(wt),ar=ft(),ar.length&&!gr&&ar.offset().top>b.offset().top?wt.scrollTop(wu+b.outerHeight()-bu):pe(wt,null,!0),ru=b.data("auto-highlight"),b.removeData("auto-highlight"),ru){var ff=$.Event("vclick",{ctrlKey:!0,force:!0}),pu=b.find(".app-listview .dv-item .ui-btn:not(.app-calculated):not(.dv-action-see-all)"),fu=ru==="first"?pu.first():pu.last();fu.is(".app-selected")||(ir(wt),n.lastTouch(!1),fu.trigger(ff),fr?ht.scrollIntoView():ev(fu),n.lastTouch(!0))}n.stub("trim",wt);ht.sync();u._selectedKey.length||db(u);$(document).trigger($.Event("dataviewrefresh.app",{dataView:u}));u.get_searchOnStart()&&f.search("show",u._id)}}function hl(n,t,i,r,u,f){if(i==null&&(i=n.get_selectedKey().length>0),!r){if(t||(t=ni(n)),!t.length)return;r=t.find(".app-echo-toolbar .app-echo-controls");u=r.parent().find("h3");f=r.next()}var e=u.next().css("visibility",""),o=e.offset().left+e.outerWidth(),s=f.offset().left-16;drt(n,r,o,s)}function drt(t,i,r,u,f,e){function v(n){return n.offset().left+n.outerWidth()>d+p-1}var b=[],y=[],k,d,p,s=[],w=[],l,a={},o,h,c;if(r&&u)if(u-r>=28){if(i.find(".ui-btn").data("data-context",null),i.hide().contents().remove(),k=n.contextScope(),n.contextScope(t),t.extension().context(b,["ActionBar"]),n.contextScope(k),$(b).each(function(){var n=this;n.system?n.icon!=="search"||f||y.push(n):n.text&&!n.isStatic&&y.push(n)}),$(y).each(function(){var r=this,n,t=r.icon,u=r.text,f;l=r.group;e&&t===e||(n=vt("ui-btn").appendTo(i).data("data-context",r).attr({title:cv(r),"data-action-path":r.path||l}),t==="dots"||r.transition?n.addClass("app-has-children ui-mini").text(u):(n.addClass("ui-mini ui-btn-icon-left"),t==="search"?n.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):n.text(u),t=ko(t),f=tl(t),f&&bt(t,n),t===!1&&n.removeClass("ui-btn-icon-left"),o=a[l],o||(o=a[l]=[]),o.push(n)))}),p=u-r,i.width(p).show(),d=i.offset().left,i.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&w.push(n);v(n)&&s.push(n)}),s.length)for(w.reverse();s.length;){if(h=s[0],c=v(h),c&&(isGeneric=h.is(".ui-icon-carat-r"),isGeneric?s.push(h):h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h)),!isGeneric&&c&&$(w).each(function(){var n=this;if(s.indexOf(n)===-1&&n.is(".ui-btn-icon-left")&&(n.is(".ui-icon-carat-r")?n.hide():n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h),!c))return!1}),c)){$(s).each(function(){this.hide()});break}s.splice(0,1)}else for(l in a)o=a[l],o.length>1&&($(o).each(function(){$(this).addClass("app-group-item")}),o[0].addClass("app-group-first"),o[o.length-1].addClass("app-group-last"));vt("ui-btn ui-mini ui-btn-icon-left").appendTo(i).css("visibility","hidden").text("i")}else i.hide();else i.addClass("app-stale")}function dst(n,t){var i=p("app-bar-actions ui-header ui-bar-inherit ui-header-fixed").insertBefore(t),u=cr("h3").appendTo(i).text(tt(n).text),r;return vt("ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots app-btn-more").appendTo(i),r=p("app-bar-controls").appendTo(i),i.data({selector:u,controls:r}),i}function gst(){var n=vu||et;return n===!0}function we(n,t){var i;if(vu||et||ut.dragged())return!1;if(gr)if(i=$(n).closest("a"),i.data("scroll-check")===!0)i.data("scroll-check",!1);else{os=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&ai()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f===r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(we(i,t),ur())},10),!1)}return!0}function fi(t,i,r){function u(){var f,i,e;if(et||rt&&rt.data("busy"))fi(t,er,r);else{if(oc=null,di("refresh"),f=l(),i=f.is(".app-page-modal"),!i||ot()){var o=ot()?dt()._parentDataViewId:si(),u=fy(),s=u.data("page-id"),h=n.contextScope();s===o&&sb(u);n.contextScope(i?o:null);u.find(".app-show-request").removeClass("app-show-request").show().trigger("show.sidebar.app");u.find(".app-hide-request").removeClass("app-hide-request").hide().trigger("hide.sidebar.app");n.refreshTitleState();n.refreshContextMenu(u.data("page-id",o));n.contextScope(h);n.refreshMenuStrip();r&&r()}i&&(e=[],n.navContext(e),n.refreshAppButtons(e,{toolbar:!1,actionBar:!0,promo:!0,buttonBars:f.find(".app-bar-buttons")}),r&&r(),i=!0)}}aet||gu()||(i==null&&(i=vet),oc&&(clearTimeout(oc),oc=null),t||(i?oc=setTimeout(u,i):u()))}function grt(n,t){if(arguments.length===1)return f.cache[n];f.cache[n]=t}function nut(n,t){var r={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),o,u,s,h=$(n).prev(".DataViewHeader").text(),e;return i||(s=n.closest("div[data-activator]"),i=s.attr("data-activator"),n=s),i&&(o=n.parent(),u=o.attr("id"),u||(u="aid"+cet++,o.attr("id",u)),r.container=u),i||(i=h),i&&i!="false"?(i=f.eval(i),e=pft.exec(i),e?(r.text=e[4]||e[2],r.type=e[1]):r.text=i):r.resolved=!1,r.description=n.attr("data-activator-description"),r}function gb(n,t){return tk(n,t,"call",dft)}function nk(n,t){return tk(n,t,"email",gft)}function nht(n,t){return tk(n,t,"url",net)}function tk(n,t,i,r){var u=r&&n.Name.match(r);return t?!n.tagged("action-"+i+"-disabled")&&(n.tagged("action-"+i)||u):n.tagged("action-"+i,"field-"+i)||u}function yy(n,t){t.toggleClass("app-thumb-person",!!(n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard")))}function cl(n,t){t.toggleClass("app-listview-multiselect",n.get_showMultipleSelection());t.toggleClass("app-listview-inlineediting",n.inlineEditing());t.toggleClass("app-grid-vert-lines-none",!!n.tagged("grid-lines-vertical-none")||o("ui.grid.lines.vertical")===!1);t.toggleClass("app-grid-horiz-lines-none",!!n.tagged("grid-lines-horizontal-none")||o("ui.grid.lines.horizontal")===!1)}function tut(n,t){n=$(n);ft().length||n.scrollTop(n.scrollTop()+co()*5*(t==="up"?-1:1))}function py(n,t,i){n.data("scrolling",!0).animate({scrollTop:t},"swing",function(){et=!1;i&&i();setTimeout(function(){n.removeData("scrolling")},100)})}function iut(t,i,u){var f,e,o;return u||(u={}),f=$(t),e=u.position||"right",vi(),oo=null,f.length?(o=f.find("ul"),!f.is(".ui-panel-open")&&o.length>1&&(o.first().parent().css({transition:"none",transform:"none"}).removeClass("app-list-container-reverse"),o.slice(1).remove())):(f=p("app-popup-icon-left ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-"+e,'data-position-fixed="true" data-role="panel" data-draggable="panel" data-theme="a" data-display="overlay"'),nr().appendTo(f),f.appendTo(c).panel({animate:ny(),position:e,beforeopen:function(){if(wr()?f.css({top:r.top,height:r.height,minHeight:r.height,right:e=="right"?r.right:"",left:e=="right"?"":r.left}):f.css({top:"",height:"",minHeight:"",right:""}),wt.width){var n=f.find(".ui-panel-inner").css({width:"","overflow-y":"scroll"});n.width(n.width()+wt.width)}f.find(".ui-panel-inner").attr("tabindex",0);yu(!1);ku=!0;sc&&(clearTimeout(sc),sc=null);i&&i()},open:function(){setTimeout(function(){ku=!1;ur();u&&u.afteropen&&u.afteropen();$(".ui-panel-open .ui-panel-inner").focus();yu(!0)})},beforeclose:function(){yu(!1);ku=!0;sb(f)},close:function(){setTimeout(function(){f.css("visibility","");yu(!0);ku=!1;oo&&oo();n.contextScope()&&(sc=setTimeout(function(){n.contextScope(null);sc=null},1e3));var t=ir();oo||h||!t.find("[data-input-container]").length||te(t);oo=null;u&&u.close&&u.close()})}}),ny(f),u.className&&f.addClass(u.className),git(f),t.match(/^#/)&&f.attr("id",t.substring(1)),f.find("ul").listview(),pc(f,!1),u&&u.resetScrolling&&f.addClass("app-reset-scrolling")),f}function be(){n.contextScope()==="_contextMenu"?vc(n._menuPanel):n.toggleContextPanel("#app-panel-context")}function ke(t){return n.stickyHeaderBar(t)}function de(t){t!=null?(clearTimeout(og),og=setTimeout(n.fetchOnDemand,t)):n.fetchOnDemand()}function uf(t){n.stickyHeader(t)}function ik(n){ke(n).hide()}function rut(n){ik(n);uf(n)}function ti(t,i,r){var u=$(".ui-panel-open"),s,f,e,c,l,o,h;if(u.length){yu(!1);f=u.find(".ui-panel-inner").addClass("app-multi-list");e=f.find(".app-list-container");e.length||(f.contents().wrap(uv("app-list-container")),e=f.find(".app-list-container"));s=u.outerWidth();h='[data-panel="'+i+'"]';o=f.find(h);o.length||(o=nr().attr("data-panel",i).appendTo(e).listview());c=u.find("ul").width(s);l=c.first();ci=t;n.refreshContextMenu(u,ci,h);e.css({transition:"",transform:"translate3d("+-(-d(l,"margin-right")+s*o.prevAll("ul").length)+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){o.nextAll("ul").remove();r&&r.afteropen&&r.afteropen();yu(!0);$(".ui-panel-open .ui-panel-inner").focus()})})}else return ci=t,(n.contextScope()&&(!r||r.position!=="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),vc(iut(i,function(){n.refreshContextMenu(i,ci)},r))}function rk(n){var r=new kf.StringBuilder,o=n._fields,i,f,u=n.get_sortExpression(),e=ea,t;if(u)for(t=e.exec(u);t;)i=n.findField(t[1]),f=!t[3]||t[3].match(/^asc/)?"asc":"desc",i&&i.AllowSorting&&(r.isEmpty()||r.append(", "),r.appendFormat("{0} ({1})",i.HeaderText,bo(i,f))),t=e.exec(u);return r.toString()}function uk(n){var i=new kf.StringBuilder,o=n._fields,r,e,u=n.get_groupExpression(),f=ea,t;if(u)for(t=f.exec(u);t;)r=n.findField(t[1]),e=!t[3]||t[3].match(/^asc/)?"asc":"desc",r&&r.AllowSorting&&(i.isEmpty()||i.append(", "),i.appendFormat("{0}",r.HeaderText)),t=f.exec(u);return i.toString()}function wh(n){n.extension()._instructed=!1;tt(n).stickyHeader.find(".app-bar-text").removeData("html")}function fk(t,i){var h=t.groupExpression(),r=t.get_sortExpression(),o,u=0,s;if(h&&r){for(r=r.split(f._simpleListRegex);u<r.length;)o=r[u].match(/(\w+)(\s+\w+)?/),!r[u]||o&&h.indexOf(o[1])!=-1?r.splice(u,1):u++;r=r.join(",");t.set_sortExpression(r);t.viewProp("sortExpression",r)}t.viewProp("groupExpression",i);t.set_groupExpression(i);wh(t);t._keepKeyList=!0;t.AutoPivots=null;wf(t);s=uk(t);n.notify({dataView:t,text:s?e.Grouped+" - "+s:e.UnGrouped});t.sync()}function ll(n){n.session("reset-grid-header",!0)}function wf(n){if(n)$(n._views).each(function(){var i=this,t=i.Id;i.Type!=="Form"&&(n.session("grid-style-changed",!0,t),n.session("grid-avail-width",null,t),n.session("window-width",null,t))});else{var t=[];n=dt();n?t.push(n._id):l(".app-echo[data-for]").each(function(){t.push($(this).data("for"))});t.forEach(function(n){ek(k(n),wf)});nf();tf()}}function ek(n,t){(n._allFields||[]).forEach(function(n){if(n.Type==="DataView"){var i=k(n._dataViewId);i&&t(i)}})}function ok(){var n,i,t;ot()&&(i=dt()._parentDataViewId,n=k(i),wf(n),ll(n),t=$("#"+i),nf(t.find(".app-listview")),tf(t),ye(n),vf(t))}function sk(){if(li()){var n=$(".app-reading-pane-detail"),t;n.length&&!n.is(".app-hidden")&&(t=k(n.attr("id")),t&&(ei(n),ek(t,wf),ek(t,ll),uu(g(n)),od(n),nf(n.find(".app-listview")),tf(n),ye(t),vf(n)))}}function al(t){var i=n.contextDataView(t),r;iu!=null&&(i.set_sortExpression(iu),iu=null,wh(i),i._keepKeyList=!0,ll(i),r=rk(i)||"",n.notify({dataView:i,text:r?e.Sorted+" - "+r:e.SortedDefault}),i.sync())}function ge(n,t,i){var e=iu==null?n.get_sortExpression()||"":iu,o=e.split(f._simpleListRegex),r,u;if(i==null){if(e)for(r=0;r<o.length;r++)if(u=o[r].match(tet),u&&u[1]===t)return u[3]||"asc";return null}iu=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",iu)}function bo(n,t){var i=ef.GenericSortAscending,r=ef.GenericSortDescending;switch(n.FilterType){case"Text":i=ef.StringSortAscending;r=ef.StringSortDescending;break;case"Date":i=ef.DateSortAscending;r=ef.DateSortDescending}return t==="asc"?i:r}function br(n,t){ci=n;t?setTimeout(t,500):wy()}function tht(n,t){function h(n,t){for(var s,u="",i="",f=[],e=0;e<t;e++)i+=o;for(s in n)f.push(s);f.forEach(function(e,s){u=i+e+": ";var c=n[e],l=s==f.length-1?"":",";c!=null&&c instanceof Array?(u+="[",r.push(u),c.forEach(function(n,u){var f=u===c.length-1?"":",";typeof n=="object"?(r.push(i+o+"{"),h(n,t+2),r.push(i+o+"}"+f)):r.push(i+o+JSON.stringify(n)+f)}),r.push(i+"]"+l)):typeof c=="object"?(u+="{",r.push(u),h(c,t+1),r.push(i+"}"+l)):r.push(u+JSON.stringify(c)+l)})}var s=k(n),u=s._controller,e="",a=t.closest("ul").find(".app-layout-size").filter(function(){return $(this).find(".app-icon").length>0}),f=s._survey,c,i,l,r,o;if(f&&f.layout?(u=u.replace(/__search/,"._search"),e+=String.format("<!--\r\n\t~/js/surveys/{0}.html\r\n-->\r\n{1}",u,f.layout)):(u+="."+s._viewId,a.each(function(){var n=$(this).data("context-action");e+="\r\n<!--  "+n.text+" -->\r\n";e+=htt(s,oi(n.context));e+="\r\n"}),e=String.format("<!--\r\n\t~/views/{0}.html\r\n-->\r\n{1}",u,e.replace(/<span\s+class=\"app-control-inner\">([\s\S]+?)<\/span>/g,"$1").replace(/\n\s*>/g,">"))),wb(u+".html.txt",e,"text/plain"),f){c=f.context;f.context=null;i=JSON.stringify(f);c!=null&&(f.context=c);i=JSON.parse(i);i.text&&typeof i.text!="string"&&(i.text=i.text[0]);for(l in i)["options","text","text2","topics","controller",].indexOf(l)===-1&&delete i[l];i.layout="#ref";i.cache=!1;r=[];o="    ";h(i,1);i=String.format("//\r\n//\t~/js/surveys/{0}.js\r\n//\r\n({{\r\n{1}\r\n}})();",u,r.join("\r\n"));wb(u+".js.txt",i,"text/plain")}}function hk(n){ru=JSON.parse(JSON.stringify(n));var t=n.width,i=n.height,u=t>i?!1:r.isVirtual&&r.width>r.height?!0:ru&&(i==null||t<i)?!1:!0;t==null?r.isVirtual=!1:t==="auto"?r.isVirtual=!0:(r.isVirtual=!0,u?(r.width=i,r.height=t):(r.width=t,r.height=i),n.width=r.width,n.height=r.height);yc(n);r.deviceWidth=r.deviceHeight=null;po()}function iht(){function u(n){if(r.isVirtual){var t=Math.min(ru.width,ru.height),i=Math.max(ru.width,ru.height);r.deviceWidth=null;r.deviceHeight=null;n==="Portrait"?(r.width=t,r.height=i):(r.width=i,r.height=t)}ru.width=r.width;ru.height=r.height;yc(ru);po()}var f=ci,t=ru.name,i=r.width>r.height?"Landscape":"Portrait",n=[{text:e.Back,icon:ui,callback:function(){br(f)}}];ru.width&&(n.push({text:e.Orientation,instruction:!0}),n.push({text:e.Portrait,icon:i==="Portrait"?"check":!1,context:"Portrait",callback:u}),n.push({text:e.Landscape,icon:i==="Landscape"?"check":!1,context:"Landscape",callback:u}));n.push({text:e.Device,isStatic:!1,instruction:!0});n.push({text:"Responsive",icon:wr()?!1:"check",context:{name:"Responsive"},callback:hk});n.push({text:"Generic",icon:t==="Generic"?"check":!1,context:{name:"Generic",width:"auto",height:"auto"},callback:hk});[{n:"Moto G4 ",w:360,h:640},{n:"Galaxy S5 ",w:360,h:640},{n:"Pixel 2 ",w:411,h:731},{n:"Pixel 2 XL",w:411,h:823},{n:"iPhone 5/SE",w:320,h:568},{n:"iPhone 6/7/8",w:375,h:667},{n:"iPhone 6/7/8 Plus",w:414,h:736},{n:"iPhone X",w:375,h:812},{n:"iPad",w:768,h:1024},{n:"iPad Pro",w:1024,h:1366},{n:"Surface Pro 7",w:1368,h:912},{n:"Surface Duo",w:540,h:720},{n:"Galaxy Fold",w:280,h:653}].forEach(function(i){var r=i.n;n.push({text:r,icon:t===r?"check":!1,context:{name:r,width:i.w,height:i.h},callback:hk})});ti(n,"#app-panel-developer-tools-device")}function rht(){function i(n,t){var i=t.find(".app-icon");i.length?(i.remove(),t.removeClass("app-has-material-icon")):bt("material-icon-check",t)}var r=ci,n=[{text:e.Back,icon:ui,callback:function(){br(r)}},{text:fc.FormLayout,isStatic:!1,instruction:!0},],u=dt(),t;n.push({text:e.Download,icon:"material-icon-get-app",context:u._id,keepOpen:!0,callback:tht});t=le(ie(g()));n.push({text:fc.FormLayoutInstr,instruction:!0});n.push({text:"Tiny (tn)",icon:t==="tn"?"check":!1,keepOpen:!0,context:"tn",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Extra Small (xxs)",icon:t==="xxs"?"check":!1,keepOpen:!0,context:"xxs",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Small (xs)",icon:t==="xs"?"check":!1,keepOpen:!0,context:"xs",linkClassName:"app-layout-size",callback:i});n.push({text:"Small (sm)",icon:t==="sm"?"check":!1,keepOpen:!0,context:"sm",linkClassName:"app-layout-size",callback:i});n.push({text:"Medium (md)",icon:t==="md"?"check":!1,keepOpen:!0,context:"md",linkClassName:"app-layout-size",callback:i});n.push({text:"Large (lg)",icon:t==="lg"?"check":!1,keepOpen:!0,context:"lg",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Large (xl)",icon:t==="xl"?"check":!1,keepOpen:!0,context:"xl",linkClassName:"app-layout-size",callback:i});n.push({text:"Extra Extra Large (xxl)",icon:t==="xxl"?"check":!1,keepOpen:!0,context:"xxl",linkClassName:"app-layout-size",callback:i});ti(n,"#app-panel-developer-tools-form-layout")}function uht(){var r=ci,n=[{text:e.Back,icon:ui,callback:function(){br(r)}},{text:fc.Tools,isStatic:!1,instruction:!0},],t=yc(),i=dt();n.push({text:e.Device,icon:"material-icon-devices",desc:wr()&&t?t.name:null,transition:!0,callback:iht});i&&i.get_isForm()&&!di()&&n.push({text:fc.FormLayout,icon:!1,transition:!0,callback:rht});ti(n,"#app-panel-developer-tools")}function fht(){function t(n){n==="OnHover"&&c.addClass("app-show-system-buttons-on-hover");n==="Always"&&c.removeClass("app-show-system-buttons-on-hover");ri("showSystemButtons",n);o("ui.showSystemButtons",n)}var i=ci,r=[{text:e.Back,icon:ui,callback:function(){br(i)}},{text:e.ShowSystemButtons,isStatic:!1,instruction:!0},{text:e.OnHover,icon:o("ui.showSystemButtons")==="OnHover"||o("ui.showSystemButtons")=="Auto"&&!h?"check":!1,context:"OnHover",callback:t},{text:e.Always,icon:o("ui.showSystemButtons")==="Always"?"check":!1,context:"Always",callback:t},];n.contextScope("_contextMenu");ti(r,"#app-panel-settings-showsystembuttons")}function eht(){function t(t){vit();n.contextScope(null);o("ui.sidebar.when",t);ri("sidebar",t);gv();po()}var r=ci,i=o("ui.sidebar.when"),u=[{text:e.Back,icon:ui,callback:function(){br(r)}},{text:e.Sidebar,isStatic:!1,instruction:!0},{text:e.Landscape,icon:i==="Landscape"?"check":!1,context:"Landscape",callback:t},{text:e.Always,icon:i==="Always"?"check":!1,context:"Always",callback:t},{text:e.Never,icon:i==="Never"?"check":!1,context:"Never",callback:t}];n.contextScope("_contextMenu");ti(u,"#app-panel-settings-sidebar")}function ck(n){return n=n.toLowerCase(),n==="tiny"&&(n="condensed app-font-tiny"),"app-density-"+n}function lk(n){return"app-theme-"+n.toLowerCase()}function uut(t,i){var r=pi.ui.theme,u=r.name,f=r.accent;t.theme?r.name=t.theme.name:t.accent&&(r.accent=t.accent.name);i.closest(".ui-panel-inner").find(".app-item-theme-"+(t.theme?"name":"accent")+" i").remove();bt("material-icon-check",i);dp=!0;setTimeout(function(){o("ui.theme.name",r.name);o("ui.theme.accent",r.accent);ri("userTheme",!0);n._changeThemeLink(u+"."+f,r.name+"."+r.accent,function(){u&&c.removeClass(lk(u));c.addClass(lk(r.name));hr.trigger("themechanged.app");var n=$(".ui-panel-open").css("transition","opacity 500ms");setTimeout(function(){n.css("opacity",0);setTimeout(function(){n.css("opacity","");setTimeout(function(){n.css("transition","");dp=!1},600)},r.preview||1e3)},32)})},200)}function oht(){function f(){$(r.themes).each(function(){var n=this;t.push({text:eo.List[n.name]||n.text||n.name,icon:i.name==n.name?"check":!1,keepOpen:!0,context:{theme:n},callback:uut,linkClassName:"app-item-theme-name",color:n.color})});t.push({text:eo.Accent,isStatic:!1,instruction:!0});$(r.accents).each(function(){var n=this;t.push({text:eo.List[n.name]||n.text||n.name,icon:i.accent==n.name?"check":!1,keepOpen:!0,context:{accent:n},callback:uut,linkClassName:"app-item-theme-accent",color:n.color})})}var u=ci,s=o("ui.theme.name"),t=[{text:e.Back,icon:ui,callback:function(){br(u)}},{text:eo.Label,isStatic:!1,instruction:!0}],i=pi.ui.theme,r=i.config;t.push({text:of,icon:"material-icon-refresh",animate:!0,keepOpen:!0,callback:gi});ti(t,"#app-panel-settings-theme");n.getThemes().done(function(i){r=pi.ui.theme.config=i;var u=$('.ui-panel-open [data-panel="#app-panel-settings-theme"] .ui-btn.app-animated').closest(".ui-panel");u.length&&(t.splice(t.length-1,1),f(),n.refreshContextMenu(u,t,'[data-panel="#app-panel-settings-theme"]'))})}function sht(){function i(t){t!=n&&(o("ui.transitions.style",t),ri("transitions",t))}var r=ci,n=o("ui.transitions.style"),t=[{text:e.Back,icon:ui,callback:function(){br(r)}},{text:e.Transitions.Label,isStatic:!1,instruction:!0},];t.push({text:e.Transitions.List.none,icon:"none"==n?"check":!1,context:"none",callback:i});t.push({text:e.Transitions.List.slide,icon:"slide"==n?"check":!1,context:"slide",callback:i});ti(t,"#app-panel-settings-theme")}function hht(){var r=ci,n=o("ui.displayDensity.value"),i=[{text:e.Back,icon:ui,callback:function(){br(r)}},{text:e.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var t in e.DisplayDensity.List)i.push({text:e.DisplayDensity.List[t],icon:t==n?"check":!1,context:t,callback:function(t){t!=n&&(po(),c.removeClass(ck(n)),o("ui.displayDensity.value",t),c.addClass(ck(t)),ei(),ri("displayDensity",t),as=null,pu())}});ti(i,"#app-panel-settings-display-density")}function cht(){var t=ci,r=o("ui.list.labels.display"),i=[{text:e.Back,icon:ui,callback:function(){br(t)}},{text:e.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in e.LabelsInList.List)i.push({text:e.LabelsInList.List[n],icon:n==r?"check":!1,context:n,callback:function(n){o("ui.list.labels.display",n);ri("labelsInList",n);f.confirm(e.ConfirmReload,function(){dw()},function(){br(t)})}});ti(i,"#app-panel-settings-labels-in-form")}function fut(){function r(n){o("ui.actions.promote",n);ri("promoteActions",n);fi();br(t,fut)}var t=ci,i=o("ui.actions.promote"),n=[{text:e.Back,icon:ui,callback:function(){br(t)}},{text:e.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:va,icon:i!=!1?"check":!1,context:!0,callback:r});n.push({text:aa,icon:i==!1?"check":!1,context:!1,callback:r});ti(n,"#app-panel-promote-actions")}function lht(){var t=ci,r=o("ui.list.initialMode"),i=[{text:e.Back,icon:ui,callback:function(){br(t)}},{text:e.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in e.InitialListMode.List)i.push({text:e.InitialListMode.List[n],icon:n==r?"check":!1,context:n,callback:function(n){ri("initialListMode",n);f.confirm(e.ConfirmReload,function(){dw()},function(){br(t)})}});ti(i,"#app-panel-settings-default-list-mode")}function aht(){function r(n){o("ui.smartDates",n);ri("smartDates",n);f.confirm(e.ConfirmReload,function(){dw()},function(){br(t)})}var t=ci,i=o("ui.smartDates"),n=[{text:e.Back,icon:ui,callback:function(){br(t)}},{text:e.Dates.SmartDates,isStatic:!1,instruction:!0},];n.push({text:va,icon:i!=!1?"check":!1,context:!0,callback:r});n.push({text:aa,icon:i==!1?"check":!1,context:!1,callback:r});ti(n,"#app-panel-smart-dates")}function vht(){function i(n){n.selected||au._instance.changeCulture(n.value)}var t=ci,n=[{text:e.Back,icon:ui,callback:function(){br(t)}},{text:se.ChangeLanguageToolTip,isStatic:!1,instruction:!0},];$(f.cultureList).each(function(){var t=this;n.push({text:t.text,icon:!1,selected:t.selected,context:t,keepOpen:t.selected,callback:i})});ti(n,"#app-panel-languages")}function vl(){return r.width>=oi("md")}function yht(){wy("left")}function wy(n){var t=[];if(n||t.push({text:e.Back,icon:ui,callback:be}),t.push({text:e.Settings}),lt("settings.options.displayDensity")&&t.push({text:e.DisplayDensity.Label,icon:"material-icon-blur-on",transition:!0,callback:hht,desc:e.DisplayDensity.List[o("ui.displayDensity.value")]}),lt("settings.options.theme")){var r=pi.ui.theme,u=r.name,i=r.accent;t.push({text:eo.Label,icon:"material-icon-brush",transition:!0,callback:oht,desc:(eo.List[u]||f.prettyText(u))+(i=="None"?"":" "+(eo.List[i]||f.prettyText(i)))})}lt("settings.options.transitions")&&t.push({text:e.Transitions.Label,icon:"material-icon-swap-horiz",transition:!0,callback:sht,desc:e.Transitions.List[o("ui.transitions.style")]});lt("settings.options.sidebar")&&vl()&&t.push({text:e.Sidebar,icon:"material-icon-view-quilt",transition:!0,callback:eht,desc:o("ui.sidebar.when")=="Landscape"?e.Landscape:o("ui.sidebar.when")=="Always"?e.Always:e.Never});lt("settings.options.labelsInList")&&t.push({text:e.LabelsInList.Label,icon:"material-icon-text-format",transition:!0,callback:cht,desc:e.LabelsInList.List[o("ui.list.labels.display")]});lt("settings.options.showSystemButtons")&&!h&&t.push({text:e.ShowSystemButtons,icon:"material-icon-more-"+(wu?"vert":"horiz"),transition:!0,callback:fht,desc:o("ui.showSystemButtons")=="OnHover"||o("ui.showSystemButtons")=="Auto"&&!h?e.OnHover:e.Always});lt("settings.options.promoteActions")&&t.push({text:e.PromoteActions,icon:"material-icon-add-circle",transition:!0,callback:fut,desc:lt("ui.actions.promote")?va:aa});lt("settings.options.smartDates")&&t.push({text:e.Dates.SmartDates,icon:"material-icon-event",transition:!0,callback:aht,desc:o("ui.smartDates")!=!1?va:aa});lt("settings.options.initialListMode")&&t.push({text:e.InitialListMode.Label,icon:"material-icon-receipt",transition:!0,callback:lht,desc:e.InitialListMode.List[o("ui.list.initialMode")]});$(f.cultureList).each(function(){var n=this;if(n.selected)return t.push({text:n.text,icon:"material-icon-language",transition:!0,callback:vht}),!1});ti(t,"#app-panel-settings",n?{position:n}:null)}function ak(t){function w(n){var t=0;return n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&(t=n.index)}),t}function b(n,t){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&n.index--})}function k(n){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this),t=n.data("context-action").context;n.find(".ui-li-count").remove();t.index&&s("ui-li-count ui-body-inherit").appendTo(n).text(t.index)})}var r=n.contextDataView(),i=r.get_groupExpression(),a=r.get_view().Label,v=r._fields,y=r._allFields,h=[],u=[],c,f,p=1,l,o={};if(t||u.push({text:e.Back,icon:ui,callback:be}),i&&u.push({text:e.GroupedBy+" "+uk(r)+"."},{text:ic,icon:"delete",callback:function(){fk(r,null)}}),u.push({},{text:rc,icon:"material-icon-check",callback:function(n,t){var u=[];$(t).closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&u.push(n)});u.sort(function(n,t){return n.index-t.index});i="";$(u).each(function(){var n=this;i&&(i+=",");i+=n.field});fk(r,i)}},{text:String.format(e.GroupByField,a)}),i)for(c=ea,f=c.exec(i);f;)l=r.findField(f[1]),l&&(o[l.Name]={field:f[1],index:p++}),f=c.exec(i);$(v).each(function(){var n=this,t=n;n=y[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&h.push(n)});h.sort(function(n,t){var i=o[n.Name],r=o[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(h).each(function(){var t=this,n;n=o[t.Name];u.push({text:t.HeaderText,keepOpen:!0,icon:!1,context:n||{field:t.Name},count:n?n.index:null,callback:function(n,t){n.index?(b(t,n.index),n.index=null):n.index=w(t)+1;k(t)}})});ti(u,"#app-panel-group-fields")}function pht(){function c(n){var t,r=0;$(i).each(function(){var i=this,r=i.context;if(r&&r.field==n.field)return t=i,!1});n.order?(t.context.order||($(i).each(function(){var n=this.context;n&&n.index>r&&(r=n.index)}),t.context.index=r+1,t.count=r+1),t.icon=n.order=="asc"?"arrow-u":"arrow-d",t.context.order=n.order):($(i).each(function(){var i=this,n=i.context;n&&n.index>t.context.index&&(i.count--,n.index--)}),t.context.order=null,t.context.index=null,t.count=null,t.icon=!1);ti(i,"#app-panel-sort-fields")}var t=n.contextDataView(),u=t.get_sortExpression(),l=t.get_view().Label,a=t._fields,v=t._allFields,o=[],i=[{text:e.Back,icon:ui,callback:be}],s,r,y=1,h,f={};if(u&&i.push({text:rk(t)},{text:ic,icon:"delete",callback:function(){iu="";t.viewProp("sortExpression",iu);al()}}),i.push({text:rc,icon:"material-icon-check",callback:function(n,i){var r=[];$(i).closest("ul").find(".ui-btn").each(function(){var n=$(this).data("context-action").context;n&&n.order&&r.push(n)});r.sort(function(n,t){return n.index-t.index});iu="";$(r).each(function(){var n=this;iu&&(iu+=",");iu+=n.field+" "+n.order});t.viewProp("sortExpression",iu);al()}},{text:String.format(e.SortByField,l)}),u)for(s=ea,r=s.exec(u);r;)h=t.findField(r[1]),h&&(f[h.Name]={field:r[1],index:y++,order:r[3]&&r[3].match(/^desc/i)?"desc":"asc"}),r=s.exec(u);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&n.Type!="DataView"&&o.push(n)});o.sort(function(n,t){var i=f[n.Name],r=f[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(o).each(function(){var r=this,n,u=t.groupExpression();n=f[r.Name];i.push({text:r.HeaderText,icon:n?n.order=="asc"?"arrow-u":"arrow-d":!1,context:n||{field:r.Name},count:n?n.index:null,transition:!0,callback:function(n){var r=t.findField(n.field),f=[{text:e.Back,icon:ui,callback:function(){ti(i,"#app-panel-sort-fields")}},{text:String.format(e.SortByOptions,t.get_view().Label,r.HeaderText)},{text:bo(r,"asc"),icon:n.order=="asc"?"check":!1,transition:!0,reverse:!0,context:{order:"asc",field:n.field},callback:c},{text:bo(r,"desc"),icon:n.order=="desc"?"check":!1,transition:!0,reverse:!0,context:{order:"desc",field:n.field},callback:c}];u&&u.indexOf(n.field)!=-1||f.splice(2,0,{text:e.None,icon:n.order?!1:"check",transition:!0,reverse:!0,context:{field:n.field},callback:c});ti(f,"#app-panel-sort-field-options")}})});ti(i,"#app-panel-sort-fields")}function wht(n){var t=n.find(".app-group"),i=t.length?t.first().outerHeight(!0):0;return t.remove(),i}function bht(n,t){var r=n.groupExpression(),o=[],y=n.get_showFirstLetters()&&!r,h,i=0,u,f,e,l,a,c,v;if(r){while(i<r.length)h=n.findField(r[i]),h?r[i++]=n._allFields[h.AliasIndex]:r.splice(i,1);t.find("li a").each(function(){var h=$(this),d=h.data("data-context"),n=[],p=[],w=[],b,k=[],g,t,nt;d?($(r).each(function(a){var rt=this,tt=d.row[rt.Index],v,ut,it,et,ft;if(tt!=null&&(v=y?tt.substring(0,1):rt.text(tt)),n.push(v),p.push(rt.HeaderText),w.push(rt.Type),k.push(tt),o.length&&o[a]==v||(o[a]=v,g=!0),g&&a==r.length-1){for(u&&(s("app-group-count").appendTo(u).text(f+(c?"+":"")),c=!1),t=ct('app-group"').insertBefore(h.parent()),it=null,ut=null,b=w[w.length-1].match(/^Date/),tt!=null&&w.length==1&&b&&(tt=k[k.length-1],ut=oe.DayNames[tt.getDay()]+" "+tt.getDate(),it=oe.MonthNames[tt.getMonth()],et=tt.getFullYear()),it&&(e=s("app-group-info").appendTo(t),s("app-group-info-value").appendTo(e).text(it),s("app-group-info-value-muted").appendTo(e).text(et),l!=it?l=it:e.addClass("app-group-info-duplicate")),b&&t.addClass("app-group-fixed"),f=0,i=0;i<n.length-1;)ft||(ft=s("app-group-path").appendTo(t)),nt=s("app-group-path-value").appendTo(ft),v=n[i],v||(v=ap),nt.text(v).attr("title",p[i]+":\n"+v),i++;v=ut||n[n.length-1];u=s("app-group-title").appendTo(t).text(v);v||(v=ap);u.text(v).attr("data-text",v).attr("title",p[p.length-1]+":\n"+v)}}),f++):h.is(".dv-load-at-bottom")?v=!0:!a&&h.is(".dv-load-at-top")&&(c=!0,a=!0)});u&&s("app-group-count").appendTo(u).text(f+(v?"+":""))}}function kht(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||ao(n).length}function eut(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function dht(n){var t=n.is(".app-include");n.find(".app-icon").text(t?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",t).toggleClass("material-icon-check-box-outline-blank",!t)}function ght(n,t){var f=vk(t),u=yk(t),r,i;t.toggleClass("app-include");r=u.filter(".app-include").length;i=u.length==r;dht(t);f.find(".app-icon").text(i?"check_box":"check_box_outline_blank").toggleClass("material-icon-check-box",i).toggleClass("material-icon-check-box-outline-blank",!i);eut(r>0)}function vk(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function yk(n){return vk(n).parent().nextAll().find("a")}function nct(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function tct(n,t){var i=k(n.dataViewId),r=n.field,f=i.findField(r),e=i._allFields[f.AliasIndex],u=ict(i,r,t);i.removeFromFilter(e);u&&i._filter.push(u);eh(i)}function ict(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".app-include");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[nct(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=yk(i);return o.filter(":not(.app-include)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function bh(t){function h(n,t,r){var u=n._dataView,o=u._allFields[n.AliasIndex],s=u.get_fieldFilter(o,!0);i||(t.push({text:e.Back,icon:ui,callback:a}),t.push({text:o.HeaderText}));t.push({});s&&t.push({text:ic,context:o.Name,callback:function(){u.removeFromFilter(o);eh(u)},icon:"material-icon-clear"});t.push({text:hu.Filters[o.FilterType].Text,context:{id:u._id,field:u._allFields[n.OriginalIndex].Name},desc:s!=="$in"&&s!=="$notin"?r:null,callback:function(n){f.search("show",n)},transition:!1,icon:"material-icon-filter-list"});i||t.push({text:String.format(e.FilterByOptions,u.get_view().Label,o.HeaderText,rc)})}function c(n,t){var f,i,v,r=n._dataView,h=n._listOfValues||[],c=r._allFields[n.AliasIndex],o=r.get_fieldFilter(c,!0),l=[],y,a,e,u,s=o==="$notin";for(o&&(o==="="||o==="$in"||s)&&(a=(r.get_fieldFilter(c)||"").split(/\$or\$/)),y={text:rc,icon:"material-icon-check",disabled:!0,itemClassName:"app-btn-apply",context:{dataViewId:r._id,mappedId:r._mappedId,field:n.Name},callback:tct},t.push(y,{}),h.length>1&&t.push({text:hp.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:"material-icon-check-box-outline-blank",callback:function(n,t){var r=yk(t),i=r.filter(".app-include").length===r.length;vk(t).find(".app-icon").text(i?"check_box_outline_blank":"check_box").toggleClass("material-icon-check-box",!i).toggleClass("material-icon-check-box-outline-blank",i);i?r.removeClass("app-include").find(".app-icon").text("check_box_outline_blank").removeClass("material-icon-check-box").addClass("material-icon-check-box-outline-blank"):r.addClass("app-include").find(".app-icon").text("check_box").addClass("material-icon-check-box").removeClass("material-icon-check-box-outline-blank");eut(!i)}}),f=0;f<h.length;f++)i=h[f],u=a&&a.indexOf(r.convertFieldValueToString(n,i))!==-1,s&&(u=!u),v=i==null?ha:typeof i=="string"&&i===""?ap:c.text(i),e={text:v,icon:"material-icon-"+(u?"check-box":"check-box-outline-blank"),keepOpen:!0,context:f,callback:ght,linkClassName:u?"app-include":""},u?s?l.push(e):t.push(e):s?t.push(e):l.push(e);return t.concat(l)}function l(t,i){var r=[],f=n.contextDataView(),u=f.findField(t),l=f._allFields[u.AliasIndex],e=$(i).data("contextAction"),o=e?e.desc:null;h(l,r,o);s&&r.splice(0,1);u._listOfValues&&u._listOfValues.length?r=c(u,r):r.push({text:of,icon:"material-icon-refresh",animate:!0,context:{id:f._id,field:t},keepOpen:!0,callback:gi});ti(r,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var u=dtt().data("context-action"),r=u&&u.context,i,f,t;r&&(i=k(r.id),t=i.findField(r.field),f=i._allFields,i._loadListOfValues(null,t.Name,f[t.AliasIndex].Name,function(){var u=dtt(),f=u.length&&u.data("context-action").context,r=[];u.length&&f.id===i._id&&f.field===t.Name&&(h(t,r,o),s&&r.splice(0,1),r=c(t,r),n.refreshContextMenu(u.closest(".ui-panel"),r,'[data-panel="#app-panel-filter-field"]'))}))}})}function a(){var t=n.contextDataView(),i=o?[]:[{text:e.Back,icon:ui,callback:be}],s={},u=t&&t._filter,h=t&&t._externalFilter;if(kht(t)){if(o&&ao(t).length){if(!u.length||t._filterSource&&u.length==h.length){f.search();return}i.push({text:sit(t)});i.push({text:us.ShowAdvancedSearch,icon:"search",toolbar:!1,system:!0,context:{dataViewId:t._id},callback:nit})}u.length&&(i.push({text:t.extension().filterStatus(!1,!0)}),i.push({text:e.ClearFilter,icon:"delete",callback:function(){var t=n.contextDataView();ty(t,!0)}}))}i.push({text:String.format(e.FilterByField,t.get_view().Label)});$(u).each(function(){var n=this,t=n.match(/^\w+/);t&&(s[t[0]]=n)});$(h).each(function(){s[this.Name]=null});$(t._fields).each(function(){var e=this,r,f,n;r=t._allFields[e.AliasIndex];f=s[r.Name];f&&(t._filter=[f],n=t.extension().filterStatus(!0,!0),n.indexOf(r.HeaderText)==0&&(n=n.substring(r.HeaderText.length).trim(),n.length>2&&(n=n.charAt(0).toUpperCase()+n.slice(1))));!e.Hidden&&r.AllowQBE&&r.Type!="DataView"&&i.push({text:r.HeaderText,context:e.Name,icon:f?"filter":!1,desc:n,transition:!0,callback:l});t._filter=u});ti(i,"#app-panel-filter",{position:li($("#"+t._id))&&r.splitLeft?"left":null})}var o,s,i,u;if(typeof t=="object"&&(t._dataView?i=t:t.scopeField?i=t.scopeField:t.mode==="everything"?o=!0:t.mode==="field"&&(s=!0)),i)return u=[],h(i,u),t.samples!=!1&&(i._listOfValues&&i._listOfValues.length?u=c(i,u):u.push({text:of,icon:"refresh",animate:!0,context:{id:i._dataView._id,field:i.Name},keepOpen:!0,callback:gi})),u;t&&t.mode=="field"?l(t.field):a()}function pk(n,t,i,r,u){i||(i=tt());var f=i&&i.dataView,o=f&&f.get_view(),s=0,e,h=[];return f&&f.get_isGrid()&&f.get_showViewSelector()&&($(f.get_views()).each(function(){var n=this;t&&n.Id===o.Id||(n.Type!=="Form"&&n.ShowInSelector||n.Id===o.Id)&&h.push(n)}),h.length>1&&(!f._lookupInfo||!f._lookupInfo.field.is("view-selector-none"))&&$(h).each(function(){var h=this,c=h.Label,l=c===o.Label;e={text:c,radio:!0,icon:l?"check":t?"":!1,context:s,callback:function(n){var t=$.find("#"+i.id+" .ui-content > .app-tabs-views .ui-btn");r&&t.length?$(t[n]).trigger("vclick",{selectedTab:c}):(f._forceSync(),f.extension()._commandRow=null,f._requestedSortExpression=f.pageProp(h.Id+"_sortExpression"),f._requestedFilter=f.pageProp(h.Id+"_filter"),f.executeCommand({commandName:"Select",commandArgument:h.Id}),f.pageProp("viewId",h.Id),r&&!t.length&&fu(i.id+"_viewTabs",c),i.id===si()&&(i.headerText!==!1&&lu(c),wtt(),wh(f),fi()))}};u&&(e.radio=!1,e.selected=e.icon==="check",e.icon="material-icon-folder"+(e.icon==="check"?"":"-open"),e.depth=1);n.push(e);s++})),s}function no(t,i){var s=$.Event("menuitem.app",{item:t}),r=t.url,u=r.match(/^((\_\w+)\:)/),e,o;return $(document).trigger(s),o=!s.isDefaultPrevented(),o&&(u?b.open(r.substring(u[0].length),u[2]):(r.match(/^http(s)?\:/)&&(e=n.openExternalUrl(r)),e?e():(i&&i.length&&(i.closest(".app-sidebar").length?(i.closest("ul").find(".app-has-depth .app-option-selected").removeClass("app-option-selected app-item-selected"),i.addClass("app-option-selected app-item-selected")):(i.closest("ul").find(".app-selected").removeClass("app-selected"),i.addClass("app-selected"))),f._navigated=!0,b.location.href=r))),o}function out(n,t,i){return n.selected&&(i.selected=!0,$(n.children).each(function(){if(this.selected)return i.selected=!1,!1}),i.selected&&t&&(i.linkClassName=t,i.selected=!1)),i}function ff(n,t,i,r,u){var e,f,o;if(i)$(i).each(function(){var i=this,u=i.children,f=out(i,null,{text:i.title,context:i,depth:r,icon:t&&i.icon?i.icon:!1,callback:i.url?no:gi,keepOpen:!i.url,tooltip:i.description});n.push(f);u&&ff(n,t,u,r+1)});else if(i=pr,i)if(lt("ui.menu.apps.tiles")&&t)if(e=or.nodesWithIcons,f=e.length,$(e).each(function(){var i=this,r=i.icon;i=i.node;n.push(out(i,"app-item-selected",{text:i.title,context:i,icon:t&&i.icon?i.icon:!1,callback:i.url?no:gi,keepOpen:!i.url,itemClassName:"app-item-tile",tooltip:i.description}))}),f){if(f%3)for(o=f%3;o<3;o++)n.push({text:" ",icon:!1,callback:gi,itemClassName:"app-item-tile app-item-tile-stub"});f<or.nodeCount&&u!==!1&&n.push({},{text:fr,icon:"material-icon-apps",transition:!0,callback:tlt,itemClassName:"app-item-tile-more"})}else ff(n,t,i,1);else ff(n,t,i,1)}function sut(t,i,r){var f=n.contextDataView(),u=f.extension();if(u){var o=u.viewStyle(),h=f!=dt(),s=[];pk(t,null,n.contextPageInfo(),!0)===1&&t.splice(t.length-2,2);f.get_isGrid()&&f.get_showViewSelector()&&(i==!1?t.length&&t.push({}):t.push({text:e.PresentationStyle}),(r==null||r==!0)&&(u.tagged("view-style-grid-disabled")||t.push({text:e.Grid,icon:o==="Grid"?"check":!1,radio:!0,callback:function(){u.viewStyle("Grid")}}),u.tagged("view-style-list-disabled")||t.push({text:e.List,icon:o==="List"?"check":!1,radio:!0,callback:function(){u.viewStyle("List")}}),u.tagged("view-style-cards-disabled")||t.push({text:e.Cards,icon:o==="Cards"?"check":!1,radio:!0,callback:function(){u.viewStyle()!=="Cards"&&u.viewStyle("Cards")}}),h||u.tagged("view-style-map-disabled")||u.tagged("supports-view-style-map")&&t.push({text:e.Map,icon:o==="Map"?"check":!1,radio:!0,callback:function(){u.viewStyle("Map")}}),n.presenter("enumerate",{id:f._id,list:s}),$(s).each(function(){var n=this;u.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.icon=n.name==o?"check":!1,n.radio=!0,t.push(n))})));vst(f,t)}}function hut(n){n||(n={});var t=[];n.position!=="left"&&t.push({text:e.Back,icon:ui,callback:be});t.push({text:e.AlternativeView});sut(t);ti(t,"#app-panel-view-options",n)}function cut(t,i,r){var e=t.extension(),o=t._id,s=t._allFields[t._fields[0].AliasIndex],f=i.length,u;r&&r.length&&!e.inserting()&&!t.rowIsTemplate(r)&&i.isSideBar===!1&&(n.enumerateFields(t,i,null,r),f<i.length&&(u=i[f],u.icon="material-icon-info-outline",u.transition=!0,u.context={id:o},u.callback=dn))}function wk(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=gb(r,!0),e=nk(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"email",href:"mailto:"+u,system:!0})))})}function ko(n){var t=lut[n];return t?"material-icon-"+t:n}function rct(n){var t=null,r=n.CommandName,i=n.CssClass;if(i&&tl(i)&&(t=i),!t){switch(r){case"Insert":case"Update":case"Confirm":t=n.CommandArgument==="SaveAndNew"?"add":"check";break;default:t=aut[r];t||(t=!1)}t&&(t="material-icon-"+t)}return t}function vut(n){var r=k(n.dataViewId),e=n.row,u=n.action,f=u.CommandName,t;r.editing()&&(t=u.CausesValidation&&f!=="Cancel",i.cancel(t),t&&!i.valid())||(vi(),f==="Edit"&&kc(r),r.extension().command(e,f,n.argument,t,u.Path))}function yut(t){n.contextScope(null);t=t.action;var i=k(t.dataViewId),r=t.action,u=t.group,e=t.groupIndex,o=t.actionIndex;i._busy()||(gf(r.Confirmation)?vut(t):i._confirm({action:r,scope:u.Scope,actionIndex:o,rowIndex:i.commandRow()?0:null,groupIndex:e},function(n){f.confirm(n,function(){vut(t)})}))}function go(n,t,i,r){function b(n){for(var r=t._views,i=0;i<r.length;i++)if(r[i].Id===n)return r[i].Type!=="Form";return!1}t._rowIsSelectedCached=t._rowIsSelected(t._selectedRowIndex);var v=t.rowIsSelected(r),u,c=[],l=t.get_isGrid(),a,f,o,y=t.get_showActionButtons()!=="None",p=h?/^(DataSheet|Grid|Export(Rowset|Rss))$/:/^(DataSheet|Grid)$/,s,w=t.extension().viewStyle().match(/Grid|List|Cards/);$(t.actionGroups(n)).each(function(h){var k=this,d=k.Scope,g;d!=="ActionBar"||k.Flat||k.Id===n?(!d.match(/Grid|ActionColumn/)||v&&l||k.Flat)&&(g=e.InlineCommands[t.extension().viewStyle()==="Grid"?"Grid":"List"],$(this.Actions).each(function(n){var v=this,e=v.CommandName,it=v.CommandArgument,ut=v.Key,ft,nt=rct(v),rt=v.HeaderText,et,ot=e+"/"+it+"/"+rt,tt=!e||c.indexOf(ot)===-1&&(!e||!e.match(p))&&(!k.Flat||v.HeaderText);o=e?yut:null;f=null;tt&&(a=e&&e.match(/^(Select|Edit|New|Duplicate)$/),a&&l&&(!it||b(it))&&(e==="Edit"&&(ut||(ut="F2")),(!t.tagged("inline-editing-none")||t.tagged("inline-editing-mode"))&&lt("ui.inlineEditing.enabled")?v._autoHeaderText&&(et=rt=g[e],et&&(rt=et,v.CssClass||(e==="New"?nt="add":e==="Edit"?nt="add-check":e==="Select"&&(nt="play")),nt&&(nt="material-icon-playlist-"+nt),ft=!1)):tt=!1,w||(tt=!1)));tt&&(!o&&d.match(/Grid|ActionColumn/)||d==="Form"&&!y)&&(tt=!1);tt?(s&&d!==s&&i.push({text:"$separator"}),c.push(ot),u={text:rt,callback:o,icon:nt,uiScope:d,group:k.Id,path:v.Path,command:e,argument:it,tooltip:v.Description,context:{action:{dataViewId:t._id,row:r,group:k,groupIndex:h,action:v,actionIndex:n,argument:it}}},ut&&(u.shortcut=ut),ft===!1&&(u.sidebar=ft),e==="Search"&&(u.system=!0,u.hidden=!0),f?Array.insert(i,i.indexOf(f)+1,u):i.push(u),s=d):rt||i[i.length-1].text==="$separator"||i.push({text:"$separator"})})):i.push({text:k.HeaderText,icon:!1,transition:!0,uiScope:d,group:k.Id,context:{group:k,isSideBar:i.isSideBar},callback:function(n){ci=[];n.isSideBar||ci.push({text:e.Back,icon:ui,callback:be});ci.push({text:k.HeaderText});go(n.group.Id,t,ci,r);ti(ci,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})});t._rowIsSelectedCached=null;t._editing=null}function uct(n,t){function s(n,t){$(e).each(function(i){var r=e[i],f=r.AliasIndex,o=e[f];r.Hidden||o.GroupBy||!(u||r.tagged(n))||t.call(r,f)})}function h(n){s(n,function(t){var e=this,h=e.tagged(n+"desc"),c=e.tagged(n+"para"),l=e.tagged(n+"column"),a=e.tagged(n+"nolabel"),o=(e.tagged(n+"label")||h||c||l)&&!a,s=f.tagSuffix,v=e.tagged(n+"count"),y=e.tagged(n+"aside"),p=e.tagged(n+"heading"),w=e.tagged(n+"thumb"),b;e.tagged(n+"none")||(!u||p||h||v||y||a||c||l||(i.heading==null?i.heading=t:i.thumb==null&&e.OnDemand&&e.OnDemandStyle!=1?i.thumb=t:(h=!0,o=!0)),p&&(i.heading=t),(!o||v||y)&&!a||(i.desc.push(t),r=i.desc.length-1,f.tagSuffix&&(i.descRwd[r]=f.tagSuffix),o&&(i.descLabels[r]=!0,s&&(i.descLabelsRwd[r]=s)),c&&(i.descPara[r]=!0),l&&(i.descColumn[r]=!0,b=e.Columns,i.descColumnCount++)),v&&(i.count=t,i.countRwd=f.tagSuffix,i.countLabel=o,i.countLabelRwd=s),y&&(i.aside=t,i.asideRwd=f.tagSuffix,i.asideLabel=o,i.asideLabelRwd=s),w&&(i.thumb=t))})}function c(){u=!0}var w=n._fields,e=n._allFields,i=t&&n._listItemMap&&n._listItemMap[n._viewId]||!t&&n._cardItemMap&&n._cardItemMap[n._viewId]||{heading:null,thumb:null,aside:null,count:null,desc:[],descOriginal:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[],descColumn:[],descColumnCount:0},u,r;if(i.cached)return i;if(t?(s("list-",c),u&&h("list-")):(s("card-",c),u&&h("card-",!0)),u||(s("item-",c),u&&h("item-")),u)i.heading==null&&(i.heading=w[0].AliasIndex);else{var l,a,b=0,o=[],v=3,y;function p(n){var f,s,h;if(!this.Hidden&&!this.GroupBy&&this.Type!="DataView")if(this.OnDemand)i.thumb==null&&this.OnDemandStyle!=1&&(i.thumb=n);else if(!l||this.ShowInSummary){if(n=this.AliasIndex,f=e[n],s=f.Type.match(/^Date/),f.GroupBy)return;h=f.Type!="String"&&!f.OnDemand;i.heading==null?(i.heading=n,t&&(i.desc.push(n),r=i.desc.length-1,i.descLabels[r]=n,o.push(r))):i.aside==null&&s&&i.count==null&&!t?i.aside=n:i.count!=null||!h||s||i.aside!=null||t?(i.desc.push(n),r=i.desc.length-1,i.descLabels[r]=n,t?(o.push(r),!f.ItemsLookupStyle&&(f.Rows>1||f.TextMode==3)?(i.descPara[r]=!0,a=!0):a&&(i.descPara[r]=!0,a=!1)):b++%3==0&&(i.descPara[r]=!0)):i.count=n;u=!0}}t&&(l=!1);$(e).each(p);t&&!i.descPara.length&&o.length>3&&(o.length<7&&(v=2),y=Math.ceil(o.length/v),$(o).each(function(n){n%y==0&&(i.descColumn[this]=!0,i.descColumnCount++)}));u||(l=!1,$(e).each(p))}return i.desc.length&&$(e).each(function(){var n=this,t=i.desc.indexOf(n.AliasIndex);t!=-1&&n.Index!=n.AliasIndex&&(i.descOriginal[t]=n.Index)}),i.cached=!0,t?(n._listItemMap||(n._listItemMap={}),n._listItemMap[n._viewId]=i):(n._cardItemMap||(n._cardItemMap={}),n._cardItemMap[n._viewId]=i),i}function put(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function fct(n){var t=hc||ri("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address===n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),hc||(hc=t),i}function wut(n,t,i){var r=hc||ri("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>fet&&r.splice(0,1);hc=r;setTimeout(ri,0,"geoLocations",r)}function ect(n,t){var i=[],r=t.latitude,u=t.longitude;return r!=null&&u!=null?i.push(n[r],n[u]):$(t.segments).each(function(){var t=n[this];t!=null&&i.push(t.trim())}),i.join(",")}function oct(n,t){var r=t.latitude,u=t.longitude,f,e,i;return r!=null&&u!=null?(r=n[r],u=n[u]):(f=new kf.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&f.append(","),f.append(i))}),e=f.toString(),i=fct(e),i?typeof i!="string"&&(r=i.lat,u=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(r,u)),i}function but(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function bk(n){if(n.fit!==!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length===1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function yl(){!(__tf!==4)||setTimeout(function(){n.notify({text:".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse().join(""),duration:"medium"})},Math.random()*1e4)}function kk(t){t.items||(t.items=[]);var s=t.dataView,v=s.extension(),y=[],f=kv(),i=p("ui-content app-popup-message app-map-info").popup({transition:ktt(),history:h,arrow:f?null:t.x?h?"b,l,t,r":"t,b,l,r":null,theme:"a",overlayTheme:"b",tolerance:f?0:5,positionTo:f?null:t.x?"origin":"window",afteropen:function(){dut(i);nf(i.find(".ui-listview"));t.afteropen&&t.afteropen(i);et=!1},afterclose:function(){i.find(".ui-btn").data("data-context",null);l.listview("destroy").remove();dk(i);et=!1;t.afterclose&&t.afterclose(i);setTimeout(function(){u&&u.callback&&u.callback(u.context)},50)}}),c=f?{x:r.width/2,y:r.height-1}:{x:t.x,y:t.y},l=nr("app-listview").appendTo(i),w=ct("",'data-icon="false"').appendTo(l),a=vt().appendTo(w),k=p("app-map-info-toolbar").appendTo(i),u,d,b;fe(s,v.commandRow(),v.itemMap(!1),null,w,a,null,!0);a.find(".app-btn-check").remove();l.listview();r.width<640&&(o("ui.displayDensity.value")==="Comfortable"?i.addClass("app-density-compact"):o("ui.displayDensity.value")==="Compact"&&i.addClass("app-density-condensed"));$(t.items).each(function(){y.push(this.icon)});context=[];n.contextScope(s);n.navContext(context,!1);$(context).each(function(){var n=this;n.icon==="eye"&&(d=n.text);n.icon==="dots"||n.navigateTo||n.system||!n.callback||y.indexOf(n.icon)!==-1||!b&&(n.icon||n.command==="Select")&&(b=n,a.data("data-context",n))});n.contextScope(null);t.hasMore||(t.items.splice(0,0,{text:fr,icon:"dots",callback:function(){c.itemsToAppend=[{text:e.Back,icon:ui,callback:function(){kk(t)}}];kh(t.anchor,c)}}),t.hasMore=!0);$(t.items).each(function(){var n=this,t=$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all"/>').appendTo(k).attr("title",n.text).addClass("ui-icon-"+n.icon).data("data-context",n);n.href&&t.attr("href",n.href);n.target&&t.attr("target",n.target)});f&&i.addClass("app-popup-panel").parent().css("minWidth","100%");et=!0;i.popup("open",c).on("vclick",".ui-btn",function(n){var t=$(n.target),r=t.closest("a");if(!t.is("[data-href]"))if(u=r.data("data-context"),u.href)u.keepOpen||to(i),u=null;else return kt(r,function(){to(i)}),!1}).on("vclick","li",function(n){if(!$(n.target).is("[data-href]"))return markerAction=!0,to(i),!1})}function kut(n,t,i,r,u){var s=n,f=t.data("data-map"),h=s.dataView(),o=new google.maps.Marker({map:f.map,position:i,title:r});return google.maps.event.addListener(o,"click",function(){function a(n){google.maps.event.trigger(n||f.selected,"click")}function v(){if(f.fit=!1,o.setAnimation(null),n.getZoom()>=17){var t=n.getStreetView();t&&t.getVisible()?(t.setVisible(!1),a(o)):(f.fit=!0,bk(f));ky(o)}else n.setZoom(17),n.panTo(o.position),ky(o);a()}function y(t){var i=-1;$(r).each(function(n){if(this===o)return i=n,!0});i!==-1&&(t==="next"?i++:i--,i<0&&(i=r.length-1),i>=r.length&&(i=0),by(f,r[i]),n.panTo(f.selected.position),a())}s.tap({row:u},"none");var n=f.map,r=f.markers,l=hct(o.position,n),c=l&&{x:l.x+t.offset().left,y:l.y+t.offset().top},i=[];n.getZoom()>=17?r.length>1&&i.push({text:e.ZoomOut,icon:"zoomout",callback:v}):i.push({text:e.ZoomIn,icon:"zoomin",callback:v});i.push({text:e.Directions,icon:"navigation",context:{api:"dir",address:ect(u,put(h))},callback:fv,target:"_blank",keepOpen:!0});f.markers.length>1&&(i.push({text:uo.Previous,icon:"arrow-l",context:"prev",callback:y}),i.push({text:uo.Next,icon:"arrow-r",context:"next",callback:y}));kk({x:c&&c.x,y:c&&c.y,dataView:h,afteropen:function(){by(f,o);ky(o)},items:i})}),f.markers.push(o),o}function by(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function sct(){setTimeout(function(){n.notify({text:".dettimrep ton si tnempoleved noitacilppa laicremmoC .emiT nO edoC fo lairt eerf a si sihT".split("").reverse().join(""),duration:"medium"})},Math.random()*1e4)}function ky(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function hct(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function dut(n){c.addClass("app-has-popup-open");n.is(".app-popup-panel")&&c.addClass("app-has-panel-open");vo();pc(n,!1)}function cct(n){n.popup("close")}function to(n){n.data("touchPopup")._currentTransition="none";cct(n)}function dk(n){rst(n);c.removeClass("app-has-popup-open app-has-panel-open");pc(n,!0);n.data("position-options",null).popup("destroy").remove()}function pl(n){n.find("a").data("data-context",null);n.find("li").remove()}function lct(n){pl(n);n.off("vclick").listview("destroy")}function kh(n,t){function o(){i.length&&i[i.length-1].text&&i.push({})}function e(n){var t=[];$(r).each(function(){var r=this,u=r.icon;r.system?n&&(!r.system||u==="eye"||u==="phone"||u==="email")&&u!="dots"&&t.push(r):r.text&&!r.isStatic&&i.push(r)});n&&t.length&&(o(),$(t).each(function(){var n=this,r=n.href,t={text:n.text,icon:n.icon};t.href?t.callback=n.callback:t.href=r;i.push(t)}))}if(n=$(n),n.css("visibility")!=="hidden"&&!di("ontop")){var s=ni(n),c=s.length?s.attr("data-for"):null,l=tt(c),f=l.dataView,u=f.extension(),r=t&&t.context,i=[],h;u.lookupInfo()?(r=[],u.context(r),e()):(e(),t&&t.autoPopulate===!1||(r=[],u.context(r,["ActionColumn"]),r.length&&(o(),e()),o(),r=[],u.context(r,["Grid"]),e(!0)));t&&$(t.itemsToAppend).each(function(){i.push(this)});$(f._fields).each(function(){var r=this,e=f._allFields[r.AliasIndex],s=r.HyperlinkFormatString,o,n,t;s&&(n=u.commandRow(),n&&!f.rowIsTemplate(n)&&(t=n[e.Index],t!=null&&(o=ly(r,n),t=e.format(n[e.Index]),h||(h=!0,i.push({})),i.push({text:t,icon:"material-icon-info-outline",href:o}))))});yr({items:i,anchor:n,iconPos:"left",defaultIcon:"carat-r",x:t&&t.x||n.length&&n.offset().left+n.outerWidth()/2,y:t&&t.y||n.length&&n.offset().top+n.outerHeight(!0)*.66,y2:t&&t.y2||n.length&&n.offset().top+n.outerHeight(!0)*.33})}}function dy(t){function r(){yt(!1);i.Handler?b.location=ne+"appservices/saas/"+i.Handler+"?username="+i.name:n.showAccountManager([{name:"UserName",value:i.name}])}var u=f.AccountManager.list(!0),i=u[t];t===f.userName()?$(".app-acc-man .app-acc-close").trigger("vclick"):i.refresh_token?(yt(!0),f.switchUser(i,function(){f._navigated=!0;b.location.replace(n.returnUrl()||ne)},r)):r()}function gy(){au._instance.logout();sessionStorage&&(sessionStorage.signedOut=!0)}function gk(t,i){function w(){lg&&l.match(/\blogout\b/)&&(t.push({text:se.LogoutLink,icon:"power",callback:gy}),p=!0)}function b(){l.match(/\blogin\b/)&&v&&!vv()&&(t.length&&t.push({}),t.push({text:e.AddAccount,icon:"material-icon-add",callback:function(){ho?n.showAccountManager():n.showAccountManager(null,!0)}}),y&&t.push({text:e.ManageAccounts,icon:"material-icon-settings",callback:function(){re().remove();n.showAccountManager(null,"switch")}}))}var c=f.userName(),l=o("membership.profile"),v=f.AccountManager.enabled(),s=f.AccountManager.list(!0),y,p,h,a;if(!ho){b();return}if(l.match(/\bview\b/)){var r=s&&s[c],k=r&&r.email,u={text:c,desc:r&&r.Handler||k,user:c,icon:!1,keepOpen:!0,callback:gi};if(t.push(u),i?(u.transition=!0,u.keepOpen=!1,u.callback=function(){var n=[{text:e.Back,callback:be,icon:ui},{}];gk(n);ti(n,"#app-panel-profile-context",{position:"left"})}):(u.selected=!0,u.depth=1,!ag||r&&r.Handler||t.push({text:se.MyAccount,icon:"account",callback:function(){n.show({controller:"MyProfile",startCommand:"Edit",startArgument:"myAccountForm"})}})),i)return;w();t.push({})}if(l.match(/\bswitch\b/)&&v&&s)for(id in s)h=s[id],h.name&&(y=!0,id!=c&&t.push({text:id,context:id,icon:!1,desc:h.Handler||h.email,user:id,status:h.refresh_token?null:e.SignedOut,callback:dy}));b();p||w();a=$.Event("beforeusercontextshow.app");a.items=t;$(document).trigger(a)}function act(n){var t=[];di()&&(n=$(".app-kiosk .app-avatar"));gk(t);t.length&&yr({anchor:n,y:n.offset().top+n.outerHeight(),title:t.length>1?"":f.userName(),items:t})}function np(n,t){var i=ni(n),r=i.length?i.attr("data-for"):null,u=tt(r);return t&&t.dataView||u.dataView}function tp(t,i){function tt(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!==-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}function g(t){n.contextScope(r);ge(r,u,ge(r,u)==t?!1:t);al();n.contextScope(null)}function it(){var n=a===u?"_none_":u;r.pageProp("frozenField",n);r._gridFrozenField=n;r.extension()._reset=!0;wf(r);r.sync()}function rt(){f.alert("hidden")}var v,l;if(tft()&&!i.refresh)return!1;if(v=t.closest(".ui-page"),ot(v)&&!ot()?l=1:li(v)&&!li()&&(l=-1),l!=null){n.pageTransitionCallback=function(){tp(t,i)};history.go(l);return}var r=np(t,i),u=i.field||t.attr("data-field-name"),y=t.offset(),o=r.findField(u),p=r.findFieldUnderAlias(o),k=(ge(r,u)||"").toLowerCase(),h=[],s=[],c,d=o.AllowSorting&&!i.valuesOnly,nt=o.AllowQBE,a=wv(r),w,b;(d&&(s=[{text:bo(o,"asc"),icon:k==="asc"?"check":"false",context:"asc",callback:g},{text:bo(o,"desc"),icon:k==="desc"?"check":"false",context:"desc",callback:g},],s.push({text:e.Group,icon:"material-icon-group-work",callback:function(){fk(r,o.Name)}})),$(r._fields).each(function(){var n=this;n.Hidden||n.GroupBy||n.OnDemand||(w=n.Name,a==="_first_"&&(a=w))}),u===w||i.valuesOnly||(i.hide&&s.push({}),s.push({text:us.Freeze,icon:u===a?"check":null,callback:it})),i.hide&&s.push({text:e.Hide,callback:rt}),nt&&(o.AllowSamples===!1&&(i.samples=!1),c=bh({scopeField:p,samples:i.samples}),d&&c.splice(0,0,{}),i.valuesOnly&&tt(c,i.callback)),s&&(h=h.concat(s)),c&&(h=h.concat(c)),h.length)&&(b={x:i&&i.x||y.left+t.outerWidth()/2,y:i&&i.y||y.top+t.outerHeight(!0)*3/4,y2:i&&i.y2||y.top},yr({items:h,anchor:t,x:b.x,y:b.y,scope:r._id,refresh:i.refresh,afteropen:function(){gtt().length&&r._loadListOfValues(null,p.Name,o.Name,function(){var i=gtt(),n=i.length&&i.data("data-context");n&&r._id===n.context.id&&p.Name===n.context.field&&(n.refresh=!0,setTimeout(tp,0,t,n))})},afterclose:function(){i.afterclose&&i.afterclose()}}))}function gut(n,t,i){var r;$(t).each(function(){var t=this,e=t.text,f,u,o,c,l,v=t.icon,h=v,y=t.itemClassName,a=t.shortcut,p=t.status;e=="$separator"&&(e=null);e?(r=!1,l=v=="check",l&&(h="false"),f=ct().appendTo(n),h||h==!1||(h=i.defaultIcon),o=h||"false",f.attr("data-icon",!1),t.disabled&&f.addClass("ui-disabled"),y&&f.addClass(y),t.callback?(u=vt().appendTo(f).text(e).data("data-context",t),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent")),l&&(bt(t.radio&&!1?"material-icon-radio-button-checked":"material-icon-check",u),f.addClass("app-checked")),t.linkClassName&&u.addClass(t.linkClassName),t.animate&&u.addClass("app-animated app-animation-spin"),t.count&&s("ui-li-count").text(t.count).appendTo(u),t.desc&&dr("app-item-desc").appendTo(dr().appendTo(u)).text(t.desc),t.callback===no&&op&&u.addClass("app-is-link")):t.href?u=vt().appendTo(f).text(e).attr("data-href",t.href):f.text(e).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(f.attr("data-visible","true"),u.addClass("app-selected")),t.selected&&t.depth&&u.addClass("app-item-selected"),o=ko(o),tl(o)&&bt(o,u),c=t.user,c&&lv(c,vs("app-icon-avatar").appendTo(u.addClass("app-avatar")).text(wc(c))),t.depth&&(f.addClass("app-has-depth"),u.addClass("app-depth"+t.depth)),a&&(s("ui-li-count app-hidden").text(a).appendTo(u),s("ui-li-count").text(a).appendTo(u)),p&&s("app-status").appendTo(u).text(p),t.color!=null&&s("app-event").insertBefore(u.contents()).addClass("app-event-color-"+t.color),t.tooltip&&u.attr("title",t.tooltip).addClass("app-btn-tooltip")):r||(r=!0,ct("",'data-role="list-divider"').appendTo(n))});r&&n.find("li").last().remove()}function vct(n){var t=gt(n),i,r;i=document.elementFromPoint(t.x+20,t.y+1);i&&(r=gt(i),n.scrollTop(n.scrollTop()-(t.top-r.top)))}function yr(n){et||i.keyboard(function(){yct(n)})}function yct(t){function ht(){return pot({x:t&&t.x||(l?u.offset().left+u.outerWidth()/2:0),y:Math.round(t&&t.y||(l?u.offset().top+u.outerHeight(!0)*.8:0)),y2:Math.round(t&&t.y2||(l?u.offset().top+u.outerHeight(!0)*.2:0))})}function rt(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}function ut(){t.autoFocus!==!1&&(ir(),h||te());c&&rt(c,a);c=null;a=null;pl(e);lct(e);dk(i)}function ft(){var c=u.offset(),v=r.height,l=r.toolbarHeight,n=c.top-r.top,e=v-(c.top-r.top+u.outerHeight()),a=o?tt*.6:Math.max(n-l*2,e-l*2,50),h=hot(i),p=i.outerHeight()>tt?a:Math.max(a,f.height());o||t.arrow===!1||(!y&&n-w<h?i.popup("option","arrow",b):s.y2&&(n>e&&h>e-w||!y&&h<n-w)&&(s.y=s.y2,i.popup("option","arrow",b)));f.css({minHeight:o?"":null,maxHeight:o?Math.min(r.height*.5,r.height-156):p})}var y=!h,b=h?"b,t,r,l":"t,b,l,r",tt=r.height,st=t.refresh,i=st?$(".app-popup"):p("app-popup app-popup-listview app-popup-icon-left app-no-icons",'data-theme="a"'),u=$(t.anchor),l=u&&u.length,f,e,c,a,d,g=t.items||[],it=u.is(".app-btn-promo"),s,o=kv(),w=o?0:t.tolerance!=null?t.tolerance:5,nt,v;if($(t.items).each(function(){if(this.icon)return hasIcons=!0,i.removeClass("app-no-icons"),!1}),t.refresh){e=i.find(".app-listview").empty();gut(e,g,t);e.listview("refresh");s=i.data("positionOptions");f=i.find(".ui-panel-inner").css({minHeight:"",maxHeight:"",minWidth:"",maxWidth:""});ft();i.popup("reposition",{x:s.x,y:s.y,positionTo:"origin"});return}if(l){if(currentPage=u.closest(".ui-page"),currentPage.length&&!currentPage.is(".ui-page-active")&&!(li()||ot()))return;nt=k(u.closest(".app-echo").attr("data-for"));nt&&bi({field:nt._dataViewFieldName})}vo();vi();ur();l&&(t.x==null&&(t.x=Math.ceil(u.offset().left+(t.xOffset?t.xOffset:u.outerWidth()/2))),t.y==null&&(t.yOffset==="bottom"?t.y=Math.ceil(u.offset().top+(y?u.outerHeight():u.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(u.offset().top+u.outerHeight()*(y?t.y:1-t.y)))));typeof t.x=="number"&&(t.x=Math.ceil(t.x));typeof t.y=="number"&&(t.y=Math.ceil(t.y));t.title&&cr("h1","ui-title").appendTo(p("ui-header ui-bar-a").appendTo(i)).text(t.title);f=p("ui-panel-inner",'tabindex="0"').appendTo(p("ui-content").appendTo(i));e=nr("app-listview").appendTo(f);gut(e,g,t);e.listview().on("vclick",function(n){var r=$(n.target),t=r.closest("a"),u;return r.is("[data-href]")?(u=r.attr("data-href"),u&&fh(u),kt(t,function(){to(i)})):t.length&&!d&&we(t)&&(d=!0,kt(t,function(){c=t.data("data-context");a=t;c.keepOpen?(rt(c,a),eb(a),c=null,a=null,d=!1):to(i)})),!1});et=!0;yu(!1);"arrow"in t||!l||(t.arrow=t.dropDown?"t,b,l,r":b);ds(!0);i.popup({history:!y&&!(li()||ot()),arrow:o?null:t.arrow,tolerance:w,positionTo:t.arrow===!1?"absolute":null,transition:ktt(),afteropen:function(){dut(i);t.afteropen&&t.afteropen(i);vct(f);f.focus();et=!1;yu(!0);o&&(i.css({transform:"translate3d(0,100%,0)"}),setTimeout(function(){i.css({transition:"transform 150ms ease-out"});setTimeout(function(){i.one("endtransition",function(){i.css("transition","")}).css("transform","")})}))},afterclose:function(){vi();et=!1;u&&(!(u.data("data-context")||{}).row||u.is(".app-calendar-selected"))&&u.removeClass("app-selected");t.afterclose&&t.afterclose(i,c);i.data("touchPopup")._currentTransition==="none"?ut():setTimeout(ut,100)},beforeposition:function(){if(wt.width&&f[0].scrollHeight>f.height()){f.css({width:"","overflow-y":""}).parent().width("");var n=e.width();f.css({"overflow-y":"scroll"}).css({width:n+wt.width}).parent().css({width:n,overflow:"hidden"})}}});git(i);g.length||(i.find(".ui-content").hide(),i.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"}));s=o?{x:r.left,y:r.top+r.height-1}:t.arrow===!1?{x:t.x,y:t.y}:ht(!0);l&&(it||t.highlightAnchor===!1||u.is(".app-calendar-selected")||u.addClass("app-selected"),ft());lst(i);v=e.find('li[data-visible="true"]');v.length&&f.offset().top+f.outerHeight()<v.offset().top+v.outerHeight()&&f.scrollTop(v.offset().top-f.offset().top-(f.outerHeight()-v.outerHeight())/2);it&&n.promo().show();o&&i.addClass("app-popup-panel");i.data("position-options",s).popup("open",s);h||$(".ui-popup-screen").css("top",o?0:n._toolbar.height()+1+r.top)}function pct(t){var i=[],r=ot();$(t).closest(".app-bar-buttons").find(".ui-btn:not(.app-btn-more)").filter(function(){return!lr.call(this)}).each(function(){var n=$(this),t=n.html().match(/^(.+?)(<|$)/),r=n.find("i").data("icon");i.push({text:t[1],icon:r,callback:function(){n.trigger("vclick")}})});i.length?(kg(n.dataView())&&(i=i.reverse()),r&&i.push({},{text:fr,icon:"material-icon-more-horiz",callback:n.showContextMenu}),yr({anchor:t,items:i,x:t.offset().left+12,y:t.offset().top+t.outerHeight()/4*3,tolerance:0})):r&&n.showContextMenu()}function wct(n){return{overlayTheme:"b",history:!0,transition:n||"pop",positionTo:"window",afteropen:function(){$(this).attr("tabindex",0).focus();var n=ug;n&&setTimeout(n,200);ug=null},afterclose:function(){ir();var n=vp;n&&setTimeout(n,100);vp=null}}}function nft(n){var t=k(n.id),r=t.findField(n.field),i=n.op;t.removeFromFilter(r);i!="$clear"&&(i.startsWith("$")&&(i+="$"),t._filter.push(n.field+":"+i+(i.match(/\$(true|false)/)?"":t.convertFieldValueToString(r,n.value))));eh(t)}function bct(n){n=n.closest(".app-echo");n.length&&bi({fieldName:k(n.attr("data-for"))._dataViewFieldName,container:g(n)})}function tft(){var n=$(".ui-popup-container");return et||n.length&&!n.is(".ui-popup-hidden")}function kct(t,i){function o(n,i){var e=r.Name+":"+n;n.startsWith("$")&&(e+="$");e+=t.convertFieldValueToString(r,p);tt!==e&&c.push({text:f.filterDef(nt,n).Text+(i?" "+i:""),context:{id:t._id,field:u,op:n,value:p},callback:nft})}function ut(i){var r=n.contextScope();n.contextScope(t);ge(t,u,ge(t,u)==i?!1:i);al();n.contextScope(r)}function ft(n){var i=ni(l),r=l.data("data-context");r&&(oy(t).removeClass("app-selected"),i.length&&bb(i),l.addClass("app-selected"),kc(t,l),t.extension().tap(r,"none"),i.length?lo(t,i):ae(t),n())}function b(){n.invokeInTargetPage(function(){ft(function(){kh(l,et)})})}var k,w;if(tft())return!1;var v=$(i.target),a=v.closest(".app-field"),l,r,u,p,s,y,d,g=e.LookupViewAction,nt,tt,c=[],it,rt,et={x:su(),y:th()};if(a.length||v.find(".app-field").each(function(){var t=$(this),n=gt(t);if(n.left<=ki.x&&ki.x<=n.right&&(t.is("[data-item]")||n.top-8<=ki.y&&ki.y<=n.bottom+8))return a=t,!1}),a.length){if(l=a.closest("a").removeClass("ui-btn-active"),k=l.data("data-context"),w=k&&k.row,!w||t.rowIsTemplate(w)){i.preventDefault();return}u=a.attr("class").match(/app\-field\-(\w+)/);u&&(u=u[1]);u&&(i.preventDefault(),r=t.findField(u),it=r.AllowQBE,rt=r.AllowSorting,y=t.findFieldUnderAlias(r.Name),y.ItemsDataController||(d=new RegExp("\\b"+u+"\\s*=\\s*\\w+"),$(t._fields).each(function(){var n=this;if(n.Copy&&d.exec(n.Copy))return y=n,g=String.format(es.DetailsToolTip,t._allFields[n.AliasIndex].HeaderText),!1})),y.ItemsDataController&&!y.ItemsTargetController&&c.push({text:g,icon:"material-icon-arrow-forward",callback:function(){ft(function(){n.details({field:y})})}}),rt&&(c.length&&c.push({}),c.push({text:bo(r,"asc"),icon:ge(t,u)==="asc"?"check":!1,context:"asc",callback:ut},{text:bo(r,"desc"),icon:ge(t,u)==="desc"?"check":!1,context:"desc",callback:ut})),it&&(c.length&&c.push({}),nt=hu.Filters[r.FilterType].List,p=w[r.Index],$(t._filter).each(function(){var n=this;if(n.startsWith(u+":"))return tt=n,c.push({text:String.format(ef.ClearFilter,r.HeaderText),icon:"material-icon-clear",context:{id:t._id,field:u,op:"$clear"},callback:nft},{}),!0}),p==null?(o("$isempty"),o("$isnotempty")):(s=r.text(p),r.FilterType==="Text"&&(s='"'+s+'"'),r.FilterType==="Text"?(o("=",s),o("<>",s),o("$contains",s),o("$doesnotcontain",s)):r.FilterType==="Boolean"?(o("$true"),o("$false")):(o("=",s),o("<>",s),o("<=",s),o(">=",s),o("<",s),o(">",s)))),c.length?(c.push({},{text:fr,icon:"material-icon-more-horiz",callback:function(){b(a)}}),n.invokeInTargetPage(function(){yr({anchor:a,title:r.HeaderText,items:c,x:su(i.pageX),iconPos:"left"})})):n.invokeInTargetPage(function(){b(a)}))}else{if(v.closest(".app-grid-header").length)return;if(v.closest(".app-presenter").length)return;if(l=v.closest(".ui-btn"),l.length&&!h)n.invokeInTargetPage(function(){b(l)});else if(!h&&v.closest('[data-layout="form"]').length)return}return!1}function ift(t){var i=$(t.target).closest(".ui-btn"),r=i.data("icon"),o,u,e;return i.is(".app-btn-promo")&&(o=i.data("icon-list"),o)?(kt(i,function(){var t=[],f=i.attr("data-icon"),r;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;o.icons.forEach(function(i){i.match(ep)||(r=o.labels[i].split(/\n/),t.push({text:r[0],desc:r[1],icon:i,context:i,callback:function(t){n.executeInContext(t)}}))});u=t[t.length-1];u&&u.callback?u.callback(u.context):(i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(f),yr({anchor:n.promo(),items:t,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(f)}}))}),!1):(e=gi,r==="search"?e=f.search:r==="user"?e=function(){act(i)}:r==="phone"&&wu?n.executeInContext(r):e=r==="apps"?function(){ip(li()||ot()?"left":"right")}:function(){n.executeInContext(r==="check"?"ok":r)},kt(i,e),!1)}function dct(n){var t=document.createElement("a");return t.href=n,t.href}function nd(t,i,r){var f,u;t=ii.path.convertUrlToDataUrl(dct(t));f=c.find("> div[data-url]").filter(function(){return $(this).attr("data-url")===t});r?location.href=t:f.length?(f.appendTo(c),u=tt(f.attr("id")),u?(n.makeModal(u),u.navigateInfo={href:t,transition:i},n.changePage(u.id)):ii.navigate(t,{transition:i})):(yt({progress:!0}),$.ajax({url:t,dataType:"html"}).done(function(r){var u,h,l,a;if(yt({progress:!1}),u=r.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),u||(u=r.match(/<div\s+id\s*=\s*"PageContent".+?>([\s\S]+)?<\/div>\s*<footer /i)),u&&!r.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var f=u[1],e,v=new kf.StringBuilder,y=/<script.+?>([\s\S]+?)<\/script>/ig,p,o,s,w=1;p=y.exec(f);)v.append(p[1]);for(f=f.replace(y,""),f.match(/data-content-framework="bootstrap"/)&&!$('[data-content-framework="bootstrap"]').length&&(h=$("link.app-theme"),l=h.attr("href"),l&&(l.match(/\&_cf=$/)?h.attr("href",l+"bootstrap"):$('<link href="'+ne+'css/sys/bootstrap.css" rel="stylesheet" type="text/css"/>').insertBefore(h))),e=$("<div><\/div>").appendTo(c).hide().attr("data-href",t),e.html(f).data("scripts",v.toString()),s=bw(t);n.pageInfo(s);)s=bw(t)+w++;o={pageId:s,selector:e,transition:i,dynamic:!0};n.build(e,o);a=$("#"+o.pageId).attr("data-url",t);n.pageInfo({id:o.pageId,text:o.pageId,url:t,root:!0,page:a,scrollable:g(a)});e.data("scripts",null).remove();setTimeout(nd,0,t,i)}else location.href=t}).fail(function(){yt({progress:!1})}))}function gct(n){var t=$(n.target);if(t.is(".app-btn-toggle"))return t.addClass("ui-btn-active"),c.focus(),setTimeout(function(){function u(){i.removeClass("app-text-expanded");t.attr("data-title",fo).toggleClass("ui-icon-carat-u ui-icon-carat-d");uf()}t.removeClass("ui-btn-active");var i=t.prev(),r,n;i.is(".app-text-expanded")?(r=i.closest(".dv-item"),r.length?(n=g(t),py(n,r.offset().top-(n.offset().top-n.scrollTop())-n.height()*.33,u)):u()):(i.addClass("app-text-expanded"),t.attr("data-title",ca).toggleClass("ui-icon-carat-u ui-icon-carat-d"))},er),!1}function nlt(n){w.left.visible&&(ir(),arguments.length||(n=!w.left.mini,toggled=!0,o("ui.sidebar.mini",n),ri("minisidebar",n),yt(!0)),w.left.mini=n,c.toggleClass("app-has-minisidebar-left",w.left.mini),rit(),gw(!0),rt&&rt.is(":visible")&&!rt.is(".app-bar-notify-left,.app-bar-notify-center")&&rt.css("left",w.left.width),po(),$(document).trigger("sidebarstatechanged.app"),fi(!1,0,function(){if(w.left.visible){var t=w.left.inner;t.css({transform:"translate3d("+(n?"100":"-66")+"%,0,0)"});setTimeout(function(){t.css({transition:"transform 96ms ease-in-out"});setTimeout(function(){t.css("transform","").one("transitionend",function(){t.css("transition","")});yt(!1)})})}}))}function tlt(){ip(null,!0)}function ip(n,t,i){var r=[],u;t&&(u=ci,r=[{text:e.Back,icon:ui,callback:function(){ci=u;ti(r,"#app-panel-apps")}},{}]);dc()&&!i?ff(r,!0,pr,1):ff(r,!0,t?pr:null,t?1:0,!i);ti(r,"#app-panel-apps"+(t?"-all":""),{position:n||"left"})}function ilt(t){var i=$(t.target);if(!vu)return ow(),ur(i,!1),vi(),i.attr("data-action")==="#app-back"?(n._backText.addClass("ui-btn-active"),kt(i,function(){n._backText.removeClass("ui-btn-active");ou()})):(lf(!0),kt(i,function(){var r=di(),t,i;w.left.visible&&!r?nlt():(t=[{text:ov(),itemClassName:"app-logo"}],i=$("#app-panel-menu-scope.ui-panel-open"),i.length?ps(i):(r?(ff(t,!0),t.push({})):(n._toolbar.find(".app-icon-avatar").parent().is(":visible")||gk(t,!0),t.length&&t.push({}),(!cit()||or.nodesWithIcons.length&&lt("ui.menu.tiles")||!w.left.visible&&o("ui.menu.location")!="toolbar")&&(dc(n.pageInfo())?ff(t,!0,pr,1):ff(t,!0),t.push({}))),lt("settings.enabled")&&t.push({text:e.Settings,icon:"material-icon-settings",transition:!0,callback:wy}),ti(t,"#app-panel-menu",{position:"left"})))})),!1}function rlt(t){var y,e,h,a,p;if(!t.isDefaultPrevented()){var o=$(t.target),i=o.is("a")?o:o.closest("a"),u=i.attr("href")||(i.attr("data-action-path")?"#app-action":""),v=i.attr("data-href"),s=i.attr("data-content-type"),r;if(!u&&v&&s==="image"&&(u=v),!et&&!i.attr("download")){switch(u){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=ou;break;case"#app-details":r=function(){var n=tt(),t;n&&n.dataView&&(t=n.dataView.extension(),t.command(t.commandRow(),"Select"),da=i.attr("data-field-text"),n.dataView._viewDetails(i.attr("data-field-name")))};break;case"#app-refresh":r=function(){var n=tt();n&&n.dataView&&n.dataView.sync()};break;case"#app-clear-filter":r=function(){var n=tt();n&&n.dataView&&ty(n.dataView,!1)};break;case"#app-filter":r=function(){var n=tt();n&&n.dataView&&bh({mode:"everything"})};break;case"#app-action":if(i.is(".app-btn-disabled"))return i.removeClass("ui-btn-active"),!1;r=function(){var r=i.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"],t=i.attr("data-action-path");t==="wizard-next"?setTimeout(function(){ve("next",{container:g()})}):t==="wizard-prev"?setTimeout(ve,0,"prev",{container:g()}):i.is(".app-btn-more")?pct(i):r&&(r[1]==="carat-r"?n.executeInContext(null,i.text(),t):n.executeInContext(r[1],null,t))};break;case"#close-popup":r=function(){$(".app-popup-image").popup("close")};t.preventDefault();break;default:if(u)if(u.match(/^tel/))fh(u),r=gi;else if(i.attr("target"))b.open(u,i.attr("target"));else if(s=i.attr("data-content-type"),s&&s.match(/^image/))r=function(){var t=$("#app-popup-image"),i;if(!t.length){t=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#close-popup" class="ui-btn ui-corner-all ui-shadow ui-btn ui-icon-close-circle ui-btn-icon-notext ui-btn-right"><\/a><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(c).popup(wct("none")).popup("option","history",!0);t.find(".app-image-preview").one("load",function(i){var r=$(i.target);setTimeout(function(){r.width("").height("");var o=t.find(".app-image-preview-box"),s=n.screen(),u=r.width(),e=s.width*.9,i=r.height(),f=s.height*.9;u>e?(i*=e/u,u=e,i>f&&(u*=f/i,i=f)):i>f&&(u*=f/i,i=f);r.hide();o.css({background:"",width:u+"px",height:i+"px"}).show();t.popup("reposition",{positionTo:"window"});o.css({background:String.format("url({0})",r.attr("src")),"background-size":String.format("{0}px {1}px",u,i)});n.notify(hu.BlobDownloadOriginalHint)},100)})}t.find(".app-image-preview-box").attr("data-href",u).hide();i=t.find(".app-image-preview").attr("src","").width(100).height("");f.odp.blob("url",{href:u,original:!0}).done(function(n){i.show().attr("src",n)});vp=function(){dk(t)};t.popup("open")};else if(r=n.openExternalUrl(u,i.is('[rel="external"]')),!r&&!i.closest(".ui-panel-inner").length)if(y=ii.path.parseUrl(u),e=y.hash,e)if(i.closest(".app-content-framework").length){if(o.data("app-click-test"))return;o.data("app-click-test",!0);ii.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);o.data("app-click-test",null);ii.linkBindingEnabled=!0;t.isDefaultPrevented()||(e==="#"?r=function(){py(g(),0)}:(h=e&&e.length>1&&l(e+',a[name="'+e.substring(1)+'"]'),a=g(),r=h&&h.length?function(){p=h.offset().top-(a.offset().top-a.scrollTop());kt(i,function(){py(a,p)})}:function(){$(e).is(".ui-page")&&n.changePage(e.substring(1))}));r&&t.preventDefault()}else e!=="#"&&(r=function(){ii.navigate(e)});else r=function(){nd(u,i.attr("data-transition"),i.attr("rel")=="external")}}if(r&&!yt()){if(lf(!0),i.attr("download")){i.click();return}return kt(i,function(){if(yt(!1),typeof r=="string"){var n=r;r=function(){$(n).trigger("vclick")}}r()}),!1}}}}function rft(t){var u=t.message,e=u!=null?u.toString():"",r=t.cancel,i=$.Deferred();return yt(!1),tr(function(){var t=n.pageInfo(),r=t.dataView;bc(function(){var u,n;t._canceled?i.reject():(u=r&&r.survey(),u&&(n=u._cancel,n===!1&&(n=u._submit),n?n!==gi?n():i.reject():i.resolve()))})}),f.survey({_submit:t.submit,_cancel:r,_promise:i,controller:t.name,questions:[{name:"msg__",value:e,text:!1,readOnly:!0,rows:3,htmlEncode:!e.match(/<\/\w+>/)}],options:{modal:{fitContent:!0,always:!0,max:"xxs",buttons:{more:!1}},contentStub:!1,promo:!1},submit:"alertconfirmed.app",cancel:r!==!1?"alertnotconfirmed.app":r,layout:'<div data-container="panel"><span data-control="field" data-field="msg__" class="app-text-default">[Message]<\/span><\/div>'}),i}function td(n,t,i){$(n).each(function(){var n=this,r=n.url,f=ct().appendTo(t).addClass("app-depth"+i),u,e;r?(u=r.match(iet),u&&(r=u[2],e=u[1]),vt().appendTo(f).data("node",n).attr({href:r,target:e,rel:"external"}).text(n.title)):s().appendTo(f).text(n.title);n.children&&td(n.children,t,i+1)})}function ult(){$("#app-btn-context").on("vclick",function(){var t=$(this);if(!yt()&&!t.data("skipClick"))return kt(t,function(){if(($(".ui-panel-open").attr("id")||"").match(/^app-panel-context/))lf();else{lf(!0);var t="";li()&&r.splitLeft?t="left":ot()&&(t="right");n.showContextMenu({position:t,scope:t?dt():null})}}),!1});$('[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function r(){var n=$('<li><a rel="external"/><\/li>').appendTo(t).find("a");$("#app-welcome").length&&!i?n.attr("href","#app-welcome").text(se.LoginButton):rr.loginStatus(n)}var u=$(this),t=$('<ul data-inset="false" />').appendTo(u),i=rr&&rr.loggedIn();rr&&!i&&r();td(pr,t,1);rr&&i&&r();t.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),u=r.match(/^#/);return we(i)?(kt(i,function(){u?n.changePage(r.substring(1)):no(i.data("node"))}),!1):!1}).filterable({filterPlaceholder:e.FilterSiteMap})})}function wl(n){n==="touch"?(h||f.userVar("mousePtr",null),h=!0,c.removeClass("app-desktop app-show-system-buttons-on-hover").addClass("app-touch")):(c.is(".app-desktop")||f.userVar("mousePtr",!0),h=!1,o("ui.showSystemButtons")!=="Always"&&c.removeClass("app-touch").addClass("app-show-system-buttons-on-hover"),c.addClass("app-desktop"));ro=!1}function flt(){c=$("body");ld&&c.attr("x-ms-format-detection","none");var n=b.matchMedia("(min-resolution: 144dpi), (-webkit-min-device-pixel-ratio: 1.5)");if(n.matches?(ta=144,n=b.matchMedia("(min-resolution: 240dpi), (-webkit-min-device-pixel-ratio: 2.5)"),n.matches&&(screepDPI=240)):(screen.width>1080||screen.height>1080)&&(ta=144),h="ontouchstart"in b,h){if(ra)gr=!0;else if(!gr&&!wu)$(document).on("mousemove touchstart",function(n){pi&&(ki=null,n.type.match(/^touch/)?h||wl("touch"):h&&wl("mouse"))})}else if(b.PointerEvent){h=!1;ro=!0;lft&&(h=!1,ro=!0);$(document).on("pointerdown pointermove",function(n){if(pi){var t=n.originalEvent.pointerType;t==="touch"?(!h||ro)&&wl("touch"):t==="mouse"&&(h||ro)&&wl("mouse")}})}f.userVar("mousePtr")&&(ro=!1)}function elt(){var f=o("ui.iconFonts"),e,n,i,s,u,r=["material-icon","glyphicons","glyphicon","fa","ion"],t;if(f)for(n in f)t=[],e=f[n],r.push(n),s=e.url,s&&t.push("@import url('"+s+"');"),i=e.size,i?u=(24-i)/2:(i=24,u=0),t.push(".app-icon."+n+",.app-icon."+n+":before{font-size:"+i+"px;line-height:24px;"+(u?"margin-left:"+u+"px;":"")+"}"),t.push(".app-page-header .app-icon."+n+",.app-page-header .app-icon."+n+"::before{font-size:40px;line-height:40px;}"),t.push(".app-page-header .app-icon."+n+".app-icon-background,.app-page-header .app-icon."+n+".app-icon-background::before{font-size:240px;line-height:240px;}\n"),nl().text(t.join(""));r=r.join("|");ua=new RegExp("\\b((("+r+")-([\\w-]+?)))(\\s|$|,)","g");fa=new RegExp("^("+r+")-(.+)")}function olt(){var i='<a class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"><\/a>',t=$('<div id="app-bar-toolbar" class="app-bar-toolbar ui-header ui-bar-a ui-header-fixed" data-role="header" data-position="fixed" data-theme="a" class="app-bar-toolbar">'+hf("app-btn-menu-background")+hf("app-back-text")+hf("app-logo")+ce("h1","ui-title")+'<a id="app-btn-menu" class="app-btn-menu ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars ui-btn-left"><\/a><div class="app-btn-cluster-right">'+i+i+i+i+i+'<a id="app-btn-context" class="app-btn-context ui-btn-right ui-link ui-btn ui-icon-dots ui-btn-icon-notext ui-shadow ui-corner-all"><\/a><\/div><\/div>').appendTo(c);$('<div data-role="page" id="Main"><div data-role="content" class="app-content-main"><\/div><\/div>').appendTo(c);vt("ui-btn ui-btn-a ui-btn-icon-notext app-btn-float app-btn-promo").hide().appendTo(c).on("vclick",ift);pt=lt("ui.readingPane.enabled")&&!gp?{enabled:!0,minLeft:o("ui.readingPane.minLeft")||375,minRight:o("ui.readingPane.minRight")||375,minTop:o("ui.readingPane.minTop")||375,minBottom:o("ui.readingPane.minBottom")||375,bkg:o("ui.readingPane.background"),divider:1}:{enabled:!1};fn()?(ru=yc(),bs({isVirtual:ru.width!=null,width:ru.width,height:ru.height,toolbar:t})):bs({isVirtual:!1,toolbar:t});t.find(".app-btn").data("icon","gear").on("vclick",ift);cu&&t.css("visibility","hidden");n._toolbar=t;n._logo=t.find(".app-logo");n._actionButton=$(".app-btn-promo");n._toolbarButtons=t.find(".app-btn");n._title=t.find("h1").addClass("app-hidden");n._menuButton=$("#app-btn-menu");n._backText=t.find(".app-back-text").hide().attr("title",e.Back);n._contextButton=$("#app-btn-context");$("#aspnetForm").hide()}function slt(){c.on("pagecontainerbeforeshow",function(t,i){var f=l(),u=tt(),r=u?u.headerText:n.title();r&&typeof r!="string"&&(r=r[0]);r===!1&&(r="");n.toolbar(r);fot(u);n.pageShow(si());n.unloadPage(i.prevPage,f);sh();n.contextScope(null)}).on("pagecontainerbeforehide",function(){i.ignoreErrors=!1;et=!0;yt(!0)}).on("pagecontainerbeforetransition",function(t,r){var y,s;if(r.toPage&&r.prevPage){var h=$(r.toPage).attr("id"),c=tt(h),a=$(r.prevPage),e=a.attr("id"),v=tt(e),u=v&&v.dataView,o=n.pageTransitionCallback;if(h===e||c&&c.deleted)return!1;if(u&&(dismissAll=u._dismissAll,u._dismissAll=!1,r.options.reverse&&u.editing()))if(y=i.cancel(),s=u.changed("ignore"),y&&s)s&&$(document).trigger($.Event("dataviewignorechanges.app",{dataView:u,changed:u.changed()}));else return activeUrl=a.attr("data-url"),n.pageTransitionCallback=null,setTimeout(function(){rot(e);f.confirm(hu.DiscardChanges).then(function(){u.changed("ignore",!0);o&&ot()&&(o=null);n.pageTransitionCallback=o;setTimeout(ou)}).fail(te)}),t.preventDefault(),!1}vi();n.promo(!1);fb(l());sb(fy())}).on("pagecontainershow",function(){l()&&kit(l())}).on("pagecontainertransition",function(n,t){rtt(t)})}function io(n){var i=n.originalEvent,t=i;return t.pageY==null&&(t=i.touches[0]||i.changedTouches[0]),{x:t.pageX,y:t.pageY}}function dh(){clearTimeout(rd);ns&&(ns.data("touch-start",null),ns=null)}function hlt(n){nh(n);var u=n.type,o=u==="mousedown",h=ut.lastTouchTime||0;if(o&&ai()-h<100)return!1;if((!o||n.which===1)&&!hi&&!it){vo();vi();var f=ki,s=$(this),i=s.attr("data-draggable"),r=ut[i],e=n.originalEvent.pointerType,t=r&&r.options;if(e!=="mouse"||n.which!==3)if(hi={x:f.x,y:f.y,lastX:f.x,lastY:f.y,target:s,type:i,data:null,cancel:!1,mouse:e==="mouse"||u==="mousedown",pointer:!!u.match(/^pointer/),touch:e==="touch"||!!u.match(/^touch/),pen:e==="pen",tooltip:t&&t.tooltip},$(document).trigger($.Event("dragstart.app",{drag:hi})),i!==hi.type&&(i=hi.type,r=ut[i],t=r&&r.options),hi.cancel)hi=null;else{(hi.dir==="all"||t&&t.immediate)&&(n.preventDefault(),t&&t.immediate&&ed(n,!0));$(document).on("pointermove touchmove mousemove",ed).on("pointerup pointercancel touchend touchcancel mouseup",bl);if(n.isDefaultPrevented())return!1}}}function bl(n){var i=n.type,t;if(it&&(i==="pointercancel"||i==="touchcancel")&&it.cancelable===!1){it.cancelable=!1;return}nh(n);it&&(t=it.moved&&(it.originalX!==it.x||it.originalY!==it.y),t&&(it.swipeLeft=it.originalX>it.x,it.swipeRight=it.originalX<it.x,it.swipeUp=it.originalY>it.y,it.swipeDown=it.originalY<it.y,it.swipeHorizontalDistance=Math.abs(it.originalX-it.x),it.swipeVerticalDistance=Math.abs(it.originalY-it.y)),n.type!=="touchcancel"&&(n.type!=="mousemove"||it.moved)||(ut._keepTap=!0),$(document).trigger($.Event(t?"dragend.app":"dragcancel.app",{drag:it})),t||n.type==="taphold"?ut.dragged(!0):it.dir==="all"&&n.type==="touchend"&&(ki={x:it.x,y:it.y},$(document.elementFromPoint(it.x,it.y)).trigger("vclick")),it.target=null,it.data=null,it=null);hi&&(it=hi,hi=null,n.stopPropagation(),n.preventDefault(),bl(n));$(document).off("pointermove mousemove touchmove",ed).off("pointerup pointercancel mouseup touchend touchcancel",bl);i.match(/mouse/)||(ut.lastTouchTime=ai())}function ed(n,t){var e=n.type,s=e==="pointermove",i;if(hi){var i=io(n),u=Math.round(Math.abs(i.x-hi.x)),r=Math.round(Math.abs(i.y-hi.y)),f=hi.dir==="horizontal",o;if(u<10&&r<10&&(it&&(it.moved=!1),!t))return;f&&(o=ut[hi.type],o.canScroll&&!o.canScroll(hi.target,"vertical")&&(r=0));hi.dir==="all"||f&&u>r&&u>(hi.mouse?3:hi.pointer?5:1)&&r<(hi.pointer&&hi.touch?10:9)?(dh(),it=hi,(e==="touchmove"||s)&&(it.cancelable=!1,n.preventDefault()),hi=null,s||yu(!1)):(f&&(u||r)&&dh(),(!f||r>=1)&&bl(n))}it&&(n.preventDefault(),vo(),i=io(n),it.moved||(it.moved=!0,it.originalX=it.x,it.originalY=it.y),(it.x!=i.x||it.y!=i.y)&&(it.lastX=it.x,it.lastY=it.y,it.x=i.x,it.y=i.y,it.dropTarget=e.match(/touch|pointer/)?document.elementFromPoint(i.x,i.y):n.target,$(document).trigger($.Event("dragmove.app",{drag:it}))))}function yu(n){(!h||n)&&(c[0].style.pointerEvents=n?"":"none")}function uft(n){(ot(n)||li(n))&&ei($(".app-reading-pane-"+(ot(n)?"master":"detail")))}function od(n){n?n.find('[data-control="dataview"]').each(function(){var t=$(this).attr("id"),n,i;t&&(n=tt(t.substring(0,t.length-3)),i=ni(n.id),i.is(":visible")&&n.echoId&&!n.dataView._busy()&&hl(n.dataView,i))}):l(".app-echo-toolbar").each(function(){echo=$(this).parent();echo.is(":visible")&&(pageId=echo.attr("data-for"),pageInfo=tt(pageId),pageInfo.echoId&&!pageInfo.dataView._busy()&&hl(pageInfo.dataView,echo))})}function fft(){if(!sd){if(sd=!0,n.promo(!1),(r.splitLeft!=null&&r.toolbarWidthChanged||r.splitLeft==null&&r.physicalWidth!=ls.width())&&vit(),r.toolbarWidthChanged=!1,vi(),kw(),lw().length&&n.promo(!1),!i.keyboard("virtual")){var t=$(".ui-popup");t.is(".app-popup-message,.app-popup-listview")?to(t):t.popup("reposition",{positionTo:"window"})}hr.trigger("resizing.app")}}function rp(n){n||(n=l());var i=n.attr("class").split(/\s+/),r=df.indexOf(le(n.width())),u=[],t;for(r||r++,r===df.length-1&&r--,t=1;t<=r;t++)u.push("app-min-"+df[t]);while(t<i.length)i[t].match(/^app\-min\-/)&&u.indexOf(i[t])===-1?i.splice(t,1):t++;for(t=0;t<u.length;t++)i.indexOf(u[t])===-1&&i.push(u[t]);n.attr("class",i.join(" "))}function pu(t,u){var o,f,h,e,s;et||(ht.detach(),vr(),o=tt(),f=g(u),t&&(sd=!1,gv(),$(".ui-panel-dismiss").height(r.height),h=lw(),e=l(),ei(e),uft(e),h.length&&(ei(h),ot(e)?ei(e):li(e)&&sk(),uh(o?o.dataView:null),vw()),fi(!1,null,function(){wf();ok();uu(f);tf();uf();vf();ht.sync();de()})),vi(),rp(u),uu(f),tit(f),t||de(null,u),uh(),gv(),$(".app-reading-pane-detail:not(.app-hidden)").length&&(r.splitTop&&c.addClass("app-has-reading-pane app-has-reading-pane-bottom").removeClass("app-has-reading-pane-right"),r.splitLeft&&c.addClass("app-has-reading-pane app-has-reading-pane-right").removeClass("app-has-reading-pane-bottom")),w.left.visibile&&w.left.inner.trigger("scroll"),uw(),dc(o,!0),rut(f),o&&ot()&&rut(".app-reading-pane-master"),t?iy(f):setTimeout(iy,0,f),clearTimeout(eg),eg=setTimeout(function(){et||(pf(),n.refreshMenuStrip(),pit(f),ot()&&pit(g(".app-reading-pane-master")))},1e3),clt(f),t&&(od(),vf(),vr(),hr.trigger("resized.app"),i.restoreLastPopup(),at&&at.is(".app-tooltip-message")&&(s=at.data(),s&&s.fieldName&&setTimeout(bi,100,s))))}function kl(n){n==null?tv=!0:n&&!tv?setTimeout(kl,50):tv=n}function vi(){at&&at[0].style.display!=="none"&&at.hide();cs&&(clearTimeout(cs),cs=null)}function dl(n,t,i,u,e){var nt;if(!h||e){var k=i.split(/\n/g),v=r.width,c=r.left,tt;at||(at=p("app-tooltip"),sot()&&at.addClass("app-large"),at.insertBefore(".ui-page:first"),at._outer=at.outerWidth(),at._maxw=d(at,"max-width"));at.css({left:"",top:"",maxWidth:Math.min(at._maxw,v-at._outer)}).text(i);k&&(i.match(/\t/)?(tt=cr("table").appendTo(at.empty()),$(k).each(function(){var n=this.split(/\t/g),t=cr("tr").appendTo(tt);$(n).each(function(){var n=this,i=cr("td").appendTo(t);n.match(/"/)?i.html(n.replace(/"(.+?)"/g,"<b>$1<\/b>")):i.text(n)})})):(at.empty().removeClass("app-tooltip-message"),$(k).each(function(n){var t=f.safeHtml(this);n&&$("<br/>").appendTo(at);t.match(/"/)&&(t=t.replace(/"(.+?)"/g,"<b>$1<\/b>"));s().appendTo(at).html(t)})));at.show();var g=ls.scrollLeft(),it=ls.scrollTop(),l=at.outerWidth(),y=at.outerHeight(),o,a,rt,b=u&&u[0].className,ut;e&&(t+=2);b&&typeof b=="string"&&(nt=u.attr("data-tooltip-location"),b.match(/\bapp-btn-float\b/)?(o=u.offset(),n=u.css("right")!=="auto"?o.left-l-8:o.left+u.outerWidth()+12,t=o.top+u.outerHeight()/2-y/2+1,a=!0):b.match(/\bapp-btn-tooltip\b/)?(o=u.offset(),rt=u.outerWidth(),ut=n,n=o.left+rt+12,n+l>v+c?(n=o.left-12-l,n>=c?a=!0:n=ut):a=!0,a&&(t=o.top+u.outerHeight()/2-y/2+1)):b.match(/\bui-btn\b/)&&u.closest(".app-sidebar").length&&(w.left.mini?(n=w.left.width+6+c,t=u.offset().top+u.outerHeight()/2-y/2+1,a=!0):u.parent().is(".app-bar-toolbar-bottom")&&(nt="above")),nt==="above"&&(o=u.offset(),t=o.top-y-6,n=o.left+u.outerWidth()/2-l/2,n<0&&(n=2),n+l>c+v&&(n=c+v-l-2),a=!0));a||(g+n+l>=g+v+c&&(n=g+v+c-l-2),it+t+y>=it+r.height+r.top&&(t=t-24-y));at.css({left:Math.max(c,a?n:n-5),top:t});e&&(ba=new Date,ba.setSeconds(ba.getSeconds()+10),at.addClass("app-tooltip-message"))}}function clt(n){var i=ft(n);if(i.length){var t=i.offset(),f=i.outerHeight(),r=n.offset(),u=n.height(),e=n.scrollTop();r.top+u<t.top?n.scrollTop(t.top+e-u-(f>u?0:f)):r.top>t.top&&n.scrollTop(t.top+e-r.top)}}function eft(){ft().removeData("keepFocus").trigger("blur")}function ft(n){return n?$(n).find(".app-data-input"):$(".app-data-input")}function oft(n){var t=0,r=n[0].style,i={};return uet.forEach(function(u){var e=r[u.name],f=u.ignore;f&&n.is(f)||(t++,i[u.name]=e)}),t?i:null}function llt(n){var t=[],i,r;for(i in n)r=n[i]||"",r.length&&t.push(i.replace(/([A-Z])/g,"-$1").toLowerCase()+":"+r);return t=t.join(";"),t.length?'style="'+t+'"':null}function alt(n){var f,t,wt,u,p,e,r,k,ct,g,l,tt,it,bt,v,rt,ut,et,ot;if(!i.valid())return!1;if(i.blur(),g=ft(),f=st(n),g.length&&(f.data("hitTest",!0),st(g).data("hitTest")||(g=null),f.removeData("hitTest"),eft()),r=$.Event("getvalue.input.app"),f.trigger(r),r.type="showvalue",r.dataType=f.attr("data-type"),f.trigger(r),r.isDefaultPrevented())return!0;gr&&(i._vkbd=!0);e=r.dataType;var w=r.inputRows,a=r.rtf,nt=r.spellCheck===!1?"false":"",at;a?(t=cr("iframe","app-data-input"),w=w||1):(t=w?cr("textarea","app-data-input").attr("rows",parseInt(w)+1):cr("input","app-data-input").attr("type",r.inputIsPassword?"password":"text"),at=oft(f),at&&t.css(at));h||w||nt==="false"||t.attr("spellcheck","true");p=i.createContainer(ar(f));a||t.appendTo(p);w&&(p.addClass("app-has-textarea"),a&&p.addClass("app-has-rtf"));r.inputMaxLength&&t.attr("maxlength",r.inputMaxLength);u=r.inputAltValue||r.inputValue||"";u==null&&(u=r.inputAltValue,u==null&&(u=r.inputValue),u==null&&(u=""));var vt=u,b=i._buffer,yt={autocapitalize:"off",autocorrect:"off"};if(b!=null&&(u=b.match(/Backspace|Del|Delete/)?"":b),t.val(u).data("original",vt),f.data("original")==null&&f.data("original",vt),a){l=[];tt=t[0];t.appendTo(p);t.on("load",function(){y.handlers(t,!0)});l.push('<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/><meta charset="utf-8">');l.push("<style>b,strong{font-weight:600}body{white-space:pre-line;margin:0;padding:0;overflow:hidden;font-size:"+t.css("font-size"));l.push(";color:"+t.css("color"));l.push(";font-family:"+c.css("font-family"));l.push(';}<\/style><\/head><body contenteditable="true">');l.push(u);l.push("<\/body><\/html>");tt.contentWindow.document.open();tt.contentWindow.document.write(l.join(""));tt.contentWindow.document.close()}if(r.placeholder&&(wt=s("app-data-input-placeholder").insertAfter(t).text(r.placeholder).css("display",u?"none":""),t.data("placeholder",wt)),r.change&&(t.data({change:r.change,last:u}),r.change=null,yt.autocomplete="off",nt="false"),gf(nt)||(yt.spellcheck=nt),a||t.attr(yt),!e){switch(r.inputDataType){case"DateTime":e="datetime";break;case"Date":e="date"}f.attr("data-type",e)}it=f.find(".app-control-inner");switch(e){case"datetime":it.attr("data-smart-value")&&it.data("last-smart-text",it.text()).text(t.val());break;default:e&&h&&(t.attr("type",e),e==="number"&&(u=r.inputValueRaw,u!=null&&(t.val(JSON.stringify(u)),u=u.toString())))}if(k=$.Event("beforefocus.input.app",{inputElement:t}),f.trigger(k),k.inputElement=null,k.isDefaultPrevented())return!1;try{if(ut=su(),et=th(),a&&(v=t.offset(),v.left<=ut&&ut<=v.left+t.outerWidth()&&v.top<=et&&et<v.top+t.outerHeight()&&(bt=y.range("select",{x:ut-v.left,y:et-v.top}))),bt)y.document("focus");else if(a)y.document("focus"),y.range("save"),y.focus();else if(rt=t.focus()[0],rt.setSelectionRange){if(ot=vt||r.placeholder,ot!=null&&ot.length&&f.attr("data-auto-expand")==="true"&&!h){var pt=(i._testPlaceholder||s("app-data-input-placeholder").css("font-style","normal")).text(ot).insertAfter(t),kt=gt(rt),dt=pt[0].scrollWidth+d(p,"padding-left")*2;i._testPlaceholder=pt;dt>kt.width&&ht.expandBy(t,dt-kt.width);pt.detach()}rt.setSelectionRange(b!=null||f.attr("data-select-on-focus")==="false"||h&&o("ui.input.focus.select.whenTouch")!==!0||!h&&!lt("ui.input.focus.select.whenMouse")||r.selectOnFocus===!1?u.length:0,u.length);b&&u.length&&f.data("autoOpen",!0)}i._created=ai();i._removed=0;ct=$.Event("afterfocus.input.app",{inputElement:t});f.trigger(ct);ct.inputElement=null}catch(ni){}return!0}function hd(n){var t=f.host&&f.host.barcode,i=nt.enabled&&t;return i&&n.push({text:"Scan",system:!0,icon:"material-icon-line_weight",rotate:270,toolbar:!0,callback:t||gi}),i}function gl(){return nt.input&&(new Date).getTime()-nt.time<=(h?nt.slowInputSpeed:nt.inputSpeed)}function up(t){var f=arguments.length,e,u,i=nt.queue,r;if(f){if(t.match(nt.ignore)){n.notify({text:t,force:!0});return}if(r=$.Event("barcodebefore.app",{text:t}),hr.trigger(r),r.isDefaultPrevented())if(nt.ready)e=!0;else return;else i.push(r.text)}if(f||!nt.ready||n.busy()||e)clearTimeout(nt.timeout),nt.timeout=setTimeout(up,nt.frequency);else if(i.length){t=i.shift();u=$.Event("barcode.app",{text:t});nt.ready=!1;try{hr.trigger(u);u.isDefaultPrevented()||(nt.ready=!0,n.notify({text:t,force:!0}))}catch(o){nt.ready=!0}i.length&&up()}}function sft(){nt.enabled&&(nt.keysDown={},nt.keyMap=[])}function vlt(){nt.input&&!nt.buffer.length&&(nt.input=!1,nt.waiting=null)}function ylt(n){var i=n.key,r=nt.keyMap,t;nt.enabled&&(t=r.indexOf(i),nt.keysDown[i]=!1,t>=0&&r.splice(t))}function plt(n){var o,v,f,y,s,t=n.key,c=!nt.input&&eu().is(":input"),b=nt.input||h||!c?nt.slowInputSpeed:nt.inputSpeed,r=nt.buffer,e,u,l,a=nt.keyMap,p=nt.keysDown,w;if(nt.enabled&&(!nt.always||t==="Enter"||!ks(n,!1,!1))&&(e=nt.enter,u=e.length-1,a.indexOf(t)===-1&&a.push(t),p[t]=!0,nt.override||!c)){if(o=(new Date).getTime(),v=o-nt.time,!nt.waiting&&!nt.always&&v>b?(r.splice(0),nt.input=!1):a.length===1&&r.length&&!p[r[r.length-1]]&&(nt.input=!0,i._buffer=null,f=eu(),c&&f.is(".app-data-input")&&(i.methods.lookup._preventList(),s=f.data("original"),f.val(s==null?"":s).blur())),nt.time=o,nt.input){if(e[u--]===t){for(l=r.length-1;u>=0&&l>=0&&r[l--]===e[u];)u--;w=u===-1}if(w)return clearTimeout(nt.waiting),nt.waiting=setTimeout(vlt,nt.inventorySpeed),y=r.join(""),sft(),r.splice(0),up(y),!1}return t==null||t.length!==1||n.ctrlKey||n.altKey||n.metaKey||(!di()||nt.always)&&r.push(t),nt.input||nt.always&&t!=null&&t.length===1?!1:void 0}}var f=$app,bf=f.agent,cd="app-transition",ee=navigator.userAgent,fp=navigator.platform,gr=bf.iOS=/iPhone|iPad|iPod/.test(fp)&&ee.indexOf("AppleWebKit")>-1,hft=gr?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d+)_\d+/)[1]):null,wu=bf.android=/Android/i.test(ee),cft=bf.chromeOS=/\bCrOS\b/.test(ee),lft=bf.chrome=/chrom(e|ium)/i.test(ee),na=bf.ie=!!ee.match(/Trident\/7\./),ld=bf.edge=ee.match(/Edge/),aft=bf.safari=/safari/i.test(ee),h,ro,ta=96,gh,ia,ra=bf.mac=fp.match(/Mac/i)!=null,vft=bf.win=fp.match(/Win/i)!=null,kf=Sys,ad=kf.Application,yft=kf.CultureInfo.CurrentCulture,oe=yft.dateTimeFormat,pft=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,wft=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=".+?")/g,bft=/(<(\/*(b).*?>))/g,kft=/" ([.;])/g,ua,fa,dft=/phone|fax/i,gft=/email/i,net=/\burl/i,tet=/^\s*(\w+)(\s+(\w+)\s*)?$/,ea=/\s*(\w+)(\s+(asc|ascending|desc|descending))?\s*(,|$)/gi,ep=/(delete|clear|trash|remove|undo|erase)/,vd=/(autofill(\d+)?-(\w+))-(\w+)/,iet=/^(_\w+):(.+)$/,rr,or,pr,ts,op,nu=Web,au=nu.Membership,kr=f,nc,tc,is,oa,tu=nu.DataViewResources,yd=tu.Views,ret=tu.Menu,hu=tu.Data,sp=hu.Filters,hp=sp.Labels,e=tu.Mobile,pd=tu.Device,wd=hp.And,ic=hp.Clear,sa=hu.NoRecords,rs=e.NoMatches,uo=tu.Pager,cp=tu.ModalPopup,lp=cp.Close,ef=tu.HeaderFilter,of=ef.Loading,ha=ef.EmptyValue,ap=ef.BlankValue,fr=e.More,us=tu.Grid,fs=us.PerformAdvancedSearch,bd=tu.Form,fo=bd.Maximize,ca=bd.Minimize,rc=e.Apply,uc=tu.Actions,kd=tu.Validator,la=kd.Required,es=tu.Lookup,dd=nu.MembershipResources,se=dd&&dd.Bar,gd=uc.Scopes.Grid,eo=e.Themes,sr=e.Import,fc=e.Develop,aa=hu.BooleanDefaultItems[0][1],va=hu.BooleanDefaultItems[1][1],ya=tu.Editor,bu={cache:{},list:[],keyCodes:[]},nt={buffer:[],time:(new Date).getTime(),queue:[],keyMap:[],keysDown:{},ready:!0},y,uet=[{name:"fontWeight"},{name:"color",ignore:".app-null"},{name:"backgroundColor"},{name:"textTransform"},{name:"fontStyle",ignore:".app-null"}],ec=hu.NullValueInForms,ng,tg,ig,rg,ug,vp,ku,oo,fg,oc,pa,eg,sc,og,vu,yp,wa,os,et,sg={},ci,iu,hg={},fet=500,eet=500,df=["tn","xxs","xs","sm","md","lg","xl","xxl"],ss,hs,oet="http://www.w3.org/2000/svg",at,ba,cs,set=500,het,rt,ka=[],cet=0,cg,aet,pp,da,hc,pt,cc,pi,ga={},w,i,wi,bi,b=window,wp=history,cu=b.parent!==b,bp,c,ls=$(b),hr=$(document),r={isVirtual:!1,top:0,left:0,width:0,height:0,physicalWidth:0,physicalHeight:0},ru,ht,n,ii=$.touch,lc=ii.navigate.history,sf=f.htmlEncode,er=34,vet=450,as,wt,lg,so,ag,ho,kp,ac,ki,vg,nv,ut,it,hi,he,yg,dp,tv=!0,gp,iv,ui="material-icon-chevron-left",k=f.findDataView,ri=f.userVar,yet=f.sessionVar,fu=f.pageVar,gf=String.isNullOrEmpty,ne,rv,pg={},du=f.html,ce=du.tag,uv=du.div,hf=du.span,cr=du.$tag,dr=du.$p,p=du.$div,s=du.$span,vt=du.$a,vs=du.$i,ct=du.$li,nr=du.$ul,nb,il,lut,aut,ns,rd,ud,fd,sd;f.clientRect=gt;f.keyCode={backspace:8,tab:9,enter:13,esc:27,space:32,insert:45,"delete":46,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};nb=ai;il=f.storage;hr.on("searchperform.dataview.app",function(t){var h=t.dataView,u=t.survey,a=u.context.field,y=u.context.start,i=h.data(),c=i.QuickFind,v=u.context.id,e,r,s;"QuickFind"in i&&(r=l("li.app-selected").attr("data-text"),r!=null&&(s=c?c.match(/(\"?(\S+)\:)\S*/):null,i.QuickFind=s?'"'+s[2]+":"+r.substring(1):r));e=f.search("parse",{id:v,data:i,field:a,showErrors:!0});e.errors.length?t.preventDefault():(n.pageInfo(h)._canceled=!0,yo(!1),o("ui.transitions.style","none"),tr(function(){yo(!0);f.search("execute",e)}))}).on("searchgenerate.dataview.app",function(n){f.search("generate",{id:n.survey.context.id,survey:n.survey})}).on("searchreset.dataview.app",function(n){return f.confirm(e.ResetSearchConfirm,function(){f.search("reset",{id:n.survey.context.id})}),!1}).on("searchcalculate.dataview.app",function(n){var r=n.rules.trigger(),e,v=n.dataView,w=n.survey,u=v.data(),t,o,i,s,h=u[r],l,a,y,p,c;if(r){if(r.match(/_op$/)){o=r.substring(0,r.length-3);i=u[o];t=v.findField(o);t&&(l=t.ItemsTargetController,y=t.ItemsStyle,t.ItemsStyle=t.lov("static")?t.Extended.itemsStyle:h&&h.match(/^(=|<>|\$in|\$notin)$/)&&t.FilterType==="Text"&&t.Extended.autoComplete!==!1?"AutoComplete":null,t.ItemsTargetController=h==="$in"||h==="$notin"?"_basket":null,a=t.ItemsTargetController!==l,p=t.ItemsStyle!==y,a&&(i=u[o],l?(t.Items=[],i!=null&&(i=f.csv.toArray(i),i.length&&(i=i[0]))):i!=null&&(t.Items=[[i,i]],t.is("lookup-distinct")&&t.Items[0].push(null))),(p||a)&&f.input.execute({values:{name:o,value:i}}));return}s=w.context.id;e=r.match(/^_Match(\d+)_addCondition$/);e&&setTimeout(f.search,0,"addCondition",{id:s,match:parseInt(e[1]),condition:u[r]});e=r.match(/^_Match(\d+)(_filters)?$/);e&&(c=parseInt(e[1]),setTimeout(f.search,0,"changeMatch",{id:s,match:c,type:u["_Match"+c],filters:u["_Match"+c+"_filters"]}));r==="_Match_addGroup"&&setTimeout(f.search,0,"addGroup",{id:s,type:u[r]})}}).on("quickfindshow.dataview.app",function(n){return f.search("toggle",n.survey.context.id),!1}).on("quickfindautocomplete.dataview.app",function(n){var t=n.inputData;f.search("autoComplete",{id:dt().survey().context.id,dataInput:st(t.input),value:t.value,keyboard:t.keyboard})}).on("vclick",".app-bar-history",function(n){var t=$(n.target).closest("li"),i=t.data("text");return i!=null&&(eu().blur(),t.closest("ul").find(".app-selected").removeClass("app-selected"),t.addClass("app-selected"),setTimeout(f.action,er,{path:"form/submit"})),!1}).on("populateexternalfilter.dataview.app",function(n){var t=dt(),r=t.survey(),i;r&&(i=r.context,i&&i.id===r.parent&&(t=k(i.id),t&&(t._externalFilter||"").forEach(function(t){n.externalFilter.push(t)})))});f.search=function(t,i){function st(){return co()===12||r.width<480?"xs":""}function ut(n,t){var i=t._dataView._allFields[t.OriginalIndex].SearchOptions,r={field:t.Name,operator:i?i[0]:"="};n.fields.push(r)}function rt(n){return n.is("search-mode")!=="forbidden"&&!n.OnDemand&&n.AllowQBE!==!1&&n.Type!=="DataView"}function ht(n){var t=u._allFields,i=n.fields,f=n.available,r;i.length||$(u._fields).each(function(){var r=this;if(rt(r)){if(r=t[r.AliasIndex],i.length===3)return!1;ut(n,r)}});r={};i.forEach(function(n){r[n.field]=!0});t.forEach(function(i){var e=i.is("search-mode"),u;(e&&e!=="forbidden"||!e&&!i.Hidden&&rt(i))&&(i=t[i.AliasIndex],u=i.Name,!r[u]&&f.indexOf(u===-1)&&n.available.push(u))})}function b(n,t,i){var r={id:t,type:i||"$matchall",filters:"$showfilters",fields:[],available:[]},f=n?u._allFields[u.findField(n).AliasIndex]:null;return u._allFields.forEach(function(t){var i=t.is("search-mode");(n&&f==t||!n&&(i==="required"||i==="suggested")&&rt(t))&&(t=t._dataView._allFields[t.AliasIndex],ut(r,t))}),n||ht(r),r}function vt(n,t){var r=[],o=1,f,s,e=n["_Match1"],c=u._allFields,h,i;if(t)r.push(b(t,1));else if(e)while(e)f={id:o,type:e,filters:"$showfilters",fields:[],available:[]},h={},c.forEach(function(t){rt(t)&&(t=c[t.AliasIndex],i=t.Name,s=n["_Match"+o+"_"+i+"_op"],s&&!h[i]&&(f.fields.push({field:i,operator:s}),h[i]=!0))}),ht(f),r.push(f),e=n["_Match"+(++o).toString()];else r.push(b(null,1));return r}function yt(){var s=u._allFields,n=i.data,t=i.field,r={id:i.id,data:n,field:t,start:i.start,filter:[],find:n.QuickFind,errors:[]},c=r.filter,e=[],l=[],o,a,h;for(o in n)o.match(/^_match\d+$/i)?e.push(o):l.push(o);return e.length||e.push(""),e.forEach(function(i){var r=new RegExp("^("+(i?i+"_":"")+".+?)_op$"),e=n[i]||"$matchall";i||t||s.forEach(function(t){t=s[t.AliasIndex];var i=t.Name;n[i]!=null&&n[i+"_op"]==null&&(n[i+"_op"]="=")});l.forEach(function(o){var w=o.match(r),l,b,nt=1,h,v,d,g,p,y,k;if(w){for(b=w[0];n[b]!=null;)l=n[b],b=w[0]+(++nt).toString();l&&(d=sw(l),p=w[1],h=n[p],v=n[p+"_v2"],g=i?p.substring(i.length+1):p,y=u.findField(g),!y||t&&s[y.OriginalIndex].Name!=t||d&&h==null&&v==null||(d?(l==="$between"?h==null?(l="<=",h=v):v==null?l=">=":v<h&&(v=[h,h=v][0]):h==null&&(h=v),l==="$in"||l==="$notin"?(h=f.csv.toArray(h.toString()),h.forEach(function(n,t){h[t]=u.convertFieldValueToString(y,n)}),h=h.join("$or$")):(h=u.convertFieldValueToString(y,h),l==="$between"&&(h=h+"$and$"+u.convertFieldValueToString(y,v)))):h="",l.match(/^\$/)&&(l+="$"),a!=i&&(t||(k=e.match(/(match|donotmatch)(all|any)/),k&&c.push("_"+k[1]+"_:$"+k[2]+"$")),a=i),c.push(y.Name+":"+l+h)))}})}),t||(h=dt(),h!=u&&h._allFields.forEach(function(t){if(t.Extended&&t.Extended.required){var i=n[t.Name+"_op"];i&&sw(i)&&n[t.Name]==null&&r.errors.push({field:t.Name,error:la})}})),i.showErrors&&r.errors.length&&bi({fieldName:r.errors[0].field,message:r.errors[0].error}),r}function pt(){var e=i.id,r=i.data,o=i.start,f=i.field,n=i.filter,t;f?(u.removeFromFilter(u._allFields[u.findField(f).AliasIndex]),n.forEach(function(n){u._filter.push(n)}),eh(u)):(i.keepFilter||u.clearFilter(),n=n.length?n:null,u.asearch("filter",n),u.asearch("active",n!=null),"QuickFind"in r?(t=r.QuickFind,t==null&&o?el(e):bot(u,t),oit(u)):eh(u))}function wt(){var t=dt(),r=t.survey().context,e=JSON.parse(r.base),o=r.model,n=o[i.match-1];n.available.splice(n.available.indexOf(i.condition),1);ut(n,u.findField(i.condition));i.survey=e;d(o,t.data());f.survey("refresh",e,function(n){ei();h||n.find('[data-control="label"][data-field="_Match'+i.match+"_"+i.condition+'"]').trigger("vclick")})}function bt(){var t=dt(),r=t.survey().context,u=JSON.parse(r.base),n=r.model;n.push(b(null,n.length+1,i.type));i.survey=u;d(n,t.data());f.survey("refresh",u,function(t){ei();ft(t,n.length)})}function lt(){var n=[],t=u._allFields;return t.forEach(function(t){t.is("search-option-top-values")&&n.push(t)}),n.length||t.forEach(function(i){var r=t[i.AliasIndex];i.ItemsDataController&&n.length<3&&r.Type=="String"&&!(i.AllowAutoComplete==!1||i.AllowMultipleValues==!1)&&n.push(r)}),n}function kt(){var u=dt(),o=u.survey().context,s=JSON.parse(o.base),h=o.model,n=h[i.match-1],r=i.filters,t,e,c;if(n.type=i.type,n.fields.forEach(function(t){var i=u.findField("_Match"+n.id+"_"+t.field);i.Extended&&i.Extended.context&&(i.ContextFields=n.type.match(/any/)?null:i.Extended.context,i._dataView.sessionRemove(gs(i)))}),r&&r!=n.filters){n.filters=r;t=u.data();for(e in t)e.startsWith("_Match"+n.id+"_")&&delete t[e];delete t["_Match"+n.id];r==="$showfilters"?(c=b(),n.fields=c.fields):(n.fields=[],lt().forEach(function(t){n.fields.push({field:t.Name,operator:"$in"})}));i.survey=s;d(h,t);f.survey("refresh",s,function(t){ei();ft(t,n.id)})}}function ft(n,t){h||n.find('[data-field="_Match'+t+'"]').closest("[data-container]").next().find('[data-control="label"]').first().trigger("vclick")}function gt(){var n=dt().survey().context,t=JSON.parse(n.base);i.survey=t;d(n.model=[b(null,1)],{});f.survey("refresh",t,function(n){ei();ft(n,1)})}function d(n,t){var o=i.survey,c=o.context,l=u._allFields,p=lt(),f=c.field,v,a,r=[],s=[],y,h;return t||(t=u.data(f?"filter":"search")),c.base||(c.base=JSON.stringify(o)),n||(n=vt(t,f)),c.model=n,f&&(v=t[f+"_op"],a=t[f],f&&(v==="$in"||v==="$notin")&&u.findField(f).FilterType!=="Text"&&(t[f+"_op"]="=",t[f]=a instanceof Array?a[0]:a)),r.push('<div data-layout="form" data-layout-size="tn">'),r.push('<div data-container="'+(f?"simple":"collapsible")+'" data-wrap="false" data-header-text="none">'),n.forEach(function(n){var i=f?"":"_Match"+n.id,o=n.filters,h;f||(r.push('<div data-container="row" style="padding:1em">'),r.push('<span data-control="field" data-field="'+i+'" data-size="auto" style="font-weight:bold;">[_Match]<\/span>'),p.length&&r.push('<span data-control="field" data-field="'+i+'_filters" data-size="auto" style="text-transform:lowercase">[_Match_Filters]<\/span>'),r.push("<\/div>"),s.push({name:i,required:!0,value:t[i]||n.type,text:!1,placeholder:"add matching group",causesCalculate:!0,items:{list:[{value:"$matchall",text:e.MatchAll},{value:"$matchany",text:e.MatchAny},{value:"$donotmatchall",text:e.DoNotMatchAll},{value:"$donotmatchany",text:e.DoNotMatchAny}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}),p.length&&s.push({name:i+"_filters",required:!0,value:t[i+"_filters"]||n.filters,text:!1,placeholder:"filters",causesCalculate:!0,items:{list:[{value:"$showfilters",text:e.WithSpecifiedFilters},{value:"$showtop5",text:e.WithSelectedValues5},{value:"$showtop10",text:e.WithSelectedValues10}]},options:{lookup:{openOnTap:!0,nullValue:!1}}}));n.fields.forEach(function(e,h){function ft(n,i){var f=0,r,u=i.items.list;return n.List.forEach(function(i){if(i){var e=i.Function,o=w.SearchOptions;e?o&&o.indexOf(e)===-1||(y!=="text"||w.AllowAutoComplete===!1||w.AllowMultipleValues===!1)&&e.match(/^\$(in|notin)$/)||(r&&(u.push({value:"$separator"}),r=!1),et&&["=","<>","$isnotempty","$isempty","$true","$false"].indexOf(e)===-1||(u.push({value:e,text:i.Text}),f++)):i.List&&(d={name:v+"_op2",text:a.HeaderText,value:t[v+"_op2"],items:{list:[]},placeholder:n.Text.toLowerCase(),options:{openOnTap:!0,lookup:{autoCompleteAnywhere:!0,nullValue:!1},clearOnHide:!0},visibleWhen:"$row."+v+'_op=="all-dates-in-period"'},ft(i,d)&&u.push({value:"all-dates-in-period",text:i.Text}))}else r=!0}),f}var a=u.findField(e.field),w=l[a.OriginalIndex],b=a.Name,rt=a.FilterType,y=rt.toLowerCase(),k=sp[rt],v=i?i+"_"+b:b,nt=t[v+"_op"]||e.operator,c={name:v,type:y,text:a.HeaderText,placeholder:k.Kind.toLowerCase(),format:a,value:t[v],extended:{required:l[a.OriginalIndex].is("search-mode")==="required"},visibleWhen:"["+(y==="date"?'"=","<>","<",">","<=",">=","$between","$in","$notin"':'"$isnotempty","$isempty"')+"].indexOf( $row."+v+"_op) "+(y=="date"?"!":"=")+"= -1"},ut,p={name:v+"_op",text:a.HeaderText,required:!0,items:{list:[]},value:nt,causesCalculate:!0,options:{openOnTap:!0,lookup:{autoCompleteAnywhere:!0,nullValue:!1,autoAdvance:"row"}}},d,et=a.lov("static"),tt,g,it;o==="$showfilters"?(r.push('<div data-container="row" style="padding-left:3em">'),r.push(String.format('<span data-control="label" data-field="{0}" data-size="'+(f?"fit":"auto")+'">{1}<\/span>',v,a.HeaderText)),r.push(String.format('<span data-control="field" data-field="{0}_op" data-size="auto" style="text-transform:lowercase">{0}_op<\/span>',v)),y!=="boolean"&&r.push(String.format('<span data-control="field" data-field="{0}" data-size="auto" data-focus="true" data-visibility="f:{0}">[{0}]<\/span>',v)),y==="date"&&r.push(String.format('<span data-control="field" data-field="{0}_op2" data-size="auto" data-focus="true" data-visibility="f:{0}_op2">{0}_op<\/span>',v)),y==="boolean"||a.lov("static")||r.push(String.format('<span data-control="text" data-visibility="f:{0}_v2">{1}<\/span><span data-control="field" data-field="{0}_v2" data-size="auto" data-visibility="f:{0}_v2">[{0}]<\/span>',v,wd)),r.push("<\/div>")):(h||r.push('<div data-container="row" style="padding-left:3em">'),r.push('<span style="display:inline-block;vertical-align:top">'),r.push(String.format('<span data-control="label" data-field="{0}" data-size="auto">{1}<\/span>',v,a.HeaderText)),r.push(String.format('<span data-control="field" data-field="{0}" data-size="auto" data-focus="true" data-visibility="f:{0}">[{0}]<\/span>',v)),r.push("<\/span>"),h===n.fields.length-1&&r.push("<\/div>"));ft(k,p);s.push(p);d&&s.push(d);y==="date"&&(c.options={smartDatesDisabled:!0,clearOnHide:!0});y==="text"&&(tt=w.AllowAutoComplete!==!1,g=nt.match(/^(=|<>|\$in|\$notin)$/)!=null&&tt,c.items={controller:u._controller,view:u._viewId,dataValueField:b,dataTextField:b,style:g?"AutoComplete":null,disabled:!g},c.context=[],n.fields.forEach(function(n){e!=n&&c.context.push(String.format("{1}={0}_{1}",i,n.field))}),c.extended.context=c.context.join(","),tt||(c.extended.autoComplete=!1),n.type.match(/any/)&&(c.context=null),f&&(c.extended.filter=u.get_filter(),c.extended.search=u._combinedFilter([])),c.options={lookup:{distinct:(u._fields[0]!=a||a.is("search-sample-distinct")||!!l[a.OriginalIndex].ItemsStyle)&&!a.is("search-sample-all"),acceptAnyValue:!0,multiple:t[v]instanceof Array||!!nt.match(/\$(in|notin)/),autoCompleteAnywhere:g&&w.AutoCompleteAnywhere===!0},clearOnHide:!0});y==="number"&&(c.options={clearOnHide:!0});y==="boolean"?(p.required=!1,p.options.lookup.autoCompleteAnywhere=!1,p.items.list.splice(0,0,{value:null,text:hu.AnyValue}),p.placeholder=k.Kind.toLowerCase()):(s.push(c),a.lov("static")?(it=a.ItemsStyle,c.extended.itemsStyle=it,c.placeholder=sp.Text.Kind.toLowerCase(),c.items={style:it,list:[]},a.Items.forEach(function(n){c.items.list.push({value:n[0],text:n[1]})}),c.options.lookup={nullValue:!1,openOnTap:!0}):(ut={name:v+"_v2",type:y,text:a.HeaderText,format:a,placeholder:k.Kind.toLowerCase(),visibleWhen:"$row."+v+'_op=="$between"',value:t[v+"_v2"],options:{smartDatesDisabled:!0,clearOnHide:!0}},s.push(ut)));o!=="$showfilters"&&c.items&&c.options&&(c.items.style="CheckBoxList",c.options.lookup={distinct:!0,nullValue:"any",top:parseInt(o.substring(8))})});!f&&n.available.length&&o==="$showfilters"&&(r.push('<div data-container="row" style="padding-left:3em">'),r.push('<span data-control="field" data-field="'+i+'_addCondition" data-size="auto">[_AddCondition]<\/span>'),r.push("<\/div>"),h={name:i+"_addCondition",text:!1,placeholder:us.AddConditionText.toLowerCase(),causesCalculate:!0,items:{list:[]},options:{lookup:{nullValue:!1,openOnTap:!0,autoCompleteAnywhere:!0}}},n.available.forEach(function(n){var t=u.findField(n);t=l[t.AliasIndex];h.items.list.push({value:t.Name,text:t.HeaderText})}),s.push(h))}),f||(r.push('<div data-container="row" style="padding:1em">'),r.push('<span data-control="field" data-field="_Match_addGroup" data-size="auto">[_addGroup]<\/span>'),r.push("<\/div>"),s.push({name:"_Match_addGroup",text:!1,placeholder:e.AddMatchingGroup.toLowerCase(),causesCalculate:!0,items:{list:[{value:"$matchall",text:e.MatchAll},{value:"$matchany",text:e.MatchAny},{value:"$donotmatchall",text:e.DoNotMatchAll},{value:"$donotmatchany",text:e.DoNotMatchAny}]},options:{lookup:{nullValue:!1,openOnTap:!0}}})),r.push("<\/div>"),r.push("<\/div>"),o.questions=s,o.layout=r.join("\r\n"),o.options||(o.options={discardChangesPrompt:!1,modal:{always:!0,max:st(),fitContent:!0,dock:"top",autoGrow:!0},materialIcon:"search"}),f?(o.submitText=rc,y=o.options,y.modal={always:!0,max:"xxs",fitContent:!0,autoGrow:!0},y.materialIcon="filter-list",o.text2="Filter",o.text=u.get_view().Label):(o.text||(o.text=u.get_view().Label,o.text2=e.AdvancedSearch),h=o.buttons,h||(h=o.buttons=[]),h.push({id:"resetSearch",text:us.ResetAdvancedSearch,icon:"material-icon-clear-all",click:"searchreset.dataview.app",key:"Ctrl+R"}),u.get_showQuickFind()!==!1&&h.push({},{id:"showQuickFind",text:e.ShowLess,click:"quickfindshow.dataview.app"})),o}function ni(){var n=i.value||"",rt=/(\"?(\S+)\:)\S*/g,a=rt.exec(n),g,h,t,y,ut,w=n=="",o=w?null:new RegExp(RegExp.escape(n.toString()),"i"),ft=w?null:new RegExp("^"+RegExp.escape(n.toString()),"i"),et=u.viewProp("quickFindHistory")||[],r,b=i.dataInput,ot=b.closest('[data-container="row"]'),c=ot.next(),nt,v=6,st=v,k=[],d=[],ht=i.keyboard,tt=u._allFields,e,it;if(b.closest(".app-bar-search").toggleClass("app-null",w).find("input"),r=[],ht?et.forEach(function(n){(!o||n.toString().match(o))&&r.push(n)}):r=et.splice(w?0:1),n){while(a)g=a[1],k.indexOf(a[2])==-1&&k.push(a[2]),a=rt.exec(n);k.length&&k.forEach(function(n){var t=[],i=n.replace(/\s/g,"").toLowerCase();tt.forEach(function(n){var r=tt[n.AliasIndex],u=r.HeaderText||r.Label||"";n.AllowQBE&&!n.Hidden&&u.replace(/\s/g,"").toLowerCase().startsWith(i)&&(t.push('"'+u+'"'),h||(h=r.Name))});t.length&&d.push('"'+n+':" = '+t.join(", "))});g&&(n=n.substring(g.length),o=n.length?new RegExp(RegExp.escape(n.toString()),"i"):null,ft=n.length?new RegExp("^"+RegExp.escape(n.toString()),"i"):null)}if(r.length<v&&o&&!u.tagged("search-suggestions-none")&&ht){st=r.length;t=u.viewProp("searchData");t||(t={});b.data("scannedDataItems")||(y=$("#"+u._id).find("li.dv-item a"),y.length||(y=$('[data-for="'+u._id+'"]').find("li.dv-item a")),y.each(function(){var i=$(this),n=i.data("data-context");n&&u._fields.forEach(function(i){var r,u,f;i=tt[i.AliasIndex];i.AllowQBE&&i.Type=="String"&&(r||(r=t[i.Name],r||(t[i.Name]=r=[])),u=n.row[i.Index],u!=null&&(f=i.format(u),r.indexOf(f)==-1&&(r.push(f),ut=!0)))})}),ut&&b.data("scannedDataItems",!0),u.viewProp("searchData",t));var l=[],f=[],lt=0;for(e in t)e=="_list"||h&&e!=h||t[e].forEach(function(n){n.match(ft)&&l.indexOf(n)==-1&&l.indexOf('"'+n+'"')==-1&&l.push(n)});if(l.sort(),l.length<v){for(e in t)e=="_list"||h&&e!=h||t[e].forEach(function(n){n.match(o)&&f.indexOf(n)==-1&&f.indexOf('"'+n+'"')==-1&&f.push(n)});f.sort()}for(f=l.concat(f);lt<f.length&&r.length<v;)it=f[lt++],r.indexOf(it)==-1&&r.push(it)}r.length||d.length?(c.is(".app-bar-history")||(c=p("app-bar-history",'data-container="row"').insertAfter(ot)),c.show().empty(),nt=nr().appendTo(c),d.length&&ct("app-hint").text(d.join("; ")).appendTo(nt),$(r).each(function(t){if(t==v)return!1;var i=this,f=t>=st,r=o?i.match(o):null,u=ct().attr("data-text",f?'"'+i+'"':i).appendTo(nt);r?(s().appendTo(u).text(i.substring(0,r.index)),$("<b/>").appendTo(u).text(i.substring(r.index,r.index+n.length)),s().appendTo(u).text(i.substring(r.index+n.length))):u.text(i);vs("app-icon material-icon").appendTo(u).text(f?"search":"history")}),ei()):c.length&&(c.remove(),ei())}var o,it,u,nt,ot,tt,y,a,w;if(t&&typeof t=="string"||(t="show"),u=i?typeof i=="string"?k(i):i._controller?i:k(i.id):n.contextDataView(),!u||!ast(u)){if(t=="mode")return u.asearch("mode");if(t=="toggle"&&(o=f.search("mode",u),o=o=="quickfind"?"advanced":"quickfind",u.asearch("mode",o)),t=="enumerate"){var c=[],v,et=g(l()),at=et.offset();return et.find(".app-echo").each(function(){var t=$(this),n=k(t.attr("data-for")),i=n._totalRowCount,r=t.offset(),u=n.get_view();i!=-1&&r.top>=at.top-1&&r.top<=at.top+et.height()-1&&u&&c.push({text:u.Label,icon:"search",desc:ah(n.extension().instruction(!1)),count:i,callback:function(){wo(n);f.search("show",n)}})}),c.length&&(v=function(){c.length===1?c[0].callback():(c.splice(0,0,{text:fs}),ti(c,"#app-panel-search-menu",{position:"right"}))}),v||(n.navContext(c),$(c).each(function(){var n=this;if(n.icon=="search")return v=function(){n.callback(n.context)},!1})),v&&setTimeout(v),v!=null}if(t==="generate"&&f.survey("show",d()),t==="parse")return yt();(t==="execute"&&(i.filter||(i=search("parse",i)),pt(i)),t==="addCondition"&&wt(),t==="changeMatch"&&kt(),t==="addGroup"&&bt(),t==="reset"&&gt(),t==="autoComplete"&&ni(),t==="show"||t==="toggle")&&(nt=u.get_searchOnStart(),ot=l(),nt&&(u._totalRowCount=0,si()!==u._id?hl(u):fi(!1,0),u._requiresContextRefresh=!0,u.set_searchOnStart(!1)),o=u.asearch("mode"),i||(i={}),tt=n.contextDataView(),y={id:u._id,start:nt,search:!0,field:i.field},tt&&tt!=u&&f.read(tt,"_survey.context.search")&&(n.pageInfo().deleted=!0,y=tt.survey().context,nt=y.start),nt&&(t!=="toggle"&&(it=u.tagged("search-on-start-simple")?"quickfind":"advanced",o!==it&&u.asearch("mode",it),o=it),tr(function(){var t=n.pageInfo(),i=t.dataView.survey(),r=i&&i.context;bc(function(){r&&!t._canceled&&el(r.id)})})),o==="advanced"||i.field?(a={controller:u._controller+"._search",parent:u._id,context:y,dynamic:!1},a.submit="searchperform.dataview.app",a.submitText=fs,a.submitIcon="material-icon-search",a.create="searchgenerate.dataview.app",a.calculate="searchcalculate.dataview.app",a.tryLoad=!y.field,f.survey(a),yl()):(w=u.extension().quickFind(),w===""&&(w=null),tr(function(){f.search("autoComplete",{id:u._id,dataInput:l().find('[data-field="QuickFind"]'),value:w})}),f.survey({parent:u._id,controller:u._id+"-quickfind",context:y,topics:[{questions:[{name:"QuickFind",text:!1,placeholder:String.format(e.QuickFindDescription,u.get_view().Label),value:w}]}],options:{modal:{fitContent:!0,always:!0,max:ot.is(".app-page-modal")&&!ot.is(".app-page-modal-dock")?"":st(),title:!1,tapOut:!0,dock:"top"},actionButtons:!1,discardChangesPrompt:!1,contentStub:!1},layout:'<div class="app-container-search" data-container="simple" data-header-text="none" data-wrap="true"><div data-container="row" class="app-bar-search'+(w==null?" app-null":"")+'" data-density="'+(h?"comfortable":"relaxed")+'"><i class="app-icon material-icon material-icon-search" title="'+fs+'">search<\/i><span data-control="field" data-field="QuickFind" data-notify="quickfindautocomplete.dataview.app">[Query]<\/span><i class="app-icon material-icon material-icon-cancel" title="'+e.ClearText+'">cancel<\/i><i class="app-icon material-icon material-icon-more app-btn-more" title="'+e.ShowMore+'"><\/i><\/div><\/div>',submitText:"Search",submit:"searchperform.dataview.app"})))}};f.import=function(t,i){function a(n){return n.match(/\.(\w+)$/)[1].toLowerCase()}function u(n){var u=f.import.state.queues.errors,o=i.data[n.index-1],r,t;if(!u.length){t=[e.Line,e.Error];for(r in o)t.push(r);u.push(f.csv.toString(t))}t=[n.index+1,n.error];for(r in o)t.push(o[r]);u.push(f.csv.toString(t))}function v(n,t){for(var r,f=i.data,e=t.DataFormatString,u=0;u<Math.min(f.length,100);u++)if(r=f[u],r&&(r=r[n]),r)break;return r&&t.Type.match(/^Date/)&&typeof r=="number"&&(r=e?String.format(e,d(r)):r.toString()),r}function tt(n){for(var r="",t=0,i=10240;t<n.byteLength/i;++t)r+=String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i,t*i+i)));return r+String.fromCharCode.apply(null,new Uint8Array(n.slice(t*i)))}function y(n){var t=n[n.length-1];return t=="Z"?n.length-1>0?y(n.substring(0,n.length-1))+"A":"AA":n.substring(0,n.length-1)+String.fromCharCode(n.charCodeAt(n.length-1)+1)}function p(n){this.message=n}function it(){var n=i.dataView,t=i.view,r=n.get_parentDataView();tr(yl);f.survey({text:n.get_view().Label,text2:uc.Scopes.ActionBar.Import.HeaderText,parent:n._id,context:{id:n._id,controller:n._controller,view:t},controller:"import_from_file",topics:[{description:sr.SelectFile,wrap:!0,questions:[{name:"file",text:!1,type:"blob"}]}],options:{materialIcon:"publish",discardChangesPrompt:!1,modal:{fitContent:!0,max:"xs",always:!0}},submitText:e.Submit,submit:function(n){function r(){h||bi({fieldName:"file"})}var i=n.dataView,t=i.data(),u=i.survey().context;t.file?f.import("supports",{name:t.file[0].name})?tr(function(){f.import("parse",{file:t.file[0],callback:function(n){f.import("map",{data:n,name:t.file[0].name,context:u})}})}):(n.preventDefault(),f.alert(String.format(sr.NotSupported,t.file[0].name),r)):(n.preventDefault(),f.alert(e.Files[h?"Tap":"Drop"],r))}})}function w(){var h,t,l;try{if(h=r.result,a(i.file.name)==="csv")t=$.csv.toObjects(h);else{t=[];var g=tt(h),v=XLSX.read(btoa(g),{type:"base64"}),c=v.Sheets[v.SheetNames[0]],w=c["!ref"],u=w?w.match(/(([A-Z]+)(\d+))\:(([A-Z]+)(\d+))/):null,b,k,n,e,o,s=[],d=[];if(!u)throw new p(sa);if(b=u[2],k=u[5],e=parseInt(u[3]),lastRow=parseInt(u[6]),e<lastRow){for(o=e+1,n=b;n!=k;)s.push(n),n=y(n);for(s.push(n),s.forEach(function(n){var t=c[n+e];d.push(t?t.v:null)});o<=lastRow;)l={},t.push(l),s.forEach(function(n,t){var i=c[n+o],r=d[t];r&&(l[r]=i?i.v:null)}),o++}}if(t.length)yt(!1),i.callback&&i.callback(t);else throw new p(sa);}catch(nt){yt(!1);f.alert(nt.message)}}function b(t){function tt(n,t){var i=g[n.Name];i.value=t;i.items.list.push({value:t,text:t});r.splice(r.indexOf(t),1)}function it(n,t){return n.toLowerCase().indexOf(t.toLowerCase())!==-1}var u=i.context,c,l,e;if(!arguments.length){f.execute({controller:u.controller,view:u.view||"createForm1",requiresData:!1,success:function(n){b(n)}});return}var s=k(u.id),p=(s._filterFields||"").split(","),w=t.fields,h=[],r=[],a,o=[],d=s.get_view().Label,y=[],g={};for(a in i.data[0])h.push(a.toLowerCase()),r.push(a);if(u.importColumns=r.slice(0),w.forEach(function(n){var e=n;if(n=w[n.AliasIndex],!e.Hidden&&!n.OnDemand&&!e.ReadOnly&&e.Type!=="DataView"){var i=n.Name,l=n.HeaderText,t={name:i,text:l,causesCalculate:!0,items:{style:"DropDownList",list:[{value:null,text:sr.NotMatched}]},value:null,columns:30,placeholder:sr.NotMatched,required:!n.AllowNulls&&!n.HasDefaultValue},f=h.indexOf(l.toLowerCase()),a=p.indexOf(e.Name);if(a!==-1){if(a>0)return;delete t.items;var b=s.context(),c=b.headerField(),v=s.context("data");t.value=c?c.format(v[c.Name]):ec;t.readOnly=!0;u.masterKey=[];p.forEach(function(n){u.masterKey.push({field:n,newValue:v[n],modified:!0})})}else f===-1&&(f=h.indexOf(i.toLowerCase())),f===-1?o.push(n):(i=r[f],t.value=i,t.items.list.push({value:i,text:i}),h.splice(f,1),r.splice(f,1));y.push(t);g[t.name]=t}}),o.length){for(c=0;c<r.length;)e=r[c],l=null,$(o).each(function(n){var t=this;if(it(t.HeaderText,e)||it(t.Name,e))return l=t,o.splice(n,1),!1}),l?tt(l,e):c++;o.length&&o.forEach(function(n){e=null;$(r).each(function(){var t=this;if(t.indexOf(n.HeaderText)!==-1||t.indexOf(n.Name)!==-1)return e=t.toString(),!1});e&&tt(n,e)})}y.forEach(function(n){r.forEach(function(t){n.items&&n.items.list.push({value:t,text:t})});var i=n.value,u;i&&(u=t.map[n.name],n.footer=v(i,u))});u.availableColumns=r;u.metadata=t;f.survey({controller:"import_map",text:d,text2:uc.Scopes.ActionBar.Import.HeaderText,description:String.format(sr.FileStats,i.data.length,i.name),questions:y,options:{modal:{max:"xs",fitContent:!0,always:!0},materialIcon:"settings_input_component"},context:u,submit:function(t){var r=t.dataView,u,e;i.fieldMap=r.data();for(u in i.fieldMap)e=r.findField(u),(!e||e.ReadOnly)&&delete i.fieldMap[u];r.discard();tr(function(){tr(function(){var t=n.pageInfo();bc(function(){t._canceled||t.dataView.survey().cancel()});nt("init")});f.survey({controller:"import_status",options:{modal:{max:"xxs",fitContent:!0,always:!0,buttons:{more:!1,fullscreen:!1}},contentStub:!1},questions:[],layout:String.format('<div style="padding:1em"><div>{0} <b>{1}<\/b> {2} <b>{3}<\/b>...<\/div><div class="app-import-status">&nbsp;<br/>&nbsp;<br/>&nbsp;<br/>&nbsp;<\/div><\/div>',sr.Importing,i.name,sr.Into,d),submit:!1,cancel:function(){f.import.state=null}})})},submitText:sr.StartImport,calculate:function(n){var i=n.dataView,e=i._fields,o=i.survey(),s=o.context,r=s.importColumns.slice(0),u=i.data();e.forEach(function(n){if(!n.ReadOnly){var i=u[n.Name],e=n.FooterText;i!=null?(r.splice(r.indexOf(i),1),n.FooterText=v(i,t.map[n.Name])):n.FooterText=null;e!==n.FooterText&&setTimeout(f.input.execute,0,{values:{name:n.Name,value:u[n.Name]}})}});e.forEach(function(n){if(!n.ReadOnly){var t=n.Items,i=u[n.Name];n.ItemCache=null;t.splice(1);i!=null&&t.push([i,i]);r.forEach(function(n){t.push([n,n])})}})}})}function d(n){var u=Math.floor(n-25569),f=u*86400,i=new Date(f*1e3),e=n-Math.floor(n)+1e-7,t=Math.floor(86400*e),r=t%60;t-=r;var o=Math.floor(t/3600),s=Math.floor(t/60)%60,h=String.format("{0:d4}-{1:d2}-{2:d2}T{3:d2}:{4:d2}:{5:d2}.000Z",i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),o,s,r);return Date.fromUTCString(h)}function g(n){var t=f.import.state;t.busy=!1;t.mode="error";t.error=n.get_message()}function nt(){function ri(){var n,i;for(ci.forEach(function(n){var u=r.lookup[n._ilc.lookupIndex],i=t.lookupCache[n._ilc.entryKey][n.filter[0].value];i.v!=null&&(u.values[n._ilc.valueIndex].newValue=i.v)}),n=wi;n<=li;n++)i=r.lookup[n],i.error?u(i):r.submit.push(i)}var t=f.import.state,y,ht,ut,lt,kt,dt,gt,a,w,ot,rt,ni,ti,ii,vi;if(arguments[0]==="init"){f.import.state=t=i;var ui=t.context.metadata,yi=t.fields={},fi=t.fieldMap,ut=t.columnMap={};for(y in fi)ht=fi[y],ht&&(ut[ht]=y);t.duplicate={test:[],accept:[]};ui.fields.forEach(function(n){yi[n.Name]=n;var i=n.Tag;i&&(i.match(/\bimport-duplicate-test\b/)&&t.duplicate.test.push(ui.fields[n.AliasIndex]),i.match(/\bimport-duplicate-accept\b/)&&t.duplicate.accept.push(n.Name))});t.status=l(".app-import-status");t.dataView=k(t.context.id);t.index=0;t.count=0;t.lookupCache={};t.queues={lookup:[],nextLookup:0,test:[],submit:[],errors:[]};t.started=ai();t.mode="scan"}else if(t){var r=t.queues,pi=ai(),p=t.data,ct=t.context.controller,ei=t.context.view;if(t.mode==="scan"){if(ut=t.columnMap,p.length)while(t.index<p.length){lt=p[t.index++];var tt=[],y,s,it,o,v,h=[],at,ft=[],vt=[],oi=t.duplicate.test;for(y in ut)if(o=lt[y],s=t.fields[ut[y]],s&&i.fieldMap[s.Name]===y)if(it=s.Name,v=s.OriginalIndex!==s.Index?t.fields[t.context.metadata.fields[s.OriginalIndex].Name]:null,o==null)v&&(s=v),tt.push({field:s.Name,newValue:o,modified:!0}),oi.indexOf(s)!==-1&&ft.push(it+": "+la);else{if(v)if(it=v.Name,o==="")o=null;else{var si=v.ItemsDataController,hi=v.ItemsDataView,yt=v.ItemsDataTextField,pt=v.ItemsDataValueField,wt=si+"_"+hi+"_"+pt+"_"+yt,et=t.lookupCache[wt],b,bt;et||(et=t.lookupCache[wt]={});b=et[o];b&&b.v!=null?o=b.v:pt&&(at={controller:si,view:hi,filter:[{field:yt,value:o}]},at.fieldFilter=[pt,yt],bt={valueIndex:tt.length,args:at,entryKey:wt},h.push(bt),b?bt.resolve=!0:b=et[o]={v:null},o=null)}else o===""?o=null:typeof o=="number"&&s.Type.match(/^Date/)?o=d(o):typeof o=="string"&&o&&s.Type!=="String"&&(kt={NewValue:o},dt=t.dataView._validateFieldValueFormat(t.fields[it],kt),dt?ft.push(s.HeaderText+": "+dt):(o=kt.NewValue,typeof o=="number"&&s.Type.match(/^Date/)&&(o=new Date(o))));tt.push({field:it,newValue:o,modified:!0});oi.indexOf(s)!==-1&&vt.push({field:s.Name,value:lt[y]})}if(gt=t.context.masterKey,a={index:t.index,type:"submit",command:"Insert",values:tt},gt&&gt.forEach(function(n){tt.push(n)}),ft.length?(a.error=ft.join("\n"),u(a)):vt.length?(h.length&&(a.requests=h),a.filter=vt,r.test.push(a)):h.length?(a.type="lookup",a.requests=h,r.lookup.push(a)):r.submit.push(a),ai()-pi>8)break}t.mode="send"}else if(t.mode==="send"){if(!t.busy){if(r.submit.length)t.busy=!0,w=[],ot=0,$(r.submit).each(function(n){if(n>=c)return!1;for(var t=this,u=[],r,f,i=0;i<t.values.length;i++)r=t.values[i],r&&(u.push(r),r.newValue!=null&&(f=!0));f?w.push({command:t.command,controller:ct,view:ei,values:u,_src:t}):ot++}),r.submit.splice(0,w.length+ot),t.count+=ot,w.length?(t.message=sr.InsertingRecords,f.execute({batch:w,done:function(n){var t=f.import.state;t.busy=!1;t.count+=w.length;w.forEach(function(t,i){var r=n[i];r.errors.length&&(t._src.error=r.errors.join("\n"),u(t._src))})},fail:g})):t.busy=!1;else if(r.test.length)t.busy=!0,t.message=sr.TestingRecords,rt=[],ni=t.duplicate.accept,$(r.test).each(function(n){if(n>=c)return!1;var t=this;rt.push({controller:ct,view:ei,filter:t.filter,requiresRowCount:!1,fieldFilter:["_pk_only"],_trc:t})}),r.test.splice(0,rt.length),f.execute({batch:rt,done:function(n){var t=f.import.state;t.busy=!1;n.forEach(function(n,t){var e=n[ct],i=rt[t]._trc,o,h,c,f,s,l;if(e.length){if(ni.length)if(e.length===1){if(i.command="Update",o=i.values,c=0,o.forEach(function(n,t){ni.indexOf(n.field)===-1?o[t]=null:c++}),c){f=i.requests;for(h in e[0])o.push({field:h,oldValue:e[0][h],modified:!1});if(f)for(s=0;s<f.length;)l=f[s],l.resolve=!1,o[l.valueIndex]?s++:f.splice(s,1);f&&f.length?r.lookup.push(i):r.submit.push(i)}}else i.error=sr.Duplicates+": "+e.length,u(i)}else i.requests?(i.requests.forEach(function(n){n.resolve=!1}),r.lookup.push(i)):r.submit.push(i)})}});else if(r.nextLookup<r.lookup.length){t.busy=!0;h=[];for(var ci=[],wi=r.nextLookup,li,st,bi=10;bi-->0;)if(st=r.nextLookup++,r.lookup[st].requests.forEach(function(n){n.args._ilc={lookupIndex:st,valueIndex:n.valueIndex,entryKey:n.entryKey};n.resolve?ci.push(n.args):h.push(n.args)}),st===r.lookup.length-1)break;li=r.nextLookup-1;t.message=sr.ResolvingReferences;h.length?f.execute({batch:h,done:function(n){var t=f.import.state,i=t.queues;t.busy=!1;n.forEach(function(n,r){var u=h[r],f=n[u.controller],s=u._ilc.lookupIndex,o=i.lookup[s],c=t.lookupCache[u._ilc.entryKey][u.filter[0].value];f&&f.length?c.v=o.values[u._ilc.valueIndex].newValue=f[0][n.primaryKey[0].Name]:o.error=String.format('{0}: {1} = "{2}"',e.DidNotMatch,n.map[u.filter[0].field].Label,u.filter[0].value)});ri()},fail:g}):(t.busy=!1,ri())}else r.test.length&&(t.mode="done");t.index<p.length?t.mode="scan":!r.submit.length&&r.nextLookup>=r.lookup.length&&!r.test.length&&!t.busy&&(t.mode="done")}}else t.mode==="error"&&(message=t.error);ti=ai();ii=new Date(ai()-t.started);t.status.html(String.format("{0:N1}% {1}<br/>{2}...<br/>{3}: {4}<br/>{5}: {6}",t.count/p.length*100,sr.Complete,t.message||sr.TestingRecords,sr.Expected,ii<6e4?e.Dates.InAMin:pb(new Date(ti+Math.round(ii/(t.count||1)*(p.length-t.count))),new Date(ti)),sr.Remaining,p.length-t.count));t.mode==="done"&&(n.pageInfo()._canceled=!0,vi=t.dataView,ou(function(){r.errors.length&&wb("errors_"+i.name+".csv",r.errors.join("\r\n"));setTimeout(function(){f.alert(String.format("{0} <b>{1}<\/b> {2} <b>{3}<\/b>.",sr.Done,i.name,sr.Into,vi.get_view().Label),function(){el(i.context.id)})})}),t=null)}t&&t.mode!=="error"&&requestAnimationFrame(nt)}var c=o("import.batchSize")||10,r,s;if(t==="upload")it();else{if(t==="supports")return extension=i.name.match(/\.(\w+)$/),extension&&!!extension[1].match(/^(csv|xlsx|xls)/i);t==="parse"?(yt(!0),$(".app-glass-pane").addClass("app-glass-pane-reject"),r=new FileReader,s=i.file,a(s.name)==="csv"?r.readAsText(s):r.readAsArrayBuffer(s),r.onload=function(){try{$.csv?w():$.getScript(ne+"js/lib/import.min.js",w)}catch(n){yt(!1);f.alert(n.message)}},r.onerror=function(n){yt(!1);f.alert(n.message)}):t==="map"&&b()}};$(document).on("vclick",".app-bar-actions h3,.app-echo-toolbar h3",function(t){var e=$(this).closest(".app-echo"),u=e.length?e.attr("data-for"):tt().id,i=$(t.target).closest("h3"),o=i.offset(),f=[],s=n.contextScope(),r;return i.addClass("app-selected"),n.contextScope(u),sut(f,!1,!0),r=$.Event("viewselector.dataview.app"),r.items=f,r.dataView=k(u),wo(u),$(document).trigger(r),n.contextScope(s),yr({anchor:i,items:f,iconPos:"left",dropDown:!h,y:o.top+i.outerHeight(!0)/4*3,y2:o.top}),!1}).on("vclick",".app-bar-actions .ui-btn, .app-echo-toolbar .ui-btn",function(n,t){function e(){vr();var t=r.context&&r.context.group,e=[],n=tt(o).dataView;bct(u);t?(go(t.Id,n,e,n.commandRow()),yr({items:e,iconPos:"left",defaultIcon:"carat-r",scope:n._id,anchor:i,y:f.top+i.outerHeight(!0)/4*3,y2:f.top,dropDown:!h})):r.callback(r.context)}if(!vu){var u=$(this).closest(".app-echo"),o=u.length?u.attr("data-for"):tt().id,i=$(n.target).closest("a"),f=i.offset(),r=i.data("data-context");if(r)return i.length&&!yt()&&(wo(i,!1),vr(!1),t!==!1?kt(i,e):setTimeout(e)),!1}}).on("vclick",".app-bar-actions",function(){ir()});$(document).on("vclick taphold",".app-echo-inner",function(t){var i=$(t.target),r=i.closest("a"),o=ni(i),y=o.attr("data-for"),p,u,f,h,e,c=t.type,l=c!=="taphold"&&!t.ctrlKey,a=i.closest(".dv-action-see-all").length,v,s;if((!i.closest(".app-presenter").length||a)&&!i.is(".app-hscrollbar2")){if(yp){yp=!1;return}if(wo(o,!1),(a||t.force||r.length&&!r.is(".app-divider")&&we(i,c))&&!yt())if(a)yrt(t);else{if(i.is("[data-href]"))return;if(n.contextScope(y),p=tt(y),u=p.dataView,f=u.extension(),e=r.data("data-context"),v=r.is(".app-selected"),u._hasKey()){if(rrt(t,u))return!1;h=u.get_showMultipleSelection();l&&h&&hb(t)?yb(u,r,"none"):(bb(o),l?r.addClass("app-selected"):v?r.removeClass("app-selected"):r.addClass("app-selected"),oy(u).removeClass("app-selected"),l?(h&&r.find(".app-btn-check").addClass("app-btn-check-selected"),s=urt(t),kc(u,r,s?"none":null)?s&&kh(cb(i)):s?(f.tap(e,"none"),kh(cb(i))):f.tap(e)):(v?f.clearSelection():f.tap(e,"none"),c==="taphold"&&(yp=!0)),kt(i));lo(u,o)}else n.infoView(u,!0,e.row);return n.contextScope(null),!1}if(!i.closest(".app-grid-header").length)return!1}}).on("vclick",".app-echo-footer",function(n){var t=$(n.target),i=t.closest(".dv-action-see-all");return i.length&&yrt(n),!1}).on("vclick",".app-echo-instruction, .app-echo-toolbar",function(n){n.isDefaultPrevented()||wo($(n.target))});lut={plus:"add",edit:"edit",trash:"delete",duplicate:"content-copy",search:"search",phone:"phone",email:"email",power:"power-settings-new",user:"account-circle",account:"perm-identity",refresh:"refresh",apps:"apps"};aut={Delete:"delete",New:"add",Edit:"edit",Cancel:"undo",Duplicate:"content-copy",Select:"arrow-forward",ExportCsv:"get-app",ExportRowset:"grid-on",ExportRss:"rss-feed",ReportAsPdf:"picture-as-pdf",ReportAsImage:"collections",ReportAsExcel:"filter-none",ReportAsWord:"library-books",Search:"search",BatchEdit:"done-all",Upload:"publish",Import:"publish"};f.iyf28=function(n,t){var i=il.get(n);i||(i=il.get(t),i?il.set(t,null):i=nb(),il.set(n,i));((nb()-i)/864e5>14?sct:gi)()};typeof Web=="undefined"&&(Web={DataView:{}});nc=kr.MobileBase=function(){nc.initializeBase(this)};nc.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},notify:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().inserting()},editing:function(){return this.dataView().editing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){var i=this,r,t;return arguments.length?n?(r=i._commandRow=n.slice(0),t=i.dataView(),t._rows=[r.slice(0)],t.get_isForm()||(t._editRow=null,t._originalRow=null),r):n:i._commandRow},command:function(n,t,i,r,u){var e=this,f=e.dataView(),o=0,s=f._keyFields,h;n&&!n.length&&(s.length&&s[0].Name in n?(h=n,n=[],$(f._allFields).each(function(){n.push(h[this.Name])})):(n=null,o=null));e.commandRow(n);f.executeRowCommand(n?o:null,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView().a;arguments.length===1?(a=arguments[0],this.executeRowCommand(0,a.CommandName,a.CommandArgument,a.CausesValidation,a.Path)):e.executeAction(0,t,i,r,u,f)},itemMap:function(n){return uct(this.dataView(),n)},stateChanged:function(){fi()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!==!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(yd.DefaultDescriptions[n],!0,n):"",n?n.replace(/\n/g,ce("p")):null},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u===n&&(t==null||i.argument===t))return f=i,r||yf(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=ao(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new kf.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(wft,"").replace(bft,'"').replace(kft,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(us.Aggregates[nu.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},_disposeSession:function(){var u=this.dataView(),i=u._pageSession,t,r;if(i){for(r in i)t=i[r],t&&typeof t=="object"&&(t.length===1&&t[0]&&t[0].tagName==="STYLE"&&!t.attr("id")&&(n.elementsToDelete?n.elementsToDelete.push(t):t.remove()),delete i[r]);delete u._pageSession}},focus:function(n,t){var u=this,i=u._dataView,r=l('[data-input-container="'+i._id+'"]');r.length&&(i._inlineEditor&&ht.showField(i,n,r),bi({container:r,fieldName:n,message:t}))}};oa=kr.Extensions={};kr.prototype.asearch=function(){var n=this,r=arguments[0],t,i;if(arguments.length===2)r==="active"?(t=n._useAdvancedSearch=arguments[1]===!0,n.viewProp("useAdvancedSearch",t)):r==="mode"?(t=n._searchMode=arguments[1],n.viewProp("searchMode",t)):r==="filter"&&(i=arguments[1],i===!0?n._advancedFilter=null:i===!1?n._advancedFilter="":(n._advancedFilter=i==null?"":i,n.viewProp("advancedSearchFilter",i)));else{if(r==="active")return t=n._useAdvancedSearch,t==null&&(t=n._useAdvancedSearch=n.viewProp("useAdvancedSearch")||!1),t;if(r==="mode")return t=n._searchMode,t||(t=n._searchMode=n.viewProp("searchMode")||"quickfind"),t;if(r==="filter")return i=n._advancedFilter,i==null&&(i=n._advancedFilter=n.viewProp("advancedSearchFilter")||[]),i}};kr.prototype.pageProp=function(n,t){var i=this;if(n=i._id+"_"+n,arguments.length===1)return fu(n);fu(n,t)};kr.prototype.viewProp=function(n,t){var i=this,r=arguments.length===1,u={sortExpression:"sort",groupExpression:"group",filter:"filter",advancedSearchFilter:"search"}[n];if(n=(i._viewId||"grid1")+"_"+n,u&&yg.indexOf(u)===-1){if(r)return i.session(n);i.session(n,t)}else{if(r)return i.pageProp(n);i.pageProp(n,t)}};kr.prototype.sessionShared=function(n,t){var i=this,u=i._viewId,r;return i._viewId="__shared",arguments.length===1?r=i.session(n):i.session(n,t),i._viewId=u,r};kr.prototype.mobileUpdated=function(){var t=this,e,o,s,i,c;t.tagged("history-search-none")&&fu(t._id+"_*",{viewTabs:null,viewId:null,filter:null,advancedSearchFilter:null,quickFind:null});t._startPage||t.get_useCase()||t.get_lastCommandName()||(e=t.pageProp("viewId"),e&&(t._viewId=e),o=t.viewProp("sortExpression"),s=t.viewProp("groupExpression"),i=t.viewProp("filter"),c=t.get_master(),c&&c.inserting()&&(i=null,ao(t).length&&(t._useAdvancedSearch=!1)),o&&(t._sortExpression=o),s&&(t._groupExpression=s),i&&i.length&&(t._filter=(t._filter||[]).concat(i)));var l=$(t._element),r=nut(l,document.title),a=f.eval(l.attr("data-page-header")),u=tt(t._id);u||(u={id:t._id,text:a||r.text,headerText:a||r.text,dataView:t,activator:r},tt(u));t._pageSize=ee.match(/iPad;.*CPU.*OS \d_\d/i)||!h?30:30;n._appLoaded||t._hidden||t._filterSource||vt("app-action-navigate").attr("href","#"+u.id).appendTo(ct().appendTo(n.pageMenu())).text(r.text);$(t._element).remove();t._element=null};kr.prototype.gridSettings=function(n){var t=this,i,r;if(arguments.length){if(n){for(i in n.width);for(r in n.hidden);n.sequence.length||i||r||(n=null)}t.viewProp("gridSettings",n)}else return n=t.viewProp("gridSettings"),n||(n={sequence:[],width:{},hidden:{}}),n};kr.prototype.gridChanged=function(){var n=this;wf(n);ll(n);nf();tf();ye(n);uu();de();ht.sync()};oa.Grid=function(n){return new is(n)};oa.DataSheet=function(n){return new is(n)};is=kr.MobileGrid=function(n){is.initializeBase(this);this.dataView(n)};is.prototype={initialize:function(){var n=this,t=n.dataView().pageProp("viewStyle");t||(n.tagged("view-style-map")&&!n.tagged("view-style-map-disabled")?t="Map":n.tagged("view-style-cards")&&!n.tagged("view-style-cards-disabled")?t="Cards":n.tagged("view-style-list")&&!n.tagged("view-style-list-disabled")?t="List":n.tagged("view-style-grid")&&!n.tagged("view-style-grid-disabled")?t="Grid":n.tagged("view-style-charts")&&!n.tagged("view-style-charts-disabled")?t="Charts":n.tagged("view-style-calendar")&&!n.tagged("view-style-calendar-disabled")?t="calendar":(t="Grid",$(n._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle!==1)return t="Cards",!1}).each(function(){if(this.Rows>1)return t="List",!1})));n._viewStyle=t},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(t){var i=this,r=i.dataView(),u=i._viewStyle,f,e;if(!arguments.length)return u;f=l();e=u;i._viewStyle=t;f&&(r.pageProp("viewStyle",t),i._instructed=!1,n.presenter("supports",t)||(i._reset=!0),t==="Grid"&&kst(r),r.sync());fi()},notifyChildren:function(t,r){var f=this.dataView(),e,u,o;return u=sl(f),u&&(o=u._detailDataViews,o)?(e=u._dataView,i.evaluate({dataView:e,container:g(),row:e.editRow()}),o.forEach(function(i){var u=n.pageInfo(i),e=u.dataView;t?e._busy()||u.echoInitialized==null||(f._id!==ht._dataViewId&&f.inlineEditing()&&ht.detach(),e.sync()):r==="New"&&brt(u.id)}),!0):void 0},headerText:function(n){var t=this._dataView,i=t.headerField(),r=n[i.Index];r!=null&&(t._dataText=i.format(r),i.TextMode===2&&(t._dataText=ah(t._dataText)))},tap:function(t,i){var c,o;if(t){var u=this,r=u.dataView(),a=r._dataViewFieldName,s=t.row||t,f=!0,e,v=0,l;r._busy()||yt()||(r._hasKey()?(l=r._selectedKey,l.length?u._commandRow?r._keyFields.every(function(n){return f=s[n.Index]!==l[v++],!f}):f=!0:f=!0,f&&(u.command(s,"Select"),u.headerText(s),t.pageIndex!=null&&t.pageIndex!==-1&&u.currentPageIndex(t.pageIndex),oy(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1})),i||(i="select"),e=$.Event("dataitemselect.dataview.app",{dataView:r,action:i}),$(document).trigger(e),i==="select"?(a&&(u.notifyChildren(f)&&e.preventDefault(),$("#"+r._id+"_ph").is(".app-focus")||bi({fieldName:a,container:g()})),(!e.isDefaultPrevented()||r.extension()._autoSelect)&&(c=!h&&n.lastTouch(),o=c&&$(document.elementFromPoint(c.x,c.y)).closest(".app-field-type-bool"),o&&o.length&&n.touched(o.find("i"))?ht.toggleBool(o,r):u.lookupInfo()?u.executeInContext("Select"):n.executeInContext())):u.notifyChildren(i==="highlight")):n.infoView(r,!0,s),e&&e.isDefaultPrevented()&&!f||fi())}},clearSelection:function(n,t){var r=this,i=r.dataView(),f=i._selectedKey,u,e;if(r._commandRow=null,f&&f.length){if(i.multiSelect()&&i._selectedKeyList.length){hy(i);i.extension().notifyChildren(!1,t);return}u=$.Event("clear.dataview.app");i._clearSelectedKey();i._forgetSelectedRow(!0);r.currentPageIndex(null);u=$.Event("clear.dataview.app");u.dataView=i;$(document).trigger(u);n&&(e=ni(i),e.find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),tt(i).page.find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected ui-btn-active"),lo(i));fi()}r.notifyChildren(!1,t)},quickFind:function(n){var i=this.dataView(),t,u,r;if(arguments.length){if(n&&lt("search.quickFind.history.enabled")){for(t=i.viewProp("quickFindHistory"),u=o("search.quickFind.history.depth")||100,t||(t=[]),r=t.indexOf(n),r>-1&&t.splice(r,1),t.splice(0,0,n);t.length>u&&t.length;)t.splice(t.length-1,1);i.viewProp("quickFindHistory",t)}i.viewProp("quickFind",n);i._executeQuickFind(n);hit(i)}else return i.viewProp("quickFind")||""},dispose:function(){var u=this,i=u.dataView(),r=i._lookupInfo,f=tt(i),t=f?g(f.page):null;t&&(n.presenter("dispose",{id:i._id,container:t}),vh(t),t.prev().find("h3, .app-bar-controls").off(),t.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(but(n),n.map=null,t.data("data-map",null))}));r&&(r.field=null,r.callback=null);u._disposeSession()},refresh:function(){function lr(i){if(c.requiresInitCallback)return c.initCallback=function(){t.get_searchOnStart()?tr(function(){setTimeout(f.search,0,"show",t._id)}):i()},c.requiresInitCallback=!1,n.navigate(c.id),!0;i()}function di(n){n?(hr=l.css("display")=="none",hr&&l.css({display:"block","margin-left":-2e4})):hr&&(fb(l),l.css({display:"","margin-left":""}))}function iu(){if(!pu){var n=t.get_selectedKey();t._selectedKeyList=n.length?[n.join(",")]:[];wh(t)}}function ru(){var i=t.get_master(),u,n,r;i&&(i.inserting()?lu(c.text,nt):(u=i.commandRow(),n=i._fields[0],n=i._allFields[n.AliasIndex],r=n.format(u[n.Index]),n.TextMode===2&&(r=ah(r)),lu([r,c.text],nt)));t._lookupInfo&&c.headerText!==!1&&(lu(c.headerText,nt),li!==0&&(l.attr("data-page-header",!1),lu(!1,nt)))}function bu(){t._rows.every(function(n){var r;return t.rowIsSelected(n)&&(i.commandRow()?i.commandRow(n):(t._forgetSelectedRow(!0),i.command(n,"Select")),r=!0),!r});vy(ti,t,c);ib(h,i);n.bar("hide",lt);n.bar("hide",y);var r=n.presenter("show",{name:k,id:t._id,container:h,reset:b});return ru(),r}function ku(r){function f(){var c=s!==n.asyncJob(),o,l,e,h;if(u.length&&!c)o=u[0],l=new Date,r.geocoder.geocode({address:o.address},function(n,e){var s,h,c,a;if(e===google.maps.GeocoderStatus.OK)s=n[0].geometry.location,h=kut(i,ut,s,o.title,o.row),t.rowIsSelected(o.row)&&by(r,h),wut(o.address,s.lat(),s.lng()),bk(r),ky(h,750,google.maps.Animation.DROP);else if(e===google.maps.GeocoderStatus.ZERO_RESULTS)wut(o.address);else if(e===google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(f,1e3);return}u.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(f,a-c):f()});else{if(!c&&!u.length&&r.markers.length<eet&&(e=i._mapPageWindow,e||(e=i._mapPageWindow={top:it,bottom:it,dir:"up"}),e.dir==="up"?e.bottom<i.pageCount()-1?(e.bottom++,e.dir="down"):e.top--:e.top>0?(e.top--,e.dir="up"):e.bottom++,h=e.dir==="down"?e.bottom:e.top,h>=0&&h<i.pageCount()-1)){i.pageIndex(h);i.refresh();return}c||(i._mapPageWindow=null)}}var o=put(t),u=[],s=n.nextAsycJob(),e;r.fit=!0;i._mapPageWindow==null&&but(r);$(bt).each(function(){var n=this.slice(0),f=oct(n,o),s=yu[vu[0].AliasIndex],h=s.text(n[s.Index]);typeof f=="string"?f!=="ZERO_RESULTS"&&(u.push({address:f,title:h,row:n}),r.geocoder||(r.geocoder=new google.maps.Geocoder)):(e=kut(i,ut,f,h,n),t.rowIsSelected(n)&&by(r,e))});bk(r);f()}function uu(){var t=ut.data("data-map");t?(ut.show(),rb(h),ku(t)):n.supports("Map")?(t={map:new google.maps.Map(ut.get(0),{zoom:8}),geocoder:null,markers:[]},t.map.setOptions({keyboardShortcuts:!1}),ut.data("data-map",t).show(),i.refresh()):setTimeout(uu,100)}function fu(n){var r=ct("dv-item",'data-icon="false"').appendTo(n),u=vt("ui-btn app-divider app-calculated").appendTo(r);return lh(t,pt,null,u,i.aggregateLabels(),!0),r.find(".app-field").attr("data-tooltip-location","above"),r}function gu(){var k;if(di(!0),n.bar(g?"show":"hide",lt),pt&&(g&&dt?h[0].scrollHeight-d(dt,"margin-bottom")<h.height()?n.bar("hide",y):(dt.prev().addClass("ui-last-child"+(dt.is(".app-has-promo")?" app-has-promo":"")),dt.remove(),n.bar("show",y)):(n.bar(pt?"show":"hide",y),k=!0)),g&&(ol(t),tf(u),ye(t)),b||!i._synced){if(ru(),a.length){var r=h.offset().top,e=h.height(),o,f=Math.ceil(a.offset().top),s=a.outerHeight(!0);function v(n,t){n.length&&(t+=d(n,"height"),n[0].style.cssText="height:"+t+"px !important")}ot=h.scrollTop();rt&&rt>0&&rt+s<e?(f-r<rt?v(u.find(".dv-load-at-top"),rt-(ot+f-r)):(o=h[0].scrollHeight,o-(ot+f-r-rt)<e&&v(u.find(".dv-load-at-bottom"),e-(o-(ot+f-r-rt)))),a.parent().prev().is(".dv-item,.dv-load-at-top-parent")&&af(h,ot+f-r-rt)):af(h,ot+f-r-(e-s)/2);b&&t.raiseSelected()}else if(i._synced||!t.get_selectedKey().length||t._lookupInfo)i.clearSelection();else{function p(){si()!=c.id||et?setTimeout(p,50):t.sync()}p()}i._synced=!0;de(0);a&&a.length?t.multiSelect()&&ue(!0,ab(u),frt(t),a.find(".app-btn-check")):h.scrollTop(0);yit(t,l,g)}else a&&a.length&&!b&&!w&&ki!=null&&af(h,h.scrollTop()+a.offset().top-h.offset().top-ki);vf(l);l.find(".ui-header-fixed").length&&l.addClass("app-has-fixed-bar");b?ht.sync(h):uf();di(!1)}var i=this,it=i.pageIndex(),au=i.pageCount(),t=i.dataView(),wt=t._totalRowCount,c=tt(t),vu=t._fields,yu=t._allFields,st=i.content(),l=c.page,bt=i.visibleDataRows(it),u=st.find('ul[data-role="listview"]'),oi,lt=l.find(".app-bar-hscrollbar"),y=l.find(".app-bar-aggregates"),dt,pt=i.aggregates(),hi=this.pageSize(),b=i._reset,pu=t._keepKeyList,br=it>0,kr=it<au-1,wi,ci,gr=t.get_showRowNumber()==!0,k=i.viewStyle(),g,h=st,ot=h.scrollTop(),bi,ki,rt,nt=h.find(".app-page-header"),ni,sr,hr,nu,ti=st.prevAll(".app-bar-actions"),tu=i.echoCallback,ar,vr,yr,pr,ut,ii,ou,ei,at,ur,fr,su,vi,hu,yi,pi,or,cu;if(!bt){b&&pl(u);t.goToPage(it,!0);return}if(ar=t._pendingNotification,ar&&(n.notify(ar),t._pendingNotification=null),tu){i.echoCallback=null;tu();return}if(c.echoId&&!c.echoInitialized){t.sessionShared("isSummary")||(t.sessionShared("isSummary",!0),l.remove().empty());rf(c.echoId);c.displayed||(c.initialized=!1);return}if(t._keepKeyList=!1,b&&(c.echoChanged=!0,i.currentPageIndex(it)),!et&&c.id!==si()&&c.id!==cg&&!t._lookupInfo){iu();pf();t._keepKeyList=!0;return}if(c.initialized=!0,c.displayed=!0,n.makeModal(c),vr=t.tagged(/\bpage\-header\-(\w+)\b/),vr&&(vr[1]==="none"?(c.headerText=!1,lu(!1,nt)):l.addClass("app-page-header-show")),c.headerText!==!1&&lrt(t,l,nt),wrt(t),i._autoSelect&&(yr=i._autoSelect,tr(function(){i.tap(yr.row,yr.action);i._autoSelect=null})),c.loading&&(c.loading=!1,l.find(".app-page-loading").remove()),a=u.find("a.app-selected").first(),a.length&&(ki=Math.round(a.offset().top-h.offset().top)),b&&(rt=ki,iu()),t._requiresContextRefresh&&(t._requiresContextRefresh=!1,fi()),i._checkedViews||(i._checkedViews=!0,!t._lookupInfo&&t.get_showActionBar()?ti=dst(t,st):(ni=[],pk(ni,!1,c)>1&&(sr=[],$(ni).each(function(){var n=this;sr.push({text:n.text,active:n.icon==="checked",callback:n.callback})}),n.tabs("create",{tabs:sr,className:"ui-header-fixed app-tabs-views",id:t._id+"_viewTabs",scope:"page",placeholder:st}),c.headerText=!1,lu(!1,nt),hasMultipleViews=!0))),ti.length&&nt.addClass("app-has-action-bar"),n.presenter("supports",{name:k,id:t._id})){ht.detach();lr(bu);i._reset=!1;return}if(k.match(/Grid|Cards|List|Map/)||(k=i._viewStyle="Grid",t.pageProp("viewStyle",k)),u.show(),t.groupBy(),g=k==="Grid",ci=i.itemMap(k==="List"),uh(t,ci.thumb!=null),eit(h,i,k==="Map"),k==="Map"){if(ht.detach(),n.bar("hide",lt),n.bar("hide",y),st.find('ul[data-role="listview"]').hide(),wtt(l),!i.tagged("supports-view-style-map")){i.viewStyle("Grid");fi();return}if(yl(),b){i._reset=!1;i._mapPageWindow=null;pr=!1;$(bt).each(function(){if(t.rowIsSelected(this))return pr=!0,i.tap(this,"none"),!1});pr?t.raiseSelected():i.clearSelection();i.refresh();return}lu(!0);di(!0);ib(h,i);vy(ti,t,c);ut=h.find("> .app-map");ut.length||(ut=p("app-map").appendTo(h).attr("data-map-for",t._id).hide());n.registerAPI("Map")||(h.find(".app-presenter-instruction").hide(),$('<div class="app-api-error">Google MAP API Key is required. Specify a valid key in <i>Settings | Features | Touch UI<\/i> section of your project properties.<br/><br/><a href="https://developers.google.com/maps/documentation/javascript/get-api-key" rel="external">Get The Key Now!<\/a><\/div>').appendTo(ut.empty().show()));vf(l);di(!1);lr(uu);i._reset=!1;pe(st);return}na||(bi=p("app-scrollable-cover").appendTo(h.parent()).css({position:"absolute",left:h.offset().left,top:h.offset().top,width:ie(h),height:h.outerHeight(),zIndex:2,backgroundColor:wu?"transparent":"#fff"}));u.length||(u=nr("app-listview",'data-role="listview"').addClass(ey(t)).appendTo(st).listview().on("taphold",function(n,r){if(r&&(n=r),gst())return!1;if(!t._busy()){var o=$(n.target),f=o.closest("a"),s=f.data("data-context"),e=t.multiSelect()&&!1;return f.closest("li").is(".dv-item")&&!f.is(".app-divider")&&(f.is(".app-selected")?(f.removeClass("app-selected"),e||(i.clearSelection(),i.lookupInfo()?kt(f,function(){i.executeInContext("Clear")}):kt(f,function(){}))):t._hasKey()&&(e||sy(u),f.addClass("app-selected"),i.tap(s,"none"),c.echoChanged=!0,kt(f)),wi=!0),!1}}).on("vclick",function(n){function a(n){if(!t._busy()){i._loadAtTop=!n;var u=r.parent();n?u=u.prev():(u=u.next(),u.is(".dv-item")||(u=u.next()));ni=u.find(".ui-btn").data("data-context");ni&&(i.pageIndex(ni.pageIndex+(n?1:-1)),i.refresh())}}var f=$(n.target),r=f.closest("a").removeClass("ui-btn-active"),s,l,o,h,e,v;if(!f.is(".app-btn-toggle,[data-href]")){if(r.length&&!r.is(".app-divider")){if(r.is(".dv-load-at-bottom"))a(!0);else if(r.is(".dv-load-at-top:visible"))t._autoNewRow||a(!1);else{if(wi){wi=!1;return}if(!we(f)||yt())return!1;if(n.ctrlKey)return u.trigger("taphold",n),wi=!1,!1;if(r.is(".dv-action-none")||rrt(n,t))return!1;s=t.multiSelect();s&&hb(n)?yb(t,r,"none"):(o=r.data("data-context"),h=urt(n),o?(s&&r.find(".app-btn-check").addClass("app-btn-check-selected"),u.find("a.app-selected").removeClass("app-selected ui-btn-active"),h?(r.addClass("app-selected"),f=cb(f),e=function(){kc(t,r,"none")||i.tap(o,"none");kh(f)}):e=function(){t._hasKey()?(r.addClass("app-selected"),h||kc(t,r)||i.tap(o),c.echoChanged=!0):i.tap(o)}):r.is(".dv-action-refresh")?e=function(){el(t._id)}:r.is(".dv-action-new")?e=function(){i.executeInContext("New",null,!1)}:r.is(".dv-action-filter-clear")&&(e=function(){ty(t,!0)}),e&&(e(),kt(f)))}return!1}if(l=f.closest(".app-group"),l.length)return f.is(".app-group")||(v=f.closest(".app-group").find(".app-group-path,.app-group-title").addClass("ui-btn-active"),setTimeout(function(){v.removeClass("ui-btn-active");ak(!0)},er)),!1}}),yy(t,u),oi=n.bar("create",{type:"footer",page:l}),!y.length&&pt&&(ii=oi.find('[data-location="bottom"]'),y=p("app-bar-aggregates"),ii.length?y.insertBefore(ii.first()):y.appendTo(oi)),lt.length||(lt=$('<div class="app-bar-hscrollbar"><span class="app-hscrollbar2" data-view="'+t._id+'"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"><\/span><\/span><\/div>').toggleClass("app-scrollbar-wide",he),y.length?lt.insertAfter(y):(ii=oi.children().first(),ii.length?lt.insertBefore(ii):lt.appendTo(oi)),ol(t)));b&&pl(u);b!==!1&&y.length&&pt&&(g?fu(aggregateListView=nr("ui-listview app-listview app-grid").appendTo(y.empty())):prt(t,y.empty(),pt));kot(u,k);k==="Grid"&&ol(t);vy(ti,t,c);cl(t,u);var ft=u.find(".dv-item"),ri=ft.length>hi*2,ui=u.find("li").last(),v,li,w=i._loadAtTop,a,ai,wr,gi=ui&&ui.length&&ui.prev(),du=gi&&gi.length&&Math.round(gi.position().top),eu,ir,rr;eu=wht(u);(!br||ui.length)&&(!ri||w||u.find("li.dv-load-at-top-parent").length)||(nt.hide(),v=$('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><\/a><\/li>'),ri?(v.insertBefore(ft.get(0)),br=!0):v.appendTo(u));w?(v=u.find("li").first(),v.is(".app-list-instruction")&&(v=v.next()),ai=v.length&&v.next(),wr=ai&&Math.round(ai.position().top)+eu,bt=bt.slice(0).reverse()):ui.remove();li=it*hi;ou=ww(t);$(bt).each(function(n){var r=this,f=ct("dv-item",'data-icon="false"'),s=w?li+hi-n:li+n+1,e=vt("ui-btn").appendTo(f).data("data-context",{row:this.slice(0),pageIndex:it}),o;t.rowIsSelected(r)&&(i.headerText(r),e.addClass("app-selected"),o=i.commandRow(),o?(i.commandRow(r),o.join(";")!==r.join(";")&&fi()):(t._forgetSelectedRow(!0),i.command(r,"Select")));w?f.insertAfter(v):f.appendTo(u);g?lh(t,r,gr?s:null,e):fe(t,r,ci,gr?s:null,f,e,k==="List");ih(t,r,f,ou)});(kr&&!w||ri&&w&&!u.find(".dv-load-at-bottom-parent").length)&&(ui=yi=$('<li data-icon="false" class="dv-load-at-bottom-parent"><a class="dv-load-at-bottom"><\/a><\/li>').appendTo(u));w&&!it&&v.remove();(!wt||t.get_searchOnStart())&&(ay(t,u,ci,!0),ir=ct("",ce("a","dv-action-refresh ui-btn ui-btn-icon-left ui-icon-refresh",ce("p"))).appendTo(u).find("a"),ir.attr("title",uo.Refresh).find("p").text(sa),t._filter&&t._filter.length&&!t.filterIsExternal()&&(rr=ct("",ce("a","dv-action-filter-clear ui-btn ui-btn-icon-left ui-icon-clear",ce("p"))).appendTo(u).find("a"),rr.attr("title",e.ClearFilter).find("p").text(e.ClearFilter)));kr||(wt>0&&ay(t,u,ci),pt&&g&&wt>0&&(dt=fu(u)),o("ui.actions.promote")?nu=!0:ti.length||(ei=i.executeInContext("New",null,!1,!0),ei&&(ur=ct("dv-action-new").appendTo(u).attr("data-icon",ei.icon),at=vt("dv-action-new").appendTo(ur).attr("title",e.LookupNewAction),g?dr().appendTo(at).text(ei.text):(cr("h3").appendTo(at),fr=ur.prev(),fr.is(".dv-item")&&(at.html(fr.find("a").html()).find("p,img,span").css("visibility","hidden"),fr.is(".ui-li-has-thumb")&&ur.addClass("ui-li-has-thumb")),at.find("h3").text(ei.text),wt||dr().appendTo(at.html("")).text(ei.text)))));w&&(l.attr("data-page-header")!=="false"&&l.attr("data-page-header",""),c.headerText!==!1&&lu(!li,nt));su=u.find("li").first();vi=i.instruction();(vi||g)&&!u.find(".app-list-instruction").length&&(yi=ct("app-list-instruction",'data-role="list-divider"').insertBefore(v?v:su),vi&&s("app-view-instruction").appendTo(yi).html(vi),g&&!!wt&&(hu=cy(t,yi),vi||hu.addClass("app-grid-header-no-description")),yi.toggleClass("app-no-records",wt<1));w&&v&&v.find(".ui-btn").css("height","").find("p").css("margin-top","");ri&&(w?(pi=$(String.format('<li style="clear:left;height:{0}px"><\/li>',r.height)).appendTo(u),ft=ft.slice(hi*(wu?2:2)),ft.find("a").data("data-context",null),ft.remove(),u.find("li.dv-action-new").remove()):(nt.hide(),pi=$(String.format('<li style="clear:left;height:{0}px"><\/li>',r.height)).appendTo(u),ft=ft.slice(0,hi),ft.find("a").data("data-context",null),ft.remove().empty()));bht(t,u);nf(u);u.listview("refresh");nu&&u.find("li.dv-item").last().addClass("app-has-promo");a=u.find(".app-selected");rt==null&&(ri?w?(or=ai.position().top,af(h,ot+or-wr)):(cu=gi.position().top,af(h,ot+cu-du)):w?(or=ai.position().top,af(h,ot+or-wr)):w==null&&af(h,0));pi&&setTimeout(function(){pi.prev().addClass("ui-last-child");pi.remove()},100);g&&(ir&&ir.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),at&&at.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),rr&&rr.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));gu();lr(function(){if(de(b?10:200),t.inlineEditing()&&a&&a.length){var n=gt(a),i=gt(h);(i.top<=n.top&&n.top<=i.bottom||i.top<=n.bottom&&n.bottom<=i.bottom)&&ht.sync({dataView:t})}});bi&&(wu&&ri?setTimeout(function(){bi.remove()},300):bi.remove());i._reset=!1;i._loadAtTop=null;$(document).trigger($.Event("dataviewrefresh.app",{dataView:t}))},reset:function(){var i=this.dataView(),n=tt(i),r="#"+n.id,t;this._reset=!0;$(yi("list")).each(function(n){return n>yi("index")?!1:this.hash===r?(t=!0,!1):void 0});t||(n.initialized=!1,n.echoInitialized=!1)},visibleDataRows:function(n){var u=this._dataView,i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},currentPageIndex:function(n){return arguments.length&&(this._currentPageIndex=n),this._currentPageIndex},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n==="bottom"&&(i=this.content().parent().find("ul li.dv-item").last().find("a").data("data-context"),i)?i.pageIndex:n==="top"&&(r=this.content().parent().find("ul li.dv-item").first().find("a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var f=this,o=f.lookupInfo(),i,r=f.dataView(),c=f.viewDescription()||"",t=c?[c]:[],h=f.filterStatus(),s=r.groupExpression(),u;return o&&(t.length&&t.push(" "),i=o.field,t.push(String.format(i.ItemsDescription||e.LookupInstruction,i._autoAlias?i.AltHeaderText||i.HeaderText:i._dataView._allFields[i.AliasIndex].HeaderText)),o.value&&(u=o.text,u&&u.length>50&&(u=u.substring(0,50)+"..."),t.push(String.format(e.LookupOriginalSelection,u)))),r.multiSelect()&&t.push('<span class="app-multi-select-instruction">'+ert(r)+"<\/span>"),n!==!1&&(t.length||h||s)&&r._totalRowCount>1&&(t.length&&(t.push(" "),t.push(String.format(e.ShowingItemsInfo,String.format("{0:N0}",r._totalRowCount)))),$(s).each(function(n){var i=r.findField(this);i&&(n||(t.length&&t.push(" "),t.push(e.GroupedBy," ")),n&&(n===s.length-1?t.push(" ",wd," "):t.push(", ")),t.push(i.HeaderText),n==s.length-1&&t.push("."))})),h&&(t.length&&t.push(" "),t.push(String.format('<span class="app-filter" title="{1}">{0}<\/span><i class="material-icon app-filter-clear" title="{2}">clear<\/i>',h,e.Filter,ic))),t.join("")},context:function(n,t){var l=this,i=l.dataView(),w=i.extension(),f=i._totalRowCount,b=i.get_view().Label,k=i.get_sortExpression(),r=l.commandRow()||[],u=l.lookupInfo(),o,a=r&&r.length,v,s,y,h,c,p;if(f!==-1)if(i.get_showViewSelector()&&n.push({text:b,tooltip:f>999?String.format(e.ShowingItemsInfo,String.format("{0:N0}",f)):null,count:f>999?"999+":f,icon:"gear",system:!0,toolbar:!1,transition:!0,callback:hut},{}),hd(n),(i.get_showQuickFind()&&(f>1||i._busy()||i.get_filter().length>i.get_externalFilter().length)||ao(i).length||i._hasSearchAction)&&n.push({text:fs,desc:sit(i),descInTooltip:!1,icon:"search",toolbar:!1,system:!0,context:{dataViewId:i._id},callback:nit}),n.push({text:e.Sort,icon:"sort",transition:!0,desc:rk(i),toolbar:!1,system:!0,callback:pht}),n.push({text:e.Filter,icon:"filter",transition:!0,desc:w.filterStatus(!0,!0),toolbar:!1,system:!0,callback:bh}),n.push({text:e.Group,icon:"group",transition:!0,desc:uk(i),toolbar:!1,system:!0,callback:ak}),u&&u.value==null||n.push({}),cut(i,n,r),u||wk(i,n,r),v=i.rowIsTemplate(r),u&&!v)for(o=u.field,a&&n.push({text:e.LookupSelectAction,icon:"material-icon-arrow-forward",command:"Select",context:{field:o,lookupInfo:u,row:r},callback:hn}),u.value&&n.push({text:e.UnSelect,icon:"material-icon-clear",command:"Clear",context:{field:o,lookupInfo:u},callback:hn}),gf(o.ItemsNewDataView)||n.push({text:e.LookupNewAction,icon:"material-icon-add",command:"New",system:!0,context:o,callback:det}),n.push({}),!a||o.tagged("lookup-details-hidden")||i.rowIsTemplate(a)||n.push({text:e.LookupViewAction,icon:"material-icon-info-outline",callback:get}),wk(i,n,r),s=[],y=!0,go(["Grid"],i,s,r),h=0;h<s.length;)c=s[h],p=c.argument,c.command==="Select"&&(!p||p==="editForm1")||(y&&(n.push({text:"$separator"}),y=!1),n.push(c)),h++;else t||(t=["Grid","ActionColumn","ActionBar"]),v||go(t,i,n,r)}};oa.Form=function(n){return new tc(n)};tc=kr.MobileForm=function(n){tc.initializeBase(this);this.dataView(n)};tc.prototype={initialize:function(){this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose();this._disposeSession()},_disposeLayout:function(n){function t(n){var r,i;if(n)for(r=0;r<n.length;r++)i=n[r],t(i.children),i.children=null,i.self.removeData(),i.self=null}n=$(n);n.find(".app-data-list").off();n.find(".app-drop-box").each(function(){f.upload("destroy",{container:this})});t(n.data("rootNodes"))},_disposeForm:function(n){var t=this;return n||(n=t.content()),n.find('[data-layout="form"]').each(function(){t._disposeLayout(this)})},_dispose:function(t){var r=this,f=r._dataView,i=this.content(),u;r._newValues=null;r._disposeForm(i);$(f._allFields).each(function(){var i=this,t;i._dataViewId&&(t=k(i._dataViewId),t._dataViewFieldOwnerId===f._id&&n.deletePage(t._id))});i.find(".app-status-bar, .app-bar-buttons,.app-stub,.app-form-grid").off();vh(i,!0);u=i.find(".app-echo").each(function(){var t=$(this).attr("data-for"),n=tt(t);n&&(n.echoId=null,n.echoInitialized=!1)});u.find(".app-echo-inner").off();u.find(".app-echo-footer").off();u.off();n.tabs("destroy",{container:i});t&&fi();r._disposeSession()},viewStyle:function(){return"Form"},refresh:function(){function kt(){n.tabs("create",{tabs:y,className:"app-tabs-echo",scope:t.get_selectedKey(),change:function(){}})}function dt(){a&&iit(a);tit(e);n.bar("show",k);n.refreshTitleState();n.refreshAppButtons(b,{buttonBars:u!=="None"?k:[],layout:c,toolbar:!1,dataView:t})}var f=this,t=f.dataView(),at=t._survey,vt=n[t._id+"_PendingPageDelete"],v,s,rt,ut,ft,bt,st,ht;if(vt&&(t._skipAnimate=!!$(".app-reading-pane-detail").length,delete n[t._id+"_PendingPageDelete"],vt()),f._skipRefresh||at&&at.show===!1){f._skipRefresh=!1;return}var gt=f.editing(),ni=t._inlineEditor,i=tt(t),c,e=f.content(),l,y=[],w,b,a,d,k,yt=this.inserting(),ti=this._reset,u=t.get_showActionButtons(),nt,pt=t._confirmContext,o=i.page,it=o.find(".app-page-header"),wt;ti&&(f._dispose(),f._commandRow=null);l=gt?t.editRow():f.commandRow()||f._initRow()||[];n.makeModal(i);cst(t,o,l);v=f.viewDescription();v&&p("app-view-description").appendTo(it).html(v);s=pt&&pt.WindowTitle||t.get_view().Label;s&&(i.headerTextLocked?typeof i.headerText=="string"&&(i.headerText=typeof s=="string"&&(!t.inserting()||t._confirmContext)?[i.headerText,s]:s):(t.inserting()&&t._filterSource&&(rt=g(t._filterSource).find(".app-page-header h1").text()),i.headerText=rt?[s,rt]:t._controller==="MyProfile"&&lt("membership.myProfile.appName")?[s,ov()]:s));yt&&it.attr("data-locked","false").data("data-text",null);ut=t.tagged(/page\-header\-(\w+)/);ut&&ut[1]==="none"&&(i.headerText=!1);!i.headerText==!1&&lrt(t,o,it);o.is(".app-page-modal")||i.headerText===!1||$('<div class="app-page-header-placeholder dv-heading" data-selector=".app-page-title"><span class="app-static-text app-page-title"><span class="app-text"><\/span><\/span><\/div>').appendTo(e);c=ctt(t,o.is(".app-page-modal")?ie(e):r.width);d=t.statusBar();d&&(a=p("app-status-bar").html(d).appendTo(e),ft=a.find("li.Segment"),bt=ft.length+10,ft.each(function(n){this.style.zIndex=bt-n}),h&&a.css("overflow-x","auto"));v&&i.headerText===!1&&(st=nr("app-list-instruction",'data-role="listview"').appendTo(e),ct("app-list-instruction",'data-role="list-divider"').appendTo(st).html(v),st.listview());nt=t.tagged(/\baction-buttons-(\w+)\b/);nt&&(u=nt[1],u=u.charAt(0).toUpperCase()+u.substring(1));(u==="TopAndBottom"||u==="Top")&&p("app-bar-buttons").appendTo(e);c.appendTo(e);i.isModal&&u!=="None"?u="Auto":u!=="Auto"||bn()||(u="None");u==="Auto"?k=p("app-bar-buttons").appendTo(n.bar("create",{type:ot(o)?"header":"footer",page:o})):((u==="TopAndBottom"||u==="Bottom")&&p("app-bar-buttons").appendTo(e),k=e.find(".app-bar-buttons"));b=[];f.context(b);yt||ni||($(n._pages).each(function(){var r=this,i,n,f,u=r.dataView,o=u&&u._filterSource;o&&o===t._parentDataViewId&&!u._dataViewFieldName&&(n=r.activator,n&&n.type==="Tab"&&($(y).each(function(){if(n.text===this.text)return i=this,!1}),i||(w!==n.container&&(w&&(kt(),y=[]),w=n.container),i={text:n.text,content:[]},y.push(i))),f=kb(r.id,e),i&&i.content.push(f))}),w&&kt());wt=p("app-stub").appendTo(e);t.tagged("promo-none")&&wt.addClass("app-hidden");f.stateChanged();f._reset=!1;i.requiresInitCallback?(ht=o.css("display")!=="block",ht&&o.css({display:"block","z-index":-10}),t._unchangedRow=l.slice(0),u!=="None"&&u!=="Auto"&&n.refreshAppButtons(b,{buttonBars:e.find(".app-bar-buttons"),toolbar:!1,dataView:t}),vtt(t,l,c),ih(t,l,c),t._isWizard&&ve("start",{layout:c}),uu(e),vf(o),ht&&o.css({display:"","z-index":""}),i.requiresInitCallback=!1,et=!1,i.initCallback=dt,n.navigate(i.id)):dt()},collect:function(){var r=this,u=[],n,t=r.dataView(),o=t._allFields,f,i=r.inserting(),e;return e=t.editRow(),f=t._originalRow,$(o).each(function(t){var s=this,a=s.Name,l=s.IsPrimaryKey,v=s.Type,y=s.ReadOnly,r=e[t],h=f[t],c,o;v==="DataView"||s.OnDemand||(r===undefined&&(r=null),h===undefined&&(h=null),v.match(/^Date/)&&r!=null&&r!==h&&(r=new Date(r)),c=r!==h||r==null&&!s.AllowNulls&&!l||i&&r!=null,n={Name:a},c&&r!=null&&(n.NewValue=r,o=!0),i||h==null||(n.OldValue=h,o=!0),c&&(n.Modified=c,o=!0),!y||l&&i||a==="Status"&&!o||(n.ReadOnly=!0),o||!l||y||(o=!0,n.Modified=!0),o&&u.push(n))}),u},stateChanged:function(n){var r=this,u=r.dataView(),e=r.content(),t=e.find("[data-layout]"),f;t.data("prepared")?(f=u.editRow(),i.evaluate({dataView:u,row:f,container:t}),i.render({container:t,dataView:u,row:f}),n!==!1&&(fi(!1,0),pu(),r.editing()&&!h&&bi({container:t,lastFocused:"auto"}))):fi()},context:function(n){var u=this,t=u.dataView(),i=u.commandRow(),f=u.editing(),r;n.isSideBar||cut(t,n,i);f||wk(t,n,i);r=[t._inlineEditor?"Row":"Form"];go(r,t,n,i);hd(n)&&n.push({});r=["ActionBar","Context"];go(r,t,n,i)}};f.alert=function(n,t){return rft({name:"_alert",message:n,submit:t,cancel:!1})};f.confirm=function(n,t,i){return rft({name:"_confirm",message:n,submit:t,cancel:i||gi})};$(document).on("alertconfirmed.app alertnotconfirmed.app",function(t){var u=t.rules.dataView(),i=u.survey(),f=t.type==="alertconfirmed",r=f?i._submit:i._cancel,e=i._promise;n.pageInfo(u)._canceled=!0;yo(!1);tr(function(){yo(!0);r&&r!==gi?r():f?e.resolve():e.reject()})}).on("menuchanged.app",function(t){pr=or.nodes=or[ts]=t.nodes;delete n._menuStrip;$(".app-menu-strip").remove();fi()});if(or=nu.Menu={Nodes:{}},b.$nextTabIndex=b.$closeHovers=gi,au){$(document).one("membershipinit.app",function(n){rr=n.membership;lg=rr.get_authenticationEnabled();ag=rr.get_displayMyAccount();userName=rr.get_user()});au.prototype.updated=function(){if(rr=this,sh(),this.get_idleTimeout())$(document).on("awake.app",function(){return!rr.idle()});rr.idleInterval(!0);$(document).one("start.app",function(){rr._allowLoginInMenu=rr.get_displayLogin()});rr.loginStatus('a[data-app-role="loginstatus"]');$(document).one("start.app",function(){f.AccountManager.enabled()||!n.returnUrl()||vv()||n.showAccountManager(null)})};au.prototype._idle=function(){rr.idleInterval(!1);gy()};au.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?se.LogoutLink:se.LoginLink).on("vclick",function(){return kt(r,function(){i?gy():t.showLogin()}),!1})};au.prototype.showLogin=function(){n.showAccountManager(null,!0)}}f.Mobile=function(){var n=this;n._asyncJob=0;n._pageMap={};n._pages=[];n._modalDataViews=[];n._modalStack=[];n._pagesToDelete=[]};f.Mobile.prototype={settings:function(){return o.apply(this,arguments)},appName:function(){var t=this;return t._appName||(t._appName=n._logo.text()||$("#PageHeaderBar").text()||$('head meta[name="application-name"]').attr("content")),t._appName},height:function(){var n=r.height;return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},activePage:function(){return l.apply(this,arguments)},page:function(n){n||(n="Main");var t=$("#"+n),u,i,r;return t.length||(t=$('<div data-role="page" id="'+n+'"><div data-role="content"><\/div><\/div>'),gu()&&t.addClass("app-ui-automation"),u=di("get"),i=tt((u?t.insertBefore(u):t.appendTo(c)).page()),r=$('<div class="app-bar-heading"><div class="app-bar-text"><\/div><\/div>').hide().appendTo(t),i&&(i.page=t,i.stickyHeader=r,i.scrollable=uy(t).data("sticky-header",r),i.home&&i.dataView&&i.dataView.get_isForm()&&!i.dataView._selectedKey.length&&r.remove())),t},readingPane:function(t,i){var f=n.pageInfo(t),u=f.page;i===!0?(u.addClass("app-reading-pane-master app-transition-none app-page-modal-root"),pt.id=t._id,pt.controller=t._controller):(u.removeClass("app-reading-pane-master app-transition-none"),pt.id=null,pt.controller=null,r.toolbarWidth=null,r.splitLeft=null,r.splitRight=null,r.splitTop=null,r.splitBottom=null);ei(u)},makeModal:function(t){var a,o,v,h,w,y;if(!t._madeModal){t._madeModal=!0;var u=t.page,i=t.dataView,p=t.home,l,c,f=!1;i&&(!i._inlineEditor&&i._parentDataViewId===pt.id&&i._controller===pt.controller&&(r.splitBottom||r.splitRight)?(u.addClass("app-reading-pane-detail app-transition-none"),f=!0):(i.tagged("content-stub-none")&&u.addClass("app-content-stub-hidden"),a=i.tagged(/\bmodal-dock-(top|left|right|bottom)\b/),a&&(i.tagged("modal-fit-content")||!$(".app-page-modal-background").filter(lr).length)&&u.addClass("app-page-modal-dock app-page-modal-dock-"+a[1]),i.tagged("modal-gap-none")&&u.addClass("app-page-modal-gap-none"),i.tagged("modal-fullscreen")&&(u.addClass("app-page-modal-fullscreen"),l=!0),i.tagged("transition-none")&&u.addClass("app-transition-none"),i.tagged("modal-keyboard")&&u.addClass("app-modal-keyboard"),p&&(c=i.pageProp("readingPane"),c==null&&(c=i.tagged(/reading-pane-auto/)),c&&art()&&!cu&&n.readingPane(i,!0))));p||f||($(".app-page-modal-root").length?f=!0:kp?(i.tag("modal-never-"+i.get_viewId()),i.get_view().Label!==n.title()&&(t.backText=n.title())):(o=i&&i.tagged(/\bmodal-(never|always|(when-(tn|xxs|xs|sm|md|lg|xl|xxl)))\b/),o?(u.addClass("app-page-"+o[0]),f=i._inlineEditor||o[1]==="always"||!(o[1]==="never"||r.width<oi(o[3])),f||o[1]!=="never"||(v=i.tagged(/\bmodal-never-(\w+)\b/),v&&v[1]!==i.get_viewId()&&(f=av()))):(f=i&&av(),t.backText=n.title())),di()&&(f=!0));f&&!u.is(".app-page-modal")?(u.find(".app-page-header-fixed").remove(),u.addClass("app-page-modal"),i&&(i.tagged("modal-title-none")||ot(u))||(h=$('<div class="app-page-modal-title"><span class="app-text"><\/span><\/div>').insertBefore(g(u)),vt("app-btn app-btn1 app-btn-search").appendTo(h).hide().attr("title",fs),i&&i.tagged("modal-buttons-more-none")||s("app-btn-context app-btn app-btn2 ui-icon-dots").appendTo(h).attr("title",fr),i&&i.tagged("modal-buttons-fullscreen-none")||(w=s("app-btn app-btn3 app-btn-fullscreen").appendTo(h).attr("title",l?e.ExitFullscreen:e.Fullscreen),l&&w.addClass("app-btn-fullscreen-exit")),s("app-btn app-btn4 app-btn-close").appendTo(h).attr("title",lp)),y=i&&i.tagged(/\bmodal-max-(tn|xxs|xs|sm|md|lg|xl|xxl|any)\b/),y&&u.addClass("app-page-"+y[0])):!f&&u.is(".app-page-modal")&&(u.removeClass("app-page-modal").css({left:"",top:"",width:"",minWidth:"",maxWidth:"",paddingTop:""}),u.find(".app-page-modal-title").remove(),t.scrollable.css({left:"",top:"",width:"",minWidth:"",maxWidth:""}));!!t.isModal!==f&&(t.isModal=f,ei(u))}},activeLink:function(n,t){if($(ii.activeClickedLink).is(".app-tab-active")||ii.removeActiveLinkClass(!0),n){var i=$(n).closest("a");i.length&&(n=i);n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(ii.activeClickedLink=n))}},blink:function(n,t){ur(n);setTimeout(function(){ur();setTimeout(function(){ur(n);setTimeout(function(){ur();t&&t()},200)},200)},200)},content:function(t){var i=tt(t),r=i&&i.page?i.page:n.page(t),u=i&&i.scrollable?i.scrollable:g(r);return u.length?u:r.find('[data-role="content"]')},showContextPanel:function(n,t,i){ti(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");vc($(n))},causesCalculate:function(){},pageVar:function(n,t){if(arguments.length===1)return fu(n);fu(n,t)},userVar:function(n,t){if(arguments.length===1)return ri(n);ri(n,t)},callWithFeedback:function(n,t){n=$(n);n&&n.length&&kt(n,t)},progress:function(t,i){function e(){r.length||(r=$('<div class="app-progress-screen"><div class="app-progress-text"><\/div><div class="app-progress-bar"><div class="app-progress-indicator"><\/div><\/div><div class="app-progress-content"><\/div><\/div>').appendTo(c));var h=r.find(".app-progress-text"),v=r.find(".app-progress-bar"),t=v.find(".app-progress-indicator"),l=r.find(".app-progress-content");if(i.text?h.text(i.text).show():h.hide(),i.background!=null&&r.css({"background-color":i.background,color:n.invertColor(i.background,!0)}),i.estimate!=null){u();i.progress=0;var s=0,e=0,y=i.estimate===-1,a=i.estimate/1e3,o=r.find(".app-progress-estimate").show();o.length||(o=p("app-progress-estimate").appendTo(r));_progressEstimateInterval=setInterval(function(){s++;y?o.text(f(s*.25)+"..."):(e=s*250/i.estimate,e>=1&&(e=1,u()),t.width(Math.floor(e*100)+"%"),a-=.25,o.text(f(a)+" remaining..."))},250)}else u();i.accent!=null&&t.css("background-color",i.accent);i.progress!=null?t.css({width:Math.floor(i.progress*100)+"%","margin-left":""}).removeClass("app-progress-marquee"):t.css({width:"100%","margin-left":"-100%"}).addClass("app-progress-marquee");i.content===!1?l.empty():i.content!=null&&l.empty().append(i.content)}function o(){r.remove()}function f(n){var t="",i=Math.floor(n/60),r=n%60;return i>0&&(t+=i+" minute",i>1&&(t+="s"),t+=" and "),t+=Math.ceil(r)+" second",r>1&&(t+="s"),t}function u(){r.find(".app-progress-estimate").hide();clearInterval(n._progressEstimateInterval)}var r=$(".app-progress-screen");i||(i={});switch(t){case"show":e();break;case"hide":o();break;default:r.find(".app-progress-text").text(i.text)}return r},invertColor:function(n,t){if(n.indexOf("#")===0&&(n=n.slice(1)),n.length===3&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),n.length!==6)throw new Error("Invalid HEX color.");var i=parseInt(n.slice(0,2),16),r=parseInt(n.slice(2,4),16),u=parseInt(n.slice(4,6),16);return t?i*.299+r*.587+u*.114>186?"#000000":"#FFFFFF":(i=(255-i).toString(16),r=(255-r).toString(16),u=(255-u).toString(16),"#"+padZero(i)+padZero(r)+padZero(u))},pageHeader:function(n){var t=tt(n.id),i=[n.text];n.text2&&(i[1]=n.text2);t&&(t.headerText=i,t.id===si()&&lu(i))},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},pageInfo:function(n){return n?n._id&&n._controller?n=n._id:n.is!=null&&n.length!=null&&(n=n.attr("id")||""):n=si(),typeof n=="string"?this._pageMap[n]:n?(this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n),n):null},vibrate:function(n){navigator.vibrate&&(n||(n=50),navigator.vibrate(n))},isInTransition:function(){var n=arguments;if(n.length)et=n[0];else return!wa||et},summary:function(n){return ni(n)},scrollable:function(n){var t=g(typeof n=="string"?null:n);if(typeof n=="string")if(n==="refresh")iy(t,!1);else if(n==="focus")ir(t);else if(n==="scrollbar")return wt;return t},makeVisible:function(){ev.apply(this,arguments)},scrollGrid:function(n,t){t==!0?(wf(n),t=0):n.session("scroll-left",t);ph(n,-t)},unloading:gi,refresh:function(n,t,i){fi(n,t,i)},refreshEchoToolbarWithDelay:function(n,t){lo(n,t)},listPopup:function(n){yr(n)},cardPopup:function(n){kk(n)},busyIndicator:gi,viewStyle:function(n,t,i){oh(n,t,i)},bar:function(t,i){function h(){var t,n;f=r.prevAll(".app-bar-actions");t=f.parent().find(".app-page-header-fixed");f.is(".app-bar-actions")&&f.is(":visible")?(n=f.position().top+f.outerHeight(),r.css("top",n),t.css("top",n+r.outerHeight()-1).closest(".ui-page").addClass("app-has-header-bar")):r.css("top","")}function c(){var t=!0,i;r.children().each(function(){var n=$(this);n.css("display")!=="none"&&(t=!1)});t?(r.hide(),r.is(".app-bar-footer")?n.promo().css("margin-bottom",""):r.parent().find(".app-page-header-fixed").closest(".ui-page").removeClass("app-has-header-bar"),l()):(r.show(),i?r.removeClass("app-bar-system"):r.addClass("app-bar-system"))}function l(){ei(r.closest(".ui-page"))}var r,f,u;if(t==="create"){var e=i.type,a=i.page,o=g(a),s;return r=a.find(".app-bar-"+e),r.length||(e==="header"?(r=p("app-bar-header ui-header ui-bar-inherit ui-header-fixed").hide().insertBefore(o),h()):e==="footer"&&(s=o.next(),r=p("app-bar-footer ui-footer ui-bar-inherit ui-footer-fixed").hide().insertAfter(s.is(".app-vscrollbar")?s:o))),r}(u=i,u&&u.length)&&(r=u.parent(),t==="show"?(r.is(".app-bar-header")&&h(),r.show(),u.show(),l(),vf()):t==="hide"?(u.hide(),c()):t==="remove"&&(u.remove(),c()))},promo:function(t,i,r){function s(){var r,t,i;u.is(".ui-disabled")||!o("ui.actions.promote")||n.edit._pending?u.hide():(f=$(".ui-page-active").is(".app-page-modal"),r=u.is(":visible"),t=hv(),r||(rt&&rt.is(":visible")&&(u.show(),t=hv(),u.hide()),u.css({"margin-bottom":f?0:"",transform:"scale(.5)",transition:"none"}).show(),setTimeout(function(){u.css("transition","transform 200ms");setTimeout(function(){u.css("transform","").one("transitionend",function(){u.css("transition","");vr()})})})),u.css("margin-bottom",""),i=d(u,"margin-bottom"),t&&(i=d(u,"margin-bottom")+(rt.is(":visible")?rt.outerHeight():0)),e=l(".app-bar-footer"),u.css({"margin-bottom":f?0:i+(e.is(":visible")?e.outerHeight():0)}))}var u=this._actionButton,f,e;if(arguments.length){if(typeof t=="boolean")return t?s():(clearTimeout(n._promoTimeout),u.hide()),u;if(typeof t=="string")return u.find(".app-icon").remove(),t=ko(t),bt(t,u.attr({title:i,"data-icon":t})),r&&u.find("i").css("transform","rotate("+r+"deg)"),t.match(ep)?(u.hide().addClass("ui-disabled"),!1):(u.removeClass("ui-disabled"),s(),!0)}else return u},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"&&(n?t.show():t.hide()),t},stickyHeaderBar:function(n){var t=g(n);return t.data("sticky-header")||$()},enumerateFields:function(n,i,r,u){var e=n._allFields,f=r==null;u||(u=n.commandRow());f?(r=[],$(e).each(function(){this.ShowInSummary&&!this.Hidden&&r.push(this)})):i.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(r).each(function(r){var o=e[this.AliasIndex],s=o.HeaderText;v=u[o.Index];t=v==null?"":o.TextMode===2?ah(v):o.text(v);v==null&&r||(o.OnDemand?o.OnDemandStyle!==1&&v&&typeof v=="string"&&!v.match(/^null/)&&i.push({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",n.resolveClientUrl(n.get_appRootPath()),o.OnDemandHandler,v,o.OnDemandStyle===2?"&_nocrop":""),desc:s,display:"before",isField:!0}):(gf(t)&&(t=ec),!f&&gb(o)&&v?i.push({text:t,desc:s,href:"tel:"+t,icon:"phone",isField:!0}):!f&&nk(o)&&v?i.push({text:t,desc:s,href:"mailto:"+t,icon:"material-icon-email",isField:!0}):i.push({text:t,desc:s,isStatic:!0,display:"before",isField:!0})))});r.length&&i.push({})},infoView:function(n,t,i,r){var f=[],h=t?"left":r||"",s,o,u,c;for(t||f.push({text:e.Back,callback:be,icon:ui});n;)c=f.length,s=n.extension().itemMap(),o=n._allFields,u=[o[s.heading]],t||$(s.desc).each(function(){u.push(o[this])}),$(n._fields).each(function(){this.Hidden||u.indexOf(o[this.AliasIndex])!=-1||u.push(this)}),this.enumerateFields(n,f,u,i),n=btt(n);ti(f,"#app-panel-info-view"+(h?"-standalone":""),{position:h,className:"app-panel-info-view"})},deletePage:function(t){function e(){var e=t.scrollable,u=n.elementsToDelete,r;if(e&&e.removeData().off(),i.parent().length&&i.page("destroy").remove().empty(),u&&f)for(delete n.elementsToDelete,r=0;r<u.length;r++)u[r].remove();t.dataView=null;t.page=null;t.scrollable=null}var o;typeof t=="string"&&(t=tt(t));var i=t.page,u=t.dataView,r,s,f=i&&ot(i);u&&(f&&(s=n.elementsToDelete=[]),u.dispose());i?f&&!i.is(".app-hidden")?(n[u._id+"_PendingPageDelete"]=e,tr(function(){ot()||i.fadeOut(e)})):e():u&&u.dispose();r=n._modalDataViews.indexOf(t.id);r!==-1&&n._modalDataViews.splice(r,1);r=n._pages.indexOf(t);r!==-1&&n._pages.splice(r,1);o=yi("list");$(o).each(function(n){var i=this;if(i.hash==="#"+t.id)return o.splice(n,1),n<yi("index")&&lc.activeIndex--,!1});delete n._pageMap[t.id]},garbageCollector:function(t){var i=n._pagesToDelete;arguments.length?i.push(t):i.length&&setTimeout(function(){$(i).each(function(){n.deletePage(this)});i.splice(0,i.length)},32)},modalDataView:function(n,t){var i=this,r;t!==!1&&i.busy()||(n&&i.busy(!0),t&&setTimeout(function(){n!==si()&&i.modalDataView(n,!1)}),n?(r=i.pageInfo(n),da&&(r.text=da,da=null),r.dataView._lookupInfo||(r.dataView._isModal=!0),i._modalDataViews.indexOf(n)===-1&&i._modalDataViews.push(n),i.changePage(n)):($(i._modalStack).each(function(){i.deletePage(this)}),i._modalStack=[]))},unloadPage:function(n,t){function o(){i._modalStack.indexOf(r)==-1&&i._modalStack.push(r)}var i=this,r=i.pageInfo(n),f;if(r&&(f=i._modalDataViews.indexOf(r.id),f>=0)){var s=r.dataView,h=k(s._parentDataViewId),u=i.pageInfo(t),e=u?i._modalDataViews.indexOf(u.id):-1;(u&&(h===u.dataView||u.home)||t.attr("id")==="Main"||e>=0&&f>e)&&o()}},sidebar:function(){return fy()},desktop:function(){return!h},rowContext:function(n,t){kh(n,t)},animate:function(){return ny()},clearHtmlSelection:function(n){vo(n)},tapping:function(){return vr.apply(n,arguments)},lastTouch:function(){if(arguments.length===1)arguments[0]===!0?ki=vg:(vg=ki,ki=null);else return ki},invokeInTargetPage:function(n){var t,i,u;(r.splitTop||r.splitLeft)&&(i=$(document.elementFromPoint(ki.x,ki.y)),u=ot(),detailPane=i.closest(".app-reading-pane-detail"),u&&!detailPane.length&&i.closest(".app-reading-pane-master,.app-sidebar,.app-bar-toolbar").length?t=-1:!u&&i.closest(".app-reading-pane-detail").length&&(t=1));t?($app.touch.pageTransitionCallback=n,setTimeout(function(){window.history.go(t)})):n()},syncEmbeddedViews:function(n){uu(n)},animatedScroll:function(n,t,i){py(n,t,i)},scroll:function(n,t){af(n,t)},configureFilter:function(t){n.contextScope(t.scope);bh(t);n.contextScope(null)},pointer:function(t){return arguments.length?t===n.pointer():h?"touch":"mouse"},touched:function(t,i){if(i||(i=2),t.length){var r=gt(t),u=n.lastTouch();return r.left-i<=u.x&u.x<=r.right+i&&r.top-i<=u.y&&u.y<=r.bottom+i}},toggleTooltip:function(n,t){var i=t?ca:fo;n.attr("data-title")?(n.attr("data-title",i),h||setTimeout(function(){n.attr("title",i).trigger("mouseenter",10)},50)):n.attr("data-title",i)},busy:function(n){var t=this,i,r=t._busyDV;if(arguments.length===1)isBool=typeof n=="boolean",typeof n=="boolean"?(t._busy=n,i=t._glassPane,i||(i=t._glassPane=p("app-glass-pane")),n?i.is(".app-glass-pane-active")||i.addClass("app-glass-pane-active").appendTo(c):i.parent().length&&i.detach().removeClass("app-glass-pane-reject app-glass-pane-active")):n.progress?r||(t._busyPh=dr(),r=t._busyDV=$create(kr,{},null,null,dr().get(0)),r._busy(!0)):r&&(r._busy(!1),$(r._element).remove(),r.dispose(),t._busyDV=null);else return t._busy===!0},executeInContext:function(t,i,r,u){var o=arguments,e,f,s;if(yt()&&!u)setTimeout(function(){n.executeInContext.apply(this,o)},50);else if(e=[],n.navContext(e),o.length){if(f=[],$(e).each(function(){var n=this;if((!r&&(t&&n.icon===t||!t&&n.text===i)||r&&r===n.path)&&(f.push(n),o.length>1||t&&!t.match(/material-icon-(add|edit)/)||n.uiScope!=="Grid"))return!1}),f.length){if(s=f[f.length-1],u)return s;yf(s)}}else $(e).each(function(){var n=this;if(n.text&&n.icon!=="dots"&&!n.system&&!n.isStatic)return u?n:(yf(n),!1)})},navigate:function(t){typeof t=="string"?(t.match(/^#/)&&(t=t.substring(1)),n.changePage(t)):t.id&&$("#"+t.id).length?($("#"+t.id).trigger("navigating.app"),n.changePage(t.id)):t.href&&nd(t.href,t.transition)},changePage:function(t,i){var c;si()!==t&&yt(!0);var o=l(),f=o&&n.pageInfo(o.attr("id")),r=n.pageInfo(t),a=$.Event("navigating.app");if(r&&(r.navigating?r.navigating=!1:r.page&&(r.page.trigger(a),a.isDefaultPrevented()&&(r.initialized=!1,r.navigating=!0))),trt(!0),n.pageInit(t)){page=n.page(t).css("padding-top",o.css("padding-top"));var y=pi.pageTransition,u=n.pageInfo(t),v=u.home,e,s,h=u.navigateInfo;if(h){u.navigateInfo=null;ii.navigate(h.href,{transition:h.transition});yi("last").hash="#"+u.id;return}e=u.replaceUrl;f&&f.deleted&&(b.location.replace("#"+t),tr(function(){var t=dt();t._doneCallback=f.dataView._doneCallback;t._cancelCallback=f.dataView._cancelCallback;n.deletePage(f);vw(l())}));ii.changePage("#"+t,{changeHash:!(i===!1)&&!v,transition:"none"});s=yi("last");e&&(u.replaceUrl=null,$("#"+t).attr("data-url",decodeURIComponent(e)),ii.navigate.navigator.squash(e),s.url=decodeURIComponent(ii.path.makeUrlAbsolute(e,ii.path.documentBase)));v&&(s.transition=y,ii.path.documentBase.hrefNoHash=ii.path.documentBase.hrefNoSearch,ii.path.documentBase.href=ii.path.documentBase.hrefNoSearch+ii.path.documentBase.hash)}else r.home&&(c=[],n.navContext(c),n.refreshAppButtons(c,{toolbar:!0}),n.refreshMenuStrip())},title:function(){return document.title},navContext:function(t,i){var r=n.contextPageInfo(),e=r&&r.dataView,o=e&&e.extension(),s=ws(),h,u;if(so&&n._started&&t.push({text:pd.Exit,icon:"material-icon-exit-to-app",toolbar:!0,system:!0,callback:bet},{}),o&&!t.isKiosk?(i||o&&o.context(t),r.dataView._parentDataViewId&&(r=n.pageInfo(r.dataView._parentDataViewId),e=r.dataView)):hd(t),t.isSideBar||t.isKiosk||(t.length&&t.push({}),lt("help.enabled")&&!b.location.pathname.match(/\/help(\/|$)/)&&rr&&!f.host&&(pp||(pp={text:se.HelpLink,system:!0,toolbar:!1,icon:"material-icon-info",callback:function(){rr.help()}}),t.push(pp))),bu.list.length&&(bu.list.splice(0),bu.keyCodes.splice(0)),t.isAppBuilder=s,h=t.length,hr.trigger($.Event("context.app",{context:t})),s)for(u=t.length-1;u>=h;)t[u--].appBuilder||t.splice(u+1,1);$(t).each(function(){var t=this.shortcut,n;t&&(n=bu.cache[t],n||(n=pn(t),bu.cache[t]=n),n.which&&!t.invalid&&(bu.keyCodes.push(n.which),bu.list.push(n)))});fn()&&!t.isSideBar&&t.push({text:fc.Tools,system:!0,icon:!1,toolbar:!1,transition:!0,callback:uht})},refreshAppButtons:function(t,i){var ur,er,ei,or,pt,et,si,hi,ci,ai,wt,y,vi;if(!gu()){var kt=n._title,sr=Math.max(d(n._toolbar,"width")/2,kt.offset().left+(kt.is(".app-hidden")?0:kt.outerWidth()-1)),a,u,yi=n._contextButton,st=[],it,c=[],nt={search:fs,user:et,apps:e.Apps},pi={},ht={},p,ni,g=[],ct=[],wi,bi,ki,gi,nr,ut=dt(),lt=ot(),ft=li(),h=!i&&lt?k(ut._parentDataViewId):i&&i.dataView||ut,ti=h?ft?$(".app-reading-pane-detail").attr("id")||ut&&ut._id:ut&&ut._id:"none",ii=0,v,tr=i&&i.buttonBars||$("#"+ti+" .app-bar-buttons"),at=i&&i.layout||$("#"+ti+" [data-layout]"),rt=h&&n.content(h._id).prevAll(".app-bar-actions"),ri,ir,rr,yt,ui=n._backText,fi;if(i&&i.promo&&h&&(ur=tt(h).page.find(".app-page-modal-title").removeClass("app-has-btn1"),yt=!h||!h.get_showActionBar()||h.get_isForm(),$(t).each(function(){var t=this,i;u=t.icon;i=t.toolbar!==!1&&u&&!u.match(/more|back|undo/);u&&(yt||t.uiScope==="ActionBar"&&(u==="material-icon-add"||u==="material-icon-edit")||t.system&&u!=="material-icon-info-outline")&&(u==="search"?ur.addClass("app-has-btn1"):(u.match(/^(refresh|phone|email|eye)$/)||i)&&!h.get_isForm()&&p!=="material-icon-add"&&(n.promo(u,t.text),p=u))}),p||n.promo(!1)),(!i||i.toolbar)&&(ui.css("max-width",""),yi.attr("title",fr).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),t.length&&yi.show(),wot(),n._toolbarButtons.each(function(){a=$(this).removeClass("app-avatar app-btn-text").show();er||(er=a.show()[0].offsetWidth);a.offset().left>sr-(wr()?r.left:0)&&st.push(a);a.hide()}),it=st.length,it>0)){for(yt=!h||!h.get_showActionBar()||h.get_isForm(),$(t).each(function(){var n=this,t;u=n.icon;t=n.toolbar!==!1&&u&&!u.match(/more|back|undo/);u&&(yt||n.uiScope==="ActionBar"&&(u==="material-icon-add"||u==="material-icon-edit")||n.system&&u!=="material-icon-info-outline")&&(u==="search"?nr=!0:u==="refresh"?bi=!0:u==="phone"?wi=!0:u==="email"?gi=!0:u==="eye"&&t?ki=!0:t&&c.indexOf(u)===-1?c.push(u):u=null,u&&nt[u]==null&&(nt["__"+u]=cv(n,!1),nt[u]=cv(n)+(n.desc&&n.descInTooltip!==!1?"\n"+n.desc:""),n.rotate&&(ht[u]=n.rotate),n.path&&(pi[u]=n.path),n.uiScope==="ActionBar"&&ct.push(u)))}),gi&&c.push("email"),wi&&c.push("phone"),ki&&c.push("eye"),bi?c.push("refresh"):!c.length||h&&(h.editing()||h.get_isForm()&&bn())||!o("ui.actions.promote")||$(".app-reading-pane-detail:not(.app-hidden)").length?n.promo(!1):(h&&(ei=h.get_isForm()?"material-icon-edit":"material-icon-add",fi=c.indexOf(ei),fi>0&&(c.splice(fi,1),c.unshift(ei))),$(c).each(function(){var n=this;if(!n.match(ep))return p=n.toString(),!1}),h&&(tt(h).loading||h.get_searchOnStart()||h._requiresContextRefresh)||!n.promo(p,nt[p],ht[p])||(n.promo().data("icon-list",{icons:c.slice().reverse(),labels:nt}),g.push(p),c.splice(c.indexOf(p),1))),nr&&(c.length<it?c.push("search"):c[it-1]="search"),cu||(r.width>=oi("md")||di())&&(f.odp.offline()&&(c.push(ni=f.odp.offline("icon")),nt[ni]=f.odp.offline("tooltip")),o("ui.menu.apps.location")==="toolbar"&&c.push("apps"),ho&&c.push("user"));ct.length>0;)u=ct[0],ct.splice(0,1),c.indexOf(u)!==-1&&c.splice(c.indexOf(u),1);for(c.length<it&&(ii=it-c.length),v=0;v<ii;v++)$(st[v]).hide();while(v<it)a=$(st[v]),u=c[v-ii],a.attr("data-title",nt[u]).data("action-path",pi[u]).empty(),g.push(u),u==="user"?(pt=b._userLetters,et=f.userName(),pt||(b._userLetters=pt=wc(et)),lv(et,vs("app-icon-avatar").text(pt).appendTo(a.addClass("app-avatar").attr("title",et)))):(bt(ko(u),a),ht[u]&&a.find("i").css("transform","rotate("+ht[u]+"deg)")),a.data("icon",u).show(),or||(or=!0,si=gt(ui),hi=si.left,hi&&(ai=u.match(/^(user|apps)$/)?null:nt["__"+u]||nt[u],p||!h||!h.get_isForm()||ft||lt||ai==null||!a.is(":visible")||l(".app-bar-buttons").length||$(hr[0].createTextNode(ai)).appendTo(a.addClass("app-btn-text")),ci=gt(a),si.right>ci.left-12&&ui.css("max-width",ci.left-hi-12))),v++;n._usedToolbarIcons=g.slice(0)}for(tr.length&&tr.each(function(){function v(){c||(c=vt("ui-btn ui-corner-all ui-mini app-btn-more app-btn-icon-notext",'data-action-path="more"').html("&nbsp;").attr("title",fr).appendTo(i))}var i=$(this),r,c,f,u,w=ft||lt||o("ui.actions.form.icons"),l,a,p;if(i.is(":visible"))if(i.children().remove(),i.closest(".app-reading-pane-detail").length&&bt("material-icon-close",s("app-btn-close").appendTo(i).attr("data-title",lp)),wt)i.append(wt.html()).toggleClass("app-bar-buttons-md",wt.is(".app-bar-buttons-md"));else{if(wt=i,l=h&&h._isWizard,a=t,y||(y=[],ft&&(a=[],p=n.contextScope(),n.contextScope(ti),n.navContext(a),n.contextScope(p)),$(a).each(function(){var n=this,t=n.icon;!n.system&&t!=="dots"&&n.text&&n.uiScope==="Form"&&(y.push(n),n.command==="Cancel"&&(f=y.length-1))})),l&&(y=y.reverse(),f!=null&&(f=y.length-1-f)),u=gt(i),i.closest(".app-reading-pane-detail-vertical").length||(u={width:u.width-8,right:u.right-8}),l&&(y.splice(0,0,{text:e.Prev,path:"wizard-prev"},{text:e.Next,path:"wizard-next"}),f!=null&&(f+=2,cancelButton=y[f],y.splice(f,1),i.width>375&&y.splice(0,0,cancelButton))),$(y).each(function(){var n=this,r=n.path,t=vt("ui-btn ui-mini").text(n.text).attr("data-action-path",n.path).appendTo(i),u=n.icon;(n.shortcut||n.tooltip)&&t.attr("title",cv(n));r&&r.match(/^wizard/)?t.addClass("app-btn-has-icon"):u&&w&&bt(u,t.addClass("app-has-icon"))}),ve("status",{layout:at}),h.session("zoomed")||i.toggleClass("app-bar-buttons-md",u.width>=oi("md")),r=i.find(".ui-btn").last(),(ft||lt)&&(v(),r=c),r.length&&gt(r).right>u.right&&(i.find(".ui-btn").css("min-width","8em"),gt(r).right>u.right&&(i.find(".ui-btn").css("min-width","4em"),gt(r).right>u.right&&l&&i.find(".app-btn-has-icon").addClass("app-btn-icon-notext"),gt(r).right>u.right)))for(v();r.length&&gt(c).right>u.right;)r===c||r.is(".app-btn-close")||r.hide(),r=r.prev();h&&(kg(h)&&i.append(i.find(".ui-btn").get().reverse()),i.append(i.find(".app-btn-more")))}}),at.length&&(vi={},at.find('[data-control="action"]').each(function(){var i=$(this),r=at.attr("data-input-container"),n,u,t;n=vi[r];n||(n=k(r),vi[r]=n);n&&(u=n.findAction(i.attr("data-action")),u||(i.css("visibility","hidden"),t=i.closest('[data-container="row"]'),t.length&&!t.find("[data-control]").filter(function(){return $(this).css("visibility")!=="hidden"}).length&&t.remove()))}));g.length;)if(v=0,g[0]==="user"||g[0]==="apps"||g[0]===ni)g.splice(0,1);else while(v<t.length)g.length&&t[v].icon===g[0]?(t.splice(v,1),g.splice(0,1)):v++;(!i||i.toolbar!==!1||i.actionBar===!0)&&rt&&rt.length&&(ri=rt.find("h3").next(),ir=Math.floor(ri.offset().left)+ri.outerWidth(!0),rr=Math.floor(rt.offset().left)+ie(rt)-8,rt.data("selector").toggleClass("app-hidden",!h.get_showViewSelector()||w.left.visible&&o("ui.sidebar.views.collapsed")===!0),drt(h,rt.data("controls"),ir,rr,!0,p))}},endModalState:function(t,i){if(!et){et=!0;var r=n.page(i._id);ou()}},renderContext:function(n,t,i){var a=!0,v,u=t.isSideBar,e=u&&w.left.mini,r,l,o={},c;t.forEach(function(r,l){var rt,at,tt,ut;if(!i||i(this)){var p=r.text,ft=r.shortcut,et=r.count||ft,b=ko(e&&r.miniIcon||r.icon),g=tl(b),ot=b==="check"||g?"false":b==="ok"?"check":b,st=r.rotate,it=r.href,k=r.itemClassName,y,v,nt=r.sidebarCollapse,d=r.depth,ht=!1,lt;(p==="$separator"&&(p=""),u&&(w.left.mini&&!b&&(p&&!r.transition||r.src)||r.sidebar===!1)||r.hidden)||(y=ct().attr({"data-icon":!ot&&r.pageTransition&&!g?"false":ot}).appendTo(n),r.callback||r.dataRel||it?(v=vt().appendTo(y).data("context-action",r),e?(v.html("&nbsp;").attr("title",p),p&&r.transition&&s().text(p.substring(0,1)).appendTo(v)):v.text(p),it&&v.attr({rel:"external",href:it}),!et||(u||h)&&ft||s("ui-li-count").appendTo(v.addClass("ui-li-has-count")).html(et),r.dataRel&&v.attr("data-rel",r.dataRel),r.isField&&y.addClass("app-context-field")):r.isStatic?(y.html(p),r.isField&&y.addClass("app-context-field")):r.src?f.odp.blob("url",r.src).done(function(n){cr("img","ui-li-thumb").appendTo(y.addClass("ui-li-has-thumb")).attr({src:n})}):(a&&l?y.remove():(lt=y.attr("data-role","list-divider").html(p),!r.isStatic&&p&&r.instruction!==!1&&lt.addClass("app-list-instruction")),a=!0,ht=!0),ht||(a=!1),r.desc&&!e&&(rt=r.display==="before",rt&&dr("app-item-desc app-item-desc-before").insertBefore((v?v:y).contents()).text(r.desc),at=dr("app-item-desc").appendTo(v?v:y).text(r.desc),rt&&at.addClass("app-item-desc-after")),r.wrap&&y.addClass(r.callback?"app-wrap-text":"app-wrap"),r.disabled&&y.addClass("ui-disabled"),st&&(k=(k||" ")+" app-icon-rotate"+st),k&&y.addClass(k),r.linkClassName&&v.addClass(r.linkClassName),r.keepOpen&&(v.addClass("app-keep-open"),r.animate||r.count||v.addClass("app-btn-icon-transparent")),r.animate&&v.addClass("app-animated app-animation-spin"),r.selected||b==="check"?(u?v.addClass("app-option-selected"):d||bt("material-icon-check",v),d&&v.addClass("app-item-selected"),g&&bt(b,v)):g&&bt(b,v),r.state&&v.addClass("app-selected"),r.tooltip&&(v.attr("title",r.tooltip),k&&k.indexOf(/tile$/)||v.addClass("app-btn-tooltip")),nt&&u&&(o[nt]||(o[nt]=[]),o[nt].push(y)),tt=r.user,tt&&lv(tt,vs("app-icon-avatar").appendTo(v.addClass("app-avatar")).text(wc(tt))),d&&(r.selected&&(c=y),y.addClass("app-has-depth"),v.addClass("app-depth"+d),ut=t[l+1],ut&&d<ut.depth&&bt("material-icon-expand-more",y.addClass("app-collapsible")).addClass("app-btn").attr("data-title",fo),d>1&&iv!=="all"&&!(y===c&&y.find(".app-btn").length&&iv==="current")&&y.addClass("app-collapsed")),(r.transition&&!r.reverse||r.pageTransition)&&bt(e?"material-icon-navigate-next":"material-icon-chevron-right",v.addClass("app-group-actions")),r.popOut&&!e&&bt("material-icon-chevron-right",v),r.color&&s("app-color-block").appendTo(v).css("background-color",r.color))}});c&&(c.is(".app-collapsed")||iv==="current")&&bg(c);for(v in o)if(r=o[v],r.length>4){for(l=3;l<r.length;l++)r[l].hide();vt().appendTo(ct("",'data-icon="false" data-theme="a"').insertBefore(r[3])).text("+"+(r.length-3)+" "+fr.toLowerCase()).data("context-action",{callback:yot})}},tabs:function(t,r){function f(n,t){if(!n||n==="page"||n==="user")return null;var u=grt(r.id)||[],i,f;if(n=n.toString(),$(u).each(function(t){var r=this;if(r.oid===n)return i=r,f=t,!1}),arguments.length===1)return i?i.tab:null;i?u.splice(f,1):i={oid:n};i.tab=t;u.push(i);u.length>10&&u.splice(0,1);grt(r.id,u)}function o(){var t=r.tabs,o=r.scope,s=r.placeholder||$((t[0].content||[])[0]),i=r.container||p("app-tabs ui-header ui-bar-inherit").insertBefore(s).addClass(r.className),h=nr().appendTo(i),n=t[0].text;$(t).each(function(){var t=this;t.active&&(n=t.text);$(t.content).each(function(){$(this).addClass("app-tab-content")})});r.id||(r.id=s.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(i.attr("id",r.id),n=f(o)||o==="page"&&fu(r.id)||o==="user"&&ri(r.id)||n);$(t).filter(function(){return this.text===n}).length||(n=t[0].text);$(t).each(function(t){var i=this,f=vt("ui-btn").appendTo(ct().appendTo(h)).text(i.text).attr("data-text",i.text),r=i.content,u;i.active=i.text===n;i.active&&(t>0&&(r&&r.length&&$(r[0]).is('[data-container="tab"]')&&(r=r.children()),$(r).each(function(){var n=this.style;if(n&&n.display!=="none")return u=!0,!1})),u&&t?(n=null,i.active=!1):f.addClass("ui-btn-active app-tab-active"))});n||(t[0].active=!0,h.find(".ui-btn").first().addClass("ui-btn-active app-tab-active"));r.forceSelectedTab=arguments.length!==2?null:arguments[1].selectedTab;i.data({"data-tabs":r.tabs,options:r});e(i);u(i,!1)}function s(n){n||(n=r.container?r.container.find(".app-tabs"):g().find(".app-tabs"));n.find("ul").off();n.data({"data-tabs":null,options:null})}function e(n){n||(n=g().find(".app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){$(this).toggleClass("app-tab-active",n.active)})})})}function u(n){n||(n=(r&&r.page||l()).add($(".ui-page-active .app-bar-header.ui-header-fixed")));var t=n.find(".app-tabs").addBack(".app-tabs");t.find("ul").css("visibility","");t.each(function(){var t=$(this),r=t.width(),h=t.data("data-tabs"),u=t.offset().left+d(t,"padding-left"),i,n,s,e,o,f;if(r||t.data("dynamic"))if(t.find(".app-tab-more").parent().remove(),i=t.find(".ui-btn").css({"padding-left":"","padding-right":"","min-width":"","max-width":"",display:""}).removeData("hidden"),$(h).each(function(n){var r=this,f=0,t=Array.isArray(r.content)?$(r.content).map(function(){return this.toArray()}):$(r.content),u;t.length===1&&$(t[0]).is('[data-container="tab"]')&&(t=$(r.content).children());t.length&&(t.each(function(){var t=this,n=t.style;n&&n.display==="none"&&f++}),t.length===f&&(u=$(i[n]),u.css("display","none").data("hidden",!0),u.is(".app-tab-active")&&(o=!0)))}),f=i.filter(function(){return this.style.display!=="none"}),f.length<2)t.css("display","none").data("dynamic",!0),o&&$(f[0]).trigger("vclick");else{if(t.css("display")==="none"&&(r=t.css("display","").width(),u=t.offset().left+d(t,"padding-left"),o=!1),t.find("li").removeClass("app-first-child app-last-child"),$(f[0]).parent().addClass("app-first-child"),n=$(f[f.length-1]).parent().addClass("app-last-child"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","8em"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","4em"),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":"1em","padding-right":"1em"}),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":".5em","padding-right":".5em"}),n.offset().left-u+n.outerWidth()>r)))))for(n.parent().removeClass("app-last-child"),n=vt("ui-btn app-tab-more").appendTo(ct("app-last-child").appendTo(n.closest("ul"))).text(fr).css({"min-width":"4em","padding-left":"0.5em","padding-right":"0.5em"}),e=i.length-1;n.offset().left-u+n.outerWidth()>r;){if(!e){$(i.get(0)).css("max-width",r-n.outerWidth()-12);break}s=$(i.get(e)).css("display","none");s.is(".app-tab-active")&&n.addClass("ui-btn-active");e--}o&&$(f[0]).trigger("vclick")}})}if(!n._initialized){n._initialized=!0;$(document).on("vclick",".app-tabs .ui-btn",function(t){function y(){s.find(".app-tab-active").is(":visible")||s.find(".app-tab-more").addClass("ui-btn-active")}function g(){n.stub("put");ht.detach(!0);e(c);y();a.callback&&a.callback();r.change&&(os=!1,r.change(a),pf(),r.restoreScrolling!==!1&&kit(w));r.stickyHeader&&uf();n.stub("trim")}var o=$(t.target).closest("a"),c=o.closest(".app-tabs"),r=c.data("options"),s=c.find("ul"),p=r.forceSelectedTab,d=r.tabs,h=r.selectedTab||r.forceSelectedTab||o.attr("data-text"),w=l(),a,b,v,k;if(i.cancel()){if(p&&(r.selectedTab=p),o.length)if(!r.selectedTab&&o.is(".app-tab-more"))k=s.find(".ui-btn").removeClass("ui-btn-active"),kt(o,function(){o.addClass("ui-btn-active");v=[];$(r.tabs).each(function(n){var t=this;$(k[n]).data("hidden")||v.push({text:t.text,icon:t.active?"check":!1,wrap:!0,context:{text:t.text,index:n},linkClassName:"app-btn-icon-transparent",callback:function(n){o.removeClass("ui-btn-active");r.selectedTab=n.text;$(s.find(".ui-btn")[n.index]).trigger("vclick")}})});yr({items:v,anchor:o,afterclose:function(){setTimeout(function(){o.removeClass("ui-btn-active");s.find(".app-tab-active").addClass("ui-btn-active");y()},50)}})});else{if(s.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),o.addClass("app-tab-active ui-btn-active"),$(d).each(function(){var n=this;n.active&&h===n.text&&(b=!0);n.active=n.text===h;n.active&&(a=n)}),b){r.selectedTab=null;y();return}r.scope==="page"?fu(r.id,h):r.scope==="user"?ri(r.id,h):f(r.scope,h);fb(w);r.selectedTab&&(r.selectedTab=null,u(c));g()}return!1}})}switch(t){case"create":r.tabs&&r.tabs.length>1&&o(r);break;case"destroy":s();break;case"fit":u()}},refreshTitleState:function(){n._title.toggleClass("app-hidden",n._menuButton.is(".ui-icon-bars"))},refreshMenuStrip:function(){var t=n._menuStrip,i=t&&t.strip,y=n._logo,tt=d(y,"left"),b=tt+y.width("").outerWidth(),k=w.left.visible?(w.left.mini?b:w.left.width)+1:b,g=n._toolbar,it=g.find(".app-btn-cluster-right .ui-btn").filter(lr).first(),l=(it.length?it.offset().left:ie(g))-16,rt=pr,a,v,e,ut,h,ft=o("ui.menu.location")==="toolbar",u,nt,et,ot,f,c;if(!i)if(t=n._menuStrip={strip:p("app-menu-strip").appendTo(g)},i=t.strip,ft){for(a=nr(),f=0;f<rt.length;f++)c=rt[f],u=ct().appendTo(a),nt=vt("ui-btn").toggleClass("app-is-link",!!op&&!gf(c.url)).appendTo(u).text(c.title).attr({title:c.description}).data("data-node",c),c.children&&nt.addClass("app-has-children"),c.selected&&nt.addClass("app-selected");t.links=a.find(".ui-btn");t.items=t.links.parent();t.more=vt("ui-btn app-has-children").appendTo(ct().appendTo(a)).text(fr);a.appendTo(i)}else t.title=s("app-menu-strip-title").appendTo(i.addClass("app-menu-strip-has-title")).text(or.currentNode?or.currentNode.title:document.title);if(h=l-k,ft){if(h!==i.data("tested-width")||!i.is(":visible"))if(i.data("tested-width",h),r.width>414&&h>=200&&i.attr("data-enabled")!=="false"&&n._menuButton.is(".ui-icon-bars"))for(i.removeClass("app-hidden"),rl(!0),i.width(h).css({left:k}),v=t.items,e=t.more.removeClass("app-selected").parent(),moreLink=e.find(".ui-btn").text(fr),e.hide(),v.show(),f=v.length-1;f>=0;f--){if(u=$(v[f]),ot=u.outerWidth(),et=u.offset().left,et+ot-1>=l&&(e.show(),ut=e.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&t.more.addClass("app-selected"),!e.is(":visible")||e.offset().left+ut-1<l){f<=1&&!u.is(":visible")&&rl(!1);break}else u.hide(),u.find(".app-selected").length&&t.more.addClass("app-selected");if(f<=1){rl(!1);break}}else rl(!1)}else i.width(h).css({left:k}),rl(h>=100);b>l&&y.width(l-tt)},refreshSideBar:function(t,i){function st(){var u,h,t,b;if(y=!1,u=lt("ui.sidebar.views.styles"),h=lt("ui.sidebar.views.names"),f.dataView().get_showViewSelector()&&(u||h)){var v=[],l=o("ui.sidebar.views.collapsed")===!0,r=a.dataView,k=r.get_view().Label,p;lit(i);h&&r.get_showActionBar()&&pk(v,!1,a,null,!0)>1&&(w.left.mini||l||($(v).each(function(){i.push(this)}),i.push({})));t=[];f.tagged("view-style-grid-disabled")||t.push({text:e.Grid,icon:"grid",selected:g,callback:function(){g||oh(s,"Grid")}});f.tagged("view-style-list-disabled")||t.push({text:e.List,icon:"bullets",selected:it,callback:function(){it||oh(s,"List")}});f.tagged("view-style-cards-disabled")||t.push({text:e.Cards,icon:"cards",selected:nt,callback:function(){nt||oh(s,"Cards")}});f.tagged("supports-view-style-map")&&!f.tagged("view-style-map-disabled")&&t.push({text:e.Map,icon:"location",selected:rt,callback:function(){rt||oh(s,"Map")}});n.presenter("enumerate",{id:s,list:ut});$(ut).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.name==c&&(n.selected=!0),t.push(n))});u&&t.length>1&&(l?$(t).each(function(){var n=this;if(n.selected)return p=n.text,viewStyleIcon=n.icon,!1}):($(t).each(function(){i.push(this)}),lit(i)));l&&(b=r._totalRowCount>0?" ("+String.format("{0:N0}",r._totalRowCount)+")":"",i.push({text:k+b,desc:p,icon:"material-icon-folder-open",context:{position:"left"},popOut:!0,itemClassName:"app-view-selector",callback:hut}))}}var a=tt(ot()?dt()._parentDataViewId:null),r=a&&a.dataView,b=r,s=r&&r._id,u=r&&r.get_parentDataView(r),h=[],k=r&&r.get_showActionBar(),v=$('.TaskBox.About .Inner .Value, head meta[name="description"]'),d=u&&!u._parentDataViewId,y=r&&r.get_isGrid(),f=r&&r.extension(),c=y&&f.viewStyle(),g=c==="Grid",nt=c==="Cards",it=c==="List",rt=c==="Map",ut=[],ft=[],et=["material-icon-undo","check","info"],p,l;if(d&&!r.rowIsTemplate()){while(r&&h.indexOf(r)===-1){if(u&&u._dataViewFieldName)break;(r.get_showInSummary()||u&&r!==u&&u.get_showInSummary())&&!r.inserting()&&r.commandRow()&&h.unshift(r);r.get_isForm()&&(r=u);r=btt(r)}p=i.length;$(h).each(function(){n.enumerateFields(this,i)});i.length>p&&(r=h[h.length-1],l=i[p],l.icon="material-icon-chevron-right",l.miniIcon="material-icon-info-outline",l.context=r._id,l.callback=dn,i.push({}))}k&&b&&(b.extension().context(ft,["ActionBar"]),$(ft).each(function(){var t=this,n=t.icon;t.uiScope==="ActionBar"&&n&&n!=="dots"&&n!=="carat-r"&&et.push(n)}));$(t).each(function(){var n=this;et.indexOf(n.icon)!==-1||n.system&&n.toolbar===!1||n.command==="Select"||n.icon==="eye"&&(!u||u.get_showInSummary())||(n.text||i.length)&&(n.navigateTo&&y&&st(),n.theme=null,n.uiScope==="ActionBar"&&k||i.push(n))});y&&st();w.left.mini||o("ui.menu.location")!=="sidebar"||(i.length&&i[i.length-1].callback&&i.push({}),ff(i,!0,pr,1),!lt("ui.sidebar.toolbar")&&lt("settings.enabled")&&i.push({},{text:e.Settings,icon:"material-icon-settings",transition:!0,callback:yht}));v.length&&d!==!1&&(i.length&&i[i.length-1].text&&i.push({}),i.push({text:v.is("meta")?v.attr("content"):v.html(),isStatic:!0,wrap:!0}))},contextPageInfo:function(){return tt(n._contextScope)},refreshContext:function(){fi.apply(n,arguments)},resetUI:function(){var n=$(".ui-page-active .app-bar-buttons"),i=n.outerHeight(),t;fi(!1,0,function(){ei();irt();n.length&&(t=g(),t.scrollTop(t.scrollTop()+n.outerHeight()-i));uf()})},contextScope:function(t){if(arguments.length)t&&t._controller&&(t=t._id),n._contextScope=t;else return n._contextScope},contextDataView:function(t){var i,r,u;if(t!=null){if(i=ni(t),i.length)return k(i.attr("data-for"));if(u=t.closest(".ui-page"),!u.is(".ui-page-active")&&li(u))return k(dt()._parentDataViewId)}return r=n.contextPageInfo(),r?r.dataView:null},showContextMenu:function(t){t||(t={scope:""});var r=t.position||"left",i="#app-panel-context-"+r;t&&(n.contextScope(t.scope),t.scope&&(i+="-scope",t.position=r));vc(iut(i,function(){n.refreshContextMenu(i)},t))},refreshContextMenu:function(t,i,u){var h=n,o=$(t),v=o.find(u||"ul"),f=v.length?v:o.find("ul"),g=f.outerHeight(),y,p,s=o.is(".app-sidebar"),b,k,e,d,a;if(s&&!o.is(":visible")){i=[];h.navContext(i);h.refreshAppButtons(i);return}if(s&&!na&&(p=$("<div><\/div>").appendTo(c).css({"z-index":2e3,position:"absolute",left:0,top:o.find(".ui-panel-inner").offset().top,width:o.outerWidth(),height:r.height,"background-color":"#fff"})),g&&(y=$("<div><\/div>").height(g).insertAfter(f)),pl(f),f.find("a").removeData(),f.find("li").remove(),i||(i=[],i.isSideBar=s,i.isKiosk=di("ontop"),h.navContext(i)),s&&(h.refreshAppButtons(i),k=[],e=0,h.refreshSideBar(i,k),i=k,i.isSideBar=!0,w.left.visible&&w.left.mini))for(d=n._usedToolbarIcons.slice();e<i.length;)if(a=i[e].icon,a)if(d.indexOf(a)!==-1)for(i.splice(e,1);e<i.length&&!i[e].text;)i.splice(e,1),e>0&&e--;else d.push(a),e++;else e++;var l=v.data("panel"),nt=o.attr("id").match(/^app-panel-(\w+)/),tt=s?"sidebar":nt&&nt[1];for(l&&l.match(/^\#app-panel-/)&&(l=l.substring(11)),b=$.Event("before"+tt+"panelshow.app"),b.panel={type:tt,id:l,items:i},$(document).trigger(b);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);h.renderContext(f,i);s&&w.left.mini||ct("",'data-role="list-divider"').appendTo(f);f.listview("refresh");f.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");f.find("li.app-wrap").addClass("ui-li-static").find("a").attr({"class":""});f.prev().find(".app-focus").length&&f.find(".ui-btn").first().addClass("app-focus ui-btn-active");o.is(".app-reset-scrolling")?o.find(".ui-panel-inner").scrollTop(0):hst(o);y&&y.remove();p&&p.remove();s&&w.left.inner.trigger("scroll")},pageShown:function(n){tr(n)},isWebView:function(){return gr&&!b.navigator.standalone&&!aft},isHosted:function(){return cu},screen:function(){return r},indicator:function(n){var t=f._busyIndicator,i;return n==="reset"?i=!0:t||(t=f._busyIndicator=p("dataview-busy-indicator").appendTo(c),i=!0),i&&t&&t.css({left:r.left-r.width,top:r.top,width:r.width}),t},kiosk:function(){return!1},toWidth:function(n){return arguments.length?typeof n=="string"?oi(n):le(n):df},icon:function(n,t){return bt(ko(n),t)},openHref:function(t){var r=t.match(/\?(.+)/),i={},e=/(\w+)=(.+?)(&|$)/g,u,f;if(r)for(u=e.exec(r[1]);u;)i[u[1]]=u[2],u=e.exec(r[1]);if(i._controller&&o("navigation.dataController.enabled")===!0){r={};for(f in i)f.match(/^_/)||(r[f]=i[f]);n.show({controller:i._controller,view:i._view||i._argument,startCommand:i._command,startArgument:i._argument,filter:r,syncWith:i._syncWith})}else return fh(t)},toSmartDate:function(n){return pb(n,new Date)},syncData:function(n){if(n){var t=n.dataView;t&&utt(t)}l(".app-echo").filter(lr).each(function(){var n=$(this).attr("data-for");utt(k(n),!0)})},notify:function(t){function e(n,t){var e=n._filterSource,r,u,i,f=n._dataViewFieldParentId;return i=sl(n),!i&&e&&(u=k(e),u&&(r=n._dataViewFieldName?n:n.get_parentDataView(),r&&(i=u.findField(r._dataViewFieldName),i||(f=r._dataViewFieldParentId,f&&(i=k(f).findField(r._dataViewFieldName)))))),i&&(t=i.HeaderText+": "+t),t}function o(n){var u=n._lastArgs,i,r,t;return u&&(i=n.findAction(u.Path),i&&i.Notify&&(t=i.Notify,t&&(t==="$none"?t=null:(t.match(/\{/)?t=n._parseText(t,n.row()):(r=f.touch.pageInfo(n),r&&(t+=" - "+r.text)),t=e(n,t))))),t}var u,i,r;if(t!=null){if(u=lt("ui.notify.enabled"),i=t.text,t._controller)return u?o(t):null;if(!u){t.force&&i&&f.alert(i);return}typeof t=="number"?t=t.toString():typeof t=="object"&&"stack"in t&&(t={text:location.hostname==="localhost"?t.stack:t.message,duration:6e4});typeof t=="string"?t={text:t.toString()}:Array.isArray(t)&&(t={text:t.join(", ")});t===!1&&(t={text:!1,force:!0});r=t.dataView;i=t.text;Array.isArray(i)&&(t.text=i=i.join(", "));r?(t.dataView=null,t.text=e(r,i),r._pendingNotification=t):i!==!1&&gf(i)||(di()&&ka.splice(0),ka.push(t),setTimeout(n.notify,150))}else vu?setTimeout(rw,100):rw()},stub:function(n,t){var i,f,r,u;t||(t=g());t.length&&t.scrollTop()&&(i=t.find(".app-stub,.app-stub-main"),f=i.length,n==="put"?(f||(i=p().appendTo(t).addClass("app-stub"+(est()?"-main":""))),i.height(i.outerHeight()+t[0].scrollHeight)):f&&(r=gt(i),u=gt(t),r.top>u.bottom?i.height(""):r.bottom>u.bottom&&i.height(Math.round(u.bottom-r.top))))},seeAll:function(t){var i=t,u,f,e=!1,r;typeof i=="string"&&(i=k(i));u=sl(i);u&&(f=k(u._dataViewId)._filterSource,f&&(r=k(f),r.get_isForm()&&(r=r.get_parentDataView()),r&&(e=r._dataText)));n.show({controller:i._controller,view:i._viewId,_filter:i._filter||[],_externalFilter:i._externalFilter||[],sort:i.get_sortExpression(),headerText:e,useCase:"seeAll",filterFields:i.get_filterFields(),filterSource:i.get_filterSource()})},details:function(t){var i=t.field,r=i._dataView,e=r._allFields[i.AliasIndex],s=r.editing()?r.editRow():r.commandRow(),u=t.key,o=e.format(s[e.Index]);u=u!=null?u:s[i.Index];i.ItemsTargetController&&$(i.DynamicItems||i.Items).each(function(){var n=this;if(n[0]==u)return o=n[1],!1});n.show({controller:i.ItemsDataController,view:t.view||"editForm1",filter:[{name:i.ItemsDataValueField,value:u}],headerText:o!=null?o:e.HeaderText,useCase:"ObjectRef",done:function(n){var e,u;si()===r._id?r.get_isForm()?(n._newRow&&n._newRow.length||(e=f.input.methods.lookup._rowToValues(i,n,n.editRow()),wi({dataView:r,values:e})),t.done&&t.done(n)):r.sync():(u=dt(),u&&!u.get_isForm()&&u.sync())},cancel:t.cancel})},syncWithOdp:function(t){var i=t&&t.odp;return i&&i.is(":dirty")&&i.root(t)&&t.get_isForm()&&!t.editing()&&(et=!0,n.executeInContext(ko("edit")),et=!1,pu()),i},toDataView:function(n){var t=ni(n);return t.length?k(t.data("for")):dt()},tooltip:function(n){n===!1?vi():dl(n.x,n.y,n.text,n.elem,n.autoHide===!1)},lookup:function(t){if(vi(),t.field&&cf(t.field),t.create){var u=t.field,g=t.dataInput,c=t.value,y=u.ItemsDataTextField,o=u._dataView;c==ec&&(c=null);n.show({controller:u.ItemsDataController,startCommand:"New",startArgument:u.ItemsNewDataView,filter:o.get_contextFilter(u,o.extension().collect()),defaultValues:c!=null&&y?[{name:y,value:c}]:null,done:function(n){var f=u._dataView,e,t;f._inlineEditor&&ht.showField(f,u.Name);e=i.methods.lookup._rowToValues(u,n,n.editRow());t=[];$(e).each(function(){t.push(this.value)});var o=0,s=u.DynamicItems||u.Items,r=t[1]?t[1].toString().toLowerCase():"undefined";if(u.ItemsStyle.match(/AutoComplete|Lookup/)){for(;;){if(u._dataView.session(gs(u)+r,null),!r.length)break;r=r.substring(0,r.length-1)}hw(u)}else $(s).each(function(n){if(this[0]==null||this[1].toString().toLowerCase()<r)o=n;else return!1}),s.splice(o+1,0,t);u.ItemsStyle.match(/AutoComplete|Lookup|DropDownList/)?(i.methods.lookup.focus(g.data("autoComplete",!1)),i.methods.lookup._useItemValue(u,t)):i.methods.listbox._useItemValue(u,t,!0)}});return}var s,f=t.field,h=f._dataView,p=[],w=cw(h,f,p),a,v,b=t.query,nt=h._allFields[f.AliasIndex],k=nt.HeaderText,d=k!=="&nbsp;"?k:f.AltHeaderText,tt=h.editRow();if(ul(),!f.ContextFields&&(s=n._modalStack.length&&n._modalStack[0].dataView,s&&s._lookupInfo&&s._lookupInfo.field==f&&yi("index")<yi("length")-1&&yi("next").hash=="#"+s._id)){s._lookupInfo=t;wp.go(1);return}n.modalDataView();a=f.ItemsDataController.toLowerCase();$find(a)&&(a+=ad.getComponents().length);o=$create(kr,{id:a,baseUrl:h.get_baseUrl(),servicePath:h.get_servicePath(),controller:f.ItemsDataController,viewId:f.ItemsDataView,externalFilter:w,filter:p,filterSource:w.length>0?"options":null,showSearchBar:!0,tag:(lt("history.lookup.search")?"":"history-search-none")+(l().is(".app-page-modal")&&r.width<=oi("sm")?" modal-fullscreen":""),showFirstLetters:f.ItemsLetters,searchOnStart:f.SearchOnStart,description:f.ItemsDescription},null,null,dr()[0]);v=n.pageInfo(o);b&&o.viewProp("quickFind",b);v.headerText=t.value?[t.text,d]:[d,e.LookupSelectAction];o._lookupInfo=t;t.value==null||f.ItemsValueSyncDisabled||ttt(o,[t.value]);o._parentDataViewId=h._id;n.modalDataView(v.id,!0)},show:function(t){var v=t.controller,b=t.view||"grid1",e,y=JSON.stringify(t),i,u,f,o,h=n._modalStack,p=dt(),s=$.Deferred(),r=t.filter,c,l,a,w;if(f=h.length&&h[h.length-1],f&&f.showSign===y&&t.cache!==!1&&yi("index")<yi("length")-1&&yi("next").hash==="#"+f.id&&(o=k(f.id),!o||!o.odp&&o._useCase!=="seeAll"))return wp.go(1),s.promise();if(ul(),r){if(!Array.isArray(r)){c=[];for(l in r)c.push({Name:l,value:r[l]});r=c}r.forEach(function(n){n.name&&(n.Name=n.name,delete n.name);"value"in n&&(n.Value="%js%"+JSON.stringify(n.value),delete n.value)})}for(n.modalDataView(),a=t.id||v.toLowerCase(),w=1,e=a;$find(e);)e=a+w++;return i=$create(kr,{id:e,baseUrl:ne,servicePath:rv,controller:v,viewId:b,filter:t._filter||[],externalFilter:t._externalFilter||r,sortExpression:t.sort,showSearchBar:!0,startCommandName:t.startCommand,startCommandArgument:t.startArgument,showActionButtons:t.showActionButtons,exitModalStateCommands:["Cancel"],tag:t.tags,useCase:t.useCase,filterFields:t.filterFields,filterSource:t.filterSource},null,null,dr()[0]),i._syncWith=t.syncWith,i._doneCallback=function(n){tt(n).showSign=null;ou(function(){t.done&&t.done(n);s.resolve(n)})},p&&(i._parentDataViewId=p._id),i._ditto=t.defaultValues,i._cancelCallback=t.cancel||function(n){ou(function(){s.reject(n)})},u=n.pageInfo(i),u.headerText=t.headerText,t.headerText&&(u.headerTextLocked=!0),u.showSign=y,t.key&&ttt(i,[t.key]),n.modalDataView(u.id,!0),s.promise()},pageInit:function(t){var i=n.pageInfo(t),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!==!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,i.refreshed===!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(t){var i;if(l()&&(i=n.pageInfo(t),i!=null)){var r=i.dataView,u=r?r.extension():null,f=n._modalStack.indexOf(i);f>=0&&n._modalStack.splice(f,1);i.initialized||(i.initialized=!0,r&&r._loadPage());u&&u._reset&&u.refresh()}},callWhenVisible:function(n,t){var r=l(n),i=typeof n=="string"?r:n;typeof n=="string"&&n.match(/^\.dv-load/)&&ot()&&(i=i.add(".app-reading-pane-master "+n));i.each(function(){var n=$(this);if(n.is(":visible")&&n[0].style.visibility!=="hidden"){var i=n.offset().top,u=i+n.outerHeight(),e=g(n),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)}})},whenPageShown:function(n){tr(n)},whenPageCanceled:function(n){bc(n)},goBack:function(n){ou(n)},asyncJob:function(){return n._asyncJob},nextAsycJob:function(){return++n._asyncJob},resetPageHeight:function(){ei()},supports:function(t){switch(t){case"Map":return n._supportsMap===!0}return!1},mapsApiKey:function(){var n=!!b.location.host.match(/^localhost\b/);return o("map.apiKey")||(n?"key=AIzaSyAhggwxCKiA2oEdxaRqap4t4-_96ajw_uw":"")},registerAPI:function(t,i){var u=n,f,o,e,r=pg[t];return r?(i&&r.then(i),r.promise()):(r=pg[t]=$.Deferred(),r.then(i),t==="Map"?(o=!!b.location.host.match(/^localhost\b/),e=n.mapsApiKey(),f="https://maps.googleapis.com/maps/api/js?&callback=appFactoryCallback",e?(f+="&"+e,u._mapAPI=!0,b.appFactoryCallback=function(){u._supportsMap=!0;$(document).trigger("map.init.app");r.resolve();b.appFactoryCallback=null},$.getScript(f)):r.resolve()):t==="Charts"&&n.registerAPI("Map",function(){$.getScript("https://www.google.com/jsapi",function(){$.getScript("https://www.gstatic.com/charts/loader.js",function(){u._chartsAPI=!0;$(document).trigger("charts.init.app");r.resolve()})})}),r.promise())},fetchOnDemand:function(){return os||(n.callWhenVisible(".dv-load-at-bottom",wg),n.callWhenVisible(".dv-load-at-top",wg)),n},calendar:function(n,t){var i=$(".app-calendar-plugin-container");if(i.length)switch(n){case"keepOpen":i.removeClass("app-visible app-hidden");i.addClass(i.is(":visible")?"app-visible":"app-hidden");clearTimeout(b._keepCalOpenTimeout);b._keepCalOpenTimeout=setTimeout(function(){i.removeClass("app-visible app-hidden")},t||100);break;case":visible":return i.is(n)}return i},callInAnimationFrame:function(n){if(requestAnimationFrame)var t=requestAnimationFrame(function(){n();cancelAnimationFrame(t)});else n()},stickyHeader:function(t){var p,w;if(!gu()){p=n;w=b._stickyHeaderHideInstruction;b._stickyHeaderHideInstruction=!1;var a=g(t),u=a.closest(".ui-page"),v=bv(u),e=v.attr("data-selector"),f=e?u.find(e):v.find(".app-static-text"),i=ke(t),o,s=!0;if(i&&i.length&&(u.is(".ui-page-active")||li(u))){if(!et&&(f.length||e)){var y=u.is(".app-page-modal"),k=d(a,"top"),nt=Math.ceil(f.length?f.offset().top+(t?1:0):-1),c,l;nt<k&&(e||f.height()>0)&&(i.is(":visible")&&i.data("screen-width")==r.width?s=!1:(s=!1,y?i.is(".app-bar-heading-modal")||i.addClass("app-bar-heading-modal"):i.is(".app-bar-heading-modal")&&i.removeClass("app-bar-heading-modal"),i.data("screen-width",r.width),i.show()[0].style.width=ie(a)-d(i,"padding-left")-d(i,"padding-right")-(y&&h?-1:0)+"px",o=i.css({top:k+(y?-1:-1)}).find(".app-bar-text"),e?(l=v.html(),l!=o.data("html")&&(o.data("html",l).html(l).css("white-space","normal"),w&&i.find(".app-view-instruction,.app-group:not(.app-group-fixed)").addClass("app-hidden").parent().addClass("app-bar-text-instruction-hidden"))):(c=f.text().trim(),c?c!=o.data("text")&&o.data("text",c).text(c).css("white-space",""):s=!0),i.outerHeight()+d(i,"top")<f.outerHeight()+nt&&(i.hide(),s=!0)))}return(s||st(eu()).length&&!li(u))&&i.hide(),p}}},wait:function(){},build:function(t,i,r){var h=n._pages.length>1,o=t.attr("data-href"),s=0,u=t.find('div[data-app-role="page"]'),e;return!i&&u.length===1&&u.attr("data-content-framework")&&(i={pageId:"Main"},e=$("#Main"),u.data("mainPage",!0)),u.each(function(t){var u=$(this),y=e||u,w=y.find('> div[data-role="content"]'),a=u.attr("data-content-framework"),tt=a==="display-flow",k;a&&y.attr("data-enhance","false");w.length||(w=p("",'data-role="content"'),u.contents().appendTo(w),w.appendTo(u));y.attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable");e||u.appendTo(c);var v=f.eval(u.attr("data-page-header")),b=nut(u),l={text:(v!=="false"?v:"")||b.text||n.title(),description:b.description,activator:b,url:o,transition:i&&i.transition},g=i&&i.pageId||u.attr("id")||bw(o||location.pathname)+(t>0||o?t+1:"")||"_root",it,nt,d;v=l.text.split(/\s*\|\s*/);l.headerText=v.length>1?v:v[0];k=cr("article","app-page-content"+(a?" app-content-framework app-"+a:""));e?(tt||u.contents().appendTo(k),k.appendTo(w.empty())):(u.find('div[data-role="content"]').contents().wrapAll(k),u.page().attr("id",g));l.id=g;l.page=u;l.dynamic=i&&i.dynamic;n.pageInfo(l);a&&y.attr("data-page-header","false");nt=l.scrollable=uy(y,!1);d=nt.find(".app-page-content");a&&f.configureFramework(a,d,function(n){cc=n});i&&i.dynamic||yw();h&&n.makeModal(l);u.each(function(){$.each(this.attributes,function(){var t=this,n;t.specified&&(n=t.name,n.match(/^data\-/)&&!n.match(/^(data-(content-framework|page-header|app-role|role|activator|enhance))$/)&&d.attr(n,t.value))})});f.dataBind(d,[]);b.text&&(s++,it=vt("app-action-navigate").attr("href","#"+g).text(b.text).appendTo(ct().appendTo(r)),l.description&&dr().appendTo(it).text(l.description));hr.trigger($.Event("displayflow.app",{content:nt,page:u}));e&&tr(function(){tt&&u.is('[data-editable="true"]')&&f.display("designer");u.remove()})}),u.data("linkCount",s),u},start:function(t){function ut(n){n.every(function(n){return n.selected?h=n:n.children&&ut(n.children),!h})}function et(){var i,r;try{i=b.external;i&&i.TouchUI&&(f.embedded=!0,wl("mouse"))}catch(u){}r=t&&$(t.selector).data("scripts");r?eval(r):pr&&ult();try{sessionStorage&&sessionStorage._clearUIState&&(sessionStorage.removeItem("_clearUIState"),f.storage.clearUIState())}catch(u){}if($(document).trigger("start.app"),n._started=!0,so&&n.notify({text:pd.DeviceLoginPrompt,duration:6e4}),hr.trigger("ifttt.app"),!f.host&&!na&&lt("ui.theme.detect"))hr.one("pagereadycomplete.app",function(){var n=window.matchMedia("(prefers-color-scheme: dark)");$(n).on("change",ot);ot({originalEvent:n},!0)})}function ot(t,i){var r=pi.ui.theme,u=r.name,e=r.accent,f=t.originalEvent.matches,o;i&&(ri("userTheme")||(!f||u!=="Light")&&(f||u!=="Dark"))||(r.name=o=f?"Dark":"Light",n._changeThemeLink(u+"."+e,o+"."+e,gi),ri("userTheme",null))}function st(){n.tabs("create",{tabs:y,className:"app-tabs-echo",scope:"page",change:function(){}})}var rt,h;dg();ht=n.edit;ii.ignoreContentEnabled=!0;ad._raiseInit();n._appLoaded=!0;slt();var i=n.pageMenu(t&&t.pageId),s,d=$(t&&t.selector||"#PageContent"),u=d.attr("data-href"),r=n.build(d,t,i),nt=r.data("mainPage"),at=r.data("linkCount"),it=di("get");!nt&&r.length&&(s=r.first(),at||s.attr("data-activator")==="false"||vt("app-action-navigate").attr("href","#"+s.attr("id")).text(s.attr("data-page-header")||ret.SeeAlso).appendTo(ct().appendTo(i)),i.is(".ui-listview")&&i.listview().listview("refresh"),it&&it.insertAfter(r[r.length-1]));rt=pr;t||ut(rt);!h||r.length||i.find("a").length||td(h.children,i,1);var e=t?n.page(t.pageId):l(),a=e.find("a.app-action-navigate"),v,y=[],w,ft=n._pages[0],k=ft&&ft.dataView;!nt&a.length===1&&(t||o("ui.list.initialMode")==="SeeAll"||c.attr("class").match(/see-all-always/)||!k||k.tagged("reading-pane-auto")&&!cu||k.get_lastCommandName()||b.location.href.match(/_controller=.+_commandName=.+/))?$(n._pages).each(function(){var t=this,i=t.dataView;return cg=i&&i._id,(!u||t.url===u&&!t.root)&&(!i||!i._hidden)?(u||(t.home=!0,u=ii.path.documentBase.pathname+b.location.search),et(),ii.navigate.history.clearForward(),u&&(t.replaceUrl=u),i&&(uy($("#Main")),cr("h1","app-page-loading").appendTo(n.content().empty()).text(of),yw()),ei(t.page),n.changePage(t.id),!1):void 0}):e.attr("id")==="Main"&&(a.length&&e.find('a[rel="external"]').parent().remove(),a.show(),v=uy(e),ei(),yw(),rp(e.addClass("app-page-scrollable")),lu(document.title),$(a).each(function(){var r=$(this),u=r.attr("href"),i=u&&tt(u.substring(1)),t,f,n;i&&i.dataView&&i.activator.type!=="Button"&&(n=i.activator,n&&n.type==="Tab"&&($(y).each(function(){if(this.text===n.text)return t=this,!1}),t||(w!=n.container&&(w&&(st(),y=[]),w=n.container),t={text:n.text,content:[]},y.push(t))),f=kb(i.id,v),t&&t.content.push(f),r.parent().remove())}),w&&st(),i&&(i.find('a.app-action-navigate,a[rel="external"]').length?i.listview().show():i.remove()),v.find(".app-tabs").length>1&&p("app-stub-main").appendTo(v),performance&&performance.navigation.type>1&&(f.storage.instance("session"),g().scrollTop(fu("_scrollTop")),f.storage.instance("default")),et(),rtt({toPage:e}))},pageMenu:function(t){var i=n.content(t),r=i.find("ul.app-page-menu");return i.parent().attr("id")!=="Main"||r.length||(r=nr("app-page-menu",'data-role="listview" data-inset="false"').appendTo(i).hide().on("vclick",function(t){var i=$(t.target),r,u;return i.is("a")||(i=i.closest("a")),i.length&&(r=i.attr("href"),u=r.match(/^#/),kt(i,function(){u?n.changePage(r.substring(1)):(ur(i,!1),b.location.href=r)})),!1})),r},initialize:function(){function ft(n){$(n).each(function(){var n=this,i=n.cssClass,t=i&&i.match(ua);t&&(h.push({node:n,icon:t[0]}),n.icon=t[0]);n.children&&ft(n.children);nu.Menu.nodeCount++})}function et(n){return $(n).each(function(){var n=this,i=(n.url||"").toLowerCase();return(i.startsWith("../")&&(i=i.substring(3)),n.selected||f.host&&u.indexOf(i)!==-1)?(t=n,t.selected=!0,nu.Menu.currentNode=t,!1):n.children&&(et(n.children),t)?(n.selected=!0,!1):void 0}),null}function ht(){var n=ai(),t;if(n-ot>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=ai()}ot=n;setTimeout(ht,1250)}var t,u,h,nt,tt,p,ut,v,r,l;pi=__settings;ne=__baseUrl;rv=__servicePath;$(document).trigger("beforetouchinit.app");ho=f.loggedIn();flt();cu=cu&&lt("ui.embedding");gp=o("ui.automation.enabled")&&(c.data("kiosk")||o("ui.automation.kiosk.enabled"));elt();olt();au&&oot();u=b.location.pathname+b.location.search.replace(/(\_(\w+)=(.*?)(&|$))/,"");h=nu.Menu.nodesWithIcons=[];u.match(/\?$/)&&(u=u.substring(0,u.length-1));nu.Menu.nodeCount=0;for(ts in or.Nodes){for(ws()&&(or.Nodes[ts]=f.designer.menu()),pr=or.nodes=or.Nodes[ts],et(pr),ft(pr),t&&t.cssClass&&(t.showPageHeaderTitle=!!t.cssClass.match(/\bpage-header-title\b/),t.showPageHeaderDescription=!!t.cssClass.match(/\bpage-header-description\b/),t.showPageHeaderIcon=!!t.cssClass.match(/\bpage-header-icon\b/)),nt=$.Event("menuinit.app",{menu:pr,menuId:ts}),$(document).trigger(nt),tt=nt.nodes,tt&&(pr=or.nodes=or.Nodes[ts]=tt),p=0;p<pr.length;p++)r=pr[p],r.children!=null&&r.url!=null&&(op=!0);break}var ot=ai(),it=ii.path.parseUrl(location.href),k=it&&it.hash,st=$("head"),a=$('<div class="app-scrollbar-info"><div><\/div><\/div>').appendTo(c);wt={width:a[0].offsetWidth-a[0].clientWidth,height:a[0].offsetWidth-a[0].clientWidth,gridColumnPadding:16};a.remove();ist();y.init();k&&k!=="#"&&(k.match(/\W/)||!$(k).length)&&location.replace(it.hrefNoHash);gr?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(hft>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../images/logo-icon.png"/>').appendTo(st):wu&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../images/logo-icon.png"/>').appendTo(st);setTimeout(ht,10);pi.appInfo.match(/\|$/)||$("#app-welcome").remove();n._logo.html(ov());ott();var i=w.left.toolbar,ct=lt("settings.enabled"),at=o("ui.menu.apps.location"),d=!at||at==="sidebar",rt=h.length<=4&&h.length===or.nodeCount||!d,g=Math.min(h.length,(rt?4:3)+(ct?0:1)),l;if(or.nodeCountInSidebar=g,lt("ui.sidebar.toolbar")){if(ut=o("ui.menu.tabbar")===!0,lt("ui.sidebar.icons")&&!ut)for(v=0;v<g;v++)r=h[v],l=vt("ui-btn ui-btn-a app-btn-page app-btn"+v).appendTo(i).attr("title",r.node.title).data("context",r.node),bt(r.icon,l),r.node==or.currentNode&&l.addClass("app-selected");else g=0,rt=!d;!rt&&d&&bt("material-icon-apps",vt("ui-btn ui-btn-a app-btn-apps").appendTo(i).attr("title",e.Apps));ct?(l=vt("ui-btn ui-btn-a app-btn-settings").appendTo(i).attr("title",e.Settings),bt("material-icon-settings",l),s("app-text").text(e.Settings).appendTo(l)):i.parent().addClass("app-settings-disabled");ut?i.addClass("app-has-tabbar"):g&&i.addClass("app-has-icons");o("ui.menu.location")!=="sidebar"&&d||i.addClass("app-has-optional-apps");uit();w.left.inner.closest(".ui-panel").addClass("app-has-toolbar-bottom");i.find(".ui-btn").length||i.css("visibility","hidden");stt()}else i.hide(),w.left.inner.css("bottom",0);pc(w.left.inner,!1);$(document).trigger("touchinit.app")},presenter:function(t,i){function u(){r[i.name]=i}function f(n){oh(n.id,n.name)}function e(){var n=r[typeof i=="string"?i:i.name];return n&&(typeof i=="string"||n.supports(k(i.id),i.config))}function o(){var f=k(i.id),h=f.extension(),n=i.container,o=n.is(".app-echo-inner"),t=yl(),s,e,u;if(o||f==dt()){if(t=r[i.name],o&&t.echo&&!t.echo())return!1;o||(s=g(n),e=s.scrollTop(),eit(n,h),n.find('ul[data-role="listview"]').hide(),ib(n,h));u=$(n).find('div[data-presenter="'+t.name+'"][data-scope="'+f._viewId+'"]');u.length||(e=0,u=p("app-presenter",'data-role="presenter"').appendTo(n).attr({"data-presenter":t.name,"data-scope":f._viewId}));u.show();i.container=u;t.show(i);e&&s.scrollTop(e)}else rf(i.id);return!0}function s(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.hide(i),n.hide())})}function h(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.dispose(i),n.remove())})}function c(){var e=k(i.id),o=n.contextDataView()!=dt(),u,t;for(u in r)t=r[u],t.supports(e)&&(!o||!t.echo||t.echo())&&i.list.push({name:u,text:t.text(),icon:t.icon(),context:{id:e._id,name:u},callback:f})}function l(){return r[i.name]}var r=n._presenters;switch(t){case"supports":return e();case"enumerate":c();break;case"register":u();break;case"show":return o();case"hide":s();break;case"dispose":h();break;case"find":return l()}},showAccountManager:function(t,i){if(au){var o=f.AccountManager.list(!0),s=location.href.match(/(\?|&)_accMan=(\w+)/),r=[],u;if(au._instance._rememberMeSet&&(t||(t=[]),t.push({name:"RememberMe",value:!0})),!f.AccountManager.enabled()){n.showLogin(t);return}for(u in o)u!="_lastUser"&&o[u].name&&r.push({text:u,callback:eot,context:o[u]});i&&(r.length||s&&s[2]!="login")?s||r.length?(r.push({text:e.AddAccount,callback:n.showLogin,icon:"material-icon-add"}),re(r,"switch")):dy(r[0].context.name):n.showLogin(t)}},showLogin:function(t){var u=au&&au._instance,r,i;!u||u.get_displayLogin()||vv()?(i=re(),i.is(".app-acc-man-inactive")||i.is(".app-acc-man-splash")||i.appendTo(c).addClass("app-acc-man-inactive"),i.insertBefore($(".app-page-modal-background")),av()||re().fadeOut("slow"),n.show({controller:"MyProfile",startCommand:"New",startArgument:"loginForm",showActionButtons:"Bottom",defaultValues:t})):(r=ne+"login",b.location.href.indexOf(".aspx")!==-1&&(r+=".aspx"),b.location.href=r)},openExternalUrl:function(t,i){var u,r=ii.path.parseUrl(t);return r.host&&(u=function(){if(r.host==="maps.apple.com"||r.host==="maps.google.com"||i)fh(t);else{var u=r.pathname.replace(/\//g,"-").substring(1)||r.host.replace(/\W/g,"-"),e=n.pageInfo(u),f,o,s=ot()||li();e||(e=n.pageInfo({id:u,external:!0,href:t}));f=e.page=n.page(u);(l().is(".app-page-modal")||s)&&(n.makeModal(e),f.toggleClass("app-page-modal-max-lg",s));o=f.find("iframe");yt(!0);o.length&&o.remove();o=cr("iframe","app-page-external").attr("src",t).appendTo(g(f).addClass("app-wrapper-external")).one("load",function(){si()===u?yt(!1):setTimeout(n.changePage,0,u)});gr&&g(f).css("overflow","auto")}}),u},getThemes:function(){var n=new $.Deferred;return $.ajax({url:rv+"/Themes",method:"POST",cache:!1}).done(function(t){n.resolve(t.d||JSON.parse($(t).text()))}),n.promise()},startUrl:function(){return yi(0).url},returnUrl:function(){if(so=sessionStorage.identityConfirmationRequested,so)return so;var n=yi(0).url.match(/\?ReturnUrl=(.+?)(#.+)?(&|$)/);return n&&(n=decodeURIComponent(n[1])),n&&n.indexOf("/_invoke/getidentity")!==-1&&(sessionStorage.identityConfirmationRequested=so=n),n},initials:function(n){return wc(n)},_changeThemeLink:function(n,t,i){var f=new Date,o=pi.appInfo.split("|")[1],r,u,e;f.setMonth(f.getMonth()+1);document.cookie=".COTTHEME"+o+"="+t+";expires="+f.toUTCString()+";path=/";u=$("link.app-theme");u.length&&(r=u.attr("href"),r.indexOf("appservices")>-1?r=r.replace(new RegExp(RegExp.escape(n),"i"),t):(e=t.split("."),r=r.substring(0,r.indexOf("Theme.ashx")+17)+e[0]+"&accent="+e[1]),$.ajax({url:r,dataType:"text"}).done(function(){u.attr("href",r);i()}))}};n=f.touch=f.mobile=new f.Mobile;n.activeLinkBlacklist=".ui-slider-handle,.dv-action-see-all,.app-do-not-activate";n._presenters={};n.calcWidth=ie;n.createLayout=ctt;n.prepareLayout=vtt;n.fnVisible=lr;n.hasFocus=ar;f.dragMan=ut=new function(){return this.prototype={active:function(){return ut._active===!0},call:function(t,i){function o(){if(ut._tapholdTimeout=null,r){if(r.touch)$(document).one("vmouseup pointerup",function(n){n.preventDefault();n.stopPropagation();ow()});ii.skipTouchEnd=r.touch;ii.skipMouseEnd=r.mouse||r.pointer;var n=$.Event("taphold.app",{drag:r});r.target=f;r.dataView=e;$(f).trigger(n);n.isDefaultPrevented()?ut._tapholdTimeout=setTimeout(o,90):bl(n)}}if(i.drag){ut._dragged=!1;var r=i.drag,u=ut[r.type],s=u&&u[t],e,f;clearTimeout(ut._draggedTimeout);t==="start"?(ut._keepTap=!1,ut._active=!0,f=r.target,e=n.contextDataView(f),r.dataView=e,u&&(!u.options||u.options.taphold!=!1)&&(ut._tapholdTimeout=setTimeout(o,500))):ut._keepTap||ut._tapholdTimeout&&(clearTimeout(ut._tapholdTimeout),ut._tapholdTimeout=null);u&&s&&(!u.options||!u.options.dataView||r.dataView)&&!r.cancel&&(t==="cancel"&&(r.cancel=!0),u[t](r)===!1&&i.preventDefault());(t==="end"||t==="cancel")&&(r.dataView=null,ut._active=!1,yu(!0))}},dragged:function(n){return arguments.length&&(ut._dragged=n,n&&clearTimeout(ut._draggedTimeout),ut._draggedTimeout=setTimeout(ut._clear,200)),ut._dragged===!0},_clear:function(){ut._dragged=!1}}};$(document).on("mousedown pointerdown touchstart","[data-draggable]",hlt).on("dragstart.app",function(n){ut.call("start",n)}).on("dragmove.app",function(n){ut.call("move",n)}).on("dragend.app",function(n){ut.call("end",n)}).on("dragcancel.app",function(n){ut.call("cancel",n)}).on("taphold.app",function(n){ut.call("taphold",n)});ut.hscrollbar={options:{taphold:!1,immediate:!0},start:function(n){var t=this,f=n.target,h=f.width(),r=f.parent(),u=k(r.attr("data-view")),e,o,i,s;u?(e=u.session("grid-avail-width"),o=r.outerWidth(!0),t._maxScroll=e-o,s=e/o,ht._dataViewId===u._id&&ht.detach()):(t._dataView=null,i=r.prev(),i.css("overflow-x")!=="auto"&&(i=i.children().first()),t._scrollable=i,s=i[0].offsetWidth/h);r.addClass("app-scrollbar-dragging");n.dir="all";t._dataView=u;t._ratio=s;t._rect=gt(r);t._offset=n.x-f.offset().left},move:function(t){var i=this,u=i._dataView,r=(t.x-i._rect.left-i._offset)*i._ratio;u?(r=r<0?0:Math.min(r,i._maxScroll),n.scrollGrid(u,r)):i._scrollable.scrollLeft(r)},cancel:function(n){this.end(n)},end:function(n){var i=n.target.parent(),t=this._dataView;i.removeClass("app-scrollbar-dragging");t?(ir(),ht._dataViewId===t._id&&ht.sync({dataView:t,scrollIntoView:!1})):i.prev().focus()}};ut.vscrollbar={options:{taphold:!1,immediate:!0},start:function(n){n.dir="all";this._scrollable=n.target.parent().prev();n.target.parent().addClass("app-scrollbar-dragging");this._rect=gt(n.target.parent());this._ratio=this._scrollable[0].scrollHeight/this._scrollable.height();this._offset=n.y-n.target.offset().top},move:function(n){var t=this;t._scrollable.scrollTop((n.y-t._rect.top-t._offset)*t._ratio)},cancel:function(n){this.end(n)},end:function(n){var i=n.target.parent().removeClass("app-scrollbar-dragging"),t=gt(i);lt("ui.scrollbars.expand")&&i.data({hover:t.left<=n.x&&n.x<=t.right&&t.top<=n.y&&n.y<=t.bottom,time:ai()}).addClass("app-scrollbar-hover");ir()}};ut["grid-header"]={options:{dataView:!0},start:function(n){if(h){var t;n.target.find(".app-field-separator").each(function(){var i=$(this),r=i.offset(),u=n.x-r.left;Math.abs(u)<=22&&(t=i)});t&&(n.originalType=n.type,n.type="grid-header-separator",n.target=t,ut["grid-header-separator"].start(n))}}};ut["grid-header-field"]={options:{dataView:!0},start:function(n){var t=n.target,i,u=t.offset(),r;n.mouse||(i=t.width(),i>wt.gridColumnPadding*2&&(u.left+i-wt.gridColumnPadding<n.x?(n.target=t.next(),r=!0):u.left+wt.gridColumnPadding>n.x&&t.prev().is(".app-field-separator")&&(n.target=t.prev(),r=!0)));r?(n.originalType=n.type,n.type="grid-header-separator",ut["grid-header-separator"].start(n)):n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,e=n.dataView,i=t._lastDropTarget,u,a=t._dragLine,nt=0,tt,et,v=ni(n.target),y,ot,w,it,st,b=h?30:20,o,f,rt,k,ut=t._mirror;if(o=(v.length?v:l(".app-grid")).find(".dv-item").first(),f=o.offset(),k=e.session("grid-frozen-width")||0,!t._dragLine){tt=g();et=tt.offset();st=!0;i=t._lastDropTarget=n.target;t._targetFieldName=i.attr("data-field-name");y=v.length?v.find(".dv-item").last():null;ot=r.height-(y?y.offset().top+y.outerHeight():et.top+tt.outerHeight());a=t._dragLine=p("app-drag-line").appendTo(c);a.css({top:i.offset().top,bottom:ot});n.target.css("color",a.css("background-color"));var ft=i.prevAll(".app-field-separator").first(),ht=i.nextAll(".app-field-separator").first(),ct=ft.length?ft.offset().left+Math.ceil(ft.outerWidth()/2):i.offset().left-(h?wt.gridColumnPadding/2:2),vt=ht.offset().left+Math.ceil(ht.outerWidth()/2),lt=i.css("padding-top"),at=i.css("padding-bottom");ut=t._mirror=s("app-drag-header-field").appendTo(c).css({"font-size":i.css("font-size"),paddingLeft:wt.gridColumnPadding/2,paddingRight:wt.gridColumnPadding/2,paddingTop:lt,paddingBottom:at,textAlign:i.css("text-align")}).width(vt-ct-wt.gridColumnPadding).height(i.closest(".app-grid-header").height()-d(lt)-d(at)).text(i.text());t._mirrorDispX=n.x-ct;t._mirrorDispY=n.y-i.offset().top+(n.mouse?0:i.outerHeight());t._mirrorWidth=ut.outerWidth()}o.find(".app-field").each(function(){var t=$(this),i=t.offset();(t.is(".app-frozen")||i.left>f.left+k)&&n.x>=i.left-wt.gridColumnPadding/2&&n.x<i.left+t.width()+wt.gridColumnPadding/2&&(w=t)});w&&(it=w.attr("class").match(/\bapp-field-([\w\_]+)\b/i),it&&(i=w,t._targetFieldName=it[1]));t._lastDropTarget=i;u=i.prev();u.is(".app-field-separator")?nt=Math.ceil(u.outerWidth(!0)/2)+2:(u=i,nt=-wt.gridColumnPadding/2);u.length&&a.css({transform:"translate3d("+(u.offset().left+nt)+"px,0,0)",transition:st||n.instantFeedback?"":"transform 160ms ease-out"});t._mirror.css({left:n.x-t._mirrorDispX,top:n.y-t._mirrorDispY});n.instantFeedback=!1;clearTimeout(t._gridScrollTimeout);rt=o.width();(f.left+rt-(n.x-t._mirrorDispX+t._mirrorWidth-1)<=b||n.x-t._mirrorDispX-(f.left+k)<=b)&&(t._gridScrollTimeout=setTimeout(function(){var r=e.session("grid-avail-width"),s=Math.ceil(r-r*(o.width()/r)),i=e.session("scroll-left")||0,h=n.x-t._mirrorDispX,l=h+ut.outerWidth()-1,c=h-(f.left+k),u;i<s&&f.left+rt-l<=b?(i=Math.min(i+32,s),u=!0):i>0&&c>0&&c<=b?(i=Math.max(i-32,0),u=!0):clearTimeout(t._gridScrollTimeout);u&&(e.session("scroll-left",i),ph(e,-i,!1),n.instantFeedback=!0,n.dropTarget=document.elementFromPoint(su(),th()),t.move(n))},100))},end:function(n){var e=this,t=n.dataView,f=t._allFields,o=t.gridSettings(),i=o.sequence,r=n.target.attr("data-field-name"),u=e._targetFieldName;r=f[t.findFieldUnderAlias(r).Index].Name;u=f[t.findFieldUnderAlias(u).Index].Name;i.length||$(t._fields).each(function(){i.push(this.Name)});i.splice(i.indexOf(r),1);i.splice(i.indexOf(u),0,r);this._removeDragState(n);t.gridChanged();ok();sk()},cancel:function(n){this._removeDragState(n)},taphold:function(n){tp(n.target,{x:n.x,samples:!1,hide:!0})},_removeDragState:function(n){var t=this;clearTimeout(t._gridScrollTimeout);n.target.css("color","");t._lastDropTarget=null;t._dragLine&&(t._dragLine.remove(),t._dragLine=null,t._mirror.remove(),t._mirror=null)}};ut["grid-header-separator"]={options:{dataView:!0,taphold:!1,immediate:!0},start:function(n){var t=this,f=g(),i=n.target.prevAll("[data-field-name]").first(),e=ni(i),u=e.length?e.find(".dv-item").last():null,o=r.height-(u?u.offset().top+u.outerHeight():f.offset().top+f.outerHeight());t._columnHeader=i;t._left=Math.ceil(i.offset().left);t._minRight=t._left+co()+n.target.outerWidth()+2;i.next().is(".app-btn-more")&&(t._minRight+=i.next().outerWidth());t._maxRight=t._left+(i.closest(".app-bar-heading").length?g():i.closest(".app-grid")).width()*.75;t._dragLine=p("app-drag-line").appendTo(c).css({transform:"translate3d("+(n.target.offset().left+Math.floor(n.target.outerWidth()/2))+"px,0,0)",top:n.target.offset().top,bottom:o});t._leftLine=p("app-drag-line").appendTo(c).css({left:t._left-Math.ceil(wt.gridColumnPadding/2),top:i.offset().top,bottom:o});i.css("color",t._dragLine.css("background-color"));n.dir=n.mouse?"all":"horizontal"},move:function(n){var t=this,i=n.x;i<t._minRight&&(i=t._minRight);i>t._maxRight&&(i=t._maxRight);t._right=i;t._dragLine.css("transform","translate3d("+i+"px,0,0)")},end:function(n){var i=this,f=i._right-i._left-n.target.outerWidth()-2,t=n.dataView,r=t.gridSettings(),u=i._columnHeader,e=t.findField(u.attr("data-field-name"));u.next().is(".app-btn-more")&&(f-=u.next().outerWidth());r.width[e.Name]||u.parent(".app-grid-header").find("[data-field-name]").each(function(){var n=$(this),t=n.width();r.width[n.attr("data-field-name")]=t});r.width[e.Name]=f;t.gridSettings(r);ut.dragged(!0);i._removeLine(n);yh(t,!1,!0);t.gridChanged();ok();sk()},cancel:function(n){this._removeLine(n)},_removeLine:function(n){var t=this;n.target.prevAll("[data-field-name]").first().css("color","");t._dragLine.remove();t._leftLine.remove();t._columnHeader=null},canScroll:function(){return!1}};ut.dismiss={start:function(n){n.dir="all"},move:function(){},end:function(n){this.cancel(n)},cancel:function(n){n.target.trigger("vclick")}};ut.panel={start:function(n){var t=this;t._position=n.target.is(".ui-panel-position-right")?"right":"left";n.dir="horizontal";t._lastX=t._x=n.x;t._time=+new Date},move:function(n){var t=this,i=n.target,u=t._dir,f=n.x-t._x;t._dir||(u=t._dir=i.is(".ui-panel-position-right")?"right":"left",u==="right"?i.offset().left:i.outerWidth(),i.css({position:"absolute"}),t._animated=i.is(".ui-panel-animate"));t._displacement=f;t._movedBy=n.x-n.lastX;u==="right"?i.css({right:(wr()?r.right:0)+Math.min(0,-t._displacement)}):i.css({left:(wr()?r.left:0)+Math.min(0,t._displacement)});t._lastX=n.x},end:function(n){function c(){f?ps(t.css("visibility","hidden"),!0):t.css({transform:"none",transition:"transform 0 linear",right:e=="right"?0:"",left:e==="left"?0:""});i._done(t)}var i=this,r=i._displacement,t=n.target,u=t.outerWidth(),e=i._dir,o=h?30:10,s=+new Date-i._time<=250,f;if(e==="right")if(d(t,"right")){f=i._movedBy>=0&&(s&&r>=o||Math.abs(r)>=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?u-r:-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}else i._done(t);else if(d(t,"left")){f=i._movedBy<1&&(s&&-r>=o||Math.abs(u+r)<=u*.5);t.css({transition:"transform 300ms ease",transform:"translate3d("+(f?-(u+r):-r)+"px,0,0)"}).removeClass("ui-panel-animate").one("transitionend",c)}else i._done(t)},cancel:function(n){this._done(n.target)},_done:function(n){var t=this;t._dir=null;n.css({position:"",transition:"",transform:"",left:wr()?t._position==="left"?r.left:"":"",right:wr()?t._position==="right"?r.right:"":""});t._animated?setTimeout(function(){n.addClass("ui-panel-animate");ku=!1},100):ku=!1},canScroll:function(n,t){return t==="vertical"?n.height()<n[0].scrollHeight:!0}};ut["data-item"]={options:{dataView:!0},start:function(n){var t=this,i=n.dataView,s=i.extension().viewStyle(),h=n.target.closest(".app-listview"),r=i.session("grid-avail-width"),f=h.width(),u,e,o;if(s=="Grid"&&r>f){if(i.multiSelect()&&(u=n.target.closest(".ui-btn").find(".app-btn-check"),u.length&&n.x<u.offset().left+u.outerWidth()+8))return;e=f/r;o=Math.ceil(r-r*e);t._maxScroll=o;t._originalX=n.x;t._lastX=n.x;t._listViewWidth=f;t._scrollLeft=i.session("scroll-left")||0;n.dir="horizontal";t._minScroll=d($("span."+hh(i)),"margin-left")+t._scrollLeft;i.session("scroll-left-margin",t._minScroll)}},move:function(n){var i=this,r=n.dataView,u,t=i._scrollLeft;ht._dataViewId==r._id&&ht.detach("hide");u=Math.ceil(i._originalX-n.x);t+=u;t<0?(t=0,i._originalX=n.x,i._scrollLeft=t):t>i._maxScroll&&(t=i._maxScroll,i._originalX=n.x,i._scrollLeft=t);n.time=+new Date;r.session("scroll-left",t);ph(r,-t,!0)},end:function(n){this._stopAnimation(n);var r=this._scrollLeft,u=+new Date,f=n.time,e=(u-f)*100,i=n.x-n.lastX;if(e>0&&Math.abs(i)>5){var o=i<0?1:-1,t=r+this._listViewWidth*o;t<this._minScroll?t=0:t>this._maxScroll&&(t=this._maxScroll);n.dataView.session("scroll-left",t);ph(n.dataView,-t,!1,!0)}},cancel:function(n){this._stopAnimation(n)},taphold:function(n){n.target.trigger(n.target.is(".app-btn-more")?"vclick":"contextmenu")},_stopAnimation:function(n){ut.scrollingAnimationFrame!=null&&(cancelAnimationFrame(ut.scrollingAnimationFrame),ut.scrollingAnimationFrame=null);n.moved&&n.dataView._id===ht._dataViewId&&setTimeout(ht.frame,600,"show")}};ut["reading-pane"]={options:{taphold:!1,immediate:!0},start:function(n){var t=this,u=pt.splitter,i=u.offset(),f=i.left,e=i.top;t._originalLeft=f;t._originalTop=e;r.splitLeft?(t._minLeft=f-(r.splitLeft-pt.minLeft),t._maxLeft=f+(r.splitRight-pt.minRight),t._offset=Math.round(n.x)-i.left):(t._minTop=e-(r.splitTop-pt.minTop),t._maxTop=e+(r.splitBottom-pt.minBottom),t._offset=Math.round(n.y)-i.top);t._placeholder=u.clone().insertBefore(u.addClass("app-dragging"));n.dir="all"},move:function(n){var t=this,i=Math.round(n.x),u=Math.round(n.y);r.splitLeft?(i-=t._offset,i<t._minLeft&&(i=t._minLeft),i>t._maxLeft&&(i=t._maxLeft),t._left=i,pt.splitter.css("left",i)):(u-=t._offset,u<t._minTop&&(u=t._minTop),u>t._maxTop&&(u=t._maxTop),t._top=u,pt.splitter.css("top",u))},end:function(){var n=this;n._restore();r.splitLeft?fu("splitLeft",n._left-r.left-w.left.width-1):fu("splitTop",n._top-r.top-r.toolbarHeight);setTimeout(n._resize,100)},cancel:function(){this._restore()},_restore:function(){var n=this;n._placeholder.remove();pt.splitter.removeClass("app-dragging").css({left:n._originalLeft,top:n._originalTop})},_resize:function(){uft();po();ei();ot()&&rp($(".app-reading-pane-master"))}};hr.ready(function(){n.initialize();ii.initializePage();f._parse();n.start()}).on("mousedown",function(n){nh(n)}).on("touchstart pointerdown",function(n){if(nh(n),!$(n.target).is(":input")){if(et){n.preventDefault();return}var r=$(n.target),t=r.closest("a,.app-feedback"),i=ud=io(n);fd=!ki.isScrollable;t.length&&(ns=t.data("touch-start",i),t.is(i.activeLinkBlacklist)||(t.parent().is("li")?(clearTimeout(rd),rd=setTimeout(function(){ns&&ur(ns,!1)},250)):h&&ur(t,!1)))}}).on("touchmove pointermove",function(n){var u,f=$(n.target),i=$(ns),e=f.closest(".ui-panel-inner,.app-wrapper"),t=io(n),r=i.length&&i.data("touch-start"),o;if(gr&&!i.length&&f.closest(".app-bar-toolbar").length){n.preventDefault();return}if(f.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}if(fd&&(fd=!1,e.length&&(t.y>ud.y?u=e.scrollTop()==0:t.y<ud.y&&(o=dit(e),u=o.height>=o.maxHeight-1)),u)){dh();ur();n.preventDefault();gr&&(os=!1);return}i.length&&(r&&(r.scrollTop!==t.scrollTop||Math.abs(r.x-t.x)>4||Math.abs(r.y-t.y)>4)&&ur(),dh())}).on("touchend pointerup",function(n){nh(n);dh()}).on("touchcancel pointercancel",function(){ur();dh()}).on("scrollstart.app",function(n){sh();li()||un(n,ik);kw()}).on("scrolldir.app scrollstop.app",function(n){function v(){uf(t)}if(n.relatedTarget){var t=$(n.relatedTarget),h=t.find("> .app-listview").filter(lr),u=h.find(".app-group"),f,l,a,e;u.length&&(f=bv(rh(t)),f.length&&(group=f.find(".app-group"),group.length||(group=p("app-group").appendTo(f),$(u[0]).is(".app-group-fixed")&&group.addClass("app-group-fixed")),l=t.offset().top+ke(t).outerHeight(!0),u.each(function(){var n=$(this);if(n.offset().top+n.outerHeight(!0)/2>l)return!1;a=n}),e=(a||$(u[0])).html(),e!==group.html()&&(group.html(e),ke(t).find(".app-group").html(e))));var c=t.data("scroll-dir"),y=h.filter(".app-grid"),w=h.find(".app-group-fixed").first(),o=y.length>0||w.length,s=t.data("sticky-header"),r=o?s.find(".app-view-instruction,.app-group:not(.app-group-fixed)"):null,k=r&&r.parent();c==="up"?(o&&r.length&&!r.is(":visible")&&r.removeClass("app-hidden"),ul(s),un(n,v,200)||v()):(c==="down"||!c&&o)&&(o?(r.addClass("app-hidden"),k.addClass("app-bar-text-instruction-hidden"),b._stickyHeaderHideInstruction=!0,uf(t)):s&&s.hide());n.type==="scrollstop"&&(i.restoreLastPopup(),clearInterval(rg),rg=setTimeout(function(n){var i=dit(n);i.top<=0&&i.height<=i.maxHeight+1&&(de(),pf(null,null,t.find(".app-echo")))},250,t))}}).on("contextmenu MSHoldVisual selectstart",function(n){var t,i,r,u,e,f;if(et)n.preventDefault();else if(n.type==="contextmenu"){if(t=$(n.target),t.is(".ui-popup-screen")){if(i=$(".ui-popup-active .ui-popup.app-popup-listview"),i.length){if(h)return!1;to(i);n.preventDefault();n.originalEvent&&(r=io(n),u=$(document.elementFromPoint(r.x,r.y)),setTimeout(function(){u.trigger(u.closest(".app-control-helper").length?"vclick":"contextmenu")},75))}}else if(t.closest(".ui-popup").length)n.preventDefault();else if(t.is(".app-has-children"))n.preventDefault(),setTimeout(function(){t.trigger("vclick")},50);else if(!(t.is(":input")||t.closest("article").length)&&(e=ni(t).attr("data-for"),f=tt(e||t.closest(".ui-page").attr("id")),f))return kct(f.dataView,n)}else n.type==="MSHoldVisual"&&n.preventDefault()}).on("vclick","a",rlt).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-btn-toggle",gct).on("vclick",".app-has-depth .app-btn",function(){if(!vu){var t=$(this);return n.toggleTooltip(t,t.text()==="expand_less"),bg(t.closest(".app-has-depth"),!0),!1}}).on("vclick",".app-filter",function(t){var i=ni(t.target);return i.length&&n.contextScope(i.attr("data-for")),bh({mode:"everything"}),!1}).on("vclick","[data-href]",function(n){if(!n.isDefaultPrevented()){var t=$(this),r=t.attr("data-href"),i=t.closest(".app-field");return t.is(".app-control-inner")&&t.parent().attr("data-input")!=="none"?void 0:(i.addClass("app-selected"),setTimeout(function(){i.removeClass("app-selected");f.odp.blob("download",r)},er),!1)}}).on("vclick",".app-filter-clear",function(n){var t=np(n.target);return ty(t),!1}).on("vclick",".app-form-clear-all",function(n){var r=$(n.target),u=r.closest('[data-layout="form"]'),t=np(r),i={};return u.find("[data-control][data-field]").each(function(){var n=t.findField($(this).attr("data-field"));n&&n.Type!=="DataView"&&!n.OnDemand&&(i[n.Name]=null,n.Index!==n.AliasIndex&&(n=t._allFields[n.AliasIndex],i[n.Name]=null))}),wi(i),u.find(".app-has-clear-all").removeClass("app-form-clear-all-visible"),t._showClearAll=!0,!1}).on("vclick contextmenu",".app-grid-header",function(n){if(ut.dragged()||vu){n.preventDefault();n.stopPropagation();return}vo();var t=$(n.target),i={x:n.pageX,y:null};if(!t.is(".app-btn-more")){if(!h&&t.is(".app-btn-sort")&&n.type==="vclick"){iu=t.closest("[data-field-name]").data("field-name")+" "+(t.data("sort")==="asc"?"desc":"asc");al(t);return}return t.is(".app-icon,.app-grid-header-text")&&(t=t.parent()),hb(n)?hy(np(t),null,!0):(t.attr("data-field-name")||$(this).find("span").each(function(){var i=$(this),r=i.offset().left;if(!i.is(".app-btn-check,.app-btn-more,.app-frozen-spacer")&&r<=n.pageX&&n.pageX<r+i.outerWidth(!0))return t=i,!1}),t.is(".app-frozen-spacer")&&(t=t.next()),t.is("span")&&!t.is(".app-btn-check,.app-field-separator")&&(t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),(n.type==="contextmenu"||n.type==="vclick"&&n.ctrlKey)&&(i.samples=!1),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");tp(t,i)},er))),!1}}).on("vclick contextmenu",".app-bar-heading",function(n){var t=$(n.target);if(t.closest(".app-group").length&&!t.is(".app-group"))return ak(!0),!1});ls.on("resize",function(){i.keyboard("detect");fft();bs();r.isVirtual&&lf(!0)}).on("throttledresize",function(){bs();pu(!0)}).on("orientationchange",function(){i.keyboard("detect");bs();pu(!0)}).on("popstate",function(){i.ignoreErrors=!0}).on("focus",function(){sft();ket()&&!ws()||ft().length||!tv||gu()||te()}).on("beforeunload",function(){l().is("#Main")&&(f.storage.instance("session"),fu("_scrollTop",g().scrollTop()),f.storage.instance("default"))});$(document).on("mousedown",function(){var n=at&&at[0];n&&n.display!=="none"&&!n.className.match(/\bapp-tooltip-message\b/)&&vi()}).on("mousemove",function(n){n.pageX!=null&&(ss=n.pageX,hs=n.pageY)}).on("vclick",".app-tooltip-message",function(){vi();te()}).on("mouseenter","[title],[data-title]",function(n,t){var i=$(this),u=i.attr("data-title"),f=typeof u=="string"&&u.length,r=i.attr("title"),e=typeof r=="string"&&r.length,o=ss,s=hs;if(f&&(r=u),e&&i.attr("data-title",r).removeAttr("title"),e||f){if(het){r&&(i.removeAttr("title"),setTimeout(function(){i.attr("data-title",r)},1e3));return}clearTimeout(cs);cs=setTimeout(function(){if(cs=null,t=10,!it||it.tooltip){var n=i.offset();i[0].namespaceURI===oet&&Math.abs(o-ss)<=11&&Math.abs(s-hs)<=11||ss>=n.left&&ss<n.left+i.outerWidth()&&hs>=n.top&&hs<n.top+i.outerHeight()?at&&at.is(".app-tooltip-message:visible")&&ba>new Date||dl(ss,hs+23,r,i):at&&!at[0].className.match(/\bapp-tooltip-message\b/)&&at.hide()}},t!=null?t:set)}}).on("mouseleave","[data-title]",function(){at&&!at[0].className.match(/\bapp-tooltip-message\b/)&&vi()});i=f.input={methods:{none:{render:gi},text:{render:function(n){var l=n.container,e=n.inner,v=n.row,t=n.field,y=t._dataView,h,p=n.originalField,a,o,r,s,u,c;p||t.Index===t.AliasIndex||(t=y._allFields[t.AliasIndex]);s=t.ItemsStyle;h=t.TextMode;o=v[t.Index];typeof o!="string"||o.length||(o=null);l.removeClass("app-has-helper");o==null?(r=n.editing?i.fieldToPlaceholder(p||t):"",l.addClass("app-null")):(s&&s!=="Lookup"&&s!=="AutoComplete"?(a=y._findItemByValue(t,o),a&&(r=a[1])):r=t.text(o,!0),h===1&&(r=new Array(r.length+1).join("&#9679;")),l.removeClass("app-null"));h===2&&e.addClass("app-field-data-rtf");!t.Rows||t.ItemsTargetController||s||e.css({"min-height":t.Rows+"em"}).addClass("app-text-multiline");gf(r)?e.html("&nbsp;"):(r=r.trim(),t.HtmlEncode&&h!==1?e.text(r):e.html(r));fl(e,t,o,r,!0)&&e.attr("title",r);n.editing?(u=t.tagged(/\bkbd-([\w\-]+)\b/),c=t.Type,u?u=u[1]:c.match(f._numericTypeRegex)?u="number":c.match(/Date(Time)?/)?u=c.toLowerCase():gb(t)?u="tel":nk(t)?u="email":nht(t)&&(u="url"),u&&n.container.attr("data-type",u)):t.HyperlinkFormatString&&e.attr("data-href",ly(t,v));this._createFooter(n)},focus:function(n){i.beforeFocus(n);var u=st(n),f=ft(u),t=i.elementToField(n),e=t.TextMode===2,r;if(e){if(r=t.is("rtf-editor"),r){y.editor({field:t.Name,type:r});return}y.toolbar("create",u)}else y.range("clear");if(cf(t),f.length)f.focus();else return alt(n)},blur:function(n){var t=$(n.target),i=st(t),u=i.find(".app-control-inner"),r=t.data("restoreText");y.range("save");r!=null&&u.text(r);y.toolbar("remove",i)},setup:function(n){var t=$(n.target).data("notify");t&&(n.change=i.methods.text._textChange)},_textChange:function(n){var i=n.input.closest("[data-notify]").data("notify"),t=$.Event(i);t.inputData=n;$(document).trigger(t)},_createFooter:function(n){var i=n.container,u=n.field,r=n.originalField,t;r||(r=u);r.FooterText?(t=i.find(".app-control-footer"),t.length||(t=s("app-control-footer")),t.appendTo(i.addClass("app-has-footer")),t.html(r.FooterText)):i.is(".app-has-footer")&&i.removeClass("app-has-footer").find(".app-control-footer").remove()}},blob:{_mapRequest:function(n,t,i,r){var u={autofill:"map"},f=0,e=0,o=0;return r.forEach(function(r){if(!r.match(/^_/)&&r in i){var s=i[r],h=s.trigger,l=n.findField(s.field),c=t[l.Index];h&&e++;c!=null&&(u[r]=c,f++,h&&o++)}}),f&&e===o?u:null},_mapUpdate:function(n,t,i,r){var u="",f,e;i=JSON.parse(i);r&&(r=JSON.parse(r),r.image&&(u="url(data:"+r.contentType+";base64,"+r.image+")"));f=[];e=i.latitude;e==null||"address1"in i?["address1","address2","address3","city","region","postalcode","country"].forEach(function(n){var t=i[n];t!=null&&f.push(t)}):f.push(e,i.longitude);n.attr("title",f.join(", "));n.css({backgroundImage:u,width:u?i.width:"",backgroundSize:i.scale>1?"100% auto":""}).data("r",i);t.toggleClass("app-has-map",u.length>0)},render:function(n){var b=this,y=n.container,e=n.inner,r=n.field,c=r._dataView,w=n.row,et=n.editing,d=w[r.Index],o,u,g,nt,tt,k,ot,t,a,st,it,rt,ut,l,v,ft;if(o=i.fieldToPlaceholder(r),r.tagged("autofill-address","autofill-geocode")){u=e.find(".app-map-placeholder");u.length||(u=p("app-map-placeholder").appendTo(e.empty()),y.attr("data-read-only","true"),o?s("app-data-input-placeholder").text(o).appendTo(u):u.html("&nbsp;"));rn(c,"");g=c._autoFill;nt=c._controller;for(it in g)if(r.tagged(it+"-map")&&(tt=g[it],k=b._mapRequest(c,w,tt,["latitude","longitude"]),ot=b._mapRequest(c,w,tt,["address1","address2","address3","city","region","city","country"]),t=ot,t?"address1"in t||!k||(t=k):t=k,e.toggleClass("app-has-map",t!=null),t)){st="";u.css({width:"",height:r.tagged("map-height-")?f.tagSuffix:""});t.width=Math.floor(u.width());t.height=Math.floor(u.height());u.css("width",t.width);t.scale=Math.ceil(window.devicePixelRatio)||1;rt=r.Tag.match(/\bmap\-type\-(\w+)\b/);rt&&(t.mapType=rt[1]);t.zoom=r.tagged("map-zoom-")?parseInt(f.tagSuffix):16;t=JSON.stringify(t);a=f.cache["map:"+t];a?a!==!0&&b._mapUpdate(u,e,t,a):(f.cache["map:"+t]=!0,f.execute({controller:nt,view:c._viewId,command:"AutoFill",trigger:t,background:!0}).done(function(n){a=n[nt].AutoFill;b._mapUpdate(u,e,t,a);f.cache["map:"+t]=a}));break}st==null&&u.css({backgroundImage:"",width:"",height:""}).removeData("r")}else e.empty(),!d||d.match(/^null/)?(y.addClass("app-null"),o&&(o===la&&(o=""),s("app-blob-placeholder").text(o).appendTo(e))):(o=d,et||(ut=e.find(".app-drop-box"),ut.length&&f.upload("destroy",{container:ut})),l=vt("",'rel="external"').appendTo(e),ft=r.Name.toLowerCase(),f.odp.blob("init",{link:l,field:r,key:o}),r.OnDemandStyle!==1?(l.addClass("app-has-image"),f.odp.blob("init",{image:$("<img/>").appendTo(l).attr({title:hu.BlobDownloadHint}),field:r,key:o}),$(c._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t===ft+"contenttype"||t===ft+"content_type")return v=w[n.Index],!1}),$(c._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t==="contenttype"||t==="content_type")return v=w[n.Index],!1}),v||(v="image"),v.match(/^image/i)?l.attr("data-content-type",v):h||l.attr("target","_blank")):(l.appendTo(e).addClass("app-link-blob").attr("title",hu.BlobDownloadHint),s().text(hu.BlobDownloadLink).appendTo(l),h||l.attr("target","_blank"))),et&&f.upload("create",{container:p("drop-box-"+r.Index,'tabindex="0"').appendTo(e),dataViewId:c._id,fieldName:r.Name,multiple:r.Multiple,change:function(){var n=!!y.find(".app-drop-box.app-empty").length;y.toggleClass("app-null",n);wi({dataView:r._dataView,values:{field:r,value:n?null:"0"},skipDrawingInput:y});pu(!1)}});i.methods.text._createFooter(n)},focus:function(n){return i.beforeFocus(n),ar(n),n.is(":input")?void 0:(ft().blur(),n.find(".app-drop-box").focus(),cf(n),!0)},blur:function(n){ar(n.target,!1)}},checkbox:{render:function(n){var t=n.container,r=n.inner,u,e=n.field,o=e.Items,f,s=n.editing,h=n.row[e.Index];f=o[o.length-1][0]==h;h==null?r.html(ec):(bt("material-icon-"+(f?"check-box":"check-box-outline-blank"),r.empty()).addClass("app-icon-checkbox"),t.addClass("app-has-checkbox"));r.css("visibility",s?"hidden":"");s?(u=p("app-checkbox-container",'tabindex="0"').appendTo(i.createContainer(t)),f&&u.addClass("app-checkbox-on"),vt("app-checkbox-button").appendTo(u)):t.find(".app-data-input-container").remove();i.methods.text._createFooter(n)},focus:function(n,t){i.beforeFocus(n);ft().blur();ar(n);var r=n.find(".app-checkbox-container").focus();return t&&t.is('[data-control="label"]')&&this._toggleState(r),cf(n),!0},blur:function(n){ar(n.target,!1)},click:function(n){var i=su(n.clientX),t=st(n.target,".app-checkbox-container");t.offset().left-8<=i&&i<=t.offset().left+t.outerWidth()+8&&(this._toggleState(t),this.focus(t),n.preventDefault())},_toggleState:function(n){var r=n.is(".app-checkbox-on"),u=st(n),e=u.attr("data-checkbox-style"),t,f;i.cancel()&&!n.is(".app-animation")&&(vi(),n.toggleClass("app-checkbox-on"),t=i.elementToField(n),e!=="circle"&&e!=="square"&&(r?(n.addClass("app-animation app-checkbox-on"),setTimeout(function(){n.addClass("app-animate-off").one("transitionend",function(){n.removeClass("app-animation app-checkbox-on app-animate-off")})})):(n.addClass("app-animation"),setTimeout(function(){n.addClass("app-animate-on").one("transitionend",function(){n.removeClass("app-animation app-animate-on")})}))),cf(t),wi({dataView:t._dataView,values:{field:t,value:!r},skipDrawingInput:u}),h||r||(f=t.is("lookup-auto-advance"),f&&setTimeout(i.move,0,u,"right",9,f)))}},lookup:{render:function(n){var t=n.originalField=n.field,p=t.ItemsTargetController,w,b;n.field=n.dataView._allFields[n.field.AliasIndex];var c=n.inner,o=n.container,u=o.find(".app-data-input-button"),k=o.data("node"),a=n.editing,v,h,y,r,l;!a&&p?i.methods.listbox.render(n):(v=t.ItemsStyle,a&&!u.is(".app-data-input-button")&&(u=s("app-data-input-button",hf("app-caret")).attr("title",gd.Select.HeaderText).insertAfter(c),u.css("marginTop",(c.text("w").outerHeight()-u.outerHeight())/2),v==="Lookup"?u.addClass("app-caret-r"):v==="DropDownList"&&(s("app-caret app-caret2").appendTo(u.addClass("app-caret-u-d")),t.tagged("open-on-tap")&&o.css("cursor","pointer"))),a?c.css("max-width",o.attr("data-size")!==""?"none":k.self.width()-(u.outerWidth()||22)-d(c,"padding-left")*2):(u.length&&u.is(".app-data-input-button")&&u.remove(),c.find(".app-control-before").remove(),o.removeClass("app-null app-has-helper")),h=o.find(".app-control-before"),p?(h.length?l=h.find("ul"):(c.text(i.fieldToPlaceholder(t)),o.addClass("app-has-helper"),h=s("app-control-before app-control-helper").attr("tabindex",0).insertBefore(c),l=nr().appendTo(h)),y=t.DynamicItems||t.Items,r=n.row[t.Index],r==null&&(r="",v!=="CheckBoxList"&&(l.empty(),h.css("display","none"),i.fitContainer(o))),typeof r!="string"&&(r=r.toString()),y.length?(r.length&&(w=l.find("li"),b=t.is("lookup-distinct"),r=f.csv.toArray(r),$(y).each(function(){var n=this,t=n[0],u;t!=null&&r.indexOf(t.toString())!=-1&&(u=ct().text(n[1]).attr("data-value",t).appendTo(l),b&&i.addCount(n[n.length-1],u))}),w.remove()),h.css("visibility","")):h.css("visibility","hidden"),o.toggleClass("app-null",gf(r))):(h.remove(),i.methods.text.render(n)),a||!t.ItemsDataController||n.row[t.Index]==null||t.tagged("lookup-details-hidden")||s("app-field-object-ref app-feedback").appendTo(c).attr("title",e.LookupViewAction))},focus:function(n){var t,f,r,s,c,l;i.beforeFocus(n);var u=n.find(".app-control-helper"),e=u.data("focus")===!1||i._buffer!=null,o=n.find("li");return(u.removeData("focus"),t=st(n),ar(t),cf(t),!e&&o.length)?i.valid()?(u.focus(),o.removeClass("app-focus").first().addClass("app-focus"),!0):!1:(f=i.methods.text.focus(n),e&&ar(t),f&&(r=i.elementToField(n),s=r._dataView.editRow(),n.data("autoComplete")===!1?n.removeData("autoComplete"):s[r.Index]==null&&(i.elementToButton(n).removeClass("app-caret-r"),r.ItemsStyle==="Lookup"&&(c=ft(st(n)).focus(),setTimeout(function(){i.methods.lookup._showList({field:r,value:null,input:c})},h?300:10)))),l=t.data("autoOpen"),l&&(t.removeData("autoOpen"),setTimeout(function(){i.popup("hide");$(".app-data-input").trigger($.Event("keydown",{altKey:!0,which:40}))},h?310:20)),f)},click:function(t){function a(){ar(u,!1);r.removeClass("app-focus")}var f=i.eventToButton(t),c=f.offset(),l=t.pageX,r=$(t.target),u=st(r),s;if(r.is("li,.app-muted")){if(r=r.closest("li"),!i.cancel())return t.preventDefault(),!1;if(ft(u).length){t.preventDefault();ft(u).blur();setTimeout(function(){r.trigger("vclick")},100);return}r.is(".app-focus")||r.parent().find("li").removeClass("app-focus");ft(u).blur();var v=u.find(".app-control-helper").blur(),o=i.elementToField(r),y=[{text:gd.Delete.HeaderText,icon:"trash",callback:function(){i.methods.lookup._removeBasketItem(r,!0);v.focus()}}];o.is("lookup-details-hidden")||o.is("lookup-distinct")||y.push({text:e.LookupViewAction,icon:"carat-r",callback:function(){a();n.details({field:o,key:r.attr("data-value")})}});ar(u);r.addClass("app-focus");yr({anchor:r,items:y,autoFocus:!1,afterclose:function(n,t){h?a():t||v.focus()}});t.preventDefault()}else r.closest(".app-control-helper").length?r.closest(".app-control-helper").focus():u.attr("data-input")==="dropdownlist"&&!ft(u).length&&(h||i.elementToField(r).tagged("open-on-tap"))?(t.preventDefault(),s=ft(),s.length&&s.blur(),h?(cf(u.data("field")),i.methods.lookup.lov(u)):this.clickButton(t)):(f.length&&c.left<=l&&l<c.left+f.outerWidth()+8||di())&&this.clickButton(t)&&t.preventDefault()},clickButton:function(t,r){function y(){e.removeClass("ui-btn-active");o=u._dataView;c=o._allFields[u.AliasIndex];l=o.editRow();n.lookup({field:u,value:v?l[u.Index]:null,text:v?c.format(l[c.Index]):null,change:function(n){if(o._inlineEditor&&ht.showField(o,u.Name),u.ItemsTargetController){if(n.length>=2)if(i.methods.lookup._useItemValue(u,[n[0].value,n[1].value]))h||f.find(".app-control-helper").data("focus",!1);else{ar(f).find(".app-control-helper").focus();return}}else wi({dataView:o,values:n});h||setTimeout(function(){a.focus(f)},100)}})}var e=i.eventToButton(t),a=i.elementToMethod(e),f=st(e),s=ft(f).length>0,u=i.eventToField(t),o,c,v=!u.ItemsTargetController,l;return!s&&!i.cancel()?!1:(s&&i.popup(":visible")&&(h||t.type!=="vclick")?(i.popup("hide"),i.methods.lookup._buttonUp(e)):u.ItemsStyle!=="Lookup"&&(!di()||$(".app-kiosk").nextAll(".ui-page-active").length)?(e.removeClass("ui-btn-active"),s||(f.find(".app-control-helper").data("focus",!1),a.focus(f)),ft(f).trigger($.Event("keydown",{ctrlKey:!0,which:32}))):(r!==!1&&e.addClass("ui-btn-active"),i.blur(),setTimeout(i.keyboard,0,y)),ow(),!0)},blur:function(n){var r=$(n.target),f=st(r),e=f.find(".app-control-inner"),t=r.data("restoreText"),u=i.eventToField(n);u.ItemsTargetController?(t=i.fieldToPlaceholder(u),e.text(t),i.fitContainer(f,null,t)):t!=null&&e.text(t);this._buttonUp(r);i.popup("hide");clearTimeout(u._showListTimeout)},setup:function(n){n.change=i.methods.lookup._lookupChange},_lookupChange:function(n){var t=n.input,r=i.elementToField(t),e,o,u,f,s;if(i.methods.lookup._preventList(),t&&r)if(t.removeData("keepFocus"),n.value?r.AllowAutoComplete===!1&&(t.val(t.data("original")).select(),n.value=""):(i.popup(":visible")||r.AllowAutoComplete===!1||r.ItemsStyle==="DropDownList")&&(clearTimeout(r._showListTimeout),f=st(t),s=t.data("original")||"",t.val(""),t.removeData("restoreText"),s!==""&&(i.clearValue(r),e=!0),t.data("original",""),f.find(".app-control-inner").text(i.fieldToPlaceholder(r)),i.fitContainer(f)),o=i.elementToButton(t),o.removeClass("app-caret-r"),t.data("autoComplete")===!1)t.removeData("autoComplete"),clearTimeout(r._showListTimeout);else{if(!n.value&&(e||t.data("original")===""||i.clearValue(r),r.ItemsTargetController&&n.keyCode))return;u={field:r,value:n.value,originalValue:t.data("original"),input:t};"keyCode"in n&&(u.keyCode=n.keyCode);i.methods.lookup._showList(u)}},lov:function(t){function s(u){if(u==="Clear")i.clearValue(r);else if(u==="New")n.lookup({field:r,create:!0,dataInput:t});else{var e=a[u];f.input.methods.lookup._useItemValue(r,e)}}var r=i.elementToField(t),c=r._dataView,l=c._allFields[r.AliasIndex],p=c.editRow(),a=r.DynamicItems||r.Items,v=p[r.Index],y,u=[],h,o;$(a).each(function(n){var t=this,i=v==t[0];u.push({text:l.format(t[1]),icon:i?"check":!1,visible:i,callback:s,context:n})});i.canCreateItems(r)&&(u.length&&(u.push({}),y=!0),u.push({text:es.GenericNewToolTip,icon:"material-icon-add",callback:s,context:"New"}));v!=null&&r.AllowNulls&&(y||u.push({}),u.push({text:e.LookupClearAction,icon:"material-icon-cancel",callback:s,context:"Clear"}));h=l.HeaderText;o=gt(t.find(".app-control-inner"));yr({x:o.left+o.width/2,y:o.top+o.height*.66,y2:o.top,title:h!=="&nbsp;"?h:null,anchor:t.find(".app-control-inner"),items:u})},_hidePopup:function(){if(!h)if(i.popup(":visible")){var t=i._lastInputBeforeScroll=ft(),n=st(t,".app-data-input-button");n.length&&this._buttonUp(n);i.popup("hide")}else i._lastInputBeforeScroll=null},_buttonUp:function(n){var t=i.elementToField(n);n.is(".app-data-input-button")||(n=i.elementToButton(n));t&&t.ItemsStyle==="Lookup"&&n.addClass("app-caret-r");n.removeClass("app-caret-u app-caret-d")},_getCopyFields:function(n){var o=n.Copy,i,t,r,u,e;if(o&&(i=n._dataView,t=t=i.session(n.Name+"_copyFields"),!t)){for(t=[];r=f._fieldMapRegex.exec(o);)u=r[1],e=r[2],(i.findField(u)||e==="null")&&t.push({fromField:e,toField:u});i.session(n.Name+"_copyFields",t)}return t},_preventList:function(){var n=this;clearTimeout(n._popupTimeout);clearTimeout(n._searchTimeout);n._searchTimeout=null;n._popupTimeout=null},_showList:function(n){function vt(){bt||(s.push({text:"$separator"}),bt=!0)}function yt(s){function tr(){function ri(){c.css({"min-width":ai?ut.width()-ft*2:"","max-width":"",width:""});ht=Math.max(gt(bt).width,p.length?p.offset().left-ot.left+p.outerWidth()+(kt?1:0):0)+ft;ht=Math.min(ht,(ki?rr:r.width)*.9);c.css({width:ht,"max-width":ht,"min-width":ht})}var e,s,tt,v,rt,lt,at,k,fi,oi,bi,li;if(!gl()&&o.parent().length){if(e=c.data("state"),!b&&e&&e.id===l._id&&e.f===t.Name&&e.v==ct&&!e.loading&&e.c===hi&&c.is(":visible")){if(s=bt.find(".app-selected"),g){for(s.html(g.text);++si<a.length;)if(rt=a[si].text,s=s.next(),lt=s.html(),rt!=null&&rt.match(/\"app\-text\-\w+/)||lt&&lt.match(/\"app\-text\-\w+/))s.html(rt);else break;return}if(!s.length&&e.noMatch&&u.length)return}for(tt=0;tt<a.length;tt++)v=a[tt],a[tt]="<li "+(v.before?v.before:"")+">"+(v.text==null?"":v.text)+((v.after?v.after:"")+"<\/li>");bt.html(a.join(""));g&&(g=bt.find(".app-selected"));c.data("state",{id:l._id,f:t.Name,v:ct,loading:pi,c:hi,noMatch:wi});c.css({width:"",maxWidth:"",minWidth:"",maxHeight:"",height:"",minHeight:"",left:"",top:"",display:""});ot=o.offset();at=d(o,"font-size");d(c,"font-size")!=at&&c.css("font-size",at);var pt=er||bt.find("li").first(),ai=l._inlineEditor&&!it,kt=ai&&ti.closest(".app-page-inlineeditor-overlay").length>0,ki=p.css("right")=="auto",ft=d(pt,"padding-left")+d(c,"border-left-width")+(kt?-1:0),dt=wt&&(!pt.length||ot.top>pt.outerHeight()*2.5),ni;if(ri(),yt=ot.left,dt&&(ni=!o[0].selectionStart&&nt!=null&&o[0].selectionEnd===nt.length),dt&&ni||(yt-=ft),vt=ot.top-1-r.top,ii=ot.top+yi,ui=r.height-(ot.top+yi-r.top),y=c.outerHeight(),h&&vt>100?(ci=!0,y=vt<y?vt:""):ui<y?vt>ui?(ci=!0,y=vt<y?vt:""):y=ui:y="",y&&(y-=4),y=y||c.outerHeight(),ci?(ii=ot.top-y,p.is(".app-caret-u-d")||p.addClass("app-caret-u")):p.removeClass("app-caret-u"),yt+ht>r.width+r.left-10&&(yt=r.width+r.left-1-ht-10),c.css({left:yt,top:ii,"max-height":y,height:y}),g){if(g.addClass("app-selected"),k=g.position().top-(y-g.outerHeight())/2,nt=nt.trim(),fi=u.length<nt.length,fi&&!b&&n.keyCode!=8)ri();else if(dt&&!fi&&ni){k=c.css("left",-1e4).scrollTop(k).scrollTop();ot=o.offset();var di=g.offset().top,f=Math.max(r.top,ii-(di-ot.top)-(d(g,"padding-top")-d(o,"padding-top"))),vi=c.outerHeight();f<0?(f-=4,c.find("li").last().css("margin-bottom",-f),k=Math.ceil(k-f),f=4):f+vi>r.height+r.top&&(oi=Math.max(r.top,r.height-vi-4+r.top),bi=f-oi,f=oi,c.find("li").first().css("margin-top",bi));c.css({top:f,left:yt-ft+(kt?5:0)})}c.scrollTop(k)}else o.val().length||(ut=st(o),et=ut.find(".app-control-inner"),et.length&&o.data("restoreText")==null&&o.data("restoreText",et.text()),i.fitContainer(ut,o.closest(".app-data-input-container").width("")),ri());w&&(li=o.closest(".app-page-inlineeditor"),li.length&&ei(li))}}var er,nr,ai;u=o.val();u===""&&wt&&s.length&&s[0]instanceof Array&&s[0][0]==null&&(u=s[0][1]);var at=u==="",ir=at?u:u.toLowerCase(),bt=c.data("ul"),a=[],v,kt,ut=lt.parent(),vi=llt(oft(ut)),et,ot,yi=o.outerHeight(),rr=ie(ti),g,nt,si,pi,wi,hi=0,bi=u&&RegExp.escape(u),ur=u?new RegExp(b?bi:"^"+bi+".*","i"):null,tt,dt=0,ki,ni,di,ht,yt,ii,vt,ui,y,ci,fr=t.is("lookup-distinct"),gi,fi,pt,oi,li=0;c.data("list",s);it&&(oi=f.csv.toArray(l.row()[t.Index]));$(s).each(function(r){var o=this,f=o.text,h,l=o.totalRowCount,c,y;if(l)u.length>=o.value.length&&dt<l&&a.push({before:'class="app-instruction"',text:String.format(e.ShowingItemsRange,dt,l)});else if(f==="$separator")r>0&&a.push({before:'class="app-instruction app-separator"'});else if(f)a.push(v={before:"",text:f}),kt="",o.instruction?(kt="app-instruction",f===of&&(pi=!0)):ni||(ni=v),o.selected&&(kt+=" app-selected"),kt&&(v.before='class="'+kt+'"'),c=o.command,c&&(v.before+=' data-command="'+c+'"',c.match(/SeeAll|New/)&&(v.after=hf("app-icon app-caret-r",hf("app-caret"))));else if(h=o[0],f=o[1],f!=null&&typeof f!="string"&&(f=t.format(f)),tt=f?f.toString().match(ur):null,f==="$separator")a.push(di={before:'class="app-instruction app-separator"'});else if((t.AllowNulls||h!=null||at||u===f)&&(rt||at&&(ft||k)&&f!==""||!at&&f&&(tt||f===u||u===n.originalValue))){if(dt++,oi){if(h!=null&&oi.indexOf(h.toString())!==-1)return;li++}a.push(v={before:'data-index="'+r+'"',text:""});hi++;vi&&(v.before+=" "+vi);!ki&&tt&&(y=ir===f.toString().toLowerCase(),g&&!y||at||(nt=f,g=v,ct=h,si=a.length-1),ki=h!=null&&(w||y));tt&&b&&u!==n.originalValue?(tt.index&&(v.text="<span>"+sf(f.substring(0,tt.index))+"<\/span>"),v.text+="<b>"+sf(f.substring(tt.index,tt.index+tt[0].length))+"<\/b>",tt.index+tt.length<=f.length-1&&(v.text+="<span>"+sf(f.substring(tt.index+tt[0].length))+"<\/span>")):tt&&!b?(v.text='<span class="app-text-normal">'+sf(f.substring(0,u.length))+"<\/span>",v.text+='<span class="app-text-bold">'+sf(f.substring(u.length))+"<\/span>"):v.text=f==null||f===""?ha:sf(f);f===gi&&o.length>2?(pt=i.methods.lookup._itemToDetails(t,o),pt&&(v.text+="<i>"+sf(pt)+"<\/i>"),fi||(pt=i.methods.lookup._itemToDetails(t,s[r-1]),pt&&(a[a.length-(fi?1:2)].text+="<i>"+sf(pt)+"<\/i>"),fi=!0)):fi=!1;fr&&(v.text+=i.addCount(o[o.length-1]));gi=f}});g||at&&(!oi||li||k)||s[0].text===of||s[0].text===rs||(ri&&a.splice(0,0,{before:'class="app-instruction"',text:rs}),wi=!0,et=ut.find(".app-control-inner"),et.length&&o.data("restoreText")==null&&o.data("restoreText",et.text()),at||(et.text(u+""),i.fitContainer(ut,lt)));it&&dt&&li>1&&(v={before:'data-command="SelectAll"',text:ya.SelectAll},ni?a.splice(a.indexOf(ni),0,v):(di||a.push({before:'class="app-instruction app-separator"'}),a.push(v)));g&&(g.before+=' class="app-selected"',nt=nt.trim(),nr=u.length<nt.length,nr&&!b&&n.keyCode!==8&&(ut=st(o),et=ut.find(".app-control-inner"),et.length&&o.data("restoreText")==null&&o.data("restoreText",et.text()),nt=u+nt.substring(u.length),i.fitContainer(ut,o,nt),wu||(ai=o.data("keyCode"),ai!==8&&ai!==46&&(o.data("autoComplete",!1),o.val(nt),o[0].setSelectionRange(u.length,nt.length),o.removeData("autoComplete")))));i.methods.lookup._preventList();"keyCode"in n?i.methods.lookup._popupTimeout=setTimeout(tr,100):tr()}function ui(n){c.is(":visible")&&c.data("field")===l._id+"_"+t.Name&&(s.splice(0,1),yt([[null,n.get_message()]].concat(s)))}function pt(){function it(n){if(h[g]=n,tt(l)&&o.parent().length&&(!r.searchTimeout||i.methods.lookup._searchTimeout===r.searchTimeout)){o.data("ignoreContextFields",!0);var f=[],a=n[p];$(a).each(function(){var t=this,i=[t[rt||n.primaryKey[0]],t[e]],r=t.group_count_;kt&&$(kt).each(function(){i.push(t[this.fromField])});r!=null&&i.push(r);f.push(i)});l.session(gs(t)+(v[ht.Index]==u?"":u),f);s.splice(0,1);s.length&&s[0].selected&&s.splice(0,1);a.length<n.totalRowCount&&f.push({totalRowCount:n.totalRowCount,value:u});c.data("field")===l._id+"_"+t.Name&&(k&&!u?(s.splice(0,1),s=f.concat(s),s.splice(0,0,{text:dt,instruction:!0})):s=f.concat(s),s.length||(s=[{text:rs,instruction:!0}]),yt(s))}}var p=w,e=t.ItemsDataTextField,rt=t.ItemsDataValueField,v=l.editRow(),h=l.session(t.Name+"_listCache"),b=[e],a=u!==n.originalValue&&u!==""?[e+":$"+ni+"$%js%"+f.serializer.serialize(u)]:[],y=cw(l,t,a),d=$.Event("populateexternalfilter.dataview.app");c.data("field",l._id+"_"+t.Name);d.externalFilter=y;$(document).trigger(d);y.forEach(function(n){var t;a.every(function(i){return i.startsWith(n.Name+":")&&(t=i),!t});t||a.splice(0,0,n.Name+":="+n.Value)});$(i.methods.lookup._getCopyFields(t)).each(function(){this.fromField!=="null"&&b.push(this.fromField)});h||l.session(t.Name+"_listCache",h={});var r={odp:!0,controller:p,view:t.ItemsDataView,sync:v[ht.Index]==u?v[t.Index]:null,lookupContext:{Controller:l._controller,View:l._viewId,FieldName:t.Name},_filter:a,sort:e,pageSize:t.tagged("lookup-fetch-all")?1e5:gh,fieldFilter:b,pageIndex:0,requiresRowCount:!0,externalFilter:y,distinct:t.is("lookup-distinct")},g=JSON.stringify(r),nt=h[g];nt?it(nt):(r.popupTimeout=i.methods.lookup._popupTimeout,i.methods.lookup._preventList(),i.methods.lookup._searchTimeout=r.searchTimeout=setTimeout(function(){f.execute(r).done(it).fail(ui)},na||ld?200:100))}var t=n.field,l=t._dataView,w=t.ItemsDataController,ut=t.ItemsStyle,wt=ut==="DropDownList",ft=ut==="AutoComplete",k=ut==="Lookup",it=t.ItemsTargetController,rt=!k&&!ft,bt,kt=this._getCopyFields(t),et,ot,dt=e.TypeToSearch,ht=l._allFields[t.AliasIndex],ni=ht.AutoCompleteAnywhere?"contains":"beginswith",b=ni==="contains",a=n.value,u=a==null?"":a,ct,c=i.popup(),o=n.input,ti=g(o),lt=o.parent(),p=i.elementToButton(o),at,v,y,nt,ii=t.AutoCompletePrefixLength,ri=!ii||u.length>=ii,s=[];if(vi(),lt.length){if(it&&st(o,".app-control-before .app-focus").removeClass("app-focus"),rt)s=t.DynamicItems||t.Items;else{if(t.AllowAutoComplete!==!1)if(u&&ri||ft){for(a=u,o.data("ignoreContextFields",!1),nt=gs(t),v=l.session(nt+a);!v&&a.length;)if(a=a.substring(0,a.length-1),v=l.session(nt+a),v&&v.length>=gh){v=null;break}while(v&&a.length){for(a=a.substring(0,a.length-1),y=l.session(nt+a);!y&&a.length;)if(a=a.substring(0,a.length-1),y=l.session(nt+a),y&&y.length>=gh){y=null;break}y&&y.length<gh&&(v=y)}v?s=s.concat(v):(s.push({text:of,instruction:!0}),u&&s.push({text:u,selected:!0,command:"None"}),at=!0)}else s.push({value:null,text:dt,instruction:!0});k&&(t._doSearch?(t._doSearch=!1,v=o.data("ignoreContextFields")?l.session(gs(t)):null,v?s=s.concat(v):(at=!0,s.splice(1,0,{value:null,text:of,instruction:!0}))):u||s.push({text:e.ShowOptions,command:"ShowOptions"}),vt(),s.push({text:e.SeeAll,command:"SeeAll"}))}i.canCreateItems(t)&&(rt&&(s=s.slice(0)),vt(),s.push({text:es.GenericNewToolTip,command:"New"}));!rt&&n.originalValue&&n.value&&(vt(),s.push({text:e.LookupClearAction,command:"Clear"}));s.length||s.push({text:rs,instruction:!0});yt(s);at&&(clearTimeout(t._showListTimeout),t.ItemsDataValueField||(ot=w+"_"+t.ItemsDataView+"_DataValueField",t.ItemsDataValueField=f.cache[ot]),t.ItemsDataTextField||(et=w+"_"+t.ItemsDataView+"_DataTextField",t.ItemsDataTextField=f.cache[et]),t.ItemsDataTextField&&t.ItemsDataValueField?n.keyCode!=null?t._showListTimeout=setTimeout(pt,300):pt():f.execute({controller:w,view:t.ItemsDataView,requiresData:!1}).done(function(n){t.ItemsDataValueField=n.primaryKey[0].Name;t.ItemsDataTextField=n.fields[0].Name;f.cache[ot]=t.ItemsDataValueField;f.cache[et]=t.ItemsDataTextField;pt()}).fail(ui))}},_itemToDetails:function(n,t){var e=[],u=2,o=n.Copy,i,s,r;if(o)while(s=f._fieldMapRegex.exec(o))i=n._dataView.findField(s[1]),i&&!i.Hidden&&!i.OnDemand&&i.Index==i.AliasIndex&&t&&t[u]!==undefined&&(r=t[u],r=r==null?r=ec:n.format(t[u]),e.push(r)),u++;return e.join("; ")},_rowToValues:function(n,t,i){var p=n._dataView._allFields[n.AliasIndex],y=n.Copy,o=n.ItemsDataValueField,s=n.ItemsDataTextField,e,r,c,h,l,a=null,v=null,u;if(o||$(t._allFields).each(function(){if(this.IsPrimaryKey)return o=this.Name,!1}),s||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return s=n.Name,!1}),e=t.findField(o),r=t.findField(s),i&&(v=i[r.Index],a=i[e.Index]),e)if(r){if(n.ItemsTargetController&&r)e&&(u=[{name:e.Name,value:a}]),r&&u.push({name:r.Name,value:v});else if(u=[{name:n.Name,value:a}],n.Index!=n.AliasIndex&&u.push({name:p.Name,value:v}),y)while(c=f._fieldMapRegex.exec(y))l=c[2],h=t.findField(l),(h||l=="null")&&u.push({name:c[1],value:h&&i?i[h.Index]:null})}else f.alert("Invalid text field "+s);else f.alert("Invalid value field "+o);return u},_removeBasketItem:function(n,t){if(n.length){var e=st(n),o=i.elementToField(n),s=o._dataView,h=s.editRow(),r=f.csv.toArray(h[o.Index]),u;t?(u=n.next(),u.length||(u=n.prev())):(u=n.prev(),u.length||(u=n.next()));u.addClass("app-focus");r.splice(r.indexOf(n.attr("data-value")),1);r=f.csv.toString(r);r.length||(r=null);n.remove();e.toggleClass("app-null",r==null);wi({dataView:s,values:{field:o,value:r},skipDrawingInput:e});r||(e.find(".app-control-helper").hide(),i.methods.lookup.focus(e))}},_createItemFromText:function(t,r,u,e){function c(){n.lookup({field:t,create:!0,dataInput:r,value:u})}if(e!==!1){setTimeout(function(){i.barcode(":input")||i.methods.lookup._createItemFromText(t,r,u,!1)},32);return}var h=t.ItemsNewDataView,o=t.ItemsDataValueField,s=t.ItemsDataTextField;hw(t);!yt()&&u&&t.ItemsDataController&&(h&&o&&s&&!t.Copy?(i.popup("hide"),f.execute({odp:!0,controller:t.ItemsDataController,view:h,command:"Insert",values:[{field:o},{field:s,newValue:u}],done:function(r){if(r.rowsAffected&&!r.errors.length){var u=r[t.ItemsDataController],f=[u[o],u[s]];ft().removeData("restoreText");i.methods.lookup._useItemValue(t,f);n.notify(String.format(uc.Scopes.Form.Insert.Notify,f[1]))}else c()}})):c())},_useItemValue:function(n,t,r,u){var c=t[0],s=t[1]!=null?n.format(t[1]):"",p=n._dataView,w=p.editRow(),k=p._allFields[n.AliasIndex],tt=ft(),o=tt.length&&st(tt).data("field")===n.Name?tt:$(),e=o.length?st(o):l('[data-control="field"][data-field="'+n.Name+'"]'),it=e.find(".app-control-inner"),d,a,v,b,ut,y,rt;if(c==null){if(n.ItemsTargetController)return;if(w[n.Index]!=null&&(i.clearValue(n),ut=i.fieldToPlaceholder(n),o=ft(e).val("").removeData("original").removeData("restoreText"),i.fitContainer(e,o.closest(".app-data-input-container")),e.find(".app-data-input-placeholder").css("display",""),o.length))try{o[0].setSelectionRange(0,ut.length)}catch(at){}}else{if(n.ItemsTargetController){if(b=f.csv.toArray(w[n.Index]),c!=null&&(c=c.toString()),$(b).each(function(n){if(c==this)return d=n,!1}),v=d==null,v&&(b.push(t[0]),d=b.length-1,a=f.csv.toString(b),a===""&&(a=null),e.toggleClass("app-null",a==null)),l('[data-input-container="'+p._id+'"] [data-control="field"][data-field="'+n.Name+'"]').each(function(){var u=$(this),r=u.find(".app-control-helper"),f,e;r.length&&(r.find("li").removeClass("app-focus"),v?(f=ct().text(s).attr("data-value",c).appendTo(r.show().find("ul")),n.is("lookup-distinct")&&i.addCount(t[t.length-1],f),i.drawing(u,!1),n.ItemsStyle!=="DropDownList"&&($(n.Items).each(function(){var n=this;if(n[0]==t[0])return e=!0,!1}),e||n.Items.push(t))):ar(st(r.find('li:eq("'+d+'")').addClass("app-focus"))),r.css("visibility",""))}),u==!1){w[n.Index]=a;return}if(s="",o.length){o.data({original:s,last:s}).val(s)[0].setSelectionRange(0,0);e.find(".app-data-input-placeholder").show();it.text(i.fieldToPlaceholder(n));it.css("width","");i.fitContainer(e,o.closest(".app-data-input-container").width(""));v||ar(e).find(".app-control-helper").focus();var et=e.offset(),ot=e.outerHeight(),nt=g(o),ht=nt.height(),lt=nt.offset();et.top+ot>lt.top+ht&&nt.scrollTop(nt.scrollTop()+(et.top+ot-(lt.top+ht)+4))}return v&&wi({dataView:p,values:{field:n,value:a},skipDrawingInput:e}),v}o.length&&o.data({original:s,last:s}).val(s)[0].setSelectionRange(0,s.length);it.text(s);o.length&&i.fitContainer(e,o.closest(".app-data-input-container").width(""));e.removeClass("app-null").find(".app-data-input-placeholder").hide();(w[n.Index]!=c||n.Index!==k.Index&&w[k.Index]!=s)&&(y=[{name:n.Name,value:c}],n.Index!==k.Index&&y.push({name:k.Name,value:s}),$(i.methods.lookup._getCopyFields(n)).each(function(n){y.push({name:this.toField,value:this.fromField==="null"?null:t[n+2]})}),wi({dataView:p,values:y,skipDrawingInput:e}),h||(rt=n.is("lookup-auto-advance"),rt&&y.length&&y[0].value!=null&&setTimeout(function(){i.move(e,"right",9,rt)})))}}},autocomplete:{render:function(n){i.methods.lookup.render(n)},focus:function(n){return i.methods.lookup.focus(n)},click:function(n){i.methods.lookup.click(n)},clickButton:function(n,t){return i.methods.lookup.clickButton(n,t)},blur:function(n){i.methods.lookup.blur(n)},setup:function(n){i.methods.lookup.setup(n)}},dropdownlist:{render:function(n){i.methods.lookup.render(n)},focus:function(n){return i.methods.lookup.focus(n)},click:function(n){i.methods.lookup.click(n)},clickButton:function(n,t){return i.methods.lookup.clickButton(n,t)},blur:function(n){i.methods.lookup.blur(n)},setup:function(n){i.methods.lookup.setup(n)}},radiobuttonlist:{render:function(n){i.methods.listbox.render(n)},focus:function(n){return i.methods.listbox.focus(n)},click:function(n){i.methods.listbox.click(n)},clickButton:function(n,t){return i.methods.listbox.clickButton(n,t)},blur:function(n){i.methods.listbox.blur(n)}},checkboxlist:{render:function(n){i.methods.listbox.render(n)},focus:function(n){return i.methods.listbox.focus(n)},click:function(n){i.methods.listbox.click(n)},clickButton:function(n,t){return i.methods.listbox.clickButton(n,t)},blur:function(n){i.methods.listbox.blur(n)}},listbox:{render:function(n){var et=n.container,o=n.inner,ot,t,y,r=n.field,c,tt,it=r.ItemsStyle,st=n.row,b,ht=r.Columns,l,u=r.DynamicItems||r.Items,a,v,p,rt,w,g,nt,ft,lt;if(c=st[r.Index],n.editing){if(b=i.canCreateItems(r,st),v=u.length,ht?l=Math.ceil((v+(b?1:0))/ht):(l=r.Rows,l||(l=5)),et.removeClass("app-null app-has-helper"),o.removeClass("app-collapsed"),rt=o.find(".app-focus").text(),t=o.find(".app-data-list"),!t.length){o.empty();wt.height&&(ot=s("app-data-list-outer").appendTo(o));t=s("app-data-list").attr("tabindex",0).appendTo(ot||o);wt.height&&t.css({"margin-bottom":-wt.height-d(t,"padding-bottom"),"overflow-x":"scroll"});p=$('<span class="app-hscrollbar2"><span class="app-hscrollbar-handle" data-draggable="hscrollbar"><\/span><\/span>').toggleClass("app-scrollbar-wide",he).appendTo(o).find(".app-hscrollbar-handle");t.on("scroll",function(){if(t.data("scrolling")===!1)t.removeData("scrolling");else{ry(t,p);var n=p.data("reveal-timeout"),i=p.parent();i.addClass("app-scrollbar-reveal");clearInterval(n);n=setInterval(function(){i.removeClass("app-scrollbar-reveal");clearInterval(n)},200);p.data("reveal-timeout",n)}})}v&&t.empty();t.removeClass("app-inner-shadow-right app-inner-shadow-left app-inner-shadow-left-right");it==="CheckBoxList"&&c&&(a=f.csv.toArray(c.toString()));var at=r.tagged("lookup-distinct"),h=r.is("lookup-top"),ut=u,k;if(h&&(h=parseInt(h),h)){if(u=u.slice(0),u.length&&u[0][0]==null&&it.match(/^(RadioButtonList|ListBox)$/)&&(k=u[0],u.splice(0,1)),u=u.sort(en),a||c==null||(a=[c.toString()]),a&&a.length){for(w=[],g=[],u.forEach(function(n){var t=n[0];t!=null&&a.indexOf(t)!==-1?w.push(n):g.push(n)}),nt=0;nt<g.length;nt++){if(w.length>=h)break;w.push(g[nt])}u=w.sort(en)}u.splice(h);l=h;k&&(u.splice(0,0,k),l++)}$(u).each(function(n){n%l==0&&(y=nr().appendTo(t));var f=this,u=ct().appendTo(y),e=f[0],o=f[1];h&&(n=ut.indexOf(f));u.attr("data-index",n);o==null&&(o=ha);r.HtmlEncode?u.text(o):u.html(o);at&&e!=null&&i.addCount(f[f.length-1],u);(a&&a.indexOf(e==null?"":e.toString())!==-1||c==e)&&u.addClass("app-selected");e==null&&o===ha&&u.addClass("app-null")});h&&ut.length>h&&ct().appendTo(y).attr("data-index","more").text(ut.length-h-(k?1:0)+" "+fr);ft=t.find('[data-index="new"]');b?ft.length||((l&&v%l!=0||v<r.Rows)&&v||(y=nr().appendTo(t)),ct().appendTo(y).attr("data-index","new").text(es.GenericNewToolTip)):ft.remove();this._scrollItemIntoView(t,!1);v||b&&t.find("li").length===1||t.children().addClass("app-hidden");rt&&o.find("li").each(function(){var n=$(this);if(rt===n.text())return n.addClass("app-focus"),!1});lt=t.next().show();v?ry(t):lt.hide();c!=null&&this._updateCollapsibleValue(r,et)}else o.find(".app-data-list,.app-list-value").remove(),(it==="CheckBoxList"||r.ItemsTargetController)&&c?(tt=r.text(c,!1),r.HtmlEncode?o.text(tt):o.html(tt)):(i.methods.text.render(n),r.ItemsDataController&&n.row[r.Index]!=null&&!r.tagged("lookup-details-hidden")&&s("app-field-object-ref app-feedback").appendTo(o).attr("title",e.LookupViewAction));i.methods.text._createFooter(n)},focus:function(n){i.beforeFocus(n);var t=n.find(".app-data-list");return t.length||(t=n.closest(".app-data-list")),t.focus(),cf(n),this._focusItem(t),this._scrollItemIntoView(t),ar(n),!1},click:function(t){var s,r,e,k,u,y,c,l,a,p,o,w,b,v;if(t.type!=="touchend"&&(s=$(t.target),r=s.closest("li"),i.cancel()&&!r.parent().is(".app-hidden")))if(vi(),r.length){if(e=r.closest(".app-data-list"),u=i.elementToField(r),c=u.ItemsStyle,u._dataView._busy()||r.parent().is(".app-hidden"))return;if(o=st(e),w=r.attr("data-index"),w==="new"){this._focusItem(r);n.lookup({field:u,create:!0,dataInput:o});t.preventDefault();return}if(w==="more"){t.preventDefault();i.editor({dataView:y,fieldName:u.Name});return}if(y=u._dataView,l=u.DynamicItems||u.Items,l.length)if(c==="CheckBoxList")r.toggleClass("app-selected"),a=[],e.find(".app-selected").each(function(){var t=parseInt($(this).attr("data-index")),i=l[t],n=i[0];a.push((n!=null?n:"").toString())}),p=u.ItemsTargetController||c==="CheckBoxList"?f.csv.toString(a):a.join(","),clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(function(){wi({dataView:y,values:{field:u,value:p===""?null:p},skipDrawingInput:o})},250));else{if(r.is(".app-selected")){this._focusItem(e);i.methods.listbox._updateCollapsibleValue(u,o);return}e.find(".app-selected").removeClass("app-selected");r.addClass("app-selected");b=l[parseInt(r.attr("data-index"))];i.drawing(o,!1);clearTimeout(e.data("timeout"));e.data("timeout",setTimeout(function(){i.methods.listbox._useItemValue(u,b);i.methods.listbox._updateCollapsibleValue(u,o);!h&&u.is("lookup-auto-advance")&&b[0]!=null&&i.move(o,"right",9)},c==="RadioButtonList"?250:10))}k=g(e);k.height()>e.height()&&e.focus();this._scrollItemIntoView(r);e.find(".app-focus").removeClass("app-focus");this._focusItem(r);this.focus(s);t.preventDefault()}else v=s.closest(".app-collapsed"),v.length&&(v.removeClass("app-collapsed"),r=v.find(".app-selected").first(),r.length&&(this._scrollItemIntoView(r),this._focusItem(r)))},blur:function(n){ar(n.target,!1)},_updateCollapsibleValue:function(n,t){if(n.is("lookup-collapsible")){var i=t.find(".app-control-inner"),u=i.find(".app-list-value"),r,f;u.length||(u=s("app-list-value").appendTo(i.addClass("app-has-list-value")),bt("material-icon-expand-more",i).attr("title",fo));r=[];i.find("ul:not(.app-hidden) .app-selected").each(function(){r.push($(this).html())});u.html(r.join(", "));f=r.length>0;i.addClass("app-collapsible").toggleClass("app-collapsed",f)}},_scrollItemIntoView:function(n,t){if(n.is(".app-selected,.app-focus")||(n=n.find(".app-focus").first()),n.length||(n=n.find(".app-selected").first()),n.length){var r=n.offset(),f=n.outerWidth(),i=n.closest(".app-data-list"),e=i.width(),o=Math.min(f*.2,e*.1),u=i.offset();r.left<u.left?i.data("scrolling",!1).scrollLeft(n.parent().prev().length?i.scrollLeft()+r.left-u.left-o:0):r.left+f>u.left+e&&i.data("scrolling",!1).scrollLeft(i.scrollLeft()+r.left-u.left-(e-f-o));t!=!1&&ry(i)}},_focusItem:function(n){if(!h){var t=n.closest(".app-data-list"),i=t.find("li");if(!n.is("li")){if(n.find(".app-focus").length)return;n=t.find(".app-selected").first()}n.length||(n=i.first());n.addClass("app-focus")}},_useItemValue:function(n,t,i){var u=n._dataView,o,r=[{name:n.Name,value:t[0]}],s=n.Copy,h,c=n.Index!==n.AliasIndex,e;if(n.ItemsTargetController)o=u.editRow(),e=o[n.Index]||"",e&&(e+=","),e+=t[0].toString(),r[0].value=e;else if(c&&r.push({name:u._allFields[n.AliasIndex].Name,value:t[1]}),s)for(h=2;copyInfo=f._fieldMapRegex.exec(s);)copyToField=copyInfo[1],copyFromField=copyInfo[2],u.findField(copyToField)&&r.push({name:copyToField,value:copyFromField==="null"?null:t[h++]});i||(wi({dataView:u,values:r,skipPopulateField:n}),r.splice(0,c?2:1));r.length&&wi({dataView:u,values:r,populateDynamicLookups:!1,skipPopulateField:n})}}},of:function(n,t){n&&n.jquery||(n=$(n));var i=n.closest("[data-input]");return i.length||(i=n.find(".app-data-input").closest("[data-input]")),t?i.find(t):i},restoreLastPopup:function(){var n,e,r,u,f,t;et||(n=this._lastInputBeforeScroll,n&&n.length&&!h&&(e=i.elementToButton(n),e.length&&(r=g(),u=r.offset(),f=n.offset(),u.top<f.top&&f.top+n.outerHeight()<u.top+r.height()&&(t=$.Event("keydown"),t.which=40,t.altKey=!0,ft().trigger(t)))))},reset:function(n){var i,t=n._dataView,r;typeof n=="string"&&(t=dt(),n=t.findField(n));r=n.ItemsStyle;i=n.Name;r&&(hw(n),r.match(/List/)&&f.execute({controller:t._controller,view:t._viewId,requiresData:!1,metadataFilter:["fields","items"],fieldFilter:[i]}).then(function(u){n.Items=u.map[i].Items.splice(0);r!=="DropDownList"&&wi({values:[{name:i,value:t.editRow()[n.Index]}],raiseCalculate:!1})}))},clearValue:function(n){var i=n._dataView,r,u,e,t;if(typeof n=="string"&&(i=dt(),n=i.findField(n)),r=[{name:n.Name,value:null}],u=n.Copy,n.Index!==n.AliasIndex&&r.push({name:i._allFields[n.AliasIndex].Name,value:null}),u)while(t=f._fieldMapRegex.exec(u))t=t[1],e=n._dataView.findField(t),(e&&e.ReadOnly||t==="null")&&r.push({name:t,value:null});wi({dataView:i,values:r,skipPopulateField:n});ft().data("original","")},fieldToPlaceholder:function(n){var t="",r=n.ItemsStyle,u=n.Watermark,f=es.SelectLink,e=kd.Optional,i;return u?t=u:n.ItemsTargetController?t=es.AddItem:!r||r.match(/^CheckBox/)||n.ItemsTargetController?n.AllowNulls||(t=la.toLowerCase()):(i=n.DynamicItems||n.Items,t=i&&i.length&&i[0][0]==null?i[0][1]:f),t.length||(n._naPlaceholder==null&&(n._naPlaceholder=ltt(n._dataView)&&!att(n._dataView)),n._naPlaceholder&&n.AllowNulls&&(t=e)),t},eventToButton:function(n){return this.elementToButton(n.target)},elementToButton:function(n){return st(n,".app-data-input-button")},eventToMethod:function(n){return this.elementToMethod(n.target)},elementToMethod:function(n){var t=st(n);return i.methods[t.attr("data-input")]},eventToField:function(n){return this.elementToField($(n.target))},elementToField:function(n){var f=n.closest("[data-field]"),i=f.attr("data-field"),r=n.closest("[data-input-container]"),t,u;if(i&&r.length)return t=k(r.attr("data-input-container")),t&&(u=t.findField(i)),u},inputsOf:function(n,t){if(t){var i=[];return n.find("[data-input]").each(function(){var n=$(this);i.push(!n.is('[data-input="none"]')&&n.is(":visible")?this:null)}),i}return n.find('[data-input]:not([data-input="none"])').filter(lr)},peersOf:function(n){var t=n.closest("[data-input-container]"),i,r;return t.length||(t=c),n.data("active",!0),r=t.find('[data-input]:not([data-input="none"]):not([data-read-only])').filter(lr).each(function(n){var t=$(this);if(t.data("active"))return i=n,t.removeData("active"),!1}),{list:r,index:i}},eventToDirection:function(n){function u(){return $(t).closest('[data-layout="form"]').length>0}var t=n.target,r,i=n.keyCode||n.which;if(i===9&&(r=n.shiftKey?"left":"right"),i!==37||this.selectionStart!==0||t.selectionEnd!==0||u()||(r="left"),i===39&&t.value&&t.selectionStart===t.value.length&&!u()&&(r="right"),(i===38&&!n.ctrlKey||i===13&&n.shiftKey)&&(t.tagName!=="TEXTAREA"||!t.selectionStart)&&(t.tagName!=="DIV"||$(t).is(".app-drop-box"))&&(r="up"),i===40&&!n.ctrlKey||i===13&&!n.shiftKey){var f=t.tagName==="TEXTAREA",e=t.tagName==="INPUT",h=vn(t),o=t.selectionStart,s=t.value;h||(e||f)&&!e&&(!f||(i!==40||o!==s.length)&&(i!==13||o!==0||t.selectionEnd!==s.length))||(r="down")}return r},blur:function(n){if(n)i.move(n,"enter");else{var t=ft();t.is("iframe")?(kl(!1),y.toolbar("remove",t.closest("[data-input]")),t.trigger("forceblur.app"),kl(!0)):eu().blur()}},move:function(n,t,r,u,f){function tt(t){if(!i.valid()){eu().blur();return}var r=$(t),f=r.attr("data-input"),u=i.methods[f];u&&u.focus?r.is(n)&&a.length?(a.blur(),te()):u.focus(r,n):f==="dataview"&&bi({fieldName:r.data("field")})}i._refocus(!1);n.is("[data-input]")||(n=st(n));var a=ft(n),w=n.closest('[data-layout="form"]').length>0,e=typeof t=="string"?null:t,o,b=$.Event("datainputmove.app",{fromDataInput:n,textInput:a,direction:t,keyCode:r,containerType:u});if(vi(),t&&$(document).trigger(b),!b.isDefaultPrevented()){if(!e&&t){w&&(t==="down"&&(t="right"),t==="up"&&(t="left"));var h=i.peersOf(n),l=n.closest("[data-container]"),v=l.attr("data-columns"),k=parseInt(v),c,s;if(k>1&&(o=i.inputsOf(l,!0),c=o.indexOf(n[0])),t==="left"){if(v){if(s=l.prev(),s.is('[data-container="row"][data-columns]'))while(!e&&s.length)o=i.inputsOf(s,!0),e=o[c],s=s.prev();while(!e&&c){for(s=l.nextAll('[data-container="row"][data-columns]').last();!e&&s.length;)o=i.inputsOf(s,!0),e=o[c-1],s=s.prev();c--}}else!e&&h.index&&(e=h.list[h.index-1]);e||r!==9||(o=i.find(n,"up"),o&&o.length&&(e=o[o.length-1]))}else if(t==="right"){if(v){if(s=l.next(),s.is('[data-container="row"][data-columns]'))while(!e&&s.length)o=i.inputsOf(s,!0),e=o[c],s=s.next();while(!e&&c<k-1){for(s=l.prevAll('[data-container="row"][data-columns]').last();!e&&s.length;)o=i.inputsOf(s,!0),o.length&&(e=o[c+1]),s=s.next();c++}}else!e&&h.index<h.list.length-1&&(e=h.list.get(h.index+1));e||r!==9||(o=i.find(n,"down"),o&&o.length&&(e=o[0]))}else(t==="up"||t==="down")&&(o=i.find(n,t),o&&(e=o[o.length>h.index?h.index:o.length-1]));w&&!e&&(e=n)}var d='[data-container="'+u+'"]',g=typeof u=="string",nt=g&&a.closest(d).first().is($(e).closest(d).first()),y,p;if((!g||nt)&&(e&&!nt&&t==="right"&&(p=$(e).closest("[data-container]").first(),y=p.find("[data-control][data-focus]").filter(lr),y.length&&!n.closest("[data-container]").first().is(p)&&(e=y.first())),e)){if(f)return e;tt(e)}}},find:function(n,t){var i,r,u;return n.is("[data-input-container]")||(n=n.closest("[data-input-container]")),i=n.data("active",!0).parent().find("[data-input-container]"),$(i).each(function(n){var t=$(this);if(t.data("active"))return r=n,t.removeData("active"),!1}),u=t==="up"?r?$(i.get(r-1)):null:r<i.length-1?$(i.get(r+1)):null,u?u.find('[data-input]:not([data-input="none"])'):null},popup:function(){var t=this,n=t._popup,i;if(arguments.length===1)if(arguments[0]==="hide")$(n).hide();else return $(n).is(arguments[0]);else return n||(n=t._popup=p("app-data-input-popup").hide().appendTo(c),i=nr().appendTo(n),n.data("ul",i)),n},render:function(n){var t=n.container,r=n.inner,e=n&&n.dataView||k(t.closest("[data-input-container]").attr("data-input-container")),u=n.field,o=n.row,f=n.editing,s,c,l,a,v,y,h,p;if(e&&!u){if(t.is("[data-layout]")&&!t.data("prepared"))return;f=f!=null?f:e.extension().editing();t.attr("data-state",f?"write":"read");o||(o=e.commandRow());f?t.find('[data-control="field"]').each(function(){var t=$(this),u=t.data("node"),r,n;u.ready&&(r=t.attr("data-field"),n=e.findField(r),n&&n.Type!="DataView"&&i.render({container:t,dataView:e,field:n,editing:f,row:o}))}):t.find('[data-control="field"]').removeAttr("data-input")}else{if(h=t.data("node"),!h||!h.ready)return;if(!t.is(":visible")){h.dirty=!0;return}u&&(y=f&&t.attr("data-read-only")!="true"&&!u.isReadOnly()&&!u._inputReadOnly,p=u.is("input-type"),c=p?p:(u.ItemsStyle||(u.OnDemand?"blob":"text")).toLowerCase(),l=t.attr("data-input"),a=y?c:"none",t.attr("data-input",a),l&&l!=a&&(r||(r=t.find(".app-control-inner")),r.prevAll().remove(),r.nextAll().remove(),r.empty()),s=t.attr("data-placeholder"),s&&(u.Watermark=s=="$label"?u.HeaderText:s));v=i.methods[c];v&&(r||(r=t.find(".app-control-inner")),r.length?r.addClass("app-field-data"):r=t,v.render({container:t,inner:r,dataView:e,field:u,row:o,editing:y}))}},createContainer:function(n){var i=n.children(),t=s("app-data-input-container").appendTo(n);return i.each(function(){var n=this;n.className.match(/\b(app-control-(helper|toolbar|frame))\b/)||(n.style.visibility="hidden")}),this.fitContainer(n,t),t},fitContainer:function(n,t,r){var e=n.find(".app-data-input-button"),c=n.is(".app-has-helper"),l=n.attr("data-size")==="auto"||e.length,o,u,h,f,s,a,v,y,p,w;t||(t=n.find(".app-data-input-container"));c&&(f=n.find(".app-control-inner"),f.length&&t.css({left:f.offset().left-n.offset().left,top:f.offset().top-n.offset().top}));t&&(l&&!t.is(".app-data-input")&&(t=n.find(".app-data-input")),t&&t.is(".app-data-input")&&(o=t,t=o.closest(".app-data-input-container"),l&&(arguments.length<3&&(r=o.val()),u=n.find(".app-control-inner"),v=u.offset().top,h=u.text(),h!==r&&r.length&&h.length<=r.length+2&&(a=o.data("restoreText"),a||o.data("restoreText",h),u.addClass("app-control-inner-trailer").text(r)),t.width(""),v!==u.offset().top&&uu())));y=n.is(".app-has-helper");e.length&&(u||(u=n.find(".app-control-inner")),p=gt(u.length?u:n).height,e.css("visibility",""),t.css({height:p,width:y?u.outerWidth():Math.ceil(e.position().left)-d(t,"padding-left")*2+3}),c&&f.length&&t.length&&(w=t.offset().top,t.css({left:f.offset().left-n.offset().left,top:f.offset().top-n.offset().top}),s=t.offset(),w!==s.top&&i.popup(":visible")&&i.popup().css({left:s.left,top:e.is(".app-caret-u")?s.top-i.popup().outerHeight():s.top+t.outerHeight()})))},execute:function(t){var ut,et,g,ot,ht,h,nt;(Array.isArray(t)||!t.values)&&(t={values:t});var r=t.dataView,u=t.values,st,d=t.populateDynamicLookups,a=t.skipPopulateField,tt=t.skipDrawingInput,v,ct={},y,c,o,p,s,it,e,w,b,rt;if(!Array.isArray(u))if(("name"in u||"field"in u)&&"value"in u)u=[u];else{ut=[];for(et in u)ut.push({name:et,value:u[et]});u=ut}if(u.forEach(function(n){var t=n.field;t!=null&&(n.name=typeof t=="string"?t:t.Name)}),st=u.length,tt&&(i.drawing(tt,!1),a||(a=r.findField(tt.attr("data-field")))),a&&(a.skipPopulate=!0),typeof r=="string"?r=k(r):r||(r=n.pageInfo().dataView),r._ignoreUnsavedChanges=!1,v=t.container||l('[data-input-container="'+r._id+'"]'),s=r.editRow(),d!==!1&&u.forEach(function(n){var t=r.findField(n.name||n.Name);t&&r._enumerateContextFieldValues(t,u,ct,s)}),d!==!1&&u.forEach(function(n){var i=n.name||n.Name,t=r.findField(i);t&&(t.CausesCalculate&&!y&&(y=t),s[t.Index]=n.name?n.value:n.NewValue)}),d!==!1&&(c={dataView:r,row:s,fields:[],container:v,resize:!0},i.evaluate(c)),c&&c.fields.length?(o=u.slice(),o.forEach(function(n){var i=r.findField(n.name||n.Name),t=c.fields.indexOf(i);t!==-1&&c.fields.splice(t,1)}),c.fields.forEach(function(n){o.push({name:n.Name})})):o=u,o.forEach(function(n){var o=n.name||n.Name,u=r.findField(o),c=r.editing(),l=$(v).find('[data-control][data-field="'+o+'"]'),h;u&&(l.each(function(){function d(){o&&(wf(o),o.sync())}var h=$(this),g=h.attr("data-control"),w,nt=u.Name,b=u.Tag,a,o,v,l,y;g!=="label"&&(w=c&&h.attr("data-read-only")!=="true"&&!u.isReadOnly(),u.Type==="DataView"?(p||(p=[]),p.push(n),o=k(u._dataViewId),w&&n.Modified?(v=[],l=n.NewValue,l==="null"?o._totalRowCount>0&&v.push(f.execute({command:"Delete",controller:o._controller,view:o._viewId,values:[{field:o._externalFilter[0].Name,value:o._externalFilter[0].Value}]})):l!=null&&Array.isArray(l)&&l.forEach(function(n){var t={command:"Insert",controller:o._controller,view:o._viewId,values:[]};for(var i in n)t.values.push({field:i,newValue:n[i]});v.push(f.execute(t))}),$.when.apply($,v).then(d)):d()):(h.is(".app-has-focus")&&s[u.Index]!=null&&(y=ft(),y.length&&(it=nt,y.data("original",y.val()),eu().blur())),i.drawing(h)?i.render({container:h,inner:h.find(".app-control-inner").removeData("last-smart-text"),dataView:r,field:u,row:s,editing:w}):i.drawing(h,!0),b&&(a=b.match(vd),a&&t.autoFill!==!1&&(e=rn(r,a[1]),e[a[4]].changed=!0))))}),h=u._persist,h&&(b||(rt=h==="user"?ri:yet,b=rt("persistVars")||{}),b[o]="Name"in n?n.Value:n.value))}),b&&rt("persistVars",b),$(document).trigger($.Event("datainputbroadcast.app",{dataView:r,values:o})),p&&p.forEach(function(n){u.splice(u.indexOf(n),1)}),y&&t.raiseCalculate!==!1&&r._raiseCalculate(y,y),d!==!1&&st!==u.length&&(r._busy()?r._pendingPopulate=!0:r._raisePopulateDynamicLookups()),r._showClearAll&&(r._showClearAll=!1,v.find(".app-has-clear-all").addClass("app-form-clear-all-visible")),uu(v.closest(".app-wrapper"),!0),a&&(a.skipPopulate=!1),r.tagged("modal-auto-grow")&&ei(),e){g={components:{},_reset:!0};ot=0;w=!0;for(h in e)h.match(/^_/)||(autoFillInfo=e[h],nt=s[autoFillInfo.index],autoFillInfo.trigger?nt!=null&&nt.length||(w=!1,o.forEach(function(n){n.name===autoFillInfo.field&&(ht=!0)})):nt==null?o.forEach(function(n){n.name===autoFillInfo.field&&(w=!1)}):(h=h.toLowerCase(),h.match(/^component/i)?g.components[h.substring(9)]=null:g[h]=null,ot++),autoFillInfo.changed=!1);ot&&!w&&ht&&(e._canceled&&(e._canceled=!1),nw({config:e,dataView:r,data:g}));w&&tn(r,s,e,v)}it&&(i._refocusTimeout=setTimeout(i._refocus,0,{fieldName:it}))},_refocus:function(n){if(n)eu().closest("[data-field]").length||bi(n);else{var t=i._refocusTimeout;t&&(clearTimeout(t),i._refocusTimeout=null)}},evaluate:function(t){var i=t.dataView,u=t.row,f=t.scope,s=t.fields,r=t.container,h,c=[],o=[],l=[],a,v,y,it;if($(i._expressions).each(function(){var e=this,w=e.Scope,k,b,d,nt="",tt,p;e.Type===1&&(w===5&&(!f||f.readOnly)?(k=i.findField(e.Target),k&&(b=!!i._evaluateJavaScriptExpressions([e],u,!1),d=k._inputReadOnly!==b,k._inputReadOnlyChanged=d,k._inputReadOnly=b,d&&s&&s.indexOf(k)===-1&&s.push(k))):(w===3||w===2||w===7)&&r&&(!f||f.visibility)?(b=!!i._evaluateJavaScriptExpressions([e],u,!1),d=e._visChanged!==b,e._visChanged=b,d&&(v||(y=g(r),n.stub("put",y),v=!0),t.visibilityChanged=!0,w===3?nt="f:":w===2?(nt="c:",h=!0):w===7&&(nt="v:"),tt=r.find('[data-visibility="'+nt+e.Target+'"]').css("display",b?"":"none"),b?$(tt).each(function(){var n=$(this).data("node");n&&c.push(n)}):w===3&&(p=i.findField(e.Target),p&&u[p.Index]!=null&&p.is("clear-on-hide")?(o.push({name:p.Name}),p.Index!==p.AliasIndex&&o.push({name:i._allFields[p.AliasIndex].Name})):p._dataViewId&&(a=!0,ae(p._dataViewId))))):w===1&&(!f||f.readOnly)&&l.push(e))}),l.length&&r&&ih(i,u,r,l),!t.ignoreFormButtons&&(i.isDynamicAction("Custom")||i.isDynamicAction("Form"))&&r.find("[data-action]").each(function(){var t=$(this),r=t.attr("data-action"),n;i.isDynamicAction(r)&&(n=i.findAction(r),n&&(i._clonedRow=u,t.toggleClass("app-disabled",!i._isActionAvailable(n)),i._clonedRow=null))}),h&&i._isWizard&&ve("status"),c.length&&(gc({controls:$(c)}),a=!0),h&&vf(),!t.ignoreDynamicButtons&&i.isDynamicAction("Form")){var p=r.closest(".ui-page").find(".app-bar-buttons"),nt,e,w=[],k=[],rt=[],d=[];p.length&&p.first().find(".ui-btn").each(function(){var n=$(this).attr("data-action-path");n!=="more"&&w.push(n)});i._clonedRow=u;i.extension().context(d);$(d).each(function(){var n=this;n.uiScope==="Form"&&k.push(n.path);n.icon&&rt.push(n.icon)});w.length?w.sort().join()!==k.sort().join()&&(nt=!0,e=!tt(i).isModal):(n._toolbarButtons.each(function(){var t=this,n;if(t.style.display!=="none"&&(it=!0,n=$(t).data("action-path"),n&&k.indexOf(n)===-1))return e=!0,!1}),it||(e=!0));(nt||e)&&n.refreshAppButtons(d,{buttonBars:p,layout:r,toolbar:e,dataView:i});i._clonedRow=null}o.length&&wi({dataView:i,values:o});t.visibilityChanged&&t.resize?(clearTimeout(b._visibilityChangeTimeout),b._visibilityChangeTimeout=setTimeout(function(){pu()},10)):a&&uu();v&&n.stub("trim",y)},valid:function(n){if(arguments.length)this._valid=n!==!1;else return this._valid!==!1},cancel:function(n){return i._canceled=n===!1,eft(),i._canceled=!1,i.valid()},triggerSetValue:function(n,t,i){this.valid(!0);typeof t=="string"&&(t=t.trim());var r=$.Event("setvalue.input.app",{inputValue:t,inputOriginalValue:i,inputElement:n[0],inputValid:!0,inputError:null});return n.trigger(r),r.inputElement=null,this.valid(r.inputValid),r},drawing:function(n,t){if(arguments.length===1)return n.data("redraw")!==!1;t?n.removeData("redraw"):n.data("redraw",!1)},addCount:function(n,t){var i="";return n!=null&&(i='<span class="app-muted">'+(n>999?String.format("{0:N0}",n):n)+"<\/span>",t&&$(i).appendTo(t)),i},editor:function(t){function v(u){var f=u.rules.dataView(),c=f.survey(),s=f.data(),e=u.type;n.pageInfo(f)._canceled=!0;e==="submit"&&(yo(!1),o("ui.transitions.style","none"));tr(function(){e==="submit"&&(wi({dataView:r,values:{name:l,value:s.Field}}),yo(!0));h||bi({field:i});u.type==="submit"?t.submit&&t.submit(u):t.cancel&&t.cancel(u)})}var r=t.dataView,l=t.fieldName,i,a,u,e,s,c;typeof r=="string"?r=k(r):r||(r=n.pageInfo().dataView);i=r.findField(l);e=i.ItemsStyle;u={name:"Field",required:!i.AllowNulls,columns:i.Columns,rows:i.Row,options:{}};t=u.options;e&&(s=[],c=i.is("lookup-distinct"),$(i.DynamicItems||i.Items).each(function(){var n=this,t={value:n[0],text:n[1]};c&&(t.count=n[2]);s.push(t)}),u.items={style:e,list:s},t.lookup={distinct:c});a=r.row();u.value=a[i.Index];f.survey({text:i.HeaderText,parent:r._id,controller:r._id+"-editor",context:{},questions:[u],layout:'<div data-layout="form" data-layout-size="tn"><div data-container="row"><span data-control="field" data-field="Field" data-size="fit"><\/span><\/div><\/div>',options:{modal:{fitContent:!0,always:!0},materialIcon:"edit",discardChangesPrompt:!1,contentStub:!1},submitText:"OK",submit:v,cancel:v})},blurDataView:function(){},canFocus:function(){return!gu()&&(!di()||l().prevAll(".app-kiosk").length)},beforeFocus:function(n){var i=dt(),t;at&&(t=at.data(),t.message!=null&&n.is(".app-field-"+t.fieldName)||at.removeData().hide());i._inlineEditor||(l().find('.app-focus[data-input="dataview"]').removeClass("app-focus"),ht.detach(!0))},visible:function(n){var t=!0;return l('[data-layout][data-state="write"]').find('[data-field="'+n.Name+'"][data-control="field"]').closest("[data-visibility]").each(function(){if($(this).css("display")==="none")return t=!1}),t},keyboard:function(n){var r=ai(),f=r-(i._created||0),t=r-(i._removed||0),u=350;if(n==="detect")f<1e3?i._vkbd=!0:t<1e3&&(i._vkbd=!1);else{if(n==="virtual")return!!i._vkbd;h&&t<u&&i._vkbd?setTimeout(n,u-t):(i._vkbd=!1,setTimeout(n,0))}},focus:function(t){var s,f;if(!et){t||(t={});f=t.field;f&&(t.fieldName=typeof f=="string"?f:f.Name);var u=$(t.container||l('[data-layout][data-state="write"]')),e=t.lastFocused,h=u.closest(".ui-page"),c=h.data("last-focused-field"),r=e&&c?c:t.fieldName||u.find('[data-focus="true"]').data("field"),a=r?'[data-field="'+r+'"]':"",y=u.find("[data-control]"+a+':not([data-input="none"])'),o=t.message,v=t.scrollIntoView;if(t.lastFocused&&t.container&&h.removeData("last-focused-field"),e&&e!=="auto"&&!r)return;y.each(function(){var f=$(this),d=f.offset(),p=i.methods[f.data("input")],h,c=f.closest('[data-container="tab"]'),w=f.closest('[data-container="wizard"]'),nt=f.data("input")==="dataview",ut=f.data("node"),ft=ut&&ut.ready,ot=c.length&&!c.is(".app-tab-active"),l,tt,b,y,st,ct,it,lt,rt;if((nt&&(!f.is(".app-focus")||gu()||e)||p&&p.focus||!ft&&r)&&(a||!c.length||c.is(".app-tab-active"))&&(!w.length||ve("visible",{step:w,container:u}))){if(nt&&(i.blur(),!i.valid()))return;if(w.length&&ve("show",{step:w,container:u}),ot){et=!0;c.closest('[data-container="tabset"]').first().find(".app-tabs").first().find(".ui-btn").filter(function(){return $(this).text()===c.attr("data-tab-text")}).trigger("vclick");et=!1;bi(t);return}if((ft||!ot)&&f.closest('[data-container="collapsible"].app-container-collapsed').find('[data-container="toggle"]').trigger("vclick"),ke(u).hide(),nt)l=g(),!l.is(eu())&&i.canFocus()&&(i.blur(),ir(l)),dv(l).removeClass("app-focus"),r&&(f.addClass("app-focus"),tt=ni(f).removeData("skip-item-focus"),b=tt.attr("data-for"),ht._dataViewId!==b&&(ht.detach(!0),ht._dataViewId=k(b).inlineEditing()?b:null),e||(cf(r,rh(l)),y=tt.find(".dv-item .app-selected"),v!==!1&&ev(y.length?y:f,l,null,null,.25),y.length&&y.closest(".app-listview-inlineediting").length&&ht.sync({elem:y,scrollIntoView:v})));else if(n.lastTouch(!1),st=$.Event("datainputmove.app",{direction:f}),$(document).trigger(st),n.lastTouch(!0),i.canFocus())if(p)p.focus(f);else return;return s=!0,o&&(i.popup("hide"),ct=i.elementToField(f),ct.ItemsStyle==="Lookup"&&(it=i.elementToButton(f),it.addClass("app-caret-r"),it.removeClass("app-caret-u app-caret-d")),h=f.find(".app-data-input,.app-data-list,.app-drop-box"),h.is(".app-drop-box")&&(h=h.prev()),h.length&&(d=h.offset(),setTimeout(function(){dl(d.left+1,d.top+f.outerHeight(),o,null,!0);at.data({fieldName:r,message:o})},32))),lt=i._buffer,i._buffer=null,lt==="Backspace"&&(rt=dt(),rt&&rt._inlineEditor?setTimeout(function(){i.clearValue(f.attr("data-field"))}):i.clearValue(f.attr("data-field"))),!1}})}return s},focusCopyMaster:function(n){var t,i=new RegExp("\\b"+n.Name+"\\s*=\\s*.+\\b");$(n._dataView._fields).each(function(){var n=this,r=n.Copy;if(r&&i.exec(r))return t=n.Name,!1});t&&bi({fieldName:t})},canCreateItems:function(n,t){t||(t=n._dataView.editRow());var i=!!n.ItemsNewDataView,u=n.ContextFields,r,e;if(i&&u)while(e=f._fieldMapRegex.exec(u))r=n._dataView.findField(e[2]),r&&t[r.Index]==null&&(i=!1);return i},barcode:function(n){var t=arguments,r=nt.queue,i;if(t.length)if(n=t[0],typeof n=="boolean")nt.ready=n;else{if(n===":input")return nt.input;if(n===":always")if(t.length===2)nt.always=!!t[1];else return nt.always;else{if(n===":peek")return r.length?r[0]:null;for(i=0;i<t.length;i++)nt.queue.push(t[i]);nt.active||up()}}return r}};wi=i.execute;bi=i.focus;hr.on("keydown",plt).on("keyup",ylt).on("getvalue.input.app",function(n){var t=i.eventToField(n),e=i.eventToMethod(n),u,f,o,r,s;t&&(f=t._dataView,u=f._allFields[t.AliasIndex],t.Index===u.AliasIndex||t.ItemsStyle||(u=t),s=f.editRow(),r=s[t.Index],t.ItemsTargetController?r=null:t.ItemsStyle&&t.ItemsStyle!=="Lookup"&&t.ItemsStyle!=="AutoComplete"&&(o=f._findItemByValue(t,r),o&&(r!=null||!t.tagged("lookup-null-value-none")&&t.AllowNulls)&&(r=o[1])),n.inputValue=r!=null?t.format(r):"",n.inputValueRaw=r,n.inputDataType=t.Type,n.inputFormat=t.DataFormatString,u.Len&&(n.inputMaxLength=u.Len),t.Index!==u.Index&&(r=s[u.Index],n.inputAltValue=r!=null?u.format(r):""),t.ItemsStyle||(n.inputRows=t.Rows,t.TextMode===2&&(n.rtf=!0)),n.inputIsPassword=t.TextMode===1,n.placeholder=i.fieldToPlaceholder(t),e&&e.setup&&e.setup(n),t.is("spell-check-none")&&(n.spellCheck=!1),t.is("select-on-focus-none")&&(n.selectOnFocus=!1))}).on("setvalue.input.app",function(n){var t=i.eventToField(n),u,r=n.inputValue,e,o,s,f;!t||(t.isReadOnly()||t.ItemsStyle||t.OnDemand)&&(!t.is("lookup-accept-any-value")||t.ItemsTargetController)||(u=t._dataView,s=u.editRow(),s&&(String.isBlank(r)?r=null:(o={NewValue:r},f=u._validateFieldValueFormat(t,o,!0),f||(r=o.NewValue,e=t.DataFormatString,e&&e.match(/:p/)&&(r=r/100))),f?(n.inputError=f,n.inputValid=!1):(t.Index!==t.AliasIndex&&(t.AliasIndex=t.Index),wi({dataView:u,values:{field:t,value:r}}))))}).on("vclick",'[data-control="action"]',function(n){var r=$(n.target),u=r.closest("[data-control]"),f=u.closest("[data-input-container]"),i=k(f.attr("data-input-container")),t;if(i)return vi(),t=i.findAction(u.attr("data-action")),t&&i._isActionAvailable(t)&&kt(r.closest(".app-action-column-button"),function(){var n=i.extension();n.command(n.commandRow(),t.CommandName,t.CommandArgument,t.CausesValidation,t.Path)}),!1}).on("vclick",'[data-control="label"]',function(){var t=$(this),e=t.closest("[data-input-container]"),o=k(e.attr("data-input-container")),s=t.attr("data-field"),c,n,l,a,r,u,f;return o&&(h||!ait())&&(u=o.findField(s),u&&(t.data("active",!0),e.find("[data-control]").each(function(){var t=$(this),i=t.attr("data-control"),r=t.attr("data-field");if(i==="label")t.data("active")&&(l=!0);else if(r===s)if(l){if(n)return!1;n=t}else c=t}),t.removeData("active"),n||(n=c),n.filter(lr).length||(f=n.nextAll("[data-input]").filter(lr).first(),n=f.length?f:n.prevAll("[data-input]").filter(lr).first()),n&&n.length&&(a=n.attr("data-input"),r=i.methods[a],r&&(r.focus?r.focus(n,t):i.focusCopyMaster(u))))),!1}).on("vclick mousedown touchend","[data-input]",function(n){var f=$(n.target),r=n.type,t,u;if(!f.closest(".app-data-input-button").length){if(r==="mousedown"&&n.which!==3)return;if(ft(this).length&&!f.closest(".app-control-helper").length)return}if(!vu&&(t=i.eventToMethod(n),t)){if(t.click&&t.click(n),n.isDefaultPrevented())return!1;if(t.focus&&r!=="touchend")t.focus(f)&&(n.cancelable&&n.preventDefault(),r==="mousedown"&&$(this).find(".app-data-input-placeholder").css("display","none"));else if(r==="vclick"&&(h||!ait())&&(u=i.eventToField(n),u&&!bi({fieldName:u.Name})))return i.focusCopyMaster(u),!1}}).on("blur forceblur.app",".app-data-input",function(n){function a(n,i){clearTimeout(b._focusTextInputTimeout);clearTimeout(b._focusTooltipTimeout);b._focusTextInputTimeout=setTimeout(function(){t.focus();n&&(t.attr("title",n),b._focusTooltipTimeout=setTimeout(function(){dl(t.offset().left+1,t.offset().top+t.outerHeight()+1,n,null,!0)},120));i&&i(u)},10)}function e(n){var o,f,e;i.valid(!0);o=$.Event("remove.input.app",{input:t});s.is(".app-has-rtf")&&y.handlers(t,!1);t.trigger(o);t.attr("title")&&vi();u.find(".app-data-input-focus").remove();u.find(".app-control-helper .app-focus").length||ar(u,!1);v.contents().css("visibility","");f=u.find(".app-control-inner").removeClass("app-control-inner-trailer");e=f.data("last-smart-text");e&&(u.is(".app-null")||f.text(e),f.removeData("last-smart-text"));i._lastScreenHeight=r.height;s.remove().empty();i._lastInputBeforeScroll=null;i._removed=ai();i._created=0;n&&n(u)}function h(n){var i;return n=n.split(/,/),n.length===1?i=p.closest(n[0]).is(t.closest(n[0])):$(n).each(function(){return i=h(this),i?!1:void 0}),i}var t=$(n.target),o=i.eventToMethod(n),u=st(t),c=t.data("original"),l=sv(t),s=t.parent(),v=s.parent(),p=$(n.relatedTarget),f;if(i._canceled){clearTimeout(b._focusTextInputTimeout);e();return}if(h(".app-data-input-popup,.app-data-input-helper,.app-data-input-button"))return!1;if(t.data("keepFocus"))return t.removeData("keepFocus"),!1;(o&&o.blur&&o.blur(n),n.isDefaultPrevented())||(h(".app-data-input-container,.app-data-input-placeholder")?(n.preventDefault(),a()):l===c?e():(f=i.triggerSetValue(t,l,c),i._refocus(!1),f.inputValid?e(f.inputValidCallback):i.ignoreErrors?e():(n.preventDefault(),a(f.inputError,f.inputErrorCallback))))}).on("keydown",".app-data-input,.app-drop-box",function(t){var ni,ct,bt,lt,d,a,at,ft,vt,p,w,ei,kt,oi,yt;sh();var s=this,l=s.value,g,b=t.ctrlKey||t.metaKey,nt=t.altKey,et=t.shiftKey,r=t.keyCode||t.which,v,pt,f=$(s),c=st(f),ot,si=f.closest('[data-layout="form"]').length>0,ht,e,rt,dt=vn(s),o,u,tt,h;if(!gl()){if(ks(t,!1,!1))return!1;if(l==null&&(l=""),g=!l.length,!b&&(r===38||r===8||r===37)){var ut=st(s,".app-control-before"),wt=ut.find("li"),it=ut.find(".app-focus"),gt;if(wt.length&&!it.length&&g&&!i.popup(":visible"))return it=wt.last(),(r===38||r===37)&&(gt=it.offset(),$(s).offset().top>ut.offset().top+ut.outerHeight()&&wt.each(function(){var n=$(this),t=n.offset();if(t.top===gt.top)return it=n,!1})),it.addClass("app-focus"),setTimeout(function(){ar(ut).focus();sn(it)}),!1}if(r===27)return i.popup(":visible")?(kw(),!1):f.is(".app-data-input")?(rt=f.data("change"),v=f.data("original"),pt=sv(f)!==v,!pt&&(ni=c.closest(".app-page-modal"),ni.length&&!i.popup(":visible")))?void 0:(t.stopPropagation(),t.preventDefault(),v!=null&&c.find(".app-data-input-placeholder").hide(),rt?(f.val(v),i.fitContainer(c),setTimeout(function(){i.move(c,i.popup(":visible")?c.data("autoComplete",!1):null);bi({fieldName:c.data("field")});v&&v.length&&$(".app-data-input").select().trigger($.Event("keydown",{which:40,altKey:!0}))})):(ct=$.Event("cancel.input.app",{inputElement:f}),c.trigger(ct),ct.inputElement=null,ct.isDefaultPrevented()||(f.is("iframe")?y.document("blur"):pt?(vi(),f.val(v).select(),i.triggerSetValue(f,v,v)):(i.blur(c),ir()))),!1):(f.blur(),ir(),!1);if((r===13&&!nt||r===9)&&i.popup(":visible"))if(u=i.popup().find(".app-selected"),o=i.elementToField(f),u.length){if(r===9&&o.ItemsTargetController&&(r=13),(!u.is("[data-command]")||r===13)&&(u.trigger("vclick",{feedback:!1}),r===13))return!1}else if(bt=f.val(),r===13&&o.AllowAutoComplete!==!1&&wn(o)&&bt.length)return i.methods.lookup._createItemFromText(o,st(f),bt),!1;if((r===13&&nt||r===39&&s.selectionStart===s.selectionEnd&&(g||l.length===s.selectionEnd))&&(lt=i.eventToButton(t),lt.length&&i.elementToField(lt).ItemsStyle==="Lookup"&&lt.is(":visible")&&(ot=i.eventToMethod(t),ot&&ot.clickButton)))return i.popup(":visible")?i.popup().find('[data-command="SeeAll"].app-selected').trigger("vclick"):(t.stopPropagation(),t.preventDefault(),ot.clickButton(t)),!1;if(b&&r===13)return setTimeout(gg),!1;if((b&&!et&&r>=37&&r<=40||r===32)&&(o=i.eventToField(t),o.Type.match(/^Date/))){var ti,k,ii={NewValue:l},ri=r<37,ui=n.calendar(":visible")?7:1,hi=r===38?-ui:r===40?ui:r===37?-1:1,fi=!s.selectionStart&&s.selectionEnd===l.length;if(!ri||g||fi)return g?k=new Date:fi?ri?k="":(ti=o._dataView._validateFieldValueFormat(o,ii,!0),ti||(k=ii.NewValue,k.setDate(k.getDate()+hi))):eu().select(),k!==null&&setTimeout(function(){n.calendar("keepOpen");wi({field:o,value:k})}),!1}if(!nt&&(r===38||r===40))if(o=i.eventToField(t),d=o.DynamicItems||o.Items,a=-1,o.ItemsStyle!=="DropDownList"||i.popup(":visible")||o.ItemsTargetController){if(c.data("notify")&&(ft=c.closest("[data-container]").next("[data-container]").find("li[data-text]"),u=ft.filter(function(){return $(this).is(".app-selected")}).removeClass("app-selected"),ft.length))return u=u.length?r===40?u.next("[data-text]"):u.prev("[data-text]"):$(ft[r===40?0:ft.length-1]),u.addClass("app-selected"),!1}else return o.is("lookup-auto-advance")||o.is("lookup-open-on-tap")?i.eventToMethod(t).clickButton(t):($(d).each(function(n){if(this[1]===l)return a=n,!1}),a!==-1?(r===38&&a>(!o.AllowNulls&&d[0][0]==null?1:0)&&a--,r===40&&a<d.length-1&&a++):(a=0,!g&&r===40&&d.length&&d[0][0]==null&&a++),at=d[a],at&&($(s).data("last",at[1]),setTimeout(function(){i.methods.lookup._useItemValue(o,at,!0)}))),!1;if(ht=i.eventToDirection(t),r===32&&!(b||et||nt)&&!dt&&!l.trim().length)return!1;if(r===40&&nt||r===32&&b){if(rt=f.data("change"),rt)return i.popup(":visible")||(t.stopPropagation(),t.preventDefault(),setTimeout(rt,0,{input:f,value:f.val(),lastValue:f.data("last"),force:!0})),!1;if(vt=$.Event("help.input.app",{inputElement:f}),c.trigger(vt),vt.inputElement=null,vt.isDefaultPrevented()||r===32)return!1}if(f.data("autoComplete",!((r===8||r===46)&&s.selectionStart>0&&s.selectionStart<s.selectionEnd&&i.popup(":visible"))),f.data("keyCode",r),(r===33||r===34)&&i.popup(":visible")){if(e=i.popup(),u=e.find(".app-selected"),u.length){for(h=u.removeClass("app-selected"),e.scrollTop(e.scrollTop()+(r===33?-1:1)*e.height());h.length;){if(r===33){if(h.offset().top<e.offset().top)break}else if(h.offset().top+h.outerHeight()-1>e.offset().top+e.height())break;h.is(".app-instruction")||(u=h);h=r===33?h.prev():h.next()}u.addClass("app-selected")}else u=e.find("li:not(.app-instruction)").first().addClass("app-selected");return!1}if((r===38||r===40)&&!(b||et||nt)&&i.popup(":visible")){if(t.preventDefault,t.stopPropagation(),e=i.popup(),u=e.find(".app-selected").removeClass("app-selected"),tt=e.find("li:not(.app-instruction)"),u.length)for(h=u;h.length;){if(h=r===38?h.prev():h.next(),h.length&&!h.is(".app-instruction")){u=h;break}h.length||tt.filter(":not([data-command])").length||(u=[])}else u=r===38?tt.last():tt.first();if(u.length)return u.addClass("app-selected"),r===38&&u.prev().is(".app-instruction")&&(u=u.prev()),r===40&&u.next().is(".app-instruction")&&(u=u.next()),p=u.offset(),w=e.offset(),r===38?p.top<w.top?e.scrollTop(p.top-w.top+e.scrollTop()-1):p.top>=w.top+e.height()&&e.scrollTop(p.top-w.top+e.scrollTop()-(e.height()-u.outerHeight())-1):r===40&&(p.top+u.outerHeight()>=w.top+e.height()?e.scrollTop(p.top-w.top+e.scrollTop()-(e.height()-u.outerHeight())-1):p.top<w.top&&e.scrollTop(p.top-w.top+e.scrollTop()-1)),!1;if(c.closest(".app-page-inlineeditor").length)return u=r===38?tt.first():tt.last(),u.addClass("app-selected"),!1}if(ht&&c.is('[data-input-tab-stop="false"]'))return(r===13||r===9)&&(i.blur(c),t.stopPropagation()),!1;if(ht){if(si&&r===13){if(!i.popup(":visible")&&(o=i.elementToField(f),wn(o)&&l!==f.data("original")))return i.methods.lookup._createItemFromText(o,st(f),l),!1;t.stopPropagation()}return setTimeout(function(){i.move(c,ht,r)}),!1}return r===113?(selectionStart=s.selectionStart,selectionEnd=s.selectionEnd,selectionStart||selectionEnd!==l.length?(s.selectionStart=0,s.selectionEnd=s.value.length):s.selectionStart=selectionEnd,!1):r===90&&b&&!dt?(ei=f.val(),kt=c.data("redo"),clearTimeout(i._undoTimeout),i._undoTimeout=setTimeout(function(){yt=f.val();ei===yt&&(et?kt!=null&&f.val(kt).trigger("input"):(oi=c.data("original"),f.val(oi),c.data("redo",yt),gf(yt)&&gg()),f.trigger("input"))},100),!1):void 0}}).on("vclick contextmenu taphold",".app-map-placeholder",function(n){var t=$(this),i=t.attr("title")||t.data("title"),r=t.data("r"),u;return i&&r&&(u={address:i,zoom:r.zoom},n.type==="vclick"?$(".ui-popup-active").length||fv(u):yr({anchor:$(this),x:su(),y:th()+16,items:[{text:e.Map,icon:"material-icon-location-on",context:u,callback:fv},{text:e.Directions,icon:"material-icon-directions",context:{address:i,zoom:r.zoom,api:"dir"},callback:fv}]})),!1}).on("input",".app-data-input",function(n){var a=this,v=n.keyCode||n.which,t=$(a),u=t.data("placeholder"),e,h=t.data("change"),o,r=sv(t),f,s,c,l=r.trim();if(gl())return!1;String.isBlank(r)&&t.val("");l.length||(r=l);u&&(e=r?"none":"",u=u[0],u.style.display!==e&&(u.style.display=e));o=t.data("last");f=r!==o;f&&i.fitContainer(st(t),t);h?f&&(t.data("last",r),h({input:t,value:r,lastValue:o,keyCode:v,keyboard:!0})):f&&!r.length&&(s=t.data("original"),s.length&&(c=i.triggerSetValue(t,r,s),c.inputValid&&t.data("original","")))}).on("cut paste",".app-data-input",function(){var n=$(this);setTimeout(function(){n.trigger("keyup")})}).on("contextmenu",".app-data-input",function(){$(this).data("keepFocus",!0).focus()}).on("mousedown context.menu",".app-data-input-placeholder",function(n){if(ft().data("keepFocus",!0),n.which===3||n.type==="contextmenu")$(this).css("display","none");else if(n.which===1)return!1}).on("vclick mousedown",".app-data-input-popup",function(t){function l(){if(e)if(s=i.elementToMethod(r),e==="SeeAll")t.target=r,setTimeout(function(){i.popup("hide");s&&s.clickButton&&s.clickButton(t,!1)},er);else if(e==="Clear")setTimeout(function(){r.blur();i.clearValue(u);i.fitContainer(o,null,i.fieldToPlaceholder(u));setTimeout(function(){i.methods.lookup.focus(o)},100)},er);else if(e==="New"){var l=r.val();r.blur();i.keyboard(function(){n.lookup({field:u,create:!0,dataInput:o,value:l})})}else e==="ShowOptions"?setTimeout(function(){u._doSearch=!0;i.methods.lookup._showList({field:u,value:null,input:r})},er):e==="SelectAll"?(i.popup("hide"),c=i.popup().find("li[data-index]"),c.each(function(n){i.methods.lookup._useItemValue(u,h[parseInt($(this).attr("data-index"))],null,n===c.length-1)})):e==="None"&&i.popup("hide");else i.popup("hide"),h&&u&&(r.removeData("restoreText"),i.methods.lookup._buttonUp(r),o.find(".app-control-helper").data("focus",!1),i.methods.lookup._useItemValue(u,h[parseInt(f.attr("data-index"))]))}var f=$(t.target).closest("li"),e=f.attr("data-command"),h=i.popup().data("list"),r=ft(),o=st(r),u=i.elementToField(r),c,s;return!f.length||f.is(".app-instruction")||f.data("selected")||(f.parent().find(".app-selected").removeClass("app-selected"),f.addClass("app-selected").attr("data-selected","true"),r.focus(),arguments.length!==2||arguments[1].feedback?setTimeout(l,er):l()),!1}).on("keydown",".app-checkbox-container",function(n){if(!gl()&&!ks(n)){var r=n.keyCode||n.which,t=$(this),u;return u=r===32||r===39&&!t.is(".app-checkbox-on")||r===37&&t.is(".app-checkbox-on")?"toggle":i.eventToDirection(n),u?(u==="toggle"?i.elementToMethod(t)._toggleState(t):i.move(t,u,r),!1):void 0}}).on("keydown",".app-data-list",function(n){if(!gl()&&!ks(n)){var f=n.keyCode||n.which,e=$(this),r,u,t,o;if(f===32)r="vclick";else if(f===8||f===46)r="clear";else if(n.ctrlKey){if(n.key==="a")return!1}else f===38?r="up":f===40?r="down":f===37?r="left":f===39?r="right":f===36?r="home":f===35&&(r="end");return r?(u=e.find(".app-focus"),o=u.index(),u.length?(e.find(".app-focus").removeClass("app-focus"),r==="up"?(t=u.prev(),t.length||(t=u.parent().prev().find("li").last(),t.length||(t=u))):r==="down"?(t=u.next(),t.length||(t=u.parent().next().find("li").first(),t.length||(t=u))):r==="right"?(t=u.parent().next().find("li").eq(o),t.length||(t=e.find("ul").first().find("li").eq(o+1),t.length||(t=u))):r==="left"?(t=u.parent().prev().find("li").eq(o),t.length||(t=o?e.find("ul").last().find("li").eq(o-1):u)):r==="home"?t=e.find("ul").first().find("li").first():r==="end"?t=e.find("ul").last().find("li").last():r==="vclick"?(t=null,u.addClass("app-focus").trigger("vclick")):r!=="clear"||e.closest("[data-control]").is('[data-input="checkboxlist"]')||(t=null,e.find("ul").first().find("li").first().trigger("vclick"))):i.methods.listbox._scrollItemIntoView(e.find(".app-selected").first().addClass("app-focus")),t&&t.length&&(i.methods.listbox._focusItem(t),i.methods.listbox._scrollItemIntoView(t)),!1):(r=i.eventToDirection(n),r)?(i.move(e,r,f),!1):void 0}}).on("keydown",".app-control-helper",function(n){function l(){setTimeout(function(){c.data("focus",!1);i.methods.lookup.focus(st(t))})}var c=$(this),r=n.keyCode||n.which,s=c.find("li"),t=c.find(".app-focus"),a=t,o;if(s.length&&t.length){if(o=t.offset(),r===32||r===40&&(n.altKey||n.metaKey))return t.trigger("vclick"),!1;if(r===46||r===8)return i.methods.lookup._removeBasketItem(t,r!==8),!1;if(r===9||r===13||r===27)return setTimeout(function(){var u=st(t);n.shiftKey&&r!==27?i.move(u,"up",r):(c.data("focus",!1),i.methods.lookup.focus(u))}),!1;if(r===36)t=s.first();else if(r===35)t=s.last();else if(r===38){var f=o.left,u=f+t.outerWidth()-1,e=0,h=o.top-1;$(s.get().reverse()).each(function(){var o=$(this),r=o.offset(),n=r.left,i=n+o.outerWidth()-1,s;if(!e&&r.top<h||e>0&&r.top===h)i<f||n>u||(s=n>=f&&i<=u?i-n+1:n<f&&i<=u?i-f+1:n<u&&i>=u?u-n+1:u-f+1,s>e&&(t=o,e=s,h=r.top));else if(e)return!1})}else if(r===40){var f=o.left,u=f+t.outerWidth()-1,e=0,h=o.top+1;s.each(function(){var o=$(this),r=o.offset(),n=r.left,i=n+o.outerWidth()-1,s;if(e==0&&r.top>h||e>0&&r.top==h)i<f||n>u||(s=n>=f&&i<=u?i-n+1:n<f&&i<=u?i-f+1:n<u&&i>=u?u-n+1:u-f+1,s>e&&(t=o,e=s,h=r.top));else if(e)return!1})}else if(r===39||r===37)s.each(function(){var i=$(this),n=i.offset();if(r===39&&n.top===o.top&&n.left>o.left)return t=i,!1;r===37&&n.top===o.top&&n.left<o.left&&(t=i)});else return;if(t===a){if(r===39&&(t.next().length?t=t.next():l()),r===37&&t.prev().length&&(t=t.prev()),r===38)return setTimeout(function(){i.move(st(t),"up",9)}),!1;if(r===40)return l(),!1}return s.removeClass("app-focus"),t.addClass("app-focus"),sn(t),!1}}).on("blur",".app-data-list,.app-control-helper,.app-checkbox-container,.app-drop-box",function(){var n=$(this),t=n.find(".app-focus");t.is("li")||t.removeClass("app-focus");ar(n.parent(),!1)}).on("keydown",".ui-panel-inner",function(n){var r=n.keyCode||n.which,e=$(this),f,c=e.offset(),i,t,u,o,s,h;if(r===37?i="left":r===39?i="right":r!==40&&(r!==9||n.shiftKey)?r===38||r===9&&n.shiftKey?i="up":r===36?i="home":r===35?i="end":(r===13||r===32)&&(i="select"):i="down",r===9&&e.closest(".app-sidebar").length)return ir(),g().find(".app-selected").addClass("ui-btn-active"),!1;if(i){if(e.find("ul").each(function(){var n=$(this),t=n.offset();if(t.left>=c.left&&t.left<c.left+10)return f=n,!1}),!f)return!1;if(u=f.find(".ui-btn").filter(function(){return!$(this).parent().is(".ui-disabled")}),t=f.find(".app-focus"),t.length&&(i==="right"&&(i=t.find(".material-icon-chevron-right").length?"select":"down"),i==="left"&&(i=t.find(".material-icon-chevron-left").length?"select":"up"),i==="select")){if(t.length)return(o=t.data("data-context")||t.data("context-action"),r===32&&(!o||!o.keepOpen))?!1:(vr(),t.trigger("vclick"),!1);i="down"}t.length?i==="down"?$(u).each(function(n){if(t.is(this))return t=$(u.get(n<u.length-1?n+1:0)),!1}):i==="up"?$(u).each(function(n){if(t.is(this))return t=$(u.get(n>0?n-1:u.length-1)),!1}):i==="home"?t=u.first():i==="end"&&(t=u.last()):(t=u.first(),(i==="up"||i==="end")&&(t=u.last()),t.addClass("app-focus"));f.find(".ui-btn-active, .app-focus").removeClass("ui-btn-active app-focus");t.addClass("app-focus ui-btn-active");nrt(t,e);vi();s=t.attr("title");s&&(h=gt(t),dl(h.left,h.top,s,t));event.preventDefault()}}).on("keydown",".app-drop-box",function(n){var i=n.keyCode||n.which,r=$(this),t;return i===32?t="vclick":(i===8||i===46)&&(t="clear"),t?(t==="vclick"?r.trigger(t):t==="clear"&&r.parent().find(".app-clear").trigger("vclick"),!1):void 0}).on("keydown",".app-wrapper",function(t){var g,it;if(!nt.input&&!di()){if(et||yt())return!1;var k=this,rt=t.keyCode||t.which,d,c=t.ctrlKey,y,e,o,a,s,ut,r;switch(rt){case 35:r="end";break;case 36:r="home";break;case 39:r="right";break;case 40:r="down";c&&(setTimeout(tut,0,k,r),r=null);break;case 37:r="left";break;case 38:r="up";c&&(setTimeout(tut,0,k,r),r=null);break;case 13:if($(t.target).is("textarea"))return;r="enter";break;case 113:r="edit";break;case 9:r="tab";break;case 32:r="space";break;case 33:r="pageup";break;case 34:r="pagedown"}if(r&&$(".ui-panel-dismiss,.app-popup").filter(lr).length)return t.preventDefault(),!1;if(r&&(g=$.Event("keyboardnavigation.app",{originalEvent:t,direction:r}),$(document).trigger(g),g.isDefaultPrevented()))return!1;if(r&&(d=$(t.target),r&&!c&&!d.is(":input")&&d.closest(".ui-page-active").length&&!r.match(/pageup|pagedown/))){if(y=$(k),r.match(/left|right/)&&y.find('[data-layout="form"][data-state="read"]').length&&wet(r))return!1;if(e=y.children(".app-listview"),r==="tab")if(ht.frame(":visible"))r=t.shiftKey?"up":"down";else if(n._menuButton.is(".ui-icon-bars")&&!l().is(".app-page-modal")&&w.left.visible)return fi(!0),fi(!1,0),e.find(".ui-btn-active").removeClass("ui-btn-active"),w.left.inner.focus().find(".ui-btn").first().addClass("app-focus ui-btn-active"),!1;if(e.length&&e.is(":visible")){if(r.match(/left|right|home|end/)&&e.is(".app-grid")){s=dt();var tt=s.session("grid-avail-width"),ft=e.find(".dv-item").first(),p=ft.length&&Math.ceil(tt-tt*(ft.width()/tt)),u=s.session("scroll-left")||0,v;p&&(r==="right"&&u<p?(u=Math.min(u+32,p),v=!0):r==="left"&&u>0?(u=Math.max(u-32,0),v=!0):r==="home"?(u=0,v=!0):r==="end"&&(u=p,v=!0));v&&(s.session("scroll-left",u),ph(s,-u));t.preventDefault();return}if(o=e.find(".dv-item .app-selected"),o.length||(o=e.find(".dv-item").first().find("a"),r="none"),o.length){var h=o.parent(),f=h,b=o;if(s=dt(),ut=s.extension(),r==="enter"&&ht.frame(":active")&&!c&&(t.shiftKey?r="up":c||(r="down")),r==="right"?r="down":r==="left"&&(r="up"),r==="down"?(f=h.next(),f.is(".app-group")&&(f=f.next())):r==="up"&&(f=h.prev(),f.is(".app-group")&&(f=f.prev())),b=f.find("a"),a=b.data("data-context"),a)h=f,o=b;else{if(b.is(".dv-load-at-top,.dv-load-at-bottom")){de(50);return}a=o.data("data-context")}a&&!h.is(".dv-load-at-top-parent,.dv-load-at-bottom-parent,.app-calculated")&&(e.find(".ui-btn.app-selected").removeClass("app-selected ui-btn-active"),n.lastTouch(!1),ut.tap(a,r==="enter"?null:"none"),n.lastTouch(!0),ae(s),o.addClass("app-selected ui-btn-active"),t.preventDefault(),r.match(/up|down/)&&ev(h,y,h))}}else it=dv(),it.length&&(i.move(it,rt===9?t.shiftKey?"up":"down":r),t.preventDefault())}t.isDefaultPrevented()||$(document).trigger($.Event("keyboardpreview.app",{originalEvent:t}))}}).on("keydown",function(t){var r,e,u,o,c;if(!t.isDefaultPrevented()){if(sh(),r=t.keyCode||t.which,r===27){if(it||hi){$(document).trigger($.Event("dragcancel.app",{drag:hi||it}));t.preventDefault();return}if(!yt()&&!i.popup(":visible")&&!l().is(".app-modal-keyboard")){if(e=$(".app-calendar-plugin-container"),e.length&&e.is(":visible"))return n.CalendarInput("escape"),!1;if(lf(!1))return t.preventDefault(),!1;if(ht.frame(":active")&&(u=ht.fieldElem(),u.closest(".dv-item-new").length&&u.closest(".ui-btn").trigger($.Event("vclick",{ctrlKey:!0})),ht.detach(!0),ni(u).data("skip-item-focus",!0),!di())||(o=dv(),o.length&&(o.removeClass("app-focus"),!di())))return!1;if(l().is(".app-page-modal"))return setTimeout(ou),t.preventDefault(),!1}}if(r===70&&(t.ctrlKey||t.metaKey))return f.search("enumerate"),!1;if(!ks(t)&&r===121&&i.valid()){t.preventDefault();var s=t.shiftKey,a=t.ctrlKey,h=s?n._contextButton:n._menuButton,v=$(".ui-panel-open");return $(".ui-popup-active").length?ds(!0):s||a||h.is(".ui-icon-bars")&&(!l().is(".app-page-modal")||ot())&&!v.length?(c=$.Event("showcontextmenu.app",{originalEvent:t}),$(document).trigger(c),c.isDefaultPrevented()||a||setTimeout(function(){vr();var n=dv();n.length&&s&&(h=ni(n).find(".app-echo-toolbar .app-btn-more"));h.trigger("vclick")})):lf(),!1}}}).on("mousedown",".app-hscrollbar2",function(t){if(!h){var r=$(this),e=r.find(".app-hscrollbar-handle").offset(),u=k(r.attr("data-view")),o,f,i;return u?(f=(u.session("scroll-left")||0)+(t.pageX<e.left?-1:1)*r.outerWidth(!0),o=u.session("grid-avail-width"),f=f<0?0:Math.min(f,o-r.outerWidth(!0)),n.scrollGrid(u,f),ht.sync({dataView:u,scrollIntoView:!1})):(i=r.prev(),i.attr("class").match(/-outer/)&&(i=i.children().first()),i.scrollLeft(i.scrollLeft()+(t.pageX<e.left?-1:1)*ie(i))),!1}}).on("mousedown",".app-vscrollbar",function(n){if(!h){var i=$(this),t;t=i.prev();t.attr("class").match(/-outer/)&&(t=t.children().first());t.scrollTop(t.scrollTop()+(n.pageY<i.find(".app-vscrollbar-handle").offset().top?-1:1)*t.height())}}).on("transitionend",".app-hidden",function(){var t=$(this).parent(),i,n;t.is(".app-data-list")&&(n=t.find('[data-index="new"]'),n.length&&(i=t.data("revealTimeout"),clearTimeout(i),t.data("revealTimeout",setTimeout(function(){n.parent().prevAll().remove();n.prevAll().remove();n.parent().removeClass("app-hidden")},50))))}).on("vclick",'[data-container="toggle"]',function(){var t=$(this),r=g(t),i,u;return t.addClass("ui-btn-active"),n.stub("put",r),i=t.parent().toggleClass("app-container-collapsed").is(".app-container-collapsed"),u=t.find(".app-collapsible-toggle-button"),n.toggleTooltip(u,!i),t.parent().find('[data-control="dataview"]').each(function(){ni($(this).attr("id")).css("display",i?"none":"")}),i||gc({controls:t.closest('[data-container="collapsible"]').data("node").children}),pu(),ht.sync(),n.stub("trim",r),setTimeout(function(){t.removeClass("ui-btn-active")},er),vi(),!1}).on("vclick",".app-field-object-ref",function(){var t=$(this),u=t.closest("[data-control]"),f=t.closest("[data-input-container]"),i,r;return i=k(f.attr("data-input-container")),i&&(r=i.findField(u.attr("data-field")),r&&kt(t,function(){n.details({field:r})})),!1}).on("vclick",".app-echo-see-all",function(){var t=$(this).addClass("ui-btn-active");return wo(t,!1),setTimeout(function(){t.removeClass("ui-btn-active");kp=!0;n.seeAll(t.closest(".app-echo").attr("data-for"))},er),!1}).on("vclick",".app-echo-toolbar a",function(t){var i=$(t.target),u=i.closest(".app-echo").attr("data-for");return we(i)&&!yt()&&i.is(".ui-icon-dots")&&(wo(i,!1),kt(i,function(){n.showContextMenu({scope:u,position:ot()&&r.splitLeft?"right":""})})),!1}).on("vclick",".app-sidebar ul",function(n){if(ku||!we(n.target))return!1;var t=$(n.target).closest("a"),i=t.data("context-action");if(t.length){if(i)return yt()||kt(t,function(){yf(i,t)}),!1;ur(t,!1)}}).on("vclick",".app-bar-buttons",function(n){var t=su(n.clientX);return ir(),$(n.target).closest(".app-btn-close").length?ou():$(this).find(".ui-btn").each(function(){var n=$(this),i=n.offset();if(n.is(":visible")&&t>=i.left-8&&t<=i.left+n.outerWidth()+8)return setTimeout(function(){n.trigger("vclick")}),!1}),!1}).on("vclick",".app-page-modal-title",function(t){var r,u=su(t.clientX);return ir(),r=$(t.target),r.is(".app-btn")||(r=null,$(this).find(".app-btn").each(function(){var n=$(this),t=n.offset();if(n.is(":visible")&&u>=t.left-8&&u<=t.left+n.outerWidth()+8){r=n;return}})),r&&(eu().blur(),i.keyboard(function(){kt(r,function(){var t,o;if(r.is(".ui-icon-dots"))n.showContextMenu();else if(r.is(".app-btn-search"))f.search();else if(r.is(".app-btn-close"))ou();else if(r.is(".app-btn-fullscreen")){t=!r.is(".app-btn-fullscreen-exit");o=l().data("last-focused-field");r.toggleClass("app-btn-fullscreen-exit",t).attr("data-title",e[(t?"Exit":"")+"Fullscreen"]).closest(".ui-page").toggleClass("app-page-modal-fullscreen",t);var u=n.dataView(),i=l(),s=i.width();t&&u&&u.session("zoomed",!0);pu(!0);et=!0;i.css("transform","scale("+s/i.width()+")");setTimeout(function(){i.css("transition","transform 100ms ease-in");setTimeout(function(){i.css("transform","");setTimeout(function(){i.css("transition","");et=!1;u&&(u.pageProp("zoomed",t?!0:null),t||u.session("zoomed",null));o&&te()},100)})})}})})),!1}).on("dblclick",".app-page-modal-title",function(){return $(this).find(".app-btn-fullscreen,.app-btn-fullscreen-exit").trigger("vclick"),!1}).on("dblclick",".app-page-header",function(){return $(this).prev().trigger("dblclick"),!1}).on("vclick",".app-btn-menu",ilt).on("vclick",".app-back-text",function(){return n._menuButton.trigger("vclick"),!1}).on("vclick contextmenu",".app-menu-strip ul",function(n){clearTimeout(nv);var t=$(n.target).closest(".ui-btn"),r=$(this).parent(),i=t.data("data-node"),u,f=i&&i.url&&!i.children;if(!n.autoOpen&&!h&&i&&i.url)return lf(!0),setTimeout(no,0,i,t),!1;if(!t.length||t.data("selected"))return ir(),!1;if(f){if(n.type==="contextmenu")return!1;t.addClass("app-selected")}return u=r.find(".app-selected").removeClass("app-selected"),kt(t,function(){if(f)no(i)||(t.removeClass("app-selected"),u.addClass("app-selected"));else{if(t.data("selected"))return;var e=[],n=[];i?h?n.push(i):i.children.forEach(function(t){n.push(t)}):(depth=0,i={children:[]},r.find("li:hidden a").each(function(){n.push($(this).data("data-node"))}));n.length!==1||n[0].url||(n=n[0].children);ff(e,!0,n,1);yr({arrow:!1,x:t.offset().left+1,y:t.offset().top+t.outerHeight()-2,anchor:t.data("selected",!0),items:e,afteropen:function(n){var t=n.addClass("app-popup-menu app-popup-menu-main").find(".ui-panel-inner"),i=t.find(".app-item-selected");i.length&&t.offset().top+t.height()<i.offset().top+i.outerHeight()&&t.scrollTop(i.offset().top-t.offset().top-(t.height()-i.outerHeight())/2)},afterclose:function(){t.removeData("selected")}})}}),!1}).on("vclick",".StatusBar .Segment",function(){var n=$(this).text();return setTimeout(function(){ve("select",{text:n})}),!1}).on("vclick",".app-page-modal-glass-pane-partial",function(){return setTimeout(ou),!1}).on("vclick",".app-page-modal-glass-pane,.app-page-modal-background",function(){var u,i,r,o;if(ir(),u=n.pageInfo(),i=u.dataView,i&&i._inlineEditor){var s=this,f=ki,e=$(".app-page-modal-glass-pane,.app-page-modal-background"),t;if(e.css("visibility","hidden"),t=$(document.elementFromPoint(f.x,f.y)),e.css("visibility",""),t.length){if(t.is(".app-btn-more")&&t.closest(".app-selected").length||t.is(".app-btn-context"))return rh().find(".app-icon.app-btn-more").trigger("vclick"),!1;if(r=$.Event("datainputmove.app",{direction:t}),$(document).trigger(r),r.isDefaultPrevented())return}}i&&i.tagged("modal-tap-out")?ou():(o=l().toggleClass("app-page-modal-centered"),setTimeout(function(){o.toggleClass("app-page-modal-centered")},100))}).on("vclick",".app-sidebar .app-bar-toolbar-bottom .ui-btn",function(n){var t=$(n.target).closest(".ui-btn");return t.is(".app-selected")||(t.is(".app-btn-page")&&t.closest(".app-bar-toolbar-bottom").find(".ui-btn").removeClass("app-selected"),kt(t,function(){var n=t.data("context");n?(t.addClass("app-selected"),no(n)):t.is(".app-btn-apps")?ip():t.is(".app-btn-settings")&&wy("left")})),!1}).on("focusout",".app-sidebar .ui-panel-inner",function(){$(this).find(".app-focus").removeClass("app-focus ui-btn-active")}).on("vclick",".app-bar-search",function(){var u=$(this),t,r,i;return($(this).find(".app-icon").each(function(){var n=$(this),i=su(),r=n.offset();if(r.left<=i&&i<r.left+n.outerWidth())return t=n,!1}),t)?(r=n.contextDataView(),i=r.survey().context.id,kt(t,function(){t.is(".material-icon-cancel")?(ft().blur(),t.closest(".app-bar-search").addClass("app-null"),wi({QuickFind:null}),bi(),f.search("autoComplete",{id:i,dataInput:u.find('[data-field="QuickFind"]')})):t.is(".material-icon-search")?f.action({path:"form/submit"}):t.is(".material-icon-more")&&f.search("toggle",i)}),!1):ft().length?void 0:(bi(),!1)}).on("mousedown pointerdown touchstart",".app-control-toolbar",function(){y.range("save");y.focus();ft().data("keepFocus",!0)}).on("vclick",".app-control-toolbar",function(n){var t=$(n.target),u,h=su(n.clientX),s,f,o,c;if(t.is(".app-has-droparrow"))f=ft().data("keepFocus",!0).blur(),s=i.elementToField(f),t.addClass("app-selected"),f.data("keepFocus",!0),y.range("restore",{force:!0}),setTimeout(function(){var i=t.data("group"),n=[];i.list.forEach(function(t){var i=t.command,u=t.argument,r=t.icon,f;y.allow(s,t)&&i&&(f=y.toText(i,u),n.push({text:f,icon:r?"material-icon-"+r:r,context:{c:i,a:u},callback:y.exec}))});yr({anchor:t,items:n,y:t.offset().top+t.outerHeight(),afterclose:function(){t.removeClass("app-selected");y.focus()}})},er);else{if(t.is(".app-control-toolbar-more"))return f=ft().data("keepFocus",!0).blur(),o=[],u=t,st(f,".app-control-toolbar").find(".app-has-droparrow,i,.app-divider").each(function(){var n=$(this),t=n.data("group"),r=n.data("command"),i=n.data("icon");t?o.push({text:t.text,icon:!1,transition:!0,callback:function(){var n=[{text:e.Back,icon:ui,callback:function(){ti(o,"#app-rtf",c)}},{}];t.list.forEach(function(t){var i=t.command,r=t.argument,u=t.icon;i&&y.allow(s,t)&&n.push({text:y.toText(i,r),icon:u?"material-icon-"+u:!1,context:{c:i,a:r},callback:y.exec})});ti(n,"#app-rtf-1",{close:y.focus})}}):r?o.push({text:n.data("text"),shortcut:n.data("shortcut"),icon:i?"material-icon-"+i:!1,context:{c:n.data("command"),a:n.data("argument")},callback:y.exec,disabled:n.is(".app-disabled"),state:n.is(".app-selected")}):o.push({})}),t.addClass("app-active"),f.data("keepFocus",!0),y.range("restore",{force:!0}),setTimeout(function(){t.removeClass("app-active");var n=y.range(),i=n?r.width-325>f.offset().left+gt(n).right?"right":"left":"right";ti(o,"#app-rtf",{position:i,close:y.focus})},er),!1;t.is(".app-shim-more")||$(this).find("i").each(function(){var n=$(this),t=n.offset();if(h>=t.left-4&&h<=t.left+n.outerWidth()+4)return u=n,!1})}return u&&u.length&&!u.is(".app-disabled")&&(wu||ft().data("keepFocus",!0).blur(),u.addClass("app-active"),setTimeout(function(){u.removeClass("app-active");y.range("restore");y.focus();y.range("exec",{command:u.data("command"),argument:u.data("argument")})},er)),!1}).on("mousedown pointerdown touchstart",".app-has-rtf",function(n){if($(n.target).is(".app-has-rtf,.app-data-input-placeholder"))return!1}).on("rtfeditorsubmit.dataview.app",function(n){y.document("blur");var t=n.dataView,i=t.data(),r=n.survey.context.field;t.discard();tr(function(){wi({name:r,value:i.text})})}).on("touchstart pointerdown mousedown",".app-glass-pane",function(n){n.type==="mousedown"&&h||$(this).addClass("app-glass-pane-reject");nh(n);n.preventDefault();n.stopPropagation()}).on("mouseenter",".app-desktop .app-vscrollbar",function(){var n=$(this).data({hover:!0,time:ai()});!n.is(".app-scrollbar-hover")&&lt("ui.scrollbars.expand")&&setTimeout(function(){n.data("hover")&&(n.addClass("app-scrollbar-hover"),ng||(ng=setInterval(pet,200)))},200)}).on("mouseleave",".app-vscrollbar",function(){$(this).removeData("hover").data("time",ai())}).on("mouseenter",".app-menu-strip .ui-btn",function(n){h||(clearTimeout(nv),nv=setTimeout(function(){var t=$(n.target);t.is(".app-has-children")?t.trigger($.Event("vclick",{autoOpen:!0})):t.closest(".app-menu-strip").length&&ds(!0,".app-popup-menu")},$(".ui-popup-active .app-popup-menu").length?100:350))}).on("mouseleave",".app-menu-strip .ui-btn",function(){if(!h){clearTimeout(nv);var n=$(this);n.data("selected")||ds(!0,".app-popup-menu")}}).on("mousedown",".ui-popup-screen,.app-menu-strip,.app-logo,.app-bar-toolbar,.app-bar-buttons",function(t){function f(){var n=$.Event("vclick"),t=ki.x,i=ki.y;n.pageX=n.clientX=t;n.pageY=n.clientY=i;$(document.elementFromPoint(t,i)).trigger(n)}var r,u=$(t.target),i=$(".app-popup");if(!h&&i.length&&!t.button)return r=!u.closest(".app-bar-toolbar").length&&!i.find(".app-popup-panel").length,u.is(".ui-popup-screen")&&to(i),r&&n.invokeInTargetPage(f),!1}).on("vclick",".app-bar-tabs li",function(){var n=$(this),t=n.data("item");return t?no(t.context):ip("right",!1,!0),f._navigated&&(n.parent().find(".app-selected").removeClass("app-selected"),n.addClass("app-selected")),!1}).on("mousedown touchstart pointerdown",".ui-panel-dismiss",function(){return setTimeout(ps,0,$(".ui-panel-open")),!1}).on("vclick",".ui-panel",function(n){var u=$(this),t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(ku||!t.length||!we(t))return!1;if(i=t.data("context-action"),i&&!fg){if(i.dataRel)return!0;i.feedback===!1?(ur(),i.keepOpen===!0||i.transition?(yf(i,t,!0),eb(t)):(ps(u,r!=="dots"&&r!==ui),oo=function(){setTimeout(function(){yf(i,t)},10)})):i.keepOpen===!0||i.transition?kt(t,function(){yf(i,t,!0);eb(t)}):kt(t,function(){var n,f,o,e;i.icon===ui&&(n=t.closest(".ui-panel-inner").find("ul"),f=n.first());n&&n.length>1?(yu(!1),o=f.parent().addClass("app-list-container-reverse").css({transition:"",transform:"translate3d("+-(-d(f,"margin-right")+f.closest(".ui-panel").outerWidth()*(n.length-2))+"px,0,0)"}).one("transitionend",function(){setTimeout(function(){n.last().remove();o.removeClass("app-list-container-reverse");nrt($(n[n.length-2]).find(".app-focus"));yu(!0)})})):(e=t.attr("href"),e?b.location.href=e:(ps(u,r!=="dots"&&r!==ui),oo=function(){setTimeout(function(){yf(i,t)},ny()?10:er)}))})}return fg=!1,!1}).on("vclick",".app-virtual-screen",function(){return lf(),!1});y={list:[],groups:[{list:[{command:"undo",key:"Ctrl+Z",metaKey:!0,icon:"undo",toolbar:!1},{command:"redo",key:"Ctrl+Y",icon:"redo",toolbar:!1},{command:"redo",key:"Meta+Shift+Z",toolbar:!1,hidden:!0}]},{text:ya.Format,list:[{command:"formatBlock",argument:"p",icon:"short-text"},{command:"formatBlock",argument:"blockquote",icon:"format-quote"},{command:"formatBlock",argument:"h1",icon:"title"},{command:"formatBlock",argument:"h2"},{command:"formatBlock",argument:"h3"},{command:"formatBlock",argument:"h4"},{command:"formatBlock",argument:"h5"},{command:"formatBlock",argument:"h6"}]},{list:[{command:"bold",key:"Ctrl+B",metaKey:!0,icon:"format-bold"},{command:"italic",key:"Ctrl+I",metaKey:!0,icon:"format-italic"},{command:"underline",key:"Ctrl+U",metaKey:!0,icon:"format-underlined"},{command:"strikethrough",key:"Alt+Shift+5",metaKey:!0,icon:"strikethrough-s"}]},{list:[{command:"insertUnorderedList",icon:"format-list-bulleted"},{command:"insertOrderedList",icon:"format-list-numbered"}]},{list:[{command:"justifyLeft",key:"Ctrl+L",metaKey:!0,icon:"format-align-left"},{command:"justifyCenter",key:"Ctrl+E",metaKey:!0,icon:"format-align-center"},{command:"justifyRight",key:"Ctrl+R",metaKey:!0,icon:"format-align-right"},{command:"justifyFull",key:"Ctrl+J",metaKey:!0,icon:"format-align-justify"}]},{list:[{command:"indent",icon:"format-indent-increase",key:"Ctrl+]",which:221},{command:"outdent",icon:"format-indent-decrease",key:"Ctrl+[",which:219}]},{list:[{command:"removeFormat",icon:"format-clear"},{command:"rtf",argument:"editor",icon:"fullscreen",key:"F11"}]}],status:{undo:!0,redo:!0,indent:!0,outdent:!0},init:function(){y.groups.forEach(function(n){n.list.forEach(function(n){y.list.push(n)})})},allow:function(n,t){if(!n&&(n=i.elementToField(ft()),!n))return!1;var f=n.Tag,r,e=t.command,u=t.argument;return e==="rtf"&&u==="editor"&&n._dataView._controller==="rtfeditor_sys"?!1:!f||!f.match(/\brtf\-command\-/)?!0:(r=e,u&&(r+="-"+u),n.is("rtf-command-"+r))},document:function(n){var t=ft(),i=t.is("iframe")?t[0].contentDocument:null,r,u;return i&&(n==="focus"?i.body.focus():n==="blur"&&(r=t.offset(),u=cr("input").css({borderWidth:0,position:"absolute",left:r.left,top:r.top}).appendTo(t.parent()).focus(),t.blur(),u.remove(),ir())),i},window:function(n){var i=ft(),t=i.is("iframe")?i[0].contentWindow:null;return t&&n==="selection"&&(t=t.getSelection()),t},toText:function(n,t){var i=ya[n.substring(0,1).toUpperCase()+n.substring(1)];return typeof i!="string"&&(i=i[t]),i},range:function(n,t){var u,r,i,o,k,f,rt,g,nt,h,lt,e,l,ut,a,v,et,ot;if(n||(n="get"),n==="save"){y._range=y.range();return}if(n==="clear"){y._range=null;return}if(u=y.window("selection"),n==="get")return u&&u.getRangeAt&&u.rangeCount?u.getRangeAt(0):null;if(r=y.document(),i=y._range,n==="restore"){if(t&&t.force){if(i&&i.startOffset===i.endOffset){var it=gt(i),ht=ft(),ct=ht.offset();o=s("app-rtf-cursor").appendTo(c).css({left:ct.left+it.left,top:ct.top+it.top+d(ht,"padding-top"),height:it.height}).data("blink",setInterval(function(){o.css("display",o.css("display")!=="none"?"none":"")},500))}}else o=$(".app-rtf-cursor"),clearInterval(o.data("blink")),o.remove();if(i&&u){try{u.removeAllRanges()}catch(at){r.body.createTextRange().select();r.selection.empty()}try{u.addRange(i)}catch(at){y._range=null}}}else if(n==="insert"){if(k=!0,f=t&&t.tag,f)return f==="p"&&i.endContainer.parentNode.tagName==="P"?i.startOffset===i.endOffset&&i.startContainer==i.endContainer&&i.endContainer.nodeName==="#text"&&i.endContainer.length===i.endOffset&&(i.endContainer.nextSibling==null||i.endContainer.nextSibling.tagName!=="BR")&&(rt=i.endContainer.parentNode.nextSibling,i.setStartBefore(rt,0),i.setEndBefore(rt,0),i.collapse(),g=r.createElement("p"),i.insertNode(g),i.setStart(g,0),i.setEnd(g,0),i.collapse(),nt=r.createElement("br"),i.insertNode(nt),i.setStartBefore(nt),i.setEndBefore(nt),i.collapse(),u.removeAllRanges(),u.addRange(i),k=!1):f==="br"?(h=r.createElement(f),i.deleteContents(),lt=i.startOffset===i.endOffset&&i.startContainer==i.endContainer&&i.endContainer.nodeName==="#text"&&i.endContainer.length===i.endOffset&&(i.endContainer.nextSibling==null||i.endContainer.nextSibling.tagName!=="BR"&&i.endContainer.nextSibling.nodeName!=="#text"),i.insertNode(h),lt&&(h=r.createElement(f),i.insertNode(h)),i.setStartAfter(h),i.setEndAfter(h),i.collapse(!1),u.removeAllRanges(),u.addRange(i),k=!1):((r.queryCommandState("insertUnorderedList")||r.queryCommandState("insertOrderedList"))&&(f="li"),r.execCommand("formatBlock",!1,f)),ft().trigger("rtfchanged"),k}else if(n==="exec"&&t){if(e=t.command,l=t.argument,e==="rtf"){y.allow(null,t)&&(y.range("restore"),y[l]());return}if(t.validate&&e&&!e.match(/^(undo|redo)$/)&&!y.allow(null,t))return;y.range("restore");e==="formatBlock"&&l?r.execCommand(e,0,l)||r.execCommand(e,0,"<"+l+">"):r.execCommand(e,0,l);r.body.focus();y.range("status");ft().trigger("rtfchanged")}else if(n==="focus")y.range("restore"),ft().is(":focus")||ft().focus(),y.document("focus");else if(n==="status")st(ft(),".app-control-toolbar i").each(function(){var t=$(this),n=t.data("command");if(n&&n!=="rtf")try{t.toggleClass("app-selected",r.queryCommandState(n));y.status[n]?t.toggleClass("app-disabled",!r.queryCommandEnabled(n)):t.toggleClass("app-selected",r.queryCommandState(n))}catch(i){}});else if(n==="select"){var p=t.x,tt=t.y,w=t.x2,b=t.y2;if(p==null)return null;try{return w==null&&(w=p),b==null&&(b=tt),ut=y.window(),i=null,typeof r.caretPositionFromPoint!="undefined"?(a=r.caretPositionFromPoint(p,tt),v=r.caretPositionFromPoint(w,b),i=r.createRange(),i.setStart(a.offsetNode,a.offset),i.setEnd(v.offsetNode,v.offset)):typeof r.caretRangeFromPoint!="undefined"&&(a=r.caretRangeFromPoint(p,tt),v=r.caretRangeFromPoint(w,b),i=r.createRange(),i.setStart(a.startContainer,a.startOffset),i.setEnd(v.startContainer,v.startOffset)),i!==null&&typeof ut.getSelection!="undefined"?(et=ut.getSelection(),et.removeAllRanges(),et.addRange(i)):typeof r.body.createTextRange!="undefined"&&(i=r.body.createTextRange(),i.moveToPoint(p,tt),ot=i.duplicate(),ot.moveToPoint(w,b),i.setEndPoint("EndToEnd",ot),i.select()),i}catch(at){return null}}},exec:function(n){y.range("exec",{command:n.c,argument:n.a})},focus:function(){y.range("focus")},editor:function(n){var t,u,h,e,o,s=[],c,l;if(n?(t=dt().findField(n.field),e=n.type):t=i.elementToField(st(ft())),o=t.Tag,o)for(c=/\brtf\-command\-(.+?)(\s|$)/g;l=c.exec(o);)s.push(l[0]);u=t.Name;y.document("blur");h=t._dataView.data();cf(e?null:u);f.survey({controller:"rtfeditor_sys",context:{field:u},text:t.HeaderText,text2:uc.Scopes.Form.Edit.HeaderText,questions:[{name:"text",rows:5,mode:"rtf",value:h[u],tags:s.length?s.join(" "):null}],layout:'<div data-container="simple" data-wrap="true" class="app-rtf-editor"><div data-container="row"><span data-control="field" data-field="text"><\/span><\/div><\/div>',options:{modal:{fullscreen:e?e==="fullscreen":r.width<=oi("xl")},materialIcon:"edit"},submit:"rtfeditorsubmit.dataview.app",submitKey:"Ctrl+Enter",submitText:cp.SaveButton})},scrolled:function(){y.toolbar("position")},blur:function(n){var t=ft(st(n.target));!t.is("iframe")||t.is(n.target)||ku||(kl(!1),t.blur(),kl(!0))},autoSize:function(){if(y.document()){var t=ft(),u=st(t),r=u.find(".app-control-inner"),f,n=sv(t),e=r.html(),o;e!==n&&(o=r.height(),r.html(n.length?n:i.fieldToPlaceholder(i.elementToField(t))||"&nbsp;"),e=n,o!==r.height()&&(t.parent().scrollTop(0),uu(),y.range("save")),f=u.find(".app-data-input-placeholder"),f.css("display",n.length?"none":""))}},handlers:function(t,r){var u=t[0].contentDocument,f=$(u);if(r){t.on("rtfchanged",y.autoSize);$(document).one("focusin touchend",y.blur);$(document).on("scroll.app scrollstop.app resized.app",y.scrolled);f.on("keydown","body",function(r){var u,o,f,e;if(sh(),u=r.originalEvent.key,f=r.shiftKey,u==="Enter"&&(o=y.range("insert",{tag:f?"br":"p"}),!o))return!1;if(u==="Tab")return setTimeout(function(){var n=st(ft());i.blur();i.move(n,f?"up":"down")}),!1;if(u==="F10")return f?n.showContextMenu():st(t,".app-control-toolbar-more").trigger("vclick"),!1;if(u&&u.match(/^Esc/))return e=$.Event("keydown"),e.which=27,t.trigger(e),!1;ks(r,!0)&&y.autoSize()}).on("mouseup keyup mouseout","body",function(){y.range("save");y.range("status")}).on("touchend","body",function(){setTimeout(function(){y.range("save");y.range("status")},100)}).on("paste","body",function(n){if(n.originalEvent&&n.originalEvent.clipboardData&&n.originalEvent.clipboardData.getData){n.preventDefault();var t=n.originalEvent.clipboardData.getData("text/plain");u.execCommand("insertText",!1,t)}else n.clipboardData&&n.clipboardData.getData?(n.preventDefault(),t=n.clipboardData.getData("text/plain"),u.execCommand("insertText",!1,t)):b.clipboardData&&b.clipboardData.getData&&(b._rtfLock||(b._rtfLock=!0,n.preventDefault(),u.execCommand("ms-pasteTextOnly",!1)),b._rtfLock=!1);y.autoSize()}).on("keyup","body",y.autoSize)}else y.range("clear"),f.off(),t.off("rtfchanged"),$(document).off("scroll.app scrollstop.app resized.app",y.scrolled)},toolbar:function(n,t){function l(){if(r=t.find(".app-control-toolbar"),!r.length){o=t.find(".app-control-inner");f=i.elementToField(t);f.is("rtf-frame")&&(u=p("app-control-frame app-hidden").insertBefore(o));r=p("app-control-toolbar app-hidden");u||r.addClass("app-control-toolbar-noframe");y.groups.forEach(function(n){var t,u=n.list,i=n.text;i?$(u).filter(function(){return y.allow(f,this)}).length&&(t=s("app-has-droparrow").text(i).attr("title",i).data("group",n).appendTo(r)):u.forEach(function(n){var e=n.command,h=n.argument,c=n.toolbar!==!1,o=n.icon,s,u,i;!n.hidden&&e&&y.allow(f,n)&&(s=y.toText(e,h),u=n.key,o?(i=bt("material-icon-"+o,r).attr("title",s+(u?" ("+u+")":"")),c||i.addClass("app-hidden")):i=vs("app-hidden").appendTo(r),i.data({command:e,argument:h,icon:o,text:s,shortcut:u}),t=i)});t&&(button=s("app-divider").appendTo(r),t.is(".app-hidden")&&button.addClass("app-hidden"))});f.is("rtf-more-none")||(s("app-shim-more").appendTo(r),bt("material-icon-more-"+(wu?"vert":"horiz"),r).addClass("app-control-toolbar-more").attr("title",fr+" (F10)"));var l=f.is("rtf-toolbar-location")==="bottom"?"bottom":h?"bottom":"top",n={bar:r,frame:u,location:l,defaultLocation:l};n.defaultLocation=n.location;t.data("toolbar",n);e();c(t);setTimeout(function(){u&&u.removeClass("app-hidden");r.removeClass("app-hidden")})}}function e(){var f=t.find(".app-control-inner"),u=t.data("toolbar"),i=u.bar,r=u.frame,n;i.insertBefore(f);n=i.outerHeight();u.location==="top"?(n=-n,r&&r.css({top:n,bottom:""})):(i.insertAfter(f),r&&r.css({top:"",bottom:-n}),n=0);i.css("margin-top",n)}function c(n,t){n||(n=st(ft()));var f=g(),o=f.offset(),i=n.data("toolbar"),r,u;i&&(t&&(i.location=i.defaultLocation,e()),r=i.bar,u=r.offset(),(u.top<o.top||u.top+r.outerHeight()>o.top+f.height())&&(i.location=i.location==="bottom"?"top":"bottom",e()))}function a(){r=t.data("toolbar");r&&(r.bar.find("i,.app-has-droparrow").removeData(),r.bar.remove(),u=r.frame,u&&u.remove(),t.removeData("toolbar"))}var o,f,r,u;t||(t=st(ft()));n==="create"?l(t):n==="position"?c(t,!0):a(t)}};is.registerClass("Web.DataView.MobileGrid",nc);tc.registerClass("Web.DataView.MobileForm",nc)})();