/*!
* Data Aquarium Framework - Display Flow for Touch UI
* Copyright 2021 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function k(n){return t.scrollable(n).data("displayFlow")}function g(n){n=$(n);var t=n.data("index"),i=k(n);return i.flow[t]}function s(n){return t.activePage(".app-display-flow-designer "+n)}function u(){return s(".app-container-selected")}function r(i,r,u){i=i==="top"?n.top:n.bottom;i.is(":empty")&&w("app-btn-separator").appendTo(i);t.icon("material-icon-"+(u||r),w("app-btn app-btn-"+r).appendTo(i)).attr("data-title",{drag:"Drag",settings:"Settings",edit:"Edit",cut:"Cut","delete":"Delete",copy:"Copy","insert-before":"Insert Before","insert-after":"Insert After","paste-before":"Paste Before","paste-after":"Paste After"}[r]);w("app-btn-separator").appendTo(i)}function e(t,i,r){n&&(r?r.find(".app-btn-"+t).toggleClass("app-hidden",!i):(e(t,i,n.top),e(t,i,n.bottom)))}function h(){v=!1;var i=u(),f=t.scrollable(),a=y(f),p=f.scrollTop(),o,h,c,l;i.length?(n||(n={top:b("app-display-flow-toolbar app-display-flow-toolbar-top").appendTo(f),bottom:b("app-display-flow-toolbar app-display-flow-toolbar-bottom").appendTo(f)},r("top","drag","drag_indicator"),r("top","settings"),r("top","edit"),r("top","copy","content_copy"),r("top","cut","content_cut"),r("top","delete","delete_outline"),r("top","insert-before","add"),r("top","paste-before","content_paste"),r("bottom","drag","drag_indicator"),r("bottom","insert-after","add"),r("bottom","paste-after","content_paste")),o=y(i),h=y(i[i.length-1]),n.top.show().css({left:o.left-2,top:o.top-n.top.height()-3+p-a.top}),n.bottom.show().css({left:h.left-2,top:h.bottom+3+p-a.top}),c=!i.first().is(".app-container-cut")&&s(".app-container-cut").length,e("paste-before",c),e("paste-after",c),e("cut",i.filter(":not(.app-container-cut)").length),l=i.length===1,e("edit",l),e("settings",l)):n&&(n.top.hide(),n.bottom.hide())}var o=$app,t=o.touch,f,c=Web.DataViewResources.Mobile,l=$(document),a,v,n,y=o.clientRect,d=[],p,i=o.html,nt=i.tag,tt=i.div,it=i.span,rt=i.$tag,ut=i.$p,b=i.$div,w=i.$span,ft=i.$a,et=i.$i,ot=i.$li,st=i.$ul;f=o.display.designer={attach:function(){t.activePage(".app-display-flow").addClass("app-display-flow-designer")},selectionChanged:function(){var n=k();n&&l.trigger($.Event("displaydesignerselectionchanged.app",{flow:n.flow,selection:u()}))},saveState:function(){var n=t.scrollable();p||(p=JSON.parse(n.data("originalFlow")));d.push(JSON.stringify(p))},cut:function(){s(".app-container-cut").removeClass("app-container-cut");u().addClass("app-container-cut");h()},paste:function(){var n=u();f.saveState()},pasteAfter:function(){f.paste(!0)},pasteBefore:function(){f.paste()},settings:function(){o.survey({values:{flow:"row",jumbo:!1},questions:[{name:"flow",text:"Flow",required:!0,items:{list:[{value:"column",text:"Column"},{value:"row",text:"Row"}]}},{name:"jumbo",text:"Jumbo",type:"bool",required:!0,items:{style:"DropDownList"}}],options:{modal:{dock:"right",max:"xxs",gap:!1,tapOut:!0},discardChangesPrompt:!1}})}};l.on("mousedown vclick",".app-display-flow-designer .app-container",function(n){var i=$(this),o=i.data("index"),a=g(i),h,r,e,l;if(a&&!a.readOnly){if(n.type==="mousedown"){if(t.pointer("touch"))return;$.touch.skipMouseEnd=!0}return i.is(".app-container-selected")&&!n.ctrlKey&&!n.shiftKey&&u().length===1?void 0:(n.ctrlKey?i.toggleClass("app-container-selected",!i.is(".app-container-selected")):(n.shiftKey?(h=u(),h.length&&(r=h.first().data("index"),e=h.last().data("index"),o<r?r=o:e=o)):r=e=o,u().removeClass("app-container-selected"),r===e?i.addClass("app-container-selected"):s(".app-container").each(function(){var n=$(this),t=n.data("index");r<=t&&t<=e&&n.addClass("app-container-selected")})),l=u().length,f.selectionChanged(),t.notify({force:!0,text:String.format(l>1?c.ItemsSelectedMany:c.ItemsSelectedOne,l)}),!1)}t.notify({force:!0,text:"This display object is read-only."})}).on("vclick","article",function(){var n=u().removeClass("app-container-selected app-container-cut");n.length&&(f.selectionChanged(),t.notify({force:!0,text:String.format(c.ItemsSelectedMany,0)}))}).on("displaydesignerselectionchanged.app",function(){if(a){l.one("resized.app",h);v=!0}else h()}).on("resizing.app",function(){n&&(n.top.hide(),n.bottom.hide());a=!0}).on("resized.app",function(){v||h();a=!1}).on("vclick",".app-display-flow-toolbar .app-btn",function(){for(var r=$(this),n=r.attr("class").match(/\bapp-btn-([\w\-]+)/)[1],i=n.indexOf("-");i>0;)n=n.substring(0,i)+n.charAt(i+1).toUpperCase()+n.substring(i+2),i=n.indexOf("-");return f[n]?f[n]():t.notify({force:!0,text:n}),!1})})();